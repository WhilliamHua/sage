C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE SHARK
OBJECT MODULE PLACED IN .\shark.obj
COMPILER INVOKED BY: D:\Program Files\keil\C51\BIN\C51.EXE ..\src\shark.c BROWSE DEBUG OBJECTEXTEND CODE SYMBOLS PRINT(.
                    -\shark.lst) OBJECT(.\shark.obj)

line level    source

   1          #include "stdarg.h"
   2          #include "stdio.h"
   3          #include "stdlib.h"
   4          #include "type_def.h"
   5          #include "REG52x2.h"
   6          #include "common.h"
   7          #include "reg_def.h"
   8          #include "ncq.h"
   9          #include "buf_cmd.h"
  10          #include "sata_proc.h"
  11          #include "ata_cmd.h"
  12          #include "shark.h"
  13          #include "uart.h"
  14          #include "chp.h"
  15          #include "smart.h"
  16          #include "trim.h"
  17          #include "security.h"
  18          
  19          #include "uart.c"
  20          #include "sata_proc.c"
  21          #include "ata_cmd.c"
  22          #include "ncq.c"
  23          #include "buf_cmd.c"
  24          #include "debug.c"
  25          #include "chp.c"
  26          #include "smart.c"
  27          #include "trim.c"
  28          #include "security.c"
  29          
  30          //u8 security_nd_chk ;
  31          
  32          void main()
  33          {       
  34   1               init(0x00);
  35   1               
  36   1               /* wait EFM32 to choose a partition or ATA password is supported*/
  37   1               #ifdef GPIO_security
  38   1              GPIO_security_init();    
  39   1               //security_nd_chk = security_cmd_info_read(scl_security_nd_chk);//security function need or not 
  40   1               //myprintf("\nsysmode:%c",security_nd_chk);
  41   1               
  42   1               //while(/*(security_nd_chk=='Y') && */(!g_security_enable) && (security_mode !=show_master) && (security
             -_mode !=show_user) && (security_mode !=show_all))
  43   1               //     {
  44   1               //     GPIO_security_cmd(1);
  45   1              //      myprintf("\nwait chk");
  46   1              //      uart_show=0x1;
  47   1              // }
  48   1               //init();
  49   1               #endif
  50   1               
  51   1                 
  52   1          while(1)
  53   1          {
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 2   

  54   2        
  55   2              #ifdef SUPER_ERASE
  56   2      
  57   2              #ifdef GPIO_security
  58   2              if((security_mode !=show_master) && (security_mode !=show_user) && (security_mode !=show_all))
  59   2              {
  60   3                      g_security_lock=1;
  61   3                      GPIO_security_cmd(0x01);
  62   3              }
  63   2              else
  64   2              {
  65   3                      g_security_lock=0;
  66   3                      if(g_SYS_YD==0x01)
  67   3                      {
  68   4                        GPIO_security_cmd(0x00);
  69   4                      }
  70   3                      else
  71   3                      {       myprintf("\nwhile erase");
  72   4                        GPIO_security_cmd(0x01);
  73   4                      }
  74   3              }
  75   2                      
  76   2              #endif
  77   2              
  78   2              
  79   2              if((security_erase==show_master) ||(security_erase==show_user))
  80   2                      {
  81   3                      security_cmd_info_write('N', scl_security_nd_chk);//need reconfig
  82   3                      myprintf("\nes0");
  83   3                      intial_data_partition(0);//erase partition
  84   3                      security_erase=0x00;
  85   3                      myprintf("\ned0");
  86   3              }
  87   2              else if(security_erase==show_all)
  88   2                      {
  89   3                      security_cmd_info_write('N', scl_security_nd_chk);//need reconfig
  90   3                      myprintf("\nes0");
  91   3                      intial_data_partition(1);//erase partition
  92   3                      security_erase=0x00;
  93   3                      myprintf("\ned1");
  94   3              }
  95   2      
  96   2      
  97   2               if(uart_show)
  98   2                      {
  99   3                        if(security_mode == show_master)
 100   3                              {
 101   4                              myprintf("\nmaster mode");
 102   4                              uart_show=0;
 103   4                        }
 104   3                        else if(security_mode == show_user)
 105   3                              {
 106   4                              myprintf("\nuser mode");
 107   4                              uart_show=0;
 108   4                        }
 109   3                        else if(security_mode == show_all)
 110   3                              {
 111   4                              myprintf("\nzsd mode");
 112   4                              uart_show=0;
 113   4                        }
 114   3                        tx_fis_A1(status_good, error_no, int_set);
 115   3      
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 3   

 116   3                        init(0x01);
 117   3                      }
 118   2      
 119   2               #endif
 120   2               
 121   2              #ifdef security_debug
                        myprintf("\rSV:%x",SFR_spi_io);
                      #endif
 124   2      
 125   2              #ifdef BUF_CMD_EN
                          //todo: if NCQ error, need additional control here???
                              cmd_buffer_check();
                      #endif
 129   2              //check new fis received from host(exclude data fis)
 130   2              //sata.led0_cntl = 0x80;      //rom is using 0xd4
 131   2              if(g_current_fis_num != SFR_fis_num)
 132   2              { 
 133   3                  //sata.led0_cntl = 0x00;      //rom is using 0xd4
 134   3                  sata.led0_blink = 0x44;
 135   3                  //myprintf("\nSR0:%x",SFR_FIS0_1);
 136   3                  //todo: add an led1 here.
 137   3                  //myprintf("\nfine a new cmd:%x",SFR_FIS0_2);
 138   3                  
 139   3                  g_current_fis_num = SFR_fis_num;
 140   3                  
 141   3                  //clear the fis27 flag.
 142   3                  sata.ncq_cntl = (sata.ncq_cntl & (~ncq_cntl_new_fis27));
 143   3                  
 144   3                  //if in SLEEP mode, only respond to SRST. Please refer to ATA8 Charpter 7.55.2
 145   3                  
 146   3                              //TODO: need to open this after this is tested.
 147   3                  //if(g_power_mode == power_mode_sleep)goto check_control; 
 148   3      
 149   3                              
 150   3                  #ifdef SUPPORT_NCQ
                          if(g_ncq_halt)
                          {
                             if(check_ncq_read_log);
                             //else goto Over;
                             else continue;
                          }
                                      #endif
 158   3                  
 159   3                  //open the CHP clock
 160   3                  chp_clock_on();
 161   3                              
 162   3                  #ifdef SUPPORT_SMART1
 163   3                  if(g_smart_power_down_flag == 1)
 164   3                  {
 165   4                      updata_smart(smart_power_down_addr,0x01);
 166   4                      g_smart_power_down_flag = 0;
 167   4                      reset_engine();
 168   4                  }
 169   3                  #endif
 170   3      
 171   3                  //this will load the sector count
 172   3                  check_sec_cnt();
 173   3                  //myprintf("\nsec_cnt:%x",g_sec_cnt.byte.l);
 174   3                  check_lba();
 175   3                      //myprintf("\nLBAchk0:%x");
 176   3                      
 177   3                  if(SFR_quick_cmd!=0)
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 4   

 178   3                  {
 179   4                      #ifdef SUPPORT_SECURITY
 180   4                      //analyze_states();
 181   4                      g_security_prepared = 0;
 182   4                      if(g_security_lock == 1) 
 183   4                      {
 184   5                      tx_fis_34(status_bad, error_abort,int_set);
 185   5                      }
 186   4                      else
 187   4                      #endif
 188   4                      {
 189   5                          #ifdef BUF_CMD_EN
                                  if(SFR_quick_cmd & quick_cmd_write_dma)
                                  {
              
                                      //break buffer command flow:
                                      //(1)continue command
                                      //(2)chs mode command
                                      //(3)counter > threshold
                                                      if(check_chs_cmd)
                                                      {
                                                              if(buf_not_empty) g_current_fis_num--;
                                                              else
                                                              { 
                                                                      chs_write_handle();
                                                                      buf_check_cnt = 0x00;
                                                              }
                                                      }
                                      else if(normal_cmd_cont || (g_sec_cnt.word == 0x0000) || (g_sec_cnt.byte.h!=0x00) 
             -|| (g_sec_cnt.byte.l >BUF_SEC_CNT_THRESHOLD) ||(g_enable_write_cache == 0))
                                      {
                                           
                                           if(buf_not_empty) g_current_fis_num--;
                                           else
                                           {
                                              write_handler();
                                              buf_check_cnt = 0x00;
                                           }
                                           
                                      } 
                                      else if(buf_check_cnt<BUF_START_CNT)
                                      {
                                          if(buf_not_empty) g_current_fis_num--;
                                          else
                                          {
                                             write_handler();
                                             buf_check_cnt++;
                                          }
                                      }
                                      else
                                      {      
                                           //check_lba();
                                           //the if will not happen
                                           if(g_flag_lba_err)
                                           {
                                               tx_fis_34(status_bad,error_abort,int_set);
                                               reset_engine();
                                           }
                                           else
                                           {
                                               buf_sector_num.word = 0;
                                               buf_cmd_flag = DEF_CHP_EN;
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 5   

                                               cmd_buffer_set_param();
                                               //TODO: add reset_engine here???
                                               g_cont_en = 0;
                                           }
                                       }
                                  }
                                  //need to flush all data in FIFO before other commands
                                  else if(buf_not_empty)g_current_fis_num--;                     
                                  #else
 248   5                          if(SFR_quick_cmd & quick_cmd_write_dma)
 249   5                          {
 250   6                                              if(check_chs_cmd)chs_write_handle();
 251   6                                              else write_handler();
 252   6                          }
 253   5                          #endif
 254   5                          
 255   5                                                            
 256   5                       
 257   5                          //(2)this is read_dma or read_dma_ext
 258   5                          else if(SFR_quick_cmd & quick_cmd_read_dma)
 259   5                          {  
 260   6                             // myprintf("\nr");
 261   6                                         if(check_chs_cmd)chs_read_handle();
 262   6                             else read_handler();
 263   6           
 264   6                          }
 265   5                          else if(SFR_quick_cmd & (quick_cmd_write_mul | quick_cmd_write_sec))  
 266   5                          {              
 267   6                              g_flag_dir = DIR_WRITE;
 268   6                              pio_write_handler();              
 269   6                           }   
 270   5                          
 271   5                          //(4)read pio: read_sector([ext]) or read_multiple([ext])
 272   5                          //else if((SFR_quick_cmd&quick_cmd_read_mul) || (SFR_quick_cmd&quick_cmd_read_sec));
 273   5                          else if(SFR_quick_cmd & (quick_cmd_read_mul | quick_cmd_read_sec))
 274   5                          {
 275   6                             g_flag_dir = DIR_READ;
 276   6                             pio_read_handler();
 277   6                          }
 278   5                          g_power_mode = power_mode_act;
 279   5                      }
 280   4                  }
 281   3                  else if(SFR_FIS0_0 == 0x27)//this is H2D fis
 282   3                  { 
 283   4                      #ifdef BUF_CMD_EN
                              if(buf_not_empty)g_current_fis_num--; 
                              else if((SFR_FIS0_1 & 0x80) !=0) //this is a command, not control
                              #else
 287   4                      if((SFR_FIS0_1 & 0x80) !=0) //this is a command, not control
 288   4                      #endif
 289   4                      {
 290   5                          #ifdef SUPPORT_SECURITY
 291   5                          if(SFR_FIS0_2 != ata_security_erase_unit) g_security_prepared = 0;
 292   5                          #endif
 293   5                          if(SFR_FIS0_2 == ata_write_dma_fua_ext)
 294   5                          {
 295   6                              write_handler();
 296   6                                                  g_power_mode = power_mode_act; 
 297   6                          }
 298   5                          else if(SFR_FIS0_2 == ata_write_multi_fua_ext)
 299   5                          {
 300   6                              g_flag_dir = DIR_WRITE;
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 6   

 301   6                              pio_write_handler(); 
 302   6                                                      g_power_mode = power_mode_act;                        
 303   6                          }
 304   5                          
 305   5                          #ifdef SUPPORT_NCQ
                                  else if(SFR_FIS0_2 == ata_read_fpdma)
                                  {
                                      g_flag_dir = DIR_READ;
                                      ncq_resp_cmd();
                                      g_power_mode = power_mode_act;
                                  }
                                  else if(SFR_FIS0_2 == ata_write_fpdma)
                                  {
                                      g_flag_dir = DIR_WRITE;
                                      ncq_resp_cmd();
                                      g_power_mode = power_mode_act;
                                  }
                                  #endif
 319   5                          else
 320   5                          {
 321   6                              reset_engine();
 322   6                              switch(SFR_FIS0_2)//this is the ata command index
 323   6                              {  
 324   7                              
 325   7                                  //NCQ
 326   7                                  #ifdef SUPPORT_NCQ
                                      
                                          case ata_ncq_management:
                                          {
                                              ncq_management_hander();
                                              g_power_mode = power_mode_act;
                                              break;
                                          }
                                      
                                          case ata_read_log_ext:
                                          {
                                              ncq_read_log();
                                              g_power_mode = power_mode_act;
                                              break;
                                          }        
                                          case ata_read_log_dma_ext:
                                          {
                                              ncq_read_log();
                                              g_power_mode = power_mode_act;
                                              break;
                                          }
                                      
                                          #endif
 349   7                              ///////////////////////////////////////////////////
 350   7                              ///////////BASIC
 351   7                              ///////////////////////////////////////////////////
 352   7                                  case ata_nop:                   
 353   7                                  {
 354   8                                      //note: sub-code is used for overlapped feature support.
 355   8                                      tx_fis_34(status_bad, error_abort,int_set); 
 356   8                                      break;
 357   8                                  }
 358   7                                  case  ata_seek:     
 359   7                                  {
 360   8                                      //this is sent by host to signify the device that it may access the specif
             -ied address in the following commands
 361   8                                  
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 7   

 362   8                                      if(g_flag_lba_err) tx_fis_34(status_bad,error_abort, int_set);
 363   8                                      else tx_fis_34(status_good,error_no,int_set);
 364   8                                      g_power_mode = power_mode_act;
 365   8                                      break;                                                  
 366   8                                  }
 367   7                                  case ata_recalibrate:
 368   7                                  {
 369   8                                      //this is vendor specific - ATA4
 370   8                                      tx_fis_34(status_good,error_no,int_set);
 371   8                                      break;
 372   8                                  }
 373   7                                  case ata_exec_diag:
 374   7                                  {
 375   8                                      init_tx_fis();
 376   8                                      tx_fis_34(status_bad&0xf2,0x01,int_set);       //0x01h indicated device0 p
             -assed and device1 not present
 377   8                                      break;
 378   8                                  }
 379   7                                  case  ata_init_dev_para:    
 380   7                                  {
 381   8                                      //this is to set CHS translation.
 382   8                                      //todo: change the setting of hardware operation: CHS translation.
 383   8                                      init_dev_para();
 384   8                                      break;                                                  
 385   8                                  }
 386   7                                  case ata_flush_cache:
 387   7                                  {
 388   8                                  //TODO: flush the CHPs.
 389   8                                  //This command is used by the host to request the device to flush the write ca
             -che. If there is data in the write
 390   8                                  //cache, that data shall be written to the media. This command shall not indic
             -ation completion until the data is
 391   8                                  //flushed to the media or an error occurs.
 392   8                                  //NOTE . This command may take longer than 30 s to complete.
 393   8                                      flush_delay();
 394   8                                      tx_fis_34(status_good,error_no,int_set);
 395   8                                      g_power_mode = power_mode_act;
 396   8                                      break;
 397   8                                  }
 398   7                                  case ata_flush_cache_ext:
 399   7                                  {
 400   8                                      flush_delay();
 401   8                                      tx_fis_34(status_good,error_no,int_set);
 402   8                                      g_power_mode = power_mode_act;
 403   8                                      break;
 404   8                                  }
 405   7                                  case ata_read_verify: //this command wasn't completed, the write protect error
             - should be took into accout
 406   7                                  {
 407   8                                      if(g_flag_lba_err) tx_fis_34(status_bad,error_abort, int_set);
 408   8                                      else tx_fis_34(status_good,error_no,int_set);
 409   8                                      g_power_mode = power_mode_act;
 410   8                                      break;  
 411   8                                  }
 412   7                                  case ata_read_verify_ext:  //this command wasn't completed, the write protect 
             -error should be took into accout
 413   7                                  {
 414   8                                      if(g_flag_lba_err) tx_fis_34(status_bad,error_abort, int_set);
 415   8                                      else tx_fis_34(status_good,error_no,int_set);
 416   8                                      g_power_mode = power_mode_act;
 417   8                                      break;  
 418   8                                  }
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 8   

 419   7      
 420   7                                  #ifdef SUPPORT_SMART
 421   7      
 422   7                                  case ata_smart:
 423   7                                  {
 424   8                                      //myprintf("\nsmart_handler");
 425   8                                      smart_handler();
 426   8                                      break;
 427   8                                  }
 428   7                              
 429   7                                  #endif
 430   7      
 431   7                             
 432   7                              case ata_data_set_management:
 433   7                              {
 434   8                                  #ifdef SUPPORT_TRIM
 435   8                                 //#if 0
 436   8                                      //if(check_sd_mode) tx_fis_34(status_good,error_no,int_set);
 437   8                                      //else 
 438   8                                      if((sata.FIS_seccnt_ext !=0)||(sata.FIS_seccnt >0x20)||((sata.FIS_seccnt_e
             -xt==0)&&(sata.FIS_seccnt==0)))
 439   8                                      {
 440   9                                           tx_fis_34(status_good,error_no,int_set);
 441   9                                      }
 442   8                                      else  trim_handler();
 443   8                                  #else
                                              tx_fis_34(status_good,error_no,int_set);
                                          #endif
 446   8                                  
 447   8                                  break;
 448   8                                  
 449   8                              }
 450   7                              
 451   7      
 452   7                                  ////////////////////////////////////////////////////
 453   7                                  /////POWER MANAGEMENT FEATURE SET
 454   7                                  ////////////////////////////////////////////////////
 455   7                                  case ata_chk_power_mode:
 456   7                                  {
 457   8                                      sata.FIS_seccnt=g_power_mode;
 458   8                                      tx_fis_34(status_good,error_no,int_set);
 459   8                                  
 460   8                                      break;
 461   8                                  }
 462   7                                  case ata_idle:
 463   7                                  {
 464   8                                      flush_delay();
 465   8                                      g_power_mode=power_mode_idle;
 466   8                                      tx_fis_34(status_good,error_no,int_set);
 467   8                                      break;
 468   8                                  } 
 469   7                                  case ata_idle_imd:
 470   7                                  { 
 471   8                                      flush_delay();
 472   8                                      g_power_mode=power_mode_idle;
 473   8                                      tx_fis_34(status_good,error_no,int_set);
 474   8                                      break;                                                                    
             -                            
 475   8                                  }
 476   7                                  case ata_sleep:
 477   7                                  {  
 478   8                                      flush_delay();
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 9   

 479   8                                      g_power_mode=power_mode_sleep;
 480   8                                      tx_fis_34(status_good,error_no,int_set);
 481   8                                      break;                                                                    
             -         
 482   8                                  }
 483   7                                  case ata_standby:
 484   7                                  {
 485   8                                      flush_delay();
 486   8                                      g_power_mode=power_mode_standby;
 487   8                                      tx_fis_34(status_good,error_no,int_set);                           
 488   8                                      break; 
 489   8                                  }
 490   7                                  case ata_standby_imd:
 491   7                                  {  
 492   8                                      flush_delay();
 493   8                                      g_power_mode=power_mode_standby;
 494   8                                      tx_fis_34(status_good,error_no,int_set);
 495   8                                      break;                                                                    
             -                                   
 496   8                                  }
 497   7                              
 498   7                              ///////////////////////////////////////////////////////
 499   7                              ///////////////////////////////////////////////////////
 500   7                                  case ata_identify_device:
 501   7                                  {
 502   8                                      identify_device();
 503   8                                      break;
 504   8                                  }
 505   7                                  case ata_set_multiple:
 506   7                                  { 
 507   8                                      if(sata.fis_rcv_content[4*3+0] == 0x01)
 508   8                                      {
 509   9                                      // we support transmitting 1 sector per multiple operation only, so the id
             -entify_data[59] low will not change                      
 510   9                                      /*
 511   9                                                              identify_data[59] &= 0xff00;
 512   9                                                              identify_data[59] |=0x0001; 
 513   9                                                              */
 514   9                                          tx_fis_34(status_good,error_no,int_set);
 515   9                                          break;
 516   9                                      }  
 517   8                                      else
 518   8                                      {
 519   9                                          tx_fis_34(status_bad,error_abort,int_set);
 520   9                                          break;
 521   9                                      }
 522   8                                  }
 523   7                                  case ata_set_feature:
 524   7                                  {
 525   8                                                                  set_feature();
 526   8                                      //tx_fis_34(status_good,error_no,int_set);
 527   8                                      break;
 528   8                                  }
 529   7                                                  case ata_security_freeze_lock:  //ok
 530   7                                  {
 531   8                                      #ifdef SUPPORT_SECURITY
 532   8                                     if(g_security_lock == 1)
 533   8                                      {
 534   9                                          tx_fis_34(status_bad, error_abort,int_set);
 535   9                                      }
 536   8                                      else
 537   8                                      {
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 10  

 538   9                                          if(g_security_enable == 0) security_state_flag = SEC2;
 539   9                                          else security_state_flag = SEC6;
 540   9                                          analyze_states();
 541   9                                          tx_fis_34(status_good,error_no,int_set);
 542   9                                      }
 543   8                                      #else
                                              tx_fis_34(status_good,error_no,int_set);
                                              #endif
 546   8                                      break;  
 547   8                                  }
 548   7      
 549   7                                  //////////////////////////////////////////////////
 550   7                                  #ifdef SUPPORT_SECURITY
 551   7      
 552   7                                      case ata_security_erase_pre:   /* BIOS没有权限擦除硬盘，所以直接返回 */
 553   7                                  {
 554   8                                      if(g_security_frozen == 1)
 555   8                                      {
 556   9                                          g_security_prepared = 0;
 557   9                                          tx_fis_34(status_bad, error_abort,int_set);
 558   9                                      }
 559   8                                      else
 560   8                                      {
 561   9                                          //g_security_prepared = 1;
 562   9                                         // security_state_flag = SEC4;
 563   9                                          tx_fis_34(status_good,error_no,int_set);
 564   9                                      }
 565   8                                      //analyze_states();
 566   8                                      break;
 567   8                                  }
 568   7      
 569   7                                      case ata_security_erase_unit:       /* BIOS没有权限擦除硬盘，所以直接返回 */
 570   7                                  {
 571   8                                      if(g_security_frozen == 1)
 572   8                                      {
 573   9                                          g_security_prepared = 0;
 574   9                                          tx_fis_34(status_bad, error_abort,int_set);
 575   9                                      }
 576   8                                      else
 577   8                                      {
 578   9                                         /*if(g_security_prepared == 0) g_security_abort = 1;
 579   9                                          else security_erase_unit();
 580   9                                          if(g_security_abort == 1) 
 581   9                                          {
 582   9                                              g_security_abort = 0;
 583   9                                              tx_fis_34(status_bad, error_abort,int_set);
 584   9                                          }
 585   9                                          else 
 586   9                                          {
 587   9                                              g_security_prepared = 0;
 588   9                                              security_state_flag = SEC1;*/
 589   9                                              tx_fis_34(status_good,error_no,int_set);
 590   9                                          /*}    
 591   9                                          analyze_states();*/
 592   9                                      }
 593   8                                      break;
 594   8                                  }
 595   7                                      
 596   7                                  case ata_security_dis_pwd:      //ok
 597   7                                  {
 598   8                                         //此处删掉frozen下不能取消密码功能，dell 1014 进入bios的时候已经frozen了
 599   8                                          if(/*(g_security_frozen == 1) ||*/ (g_security_lock == 1))
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 11  

 600   8                                      {
 601   9                                          g_security_prepared = 0;
 602   9                                          tx_fis_34(status_bad, error_abort,int_set);
 603   9                                      }
 604   8                                      else
 605   8                                      {
 606   9                                          security_dis_pwd();
 607   9                                          if(g_security_abort == 1) 
 608   9                                          {
 609  10                                              g_security_abort = 0;
 610  10                                              tx_fis_34(status_bad, error_abort,int_set);
 611  10                                          }
 612   9                                          else 
 613   9                                          {
 614  10                                              security_state_flag = SEC1;
 615  10                                              tx_fis_34(status_good,error_no,int_set);
 616  10                                          }
 617   9                                          analyze_states();
 618   9                                      }
 619   8                                      break;
 620   8                                  }
 621   7                                  
 622   7                                  case ata_security_set_pwd:  //ok
 623   7                                  {
 624   8                                      if((g_security_frozen == 1) )
 625   8                                      {
 626   9                                          g_security_prepared = 0;
 627   9                                          tx_fis_34(status_bad, error_abort,int_set);
 628   9                                      }
 629   8                                      else
 630   8                                      {
 631   9                                          security_set_pwd();
 632   9                                          if(g_security_abort == 1) 
 633   9                                          {
 634  10                                              g_security_abort = 0;
 635  10                                              tx_fis_34(status_bad, error_abort,int_set);
 636  10                                          }
 637   9                                          else tx_fis_34(status_good,error_no,int_set);
 638   9                                          analyze_states();
 639   9                                      }
 640   8                                      break;
 641   8                                  }
 642   7                                  
 643   7                                  case ata_security_unlock:   //ok
 644   7                                  {
 645   8                                      //analyze_states();
 646   8                                              //myprintf("\nunlock");
 647   8                                      security_unlock();
 648   8                                      if(g_security_abort == 1) 
 649   8                                      {
 650   9                                          g_security_abort = 0;
 651   9                                          tx_fis_34(status_bad, error_abort,int_set);
 652   9                                      }
 653   8                                      else 
 654   8                                      {
 655   9                                          
 656   9                                          security_state_flag = SEC5;
 657   9                                          tx_fis_34(status_good,error_no,int_set);
 658   9                                      }
 659   8                                      analyze_states();
 660   8                                      break;
 661   8                                  }
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 12  

 662   7                                  #endif
 663   7                                  ///////////////////////////////////////////////
 664   7                                  
 665   7                                                              #ifdef SUPER_ERASE
 666   7                                                              case ata_down_microcode:
 667   7                                                              {
 668   8                                      if(sata.FIS_feature == 0xCC)//super erase
 669   8                                                                      {
 670   9                                                                          intial_data_partition(1);//erase all
 671   9                                                                         // security_erase_pa(1);
 672   9                                                                          tx_fis_34(status_good,error_no,int_set);
 673   9                                          break;
 674   9                                      }
 675   8                                                                      else 
 676   8                                                                      {
 677   9                                                                              tx_fis_34(status_bad, error_abort,int_set); 
 678   9                                                                              break;
 679   9                                                                      }
 680   8                                                              }
 681   7                                                              #endif
 682   7      
 683   7                                                              #ifdef READ_ONLY
                                          case ata_read_only:
                                          {
                                              choose_mode();
                                              break;
                                          }
                                          #endif
 690   7                                                              
 691   7                                  default :
 692   7                                                              {
 693   8                                      tx_fis_34(status_bad, error_abort,int_set); 
 694   8                                      break;
 695   8                                  }
 696   7                              }
 697   6                          }
 698   5                      }
 699   4                      
 700   4                      else //control command process 
 701   4                      {
 702   5                          #ifdef BUF_CMD_EN
                                  buf_data_pending = 0;
                                  #endif
 705   5                          reset_engine();
 706   5                          //check_control:
 707   5                          //IF SRST
 708   5                          if((SFR_cmd_aux & 0x01)!=0) 
 709   5                          {
 710   6                              //wait until SRST is deasserted.
 711   6                              while((sata.fis_rcv_content[15] & 0x04)==0x04);
 712   6                              //clear the fis27 flag.
 713   6                              //sata.ncq_cntl = (sata.ncq_cntl & (~ncq_cntl_new_fis27));
 714   6                              //hardware latch the SRST state, firmware clear it.
 715   6                              SFR_cmd_aux = 0x00;
 716   6                              g_current_fis_num = SFR_fis_num;
 717   6                              //only resonse when SRST is not set                        
 718   6                          }
 719   5      
 720   5                          //also response the other controls without SRST bit set.
 721   5                          if(g_power_mode != power_mode_sleep)
 722   5                          {
 723   6                              init_tx_fis();
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 13  

 724   6                                                      //reset link(bit2) and transport(bit3).
 725   6                                                      //if SRST, we may recover from abnormal state
 726   6                              sata.rst_cntl = sata.rst_cntl | 0x0C;
 727   6                              delay(5);
 728   6                                                      sata.ncq_cntl = (sata.ncq_cntl & (~ncq_cntl_new_fis27));
 729   6                              tx_fis_34(status_good,0x01,int_no);
 730   6                              #ifdef SUPPORT_SMART1
 731   6                              updata_smart(smart_softrst_num_addr,0x01);
 732   6                              reset_engine();
 733   6                              #endif
 734   6                          }
 735   5                      }
 736   4                  }
 737   3                  else if(SFR_FIS0_0 == 0x58)
 738   3                  {
 739   4                      bist_handler();
 740   4                  }
 741   3                  SFR_watch_dog_high = 0x00;
 742   3              }
 743   2              else
 744   2              {
 745   3                  //(1)if current loop has command, not handle DMA setup
 746   3                  //(2)if current loop handle DMA setup, not send SET DEV BITS FIS
 747   3                  //(3)otherwise send SET_DEV_BITS FIS
 748   3                  #ifdef SUPPORT_NCQ
                          ncq_handler();
                          #endif
 751   3              }
 752   2                      #ifdef SUPPORT_SMART1
 753   2              if(check_sd_mode) smart_card_crc();
 754   2                      else smart_block_handle();
 755   2                      #endif
 756   2              
 757   2              /*
 758   2                      if(g_power_mode == power_mode_idle)
 759   2                      {
 760   2                              if(SFR_watch_dog_high >= 0x20)  g_power_mode = power_mode_standby;                      
 761   2                      }
 762   2                      */
 763   2                      if((SFR_watch_dog_high > 0x30) && g_chp_active)chp_clock_off();
 764   2          }
 765   1          
 766   1      }
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 14  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION L?1073 (BEGIN)
0000         L?1074:
0000 7F64              MOV     R7,#064H
0002 7E00              MOV     R6,#00H
             ; FUNCTION _delay (BEGIN)
                                           ; SOURCE LINE # 164
;---- Variable 'cnt' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 165
                                           ; SOURCE LINE # 167
;---- Variable 'i' assigned to Register 'R4/R5' ----
0004 E4                CLR     A
0005 FD                MOV     R5,A
0006 FC                MOV     R4,A
0007         ?C0001:
0007 C3                CLR     C
0008 ED                MOV     A,R5
0009 9F                SUBB    A,R7
000A EC                MOV     A,R4
000B 9E                SUBB    A,R6
000C 5007              JNC     ?C0004
000E 0D                INC     R5
000F BD0001            CJNE    R5,#00H,?C0892
0012 0C                INC     R4
0013         ?C0892:
0013 80F2              SJMP    ?C0001
                                           ; SOURCE LINE # 168
0015         ?C0004:
0015 22                RET     
             ; FUNCTION _delay (END)

             ; FUNCTION L?1067 (BEGIN)
0000         L?1068:
0000 7F01              MOV     R7,#01H
0002 7E00              MOV     R6,#00H
             ; FUNCTION _delay_ms (BEGIN)
                                           ; SOURCE LINE # 171
;---- Variable 'cnt' assigned to Register 'R2/R3' ----
0004 AB07              MOV     R3,AR7
0006 AA06              MOV     R2,AR6
                                           ; SOURCE LINE # 172
                                           ; SOURCE LINE # 174
;---- Variable 'i' assigned to Register 'DPTR' ----
0008 900000            MOV     DPTR,#00H
000B         ?C0005:
000B C3                CLR     C
000C E582              MOV     A,DPL
000E 9B                SUBB    A,R3
000F E583              MOV     A,DPH
0011 9A                SUBB    A,R2
0012 500A              JNC     ?C0008
                                           ; SOURCE LINE # 175
                                           ; SOURCE LINE # 176
0014 7FDC              MOV     R7,#0DCH
0016 7E07              MOV     R6,#07H
0018 120000      R     LCALL   _delay
                                           ; SOURCE LINE # 177
001B A3                INC     DPTR
001C 80ED              SJMP    ?C0005
                                           ; SOURCE LINE # 178
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 15  

001E         ?C0008:
001E 22                RET     
             ; FUNCTION _delay_ms (END)

             ; FUNCTION _uart_send_R1 (BEGIN)
0000 D3                SETB    C
0001 10AF01            JBC     EA,?C0893
0004 C3                CLR     C
0005         ?C0893:
0005 C0D0              PUSH    PSW
                                           ; SOURCE LINE # 102
;---- Variable 'tx_data' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 103
                                           ; SOURCE LINE # 104
0007 90FFE0            MOV     DPTR,#sata+0E0H
000A 7455              MOV     A,#055H
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 105
000D EF                MOV     A,R7
000E F0                MOVX    @DPTR,A
000F         ?C0009:
                                           ; SOURCE LINE # 106
000F 90FFD2            MOV     DPTR,#sata+0D2H
0012 E0                MOVX    A,@DPTR
0013 30E3F9            JNB     ACC.3,?C0009
0016         ?C0010:
                                           ; SOURCE LINE # 107
0016         ?C0011:
0016 D0D0              POP     PSW
0018 92AF              MOV     EA,C
001A 22                RET     
             ; FUNCTION _uart_send_R1 (END)

             ; FUNCTION uart_int_handler (BEGIN)
                                           ; SOURCE LINE # 112
                                           ; SOURCE LINE # 113
                                           ; SOURCE LINE # 117
0000 90FFE1            MOV     DPTR,#sata+0E1H
0003 E0                MOVX    A,@DPTR
;---- Variable 'uart_cmd_byte' assigned to Register 'R2' ----
0004 FA                MOV     R2,A
                                           ; SOURCE LINE # 118
0005 E4                CLR     A
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 119
0007 E0                MOVX    A,@DPTR
;---- Variable 'uart_b3' assigned to Register 'R3' ----
0008 FB                MOV     R3,A
                                           ; SOURCE LINE # 120
0009 E4                CLR     A
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 121
000B E0                MOVX    A,@DPTR
;---- Variable 'uart_b2' assigned to Register 'R4' ----
000C FC                MOV     R4,A
                                           ; SOURCE LINE # 122
000D E4                CLR     A
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 123
000F E0                MOVX    A,@DPTR
;---- Variable 'uart_b1' assigned to Register 'R1' ----
0010 F9                MOV     R1,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 16  

                                           ; SOURCE LINE # 124
0011 E4                CLR     A
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 125
0013 E0                MOVX    A,@DPTR
0014 FF                MOV     R7,A
;---- Variable 'uart_b0' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 126
0015 90FFD9            MOV     DPTR,#sata+0D9H
0018 E0                MOVX    A,@DPTR
0019 4480              ORL     A,#080H
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 128
001C 8C00        R     MOV     reg_addr+01H,R4
                                           ; SOURCE LINE # 129
001E 8B00        R     MOV     reg_addr,R3
                                           ; SOURCE LINE # 131
0020 BA510A            CJNE    R2,#051H,?C0012
                                           ; SOURCE LINE # 132
                                           ; SOURCE LINE # 134
0023 850083      R     MOV     DPH,reg_addr
0026 850082      R     MOV     DPL,reg_addr+01H
0029 EF                MOV     A,R7
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 135
                                           ; SOURCE LINE # 136
002B 800D              SJMP    ?C0939
002D         ?C0012:
                                           ; SOURCE LINE # 137
002D BA500F            CJNE    R2,#050H,?C0014
                                           ; SOURCE LINE # 138
                                           ; SOURCE LINE # 140
0030 AE00        R     MOV     R6,reg_addr
0032 AF00        R     MOV     R7,reg_addr+01H
0034 8F82              MOV     DPL,R7
0036 8E83              MOV     DPH,R6
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
                                           ; SOURCE LINE # 141
003A         ?C0939:
003A 120000      R     LCALL   _uart_send_R1
                                           ; SOURCE LINE # 142
003D 8040              SJMP    ?C0013
003F         ?C0014:
                                           ; SOURCE LINE # 144
003F EA                MOV     A,R2
0040 6455              XRL     A,#055H
0042 703B              JNZ     ?C0013
                                           ; SOURCE LINE # 145
                                           ; SOURCE LINE # 146
0044 EB                MOV     A,R3
0045 6453              XRL     A,#053H
0047 701F              JNZ     ?C0017
                                           ; SOURCE LINE # 147
0049 EC                MOV     A,R4
004A 644F              XRL     A,#04FH
004C 7031              JNZ     ?C0013
                                           ; SOURCE LINE # 148
004E E9                MOV     A,R1
004F 6450              XRL     A,#050H
0051 702C              JNZ     ?C0013
                                           ; SOURCE LINE # 149
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 17  

0053 BF3105            CJNE    R7,#031H,?C0020
                                           ; SOURCE LINE # 150
                                           ; SOURCE LINE # 151
0056 750010      R     MOV     security_mode,#010H
                                           ; SOURCE LINE # 152
                                           ; SOURCE LINE # 153
0059 8008              SJMP    ?C0940
005B         ?C0020:
                                           ; SOURCE LINE # 154
005B EF                MOV     A,R7
005C 6432              XRL     A,#032H
005E 701F              JNZ     ?C0013
                                           ; SOURCE LINE # 155
                                           ; SOURCE LINE # 156
0060 750020      R     MOV     security_mode,#020H
                                           ; SOURCE LINE # 157
0063         ?C0940:
0063 750001      R     MOV     uart_show,#01H
                                           ; SOURCE LINE # 158
                                           ; SOURCE LINE # 159
0066 8017              SJMP    ?C0013
0068         ?C0017:
                                           ; SOURCE LINE # 160
0068 BB4514            CJNE    R3,#045H,?C0013
                                           ; SOURCE LINE # 161
006B BC5211            CJNE    R4,#052H,?C0013
                                           ; SOURCE LINE # 162
006E B9410E            CJNE    R1,#041H,?C0013
                                           ; SOURCE LINE # 163
0071 BF3105            CJNE    R7,#031H,?C0027
                                           ; SOURCE LINE # 164
0074 750010      R     MOV     security_erase,#010H
0077 8006              SJMP    ?C0013
0079         ?C0027:
                                           ; SOURCE LINE # 165
0079 BF3203            CJNE    R7,#032H,?C0013
                                           ; SOURCE LINE # 166
007C 750020      R     MOV     security_erase,#020H
                                           ; SOURCE LINE # 167
                                           ; SOURCE LINE # 168
007F         ?C0013:
                                           ; SOURCE LINE # 171
007F 90FFD1            MOV     DPTR,#sata+0D1H
0082 E0                MOVX    A,@DPTR
0083 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 173
0084 22                RET     
             ; FUNCTION uart_int_handler (END)

             ; FUNCTION _init (BEGIN)
                                           ; SOURCE LINE # 19
;---- Variable 'mode' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 20
                                           ; SOURCE LINE # 23
0000 758E11            MOV     TS8052_CKCON,#011H
                                           ; SOURCE LINE # 24
0003 75A885            MOV     TS8052_IE,#085H
                                           ; SOURCE LINE # 25
0006 75B804            MOV     TS8052_IPL,#04H
                                           ; SOURCE LINE # 26
0009 5387EF            ANL     TS8052_PCON,#0EFH
                                           ; SOURCE LINE # 32
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 18  

000C 90FFF0            MOV     DPTR,#sata+0F0H
000F 741F              MOV     A,#01FH
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 33
0012 A3                INC     DPTR
0013 7480              MOV     A,#080H
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 51
0016 750001      R     MOV     g_SYS_YD,#01H
                                           ; SOURCE LINE # 53
0019 90FF3C            MOV     DPTR,#sata+03CH
001C 7470              MOV     A,#070H
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 54
001F BF0107            CJNE    R7,#01H,?C0031
                                           ; SOURCE LINE # 55
0022 E0                MOVX    A,@DPTR
0023 4480              ORL     A,#080H
0025 F0                MOVX    @DPTR,A
0026 020000      R     LJMP    ?C0032
0029         ?C0031:
                                           ; SOURCE LINE # 57
                                           ; SOURCE LINE # 70
0029 90FFD9            MOV     DPTR,#sata+0D9H
002C E0                MOVX    A,@DPTR
002D 4480              ORL     A,#080H
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 71
0030 90FFD1            MOV     DPTR,#sata+0D1H
0033 7480              MOV     A,#080H
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 72
0036 90FFD4            MOV     DPTR,#sata+0D4H
0039 741E              MOV     A,#01EH
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 73
003C E4                CLR     A
003D A3                INC     DPTR
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 74
003F 90FFE2            MOV     DPTR,#sata+0E2H
0042 7404              MOV     A,#04H
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 78
0045 E4                CLR     A
0046 F500        R     MOV     g_flag,A
                                           ; SOURCE LINE # 79
0048 D200        R     SETB    g_enable_write_cache
                                           ; SOURCE LINE # 81
004A 907FBA            MOV     DPTR,#07FBAH
004D 93                MOVC    A,@A+DPTR
004E F5D7              MOV     SFR_CHP_en,A
                                           ; SOURCE LINE # 82
0050 A3                INC     DPTR
0051 E4                CLR     A
0052 93                MOVC    A,@A+DPTR
0053 90FF7F            MOV     DPTR,#sata+07FH
0056 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 83
0057 907FBC            MOV     DPTR,#07FBCH
005A E4                CLR     A
005B 93                MOVC    A,@A+DPTR
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 19  

005C 90FF57            MOV     DPTR,#sata+057H
005F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 87
0060 E4                CLR     A
0061 FF                MOV     R7,A
0062 120000      R     LCALL   _GPIO_security_cmd
                                           ; SOURCE LINE # 88
0065 E500        R     MOV     A,security_erase
0067 B4300B            CJNE    A,#030H,?C0033
                                           ; SOURCE LINE # 89
                                           ; SOURCE LINE # 91
006A 120000      R     LCALL   L?1071
                                           ; SOURCE LINE # 93
006D 7F01              MOV     R7,#01H
006F 120000      R     LCALL   _intial_data_partition
                                           ; SOURCE LINE # 94
0072 E4                CLR     A
0073 F500        R     MOV     security_erase,A
                                           ; SOURCE LINE # 97
0075         ?C0033:
                                           ; SOURCE LINE # 101
0075 E4                CLR     A
0076 F5D9              MOV     SFR_watch_dog_high,A
                                           ; SOURCE LINE # 102
0078 90FF00            MOV     DPTR,#sata
007B E0                MOVX    A,@DPTR
007C 7025              JNZ     ?C0034
                                           ; SOURCE LINE # 103
007E         ?C0035:
                                           ; SOURCE LINE # 104
007E 90FF70            MOV     DPTR,#sata+070H
0081 E0                MOVX    A,@DPTR
0082 540F              ANL     A,#0FH
0084 640A              XRL     A,#0AH
0086 600C              JZ      ?C0036
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 107
0088 E5D9              MOV     A,SFR_watch_dog_high
008A D3                SETB    C
008B 9450              SUBB    A,#050H
008D 40EF              JC      ?C0035
008F 75F6B0            MOV     SFR_cpu_reboot,#0B0H
                                           ; SOURCE LINE # 108
0092 80EA              SJMP    ?C0035
0094         ?C0036:
                                           ; SOURCE LINE # 110
0094 120000      R     LCALL   L?1067
                                           ; SOURCE LINE # 111
0097 907FBD            MOV     DPTR,#07FBDH
009A E4                CLR     A
009B 93                MOVC    A,@A+DPTR
009C 90FFCC            MOV     DPTR,#sata+0CCH
009F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 112
00A0 120000      R     LCALL   L?1067
                                           ; SOURCE LINE # 113
00A3         ?C0034:
                                           ; SOURCE LINE # 114
00A3 90FF7E            MOV     DPTR,#sata+07EH
00A6 7412              MOV     A,#012H
00A8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 115
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 20  

00A9 7F2C              MOV     R7,#02CH
00AB 7E01              MOV     R6,#01H
00AD 120000      R     LCALL   _delay
                                           ; SOURCE LINE # 116
00B0 7412              MOV     A,#012H
00B2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 117
00B3 120000      R     LCALL   _delay
                                           ; SOURCE LINE # 118
00B6 7412              MOV     A,#012H
00B8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 119
00B9 120000      R     LCALL   chp_clock_on
                                           ; SOURCE LINE # 123
                                           ; SOURCE LINE # 124
00BC 120000      R     LCALL   L?1054
                                           ; SOURCE LINE # 126
00BF 7421              MOV     A,#021H
                                           ; SOURCE LINE # 127
00C1 120000      R     LCALL   L?1056
                                           ; SOURCE LINE # 128
00C4 90FF00            MOV     DPTR,#sata
00C7 E0                MOVX    A,@DPTR
00C8 7003              JNZ     ?C0038
                                           ; SOURCE LINE # 129
                                           ; SOURCE LINE # 130
00CA 7500FF      R     MOV     g_power_mode,#0FFH
                                           ; SOURCE LINE # 131
00CD         ?C0038:
                                           ; SOURCE LINE # 132
00CD 90FF00            MOV     DPTR,#sata
00D0 E0                MOVX    A,@DPTR
00D1 701F              JNZ     ?C0039
                                           ; SOURCE LINE # 133
                                           ; SOURCE LINE # 135
00D3 7D01              MOV     R5,#01H
00D5 7F07              MOV     R7,#07H
00D7 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 136
00DA 7D01              MOV     R5,#01H
00DC 7F1F              MOV     R7,#01FH
00DE 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 137
00E1 90FF34            MOV     DPTR,#sata+034H
00E4 E0                MOVX    A,@DPTR
00E5 30E705            JNB     ACC.7,?C0040
00E8 120000      R     LCALL   smart_card_update
00EB 8019              SJMP    ?C0042
00ED         ?C0040:
                                           ; SOURCE LINE # 138
00ED 120000      R     LCALL   smart_erase_handle
                                           ; SOURCE LINE # 140
00F0 8014              SJMP    ?C0042
00F2         ?C0039:
                                           ; SOURCE LINE # 142
                                           ; SOURCE LINE # 144
00F2 7D01              MOV     R5,#01H
00F4 7F13              MOV     R7,#013H
00F6 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 145
00F9 300007      R     JNB     g_smart_power_down_flag,?C0043
00FC 7D01              MOV     R5,#01H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 21  

00FE 7F1F              MOV     R7,#01FH
0100 120000      R     LCALL   _updata_smart
0103         ?C0043:
                                           ; SOURCE LINE # 146
0103 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 148
0106         ?C0042:
                                           ; SOURCE LINE # 150
0106 E4                CLR     A
0107 F500        R     MOV     g_security_flag,A
                                           ; SOURCE LINE # 153
                                           ; SOURCE LINE # 154
0109 120000      R     LCALL   security_initial
                                           ; SOURCE LINE # 155
                                           ; SOURCE LINE # 157
010C 90FF00            MOV     DPTR,#sata
010F E0                MOVX    A,@DPTR
0110 7003              JNZ     ?C0032
0112 74FF              MOV     A,#0FFH
0114 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 158
0115         ?C0032:
                                           ; SOURCE LINE # 161
0115 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 162
0118 90FFF0            MOV     DPTR,#sata+0F0H
011B 74F4              MOV     A,#0F4H
011D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 171
011E 90FFAF            MOV     DPTR,#sata+0AFH
0121 7401              MOV     A,#01H
0123 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 172
0124 90FF1E            MOV     DPTR,#sata+01EH
0127 7440              MOV     A,#040H
0129 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 173
012A 90FF56            MOV     DPTR,#sata+056H
012D 7410              MOV     A,#010H
012F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 174
0130 90FFCE            MOV     DPTR,#sata+0CEH
0133 E0                MOVX    A,@DPTR
0134 4402              ORL     A,#02H
0136 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 175
0137 90FF54            MOV     DPTR,#sata+054H
013A 7410              MOV     A,#010H
013C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 176
013D A3                INC     DPTR
013E 743F              MOV     A,#03FH
0140 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 178
0141 90FFA1            MOV     DPTR,#sata+0A1H
0144 7445              MOV     A,#045H
0146 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 179
0147 90FFA3            MOV     DPTR,#sata+0A3H
014A 7415              MOV     A,#015H
014C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 180
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 22  

014D 90FFA2            MOV     DPTR,#sata+0A2H
0150 740A              MOV     A,#0AH
0152 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 187
0153 90FF60            MOV     DPTR,#sata+060H
0156 7405              MOV     A,#05H
0158 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 188
0159 90FF64            MOV     DPTR,#sata+064H
015C 742D              MOV     A,#02DH
015E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 214
015F 750001      R     MOV     g_smart_flag,#01H
                                           ; SOURCE LINE # 215
0162 E4                CLR     A
0163 F500        R     MOV     g_smart_handle_flag,A
                                           ; SOURCE LINE # 216
0165 7800        R     MOV     R0,#LOW g_smart_test_status
0167 F6                MOV     @R0,A
                                           ; SOURCE LINE # 217
0168 7800        R     MOV     R0,#LOW g_smart_write_cnt
016A F6                MOV     @R0,A
                                           ; SOURCE LINE # 218
016B 7800        R     MOV     R0,#LOW g_smart_read_cnt
016D F6                MOV     @R0,A
                                           ; SOURCE LINE # 219
016E 7800        R     MOV     R0,#LOW g_smart_block_cnt_l
0170 F6                MOV     @R0,A
                                           ; SOURCE LINE # 220
0171 18                DEC     R0
0172 F6                MOV     @R0,A
                                           ; SOURCE LINE # 221
0173 7800        R     MOV     R0,#LOW write_sec_cnt_l
0175 F6                MOV     @R0,A
0176 08                INC     R0
0177 F6                MOV     @R0,A
                                           ; SOURCE LINE # 222
0178 7800        R     MOV     R0,#LOW write_sec_cnt_h
017A F6                MOV     @R0,A
                                           ; SOURCE LINE # 223
017B 7800        R     MOV     R0,#LOW read_sec_cnt_l
017D F6                MOV     @R0,A
017E 08                INC     R0
017F F6                MOV     @R0,A
                                           ; SOURCE LINE # 224
0180 7800        R     MOV     R0,#LOW read_sec_cnt_h
0182 F6                MOV     @R0,A
                                           ; SOURCE LINE # 227
0183 E500        R     MOV     A,security_mode
0185 B41016            CJNE    A,#010H,?C0045
                                           ; SOURCE LINE # 228
                                           ; SOURCE LINE # 229
0188 E4                CLR     A
0189 90FFC0            MOV     DPTR,#sata+0C0H
018C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 230
018D A3                INC     DPTR
018E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 231
018F A3                INC     DPTR
0190 74C0              MOV     A,#0C0H
0192 F0                MOVX    @DPTR,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 23  

                                           ; SOURCE LINE # 232
0193 A3                INC     DPTR
0194 7408              MOV     A,#08H
0196 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 233
0197 E4                CLR     A
0198 A3                INC     DPTR
0199 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 234
019A A3                INC     DPTR
019B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 235
019C 8036              SJMP    start_phy
019E         ?C0045:
                                           ; SOURCE LINE # 237
                                           ; SOURCE LINE # 238
019E 907FC4            MOV     DPTR,#07FC4H
01A1 E4                CLR     A
01A2 93                MOVC    A,@A+DPTR
01A3 90FFC0            MOV     DPTR,#sata+0C0H
01A6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 239
01A7 907FC5            MOV     DPTR,#07FC5H
01AA E4                CLR     A
01AB 93                MOVC    A,@A+DPTR
01AC 90FFC1            MOV     DPTR,#sata+0C1H
01AF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 240
01B0 907FC6            MOV     DPTR,#07FC6H
01B3 E4                CLR     A
01B4 93                MOVC    A,@A+DPTR
01B5 90FFC2            MOV     DPTR,#sata+0C2H
01B8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 241
01B9 907FC7            MOV     DPTR,#07FC7H
01BC E4                CLR     A
01BD 93                MOVC    A,@A+DPTR
01BE 90FFC3            MOV     DPTR,#sata+0C3H
01C1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 242
01C2 907FC8            MOV     DPTR,#07FC8H
01C5 E4                CLR     A
01C6 93                MOVC    A,@A+DPTR
01C7 90FFC4            MOV     DPTR,#sata+0C4H
01CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 243
01CB 907FC9            MOV     DPTR,#07FC9H
01CE E4                CLR     A
01CF 93                MOVC    A,@A+DPTR
01D0 90FFC5            MOV     DPTR,#sata+0C5H
01D3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 244
                                           ; SOURCE LINE # 250
01D4         start_phy:
                                           ; SOURCE LINE # 252
01D4 7800        R     MOV     R0,#LOW g_current_fis_num
01D6 A69F              MOV     @R0,SFR_fis_num
                                           ; SOURCE LINE # 254
01D8 90FF3C            MOV     DPTR,#sata+03CH
01DB 7470              MOV     A,#070H
01DD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 256
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 24  

01DE E4                CLR     A
01DF F5D9              MOV     SFR_watch_dog_high,A
01E1         ?C0048:
                                           ; SOURCE LINE # 257
01E1 90FF3D            MOV     DPTR,#sata+03DH
01E4 E0                MOVX    A,@DPTR
01E5 20E113            JB      ACC.1,?C0049
                                           ; SOURCE LINE # 258
                                           ; SOURCE LINE # 260
01E8 E5D9              MOV     A,SFR_watch_dog_high
01EA D3                SETB    C
01EB 9420              SUBB    A,#020H
01ED 40F2              JC      ?C0048
                                           ; SOURCE LINE # 261
                                           ; SOURCE LINE # 262
01EF E4                CLR     A
01F0 F5D9              MOV     SFR_watch_dog_high,A
                                           ; SOURCE LINE # 263
01F2 90FF34            MOV     DPTR,#sata+034H
01F5 E0                MOVX    A,@DPTR
01F6 4402              ORL     A,#02H
01F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 264
                                           ; SOURCE LINE # 265
01F9 80E6              SJMP    ?C0048
01FB         ?C0049:
                                           ; SOURCE LINE # 278
01FB E4                CLR     A
01FC F500        R     MOV     ii,A
01FE F500        R     MOV     ii+01H,A
0200         ?C0051:
0200 C3                CLR     C
0201 E500        R     MOV     A,ii+01H
0203 9430              SUBB    A,#030H
0205 E500        R     MOV     A,ii
0207 9475              SUBB    A,#075H
0209 5011              JNC     ?C0052
                                           ; SOURCE LINE # 279
                                           ; SOURCE LINE # 280
020B 90FF3D            MOV     DPTR,#sata+03DH
020E E0                MOVX    A,@DPTR
020F 20E0C2            JB      ACC.0,start_phy
0212         ?C0054:
                                           ; SOURCE LINE # 281
0212         ?C0053:
0212 0500        R     INC     ii+01H
0214 E500        R     MOV     A,ii+01H
0216 70E8              JNZ     ?C0051
0218 0500        R     INC     ii
021A         ?C0894:
021A 80E4              SJMP    ?C0051
021C         ?C0052:
                                           ; SOURCE LINE # 284
021C 90FFF0            MOV     DPTR,#sata+0F0H
021F 74F0              MOV     A,#0F0H
0221 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 287
0222 90FF3E            MOV     DPTR,#sata+03EH
0225 E0                MOVX    A,@DPTR
0226 4401              ORL     A,#01H
0228 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 289
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 25  

0229 E4                CLR     A
022A 90FF35            MOV     DPTR,#sata+035H
022D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 293
022E 120000      R     LCALL   init_tx_fis
                                           ; SOURCE LINE # 294
0231 E4                CLR     A
0232 FB                MOV     R3,A
0233 7D01              MOV     R5,#01H
0235 7F50              MOV     R7,#050H
0237 120000      R     LCALL   _tx_fis_34
                                           ; SOURCE LINE # 295
023A 120000      R     LCALL   L?1073
                                           ; SOURCE LINE # 300
023D 90FFBE            MOV     DPTR,#sata+0BEH
0240 E0                MOVX    A,@DPTR
0241 54F0              ANL     A,#0F0H
0243 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 302
0244 907FB2            MOV     DPTR,#07FB2H
0247 E4                CLR     A
0248 93                MOVC    A,@A+DPTR
0249 90FFBF            MOV     DPTR,#sata+0BFH
024C 6006              JZ      ?C0055
024E E0                MOVX    A,@DPTR
024F 4408              ORL     A,#08H
0251 F0                MOVX    @DPTR,A
0252 8004              SJMP    ?C0056
0254         ?C0055:
                                           ; SOURCE LINE # 303
0254 E0                MOVX    A,@DPTR
0255 54F7              ANL     A,#0F7H
0257 F0                MOVX    @DPTR,A
0258         ?C0056:
                                           ; SOURCE LINE # 307
0258 90FF1E            MOV     DPTR,#sata+01EH
025B E0                MOVX    A,@DPTR
025C 54BF              ANL     A,#0BFH
025E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 308
025F E4                CLR     A
0260 F5D9              MOV     SFR_watch_dog_high,A
0262         ?C0057:
                                           ; SOURCE LINE # 310
0262 7800        R     MOV     R0,#LOW g_current_fis_num
0264 E6                MOV     A,@R0
0265 659F              XRL     A,SFR_fis_num
0267 60F9              JZ      ?C0057
0269         ?C0058:
                                           ; SOURCE LINE # 311
0269 90FFCE            MOV     DPTR,#sata+0CEH
026C E0                MOVX    A,@DPTR
026D 54FD              ANL     A,#0FDH
026F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 312
0270 22                RET     
             ; FUNCTION _init (END)

             ; FUNCTION init_tx_fis (BEGIN)
                                           ; SOURCE LINE # 319
                                           ; SOURCE LINE # 320
                                           ; SOURCE LINE # 322
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 26  

0000 E4                CLR     A
0001 90FF04            MOV     DPTR,#sata+04H
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 323
0005 90FF10            MOV     DPTR,#sata+010H
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 324
0009 A3                INC     DPTR
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 325
000B A3                INC     DPTR
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 326
000D A3                INC     DPTR
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 327
000F A3                INC     DPTR
0010 04                INC     A
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 328
0012 E4                CLR     A
0013 A3                INC     DPTR
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 329
0015 A3                INC     DPTR
0016 04                INC     A
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 330
0018 E4                CLR     A
0019 A3                INC     DPTR
001A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 331
001B A3                INC     DPTR
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 332
001D A3                INC     DPTR
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 333
001F A3                INC     DPTR
0020 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 334
0021 A3                INC     DPTR
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 335
0023 22                RET     
             ; FUNCTION init_tx_fis (END)

             ; FUNCTION int0_handler (BEGIN)
0000 C0E0              PUSH    ACC
0002 C0F0              PUSH    B
0004 C083              PUSH    DPH
0006 C082              PUSH    DPL
0008 C0D0              PUSH    PSW
000A 75D000            MOV     PSW,#00H
000D C000              PUSH    AR0
000F C001              PUSH    AR1
0011 C002              PUSH    AR2
0013 C003              PUSH    AR3
0015 C004              PUSH    AR4
0017 C005              PUSH    AR5
0019 C006              PUSH    AR6
001B C007              PUSH    AR7
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 27  

                                           ; SOURCE LINE # 341
                                           ; SOURCE LINE # 345
001D 5387EF            ANL     TS8052_PCON,#0EFH
                                           ; SOURCE LINE # 346
0020 90FF3E            MOV     DPTR,#sata+03EH
0023 E0                MOVX    A,@DPTR
0024 54FE              ANL     A,#0FEH
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 355
0027 90FF00            MOV     DPTR,#sata
002A 74FF              MOV     A,#0FFH
002C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 356
002D 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 357
0030 90FFCE            MOV     DPTR,#sata+0CEH
0033 E0                MOVX    A,@DPTR
0034 4402              ORL     A,#02H
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 358
0037 90FF1E            MOV     DPTR,#sata+01EH
003A 7440              MOV     A,#040H
003C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 359
003D 90FF34            MOV     DPTR,#sata+034H
0040 7410              MOV     A,#010H
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 360
0043 D007              POP     AR7
0045 D006              POP     AR6
0047 D005              POP     AR5
0049 D004              POP     AR4
004B D003              POP     AR3
004D D002              POP     AR2
004F D001              POP     AR1
0051 D000              POP     AR0
0053 D0D0              POP     PSW
0055 D082              POP     DPL
0057 D083              POP     DPH
0059 D0F0              POP     B
005B D0E0              POP     ACC
005D 32                RETI    
             ; FUNCTION int0_handler (END)

             ; FUNCTION int1_handler (BEGIN)
0000 C0E0              PUSH    ACC
0002 C0F0              PUSH    B
0004 C083              PUSH    DPH
0006 C082              PUSH    DPL
0008 C0D0              PUSH    PSW
000A 75D000            MOV     PSW,#00H
000D C000              PUSH    AR0
000F C001              PUSH    AR1
0011 C002              PUSH    AR2
0013 C003              PUSH    AR3
0015 C004              PUSH    AR4
0017 C005              PUSH    AR5
0019 C006              PUSH    AR6
001B C007              PUSH    AR7
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 370
001D 750000      R     MOV     tmp_flag,#00H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 28  

                                           ; SOURCE LINE # 371
0020 E587              MOV     A,TS8052_PCON
0022 30E406            JNB     ACC.4,?C0062
                                           ; SOURCE LINE # 372
                                           ; SOURCE LINE # 373
0025 750001      R     MOV     tmp_flag,#01H
                                           ; SOURCE LINE # 374
0028 5387EF            ANL     TS8052_PCON,#0EFH
                                           ; SOURCE LINE # 375
002B         ?C0062:
                                           ; SOURCE LINE # 379
002B 120000      R     LCALL   check_power_loss
                                           ; SOURCE LINE # 383
002E 90FFC7            MOV     DPTR,#sata+0C7H
0031 E0                MOVX    A,@DPTR
0032 30E703            JNB     ACC.7,?C0063
0035 120000      R     LCALL   uart_int_handler
0038         ?C0063:
                                           ; SOURCE LINE # 392
0038 E500        R     MOV     A,tmp_flag
003A B40103            CJNE    A,#01H,?C0065
                                           ; SOURCE LINE # 393
                                           ; SOURCE LINE # 394
003D 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 395
                                           ; SOURCE LINE # 399
0040         ?C0065:
0040 D007              POP     AR7
0042 D006              POP     AR6
0044 D005              POP     AR5
0046 D004              POP     AR4
0048 D003              POP     AR3
004A D002              POP     AR2
004C D001              POP     AR1
004E D000              POP     AR0
0050 D0D0              POP     PSW
0052 D082              POP     DPL
0054 D083              POP     DPH
0056 D0F0              POP     B
0058 D0E0              POP     ACC
005A 32                RETI    
             ; FUNCTION int1_handler (END)

             ; FUNCTION L?1054 (BEGIN)
0000         L?1055:
0000 7412              MOV     A,#012H
0002         L?1056:
0002 90FF7E            MOV     DPTR,#sata+07EH
0005 F0                MOVX    @DPTR,A
             ; FUNCTION wait_chp_ready (BEGIN)
                                           ; SOURCE LINE # 402
                                           ; SOURCE LINE # 403
0006         ?C0066:
                                           ; SOURCE LINE # 404
                                           ; SOURCE LINE # 405
                                           ; SOURCE LINE # 407
0006 E5D6              MOV     A,SFR_CHP_rdy
0008 55D7              ANL     A,SFR_CHP_en
000A 65D7              XRL     A,SFR_CHP_en
000C 6005              JZ      ?C0069
000E         ?C0068:
                                           ; SOURCE LINE # 412
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 29  

000E 120000      R     LCALL   check_power_loss
                                           ; SOURCE LINE # 414
0011 80F3              SJMP    ?C0066
                                           ; SOURCE LINE # 415
0013         ?C0069:
0013 22                RET     
             ; FUNCTION wait_chp_ready (END)

             ; FUNCTION wait_chp_not_ready (BEGIN)
                                           ; SOURCE LINE # 417
                                           ; SOURCE LINE # 418
0000         ?C0070:
                                           ; SOURCE LINE # 419
                                           ; SOURCE LINE # 420
                                           ; SOURCE LINE # 421
0000 E5D6              MOV     A,SFR_CHP_rdy
0002 55D7              ANL     A,SFR_CHP_en
0004 6005              JZ      ?C0073
0006         ?C0072:
                                           ; SOURCE LINE # 424
0006 120000      R     LCALL   check_power_loss
                                           ; SOURCE LINE # 426
0009 80F5              SJMP    ?C0070
                                           ; SOURCE LINE # 428
000B         ?C0073:
000B 22                RET     
             ; FUNCTION wait_chp_not_ready (END)

             ; FUNCTION L?1065 (BEGIN)
0000         L?1066:
0000 7BFF              MOV     R3,#0FFH
0002 E4                CLR     A
0003 FD                MOV     R5,A
0004 7F50              MOV     R7,#050H
             ; FUNCTION _tx_fis_34 (BEGIN)
                                           ; SOURCE LINE # 429
;---- Variable 'status' assigned to Register 'R7' ----
;---- Variable 'flag' assigned to Register 'R3' ----
;---- Variable 'error' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 430
                                           ; SOURCE LINE # 431
0006 90FF01            MOV     DPTR,#sata+01H
0009 ED                MOV     A,R5
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 432
000B 90FF0B            MOV     DPTR,#sata+0BH
000E EF                MOV     A,R7
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 433
0010 EB                MOV     A,R3
0011 90FF13            MOV     DPTR,#sata+013H
0014 6006              JZ      ?C0074
0016 E0                MOVX    A,@DPTR
0017 4440              ORL     A,#040H
0019 F0                MOVX    @DPTR,A
001A 8004              SJMP    ?C0075
001C         ?C0074:
                                           ; SOURCE LINE # 434
001C E0                MOVX    A,@DPTR
001D 54BF              ANL     A,#0BFH
001F F0                MOVX    @DPTR,A
0020         ?C0075:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 30  

                                           ; SOURCE LINE # 435
0020 90FF37            MOV     DPTR,#sata+037H
0023 7434              MOV     A,#034H
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 436
0026 22                RET     
             ; FUNCTION _tx_fis_34 (END)

             ; FUNCTION L?1057 (BEGIN)
0000         L?1058:
0000 750001      R     MOV     ?_tx_fis_5f?BYTE+03H,#01H
0003 E4                CLR     A
0004 F500        R     MOV     ?_tx_fis_5f?BYTE+04H,A
0006 7500D0      R     MOV     ?_tx_fis_5f?BYTE+05H,#0D0H
0009 FB                MOV     R3,A
000A FD                MOV     R5,A
000B 7F58              MOV     R7,#058H
             ; FUNCTION _tx_fis_5f (BEGIN)
                                           ; SOURCE LINE # 438
;---- Variable 'status' assigned to Register 'R7' ----
;---- Variable 'flag' assigned to Register 'R3' ----
;---- Variable 'error' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 439
                                           ; SOURCE LINE # 440
000D 90FF01            MOV     DPTR,#sata+01H
0010 ED                MOV     A,R5
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 441
0012 90FF0B            MOV     DPTR,#sata+0BH
0015 EF                MOV     A,R7
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 442
0017 90FF13            MOV     DPTR,#sata+013H
001A EB                MOV     A,R3
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 443
001C A3                INC     DPTR
001D E500        R     MOV     A,seccnt
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 444
0020 A3                INC     DPTR
0021 E500        R     MOV     A,seccnt_ext
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 445
0024 E4                CLR     A
0025 90FF05            MOV     DPTR,#sata+05H
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 447
0029 A3                INC     DPTR
002A 7402              MOV     A,#02H
002C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 448
002D 90FF04            MOV     DPTR,#sata+04H
0030 E500        R     MOV     A,estatus
0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 449
0033 90FF37            MOV     DPTR,#sata+037H
0036 745F              MOV     A,#05FH
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 450
0039 22                RET     
             ; FUNCTION _tx_fis_5f (END)
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 31  


             ; FUNCTION _tx_fis_A1 (BEGIN)
                                           ; SOURCE LINE # 452
;---- Variable 'status' assigned to Register 'R7' ----
;---- Variable 'flag' assigned to Register 'R3' ----
;---- Variable 'error' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 453
                                           ; SOURCE LINE # 454
0000 90FF01            MOV     DPTR,#sata+01H
0003 ED                MOV     A,R5
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 455
0005 90FF0B            MOV     DPTR,#sata+0BH
0008 EF                MOV     A,R7
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 456
000A EB                MOV     A,R3
000B 90FF13            MOV     DPTR,#sata+013H
000E 6006              JZ      ?C0078
0010 E0                MOVX    A,@DPTR
0011 4440              ORL     A,#040H
0013 F0                MOVX    @DPTR,A
0014 8004              SJMP    ?C0079
0016         ?C0078:
                                           ; SOURCE LINE # 457
0016 E0                MOVX    A,@DPTR
0017 54BF              ANL     A,#0BFH
0019 F0                MOVX    @DPTR,A
001A         ?C0079:
                                           ; SOURCE LINE # 458
001A 90FF13            MOV     DPTR,#sata+013H
001D E0                MOVX    A,@DPTR
001E 4480              ORL     A,#080H
0020 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 459
0021 90FF37            MOV     DPTR,#sata+037H
0024 74A1              MOV     A,#0A1H
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 460
0027 22                RET     
             ; FUNCTION _tx_fis_A1 (END)

             ; FUNCTION L?1070 (BEGIN)
0000 0D                INC     R5
0001 7F80              MOV     R7,#080H
             ; FUNCTION _sata_burst (BEGIN)
                                           ; SOURCE LINE # 466
;---- Variable 'cnt' assigned to Register 'R5' ----
;---- Variable 'dir' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 467
                                           ; SOURCE LINE # 468
0003 E4                CLR     A
0004 F5E7              MOV     SFR_sata_burst_base+01H,A
0006 F5E6              MOV     SFR_sata_burst_base,A
                                           ; SOURCE LINE # 469
0008 8DDE              MOV     SFR_sata_burst_cnt_l,R5
                                           ; SOURCE LINE # 470
000A F5DF              MOV     SFR_sata_burst_cnt_h,A
                                           ; SOURCE LINE # 472
000C 75E810            MOV     SFR_sata_burst_cntl,#010H
                                           ; SOURCE LINE # 475
000F 8FE8              MOV     SFR_sata_burst_cntl,R7
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 32  

0011         ?C0081:
                                           ; SOURCE LINE # 476
0011 30E8FD            JNB     sata_burst_done,?C0081
0014         ?C0082:
                                           ; SOURCE LINE # 478
0014         ?C0083:
0014 22                RET     
             ; FUNCTION _sata_burst (END)

             ; FUNCTION bist_handler (BEGIN)
                                           ; SOURCE LINE # 481
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 485
0000 90FF64            MOV     DPTR,#sata+064H
0003 742D              MOV     A,#02DH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 487
0006 90FF66            MOV     DPTR,#sata+066H
0009 7483              MOV     A,#083H
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 488
000C A3                INC     DPTR
000D 742B              MOV     A,#02BH
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 512
0010 22                RET     
             ; FUNCTION bist_handler (END)

             ; FUNCTION save_lba (BEGIN)
                                           ; SOURCE LINE # 514
                                           ; SOURCE LINE # 515
                                           ; SOURCE LINE # 516
0000 E4                CLR     A
0001 90FF57            MOV     DPTR,#sata+057H
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 517
0005 90FF78            MOV     DPTR,#sata+078H
0008 E0                MOVX    A,@DPTR
0009 F500        R     MOV     g_lba,A
                                           ; SOURCE LINE # 518
000B A3                INC     DPTR
000C E0                MOVX    A,@DPTR
000D F500        R     MOV     g_lba+01H,A
                                           ; SOURCE LINE # 519
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011 F500        R     MOV     g_lba+02H,A
                                           ; SOURCE LINE # 520
0013 A3                INC     DPTR
0014 E0                MOVX    A,@DPTR
0015 F500        R     MOV     g_lba+03H,A
                                           ; SOURCE LINE # 521
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 F500        R     MOV     g_lba+04H,A
                                           ; SOURCE LINE # 522
001B A3                INC     DPTR
001C E0                MOVX    A,@DPTR
001D F500        R     MOV     g_lba+05H,A
                                           ; SOURCE LINE # 523
001F 907FBC            MOV     DPTR,#07FBCH
0022 E4                CLR     A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 33  

0023 93                MOVC    A,@A+DPTR
0024 90FF57            MOV     DPTR,#sata+057H
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 524
0028 22                RET     
             ; FUNCTION save_lba (END)

             ; FUNCTION recover_lba (BEGIN)
                                           ; SOURCE LINE # 525
                                           ; SOURCE LINE # 526
                                           ; SOURCE LINE # 527
0000 90FF78            MOV     DPTR,#sata+078H
0003 E500        R     MOV     A,g_lba
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 528
0006 A3                INC     DPTR
0007 E500        R     MOV     A,g_lba+01H
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 529
000A A3                INC     DPTR
000B E500        R     MOV     A,g_lba+02H
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 530
000E A3                INC     DPTR
000F E500        R     MOV     A,g_lba+03H
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 531
0012 A3                INC     DPTR
0013 E500        R     MOV     A,g_lba+04H
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 532
0016 A3                INC     DPTR
0017 E500        R     MOV     A,g_lba+05H
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 533
001A 22                RET     
             ; FUNCTION recover_lba (END)

             ; FUNCTION check_power_loss (BEGIN)
                                           ; SOURCE LINE # 535
                                           ; SOURCE LINE # 536
                                           ; SOURCE LINE # 538
0000 90FFC7            MOV     DPTR,#sata+0C7H
0003 E0                MOVX    A,@DPTR
0004 30E639            JNB     ACC.6,?C0088
0007         ?C0087:
                                           ; SOURCE LINE # 539
0007 90FFC7            MOV     DPTR,#sata+0C7H
000A E0                MOVX    A,@DPTR
000B 30E632            JNB     ACC.6,?C0088
000E         ?C0089:
                                           ; SOURCE LINE # 540
000E 90FFC7            MOV     DPTR,#sata+0C7H
0011 E0                MOVX    A,@DPTR
0012 30E62B            JNB     ACC.6,?C0088
0015         ?C0090:
                                           ; SOURCE LINE # 541
0015 90FFC7            MOV     DPTR,#sata+0C7H
0018 E0                MOVX    A,@DPTR
0019 30E624            JNB     ACC.6,?C0088
001C         ?C0091:
                                           ; SOURCE LINE # 544
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 34  

001C 90FFF0            MOV     DPTR,#sata+0F0H
001F 740F              MOV     A,#0FH
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 547
0022 90FFCC            MOV     DPTR,#sata+0CCH
0025 74C0              MOV     A,#0C0H
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 549
0028 90FF20            MOV     DPTR,#sata+020H
002B E0                MOVX    A,@DPTR
002C 44C0              ORL     A,#0C0H
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 550
002F 90FF60            MOV     DPTR,#sata+060H
0032 E0                MOVX    A,@DPTR
0033 4480              ORL     A,#080H
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 553
0036 7F02              MOV     R7,#02H
0038 7E00              MOV     R6,#00H
003A 120000      R     LCALL   _delay_ms
                                           ; SOURCE LINE # 554
003D 75F6B0            MOV     SFR_cpu_reboot,#0B0H
                                           ; SOURCE LINE # 557
0040         ?C0088:
0040 22                RET     
             ; FUNCTION check_power_loss (END)

             ; FUNCTION L?1069 (BEGIN)
0000 E4                CLR     A
0001 F5F4              MOV     SFR_ext_sram_cntl,A
             ; FUNCTION gen_check_sum (BEGIN)
                                           ; SOURCE LINE # 7
;---- Variable 'temp' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 8
                                           ; SOURCE LINE # 11
0003 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 12
0006 E4                CLR     A
0007 F5F2              MOV     SFR_ext_sram_addr+01H,A
0009 F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 13
;---- Variable 'sum' assigned to Register 'R6' ----
000B FE                MOV     R6,A
                                           ; SOURCE LINE # 14
;---- Variable 'jj' assigned to Register 'R4/R5' ----
000C FD                MOV     R5,A
000D FC                MOV     R4,A
000E         ?C0092:
                                           ; SOURCE LINE # 15
                                           ; SOURCE LINE # 16
000E AFF3              MOV     R7,SFR_ext_sram_data
                                           ; SOURCE LINE # 17
0010 EF                MOV     A,R7
0011 2E                ADD     A,R6
0012 FE                MOV     R6,A
                                           ; SOURCE LINE # 18
0013 0D                INC     R5
0014 BD0001            CJNE    R5,#00H,?C0895
0017 0C                INC     R4
0018         ?C0895:
0018 BC01F3            CJNE    R4,#01H,?C0092
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 35  

001B BDFFF0            CJNE    R5,#0FFH,?C0092
001E         ?C0093:
                                           ; SOURCE LINE # 20
001E EE                MOV     A,R6
001F F4                CPL     A
0020 04                INC     A
0021 FF                MOV     R7,A
                                           ; SOURCE LINE # 21
                                           ; SOURCE LINE # 22
0022         ?C0095:
0022 22                RET     
             ; FUNCTION gen_check_sum (END)

             ; FUNCTION L?1059 (BEGIN)
0000         L?1060:
0000 7BFF              MOV     R3,#0FFH
0002 7D04              MOV     R5,#04H
0004 7F51              MOV     R7,#051H
0006 120000      R     LCALL   _tx_fis_34
             ; FUNCTION reset_engine (BEGIN)
                                           ; SOURCE LINE # 25
                                           ; SOURCE LINE # 26
                                           ; SOURCE LINE # 28
0009 75F818            MOV     SFR_dma_cntl,#018H
                                           ; SOURCE LINE # 29
000C 907FBA            MOV     DPTR,#07FBAH
000F E4                CLR     A
0010 93                MOVC    A,@A+DPTR
0011 F5D7              MOV     SFR_CHP_en,A
                                           ; SOURCE LINE # 30
                                           ; SOURCE LINE # 31
0013 120000      R     LCALL   L?1054
                                           ; SOURCE LINE # 32
0016 C200        R     CLR     g_cont_en
                                           ; SOURCE LINE # 33
0018 22                RET     
             ; FUNCTION reset_engine (END)

             ; FUNCTION reset_engine_read_write (BEGIN)
                                           ; SOURCE LINE # 35
                                           ; SOURCE LINE # 36
                                           ; SOURCE LINE # 37
                                           ; SOURCE LINE # 38
0000 75F818            MOV     SFR_dma_cntl,#018H
                                           ; SOURCE LINE # 39
0003 907FBA            MOV     DPTR,#07FBAH
0006 E4                CLR     A
0007 93                MOVC    A,@A+DPTR
0008 F5D7              MOV     SFR_CHP_en,A
                                           ; SOURCE LINE # 40
000A 90FF7E            MOV     DPTR,#sata+07EH
000D 7412              MOV     A,#012H
000F F0                MOVX    @DPTR,A
0010         ?C0097:
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
                                           ; SOURCE LINE # 44
0010 E5D6              MOV     A,SFR_CHP_rdy
0012 55D7              ANL     A,SFR_CHP_en
0014 65D7              XRL     A,SFR_CHP_en
0016 600B              JZ      ?C0098
0018         ?C0099:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 36  

                                           ; SOURCE LINE # 45
0018 7800        R     MOV     R0,#LOW g_current_fis_num
001A E6                MOV     A,@R0
001B B59F05            CJNE    A,SFR_fis_num,?C0098
001E         ?C0100:
                                           ; SOURCE LINE # 49
001E 120000      R     LCALL   check_power_loss
                                           ; SOURCE LINE # 51
0021 80ED              SJMP    ?C0097
0023         ?C0098:
                                           ; SOURCE LINE # 52
0023 C200        R     CLR     g_cont_en
                                           ; SOURCE LINE # 53
                                           ; SOURCE LINE # 54
0025 22                RET     
             ; FUNCTION reset_engine_read_write (END)

             ; FUNCTION check_lba (BEGIN)
                                           ; SOURCE LINE # 56
                                           ; SOURCE LINE # 57
                                           ; SOURCE LINE # 58
0000 C200        R     CLR     g_flag_lba_err
                                           ; SOURCE LINE # 60
0002 E5D1              MOV     A,SFR_cmd_aux
0004 30E516            JNB     ACC.5,?C0102
                                           ; SOURCE LINE # 61
                                           ; SOURCE LINE # 63
0007 E5BE              MOV     A,SFR_lba_comp
0009 30E60D            JNB     ACC.6,?C0103
                                           ; SOURCE LINE # 64
                                           ; SOURCE LINE # 67
000C E4                CLR     A
000D 90FF57            MOV     DPTR,#sata+057H
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 69
0011 907FBC            MOV     DPTR,#07FBCH
0014 93                MOVC    A,@A+DPTR
0015 90FF57            MOV     DPTR,#sata+057H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 72
0019         ?C0103:
                                           ; SOURCE LINE # 74
0019 75C901            MOV     SFR_smart_load,#01H
                                           ; SOURCE LINE # 75
001C 22                RET     
001D         ?C0102:
                                           ; SOURCE LINE # 78
                                           ; SOURCE LINE # 92
001D E500        R     MOV     A,security_mode
001F B42003            CJNE    A,#020H,?C0105
                                           ; SOURCE LINE # 93
                                           ; SOURCE LINE # 94
0022 D200        R     SETB    g_flag_lba_err
                                           ; SOURCE LINE # 96
0024 22                RET     
0025         ?C0105:
                                           ; SOURCE LINE # 98
                                           ; SOURCE LINE # 99
0025 75C903            MOV     SFR_smart_load,#03H
                                           ; SOURCE LINE # 100
                                           ; SOURCE LINE # 102
                                           ; SOURCE LINE # 103
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 37  

0028         ?C0107:
0028 22                RET     
             ; FUNCTION check_lba (END)

             ; FUNCTION security_check_lba (BEGIN)
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 106
                                           ; SOURCE LINE # 107
0000 C200        R     CLR     g_flag_lba_err
                                           ; SOURCE LINE # 109
0002 E5D1              MOV     A,SFR_cmd_aux
0004 30E51D            JNB     ACC.5,?C0108
                                           ; SOURCE LINE # 110
                                           ; SOURCE LINE # 135
0007 E5BE              MOV     A,SFR_lba_comp
0009 30E612            JNB     ACC.6,?C0109
                                           ; SOURCE LINE # 136
                                           ; SOURCE LINE # 139
000C E4                CLR     A
000D 90FF57            MOV     DPTR,#sata+057H
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 141
0011 907FBC            MOV     DPTR,#07FBCH
0014 93                MOVC    A,@A+DPTR
0015 90FF57            MOV     DPTR,#sata+057H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 143
0019 D200        R     SETB    g_flag_lba_err
                                           ; SOURCE LINE # 144
                                           ; SOURCE LINE # 145
001B 120000      R     LCALL   L?1059
                                           ; SOURCE LINE # 146
001E         ?C0109:
                                           ; SOURCE LINE # 148
001E 75C901            MOV     SFR_smart_load,#01H
                                           ; SOURCE LINE # 157
0021 020000      R     LJMP    choose_lba
                                           ; SOURCE LINE # 168
0024         ?C0108:
                                           ; SOURCE LINE # 171
                                           ; SOURCE LINE # 185
0024 E500        R     MOV     A,security_mode
0026 B42003            CJNE    A,#020H,?C0111
                                           ; SOURCE LINE # 186
                                           ; SOURCE LINE # 187
0029 D200        R     SETB    g_flag_lba_err
                                           ; SOURCE LINE # 188
002B 22                RET     
002C         ?C0111:
                                           ; SOURCE LINE # 190
002C 75C903            MOV     SFR_smart_load,#03H
                                           ; SOURCE LINE # 192
                                           ; SOURCE LINE # 193
002F         ?C0113:
002F 22                RET     
             ; FUNCTION security_check_lba (END)

             ; FUNCTION security_check_chs (BEGIN)
                                           ; SOURCE LINE # 199
                                           ; SOURCE LINE # 200
                                           ; SOURCE LINE # 201
0000 E500        R     MOV     A,security_mode
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 38  

0002 B42003            CJNE    A,#020H,?C0114
                                           ; SOURCE LINE # 202
                                           ; SOURCE LINE # 203
0005 D200        R     SETB    g_flag_lba_err
                                           ; SOURCE LINE # 204
0007 22                RET     
0008         ?C0114:
                                           ; SOURCE LINE # 206
0008 75C903            MOV     SFR_smart_load,#03H
                                           ; SOURCE LINE # 215
000B         ?C0116:
000B 22                RET     
             ; FUNCTION security_check_chs (END)

             ; FUNCTION check_sec_cnt (BEGIN)
                                           ; SOURCE LINE # 222
                                           ; SOURCE LINE # 223
                                           ; SOURCE LINE # 225
0000 85BD00      R     MOV     g_sec_cnt,SFR_smart_cnt+01H
0003 85BC00      R     MOV     g_sec_cnt+01H,SFR_smart_cnt
                                           ; SOURCE LINE # 226
0006 22                RET     
             ; FUNCTION check_sec_cnt (END)

             ; FUNCTION soft_lba_add (BEGIN)
                                           ; SOURCE LINE # 232
                                           ; SOURCE LINE # 233
                                           ; SOURCE LINE # 237
0000 E4                CLR     A
0001 90FF57            MOV     DPTR,#sata+057H
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 238
0005 90FF78            MOV     DPTR,#sata+078H
0008 E0                MOVX    A,@DPTR
0009 F500        R     MOV     g_lba_add,A
                                           ; SOURCE LINE # 239
000B A3                INC     DPTR
000C E0                MOVX    A,@DPTR
000D F500        R     MOV     g_lba_add+01H,A
                                           ; SOURCE LINE # 240
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011 F500        R     MOV     g_lba_add+02H,A
                                           ; SOURCE LINE # 241
0013 A3                INC     DPTR
0014 E0                MOVX    A,@DPTR
0015 F500        R     MOV     g_lba_add+03H,A
                                           ; SOURCE LINE # 242
0017 907FBC            MOV     DPTR,#07FBCH
001A E4                CLR     A
001B 93                MOVC    A,@A+DPTR
001C 90FF57            MOV     DPTR,#sata+057H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 244
;---- Variable 'tmp_data' assigned to Register 'R7' ----
0020 AF00        R     MOV     R7,g_lba_add
                                           ; SOURCE LINE # 245
0022 E500        R     MOV     A,g_sec_cnt+01H
0024 6006              JZ      ?C0118
                                           ; SOURCE LINE # 246
0026 E500        R     MOV     A,g_sec_cnt+01H
0028 2500        R     ADD     A,g_lba_add
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 39  

002A F500        R     MOV     g_lba_add,A
002C         ?C0118:
                                           ; SOURCE LINE # 248
002C EF                MOV     A,R7
002D D3                SETB    C
002E 9500        R     SUBB    A,g_lba_add
0030 5004              JNC     ?C0120
0032 E500        R     MOV     A,g_sec_cnt+01H
0034 7016              JNZ     ?C0123
0036         ?C0120:
                                           ; SOURCE LINE # 249
                                           ; SOURCE LINE # 250
0036 AF00        R     MOV     R7,g_lba_add+01H
                                           ; SOURCE LINE # 251
0038 0500        R     INC     g_lba_add+01H
                                           ; SOURCE LINE # 253
003A EF                MOV     A,R7
003B D3                SETB    C
003C 9500        R     SUBB    A,g_lba_add+01H
003E 400C              JC      ?C0123
                                           ; SOURCE LINE # 254
                                           ; SOURCE LINE # 255
0040 AF00        R     MOV     R7,g_lba_add+02H
                                           ; SOURCE LINE # 256
0042 0500        R     INC     g_lba_add+02H
                                           ; SOURCE LINE # 258
0044 EF                MOV     A,R7
0045 D3                SETB    C
0046 9500        R     SUBB    A,g_lba_add+02H
0048 4002              JC      ?C0123
                                           ; SOURCE LINE # 259
                                           ; SOURCE LINE # 260
                                           ; SOURCE LINE # 261
004A 0500        R     INC     g_lba_add+03H
                                           ; SOURCE LINE # 262
                                           ; SOURCE LINE # 263
                                           ; SOURCE LINE # 264
                                           ; SOURCE LINE # 266
004C         ?C0123:
004C 22                RET     
             ; FUNCTION soft_lba_add (END)

             ; FUNCTION chs_cmp_lba (BEGIN)
                                           ; SOURCE LINE # 274
                                           ; SOURCE LINE # 275
                                           ; SOURCE LINE # 276
0000 E4                CLR     A
0001 90FF57            MOV     DPTR,#sata+057H
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 277
0005 90FF78            MOV     DPTR,#sata+078H
0008 E0                MOVX    A,@DPTR
0009 6500        R     XRL     A,g_lba_add
000B 7021              JNZ     discontinue
000D         ?C0124:
                                           ; SOURCE LINE # 278
000D 90FF79            MOV     DPTR,#sata+079H
0010 E0                MOVX    A,@DPTR
0011 B5001A      R     CJNE    A,g_lba_add+01H,discontinue
0014         ?C0126:
                                           ; SOURCE LINE # 279
0014 90FF7A            MOV     DPTR,#sata+07AH
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 40  

0017 E0                MOVX    A,@DPTR
0018 B50013      R     CJNE    A,g_lba_add+02H,discontinue
001B         ?C0127:
                                           ; SOURCE LINE # 280
001B 90FF7B            MOV     DPTR,#sata+07BH
001E E0                MOVX    A,@DPTR
001F B5000C      R     CJNE    A,g_lba_add+03H,discontinue
0022         ?C0128:
                                           ; SOURCE LINE # 283
0022 907FBC            MOV     DPTR,#07FBCH
0025 E4                CLR     A
0026 93                MOVC    A,@A+DPTR
0027 90FF57            MOV     DPTR,#sata+057H
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 284
002B 7F01              MOV     R7,#01H
002D 22                RET     
                                           ; SOURCE LINE # 286
002E         discontinue:
                                           ; SOURCE LINE # 287
002E 907FBC            MOV     DPTR,#07FBCH
0031 E4                CLR     A
0032 93                MOVC    A,@A+DPTR
0033 90FF57            MOV     DPTR,#sata+057H
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 288
0037 7F00              MOV     R7,#00H
                                           ; SOURCE LINE # 289
0039         ?C0129:
0039 22                RET     
             ; FUNCTION chs_cmp_lba (END)

             ; FUNCTION chs_read_handle (BEGIN)
                                           ; SOURCE LINE # 292
                                           ; SOURCE LINE # 293
                                           ; SOURCE LINE # 299
0000 120000      R     LCALL   security_check_chs
                                           ; SOURCE LINE # 300
0003 120000      R     LCALL   reset_engine_read_write
                                           ; SOURCE LINE # 301
0006 7800        R     MOV     R0,#LOW g_current_fis_num
0008 E6                MOV     A,@R0
0009 659F              XRL     A,SFR_fis_num
000B 6003              JZ      $ + 5H
000D 020000      R     LJMP    ?C0131
0010         ?C0130:
                                           ; SOURCE LINE # 303
0010 90FF7E            MOV     DPTR,#sata+07EH
0013 7420              MOV     A,#020H
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 304
0016 D200        R     SETB    g_cont_en
                                           ; SOURCE LINE # 305
0018 E4                CLR     A
0019 F500        R     MOV     temp_sel,A
                                           ; SOURCE LINE # 306
001B 907FB7            MOV     DPTR,#07FB7H
001E 93                MOVC    A,@A+DPTR
001F B40505            CJNE    A,#05H,?C0132
0022 75000F      R     MOV     boundary_check,#0FH
0025 8010              SJMP    ?C0133
0027         ?C0132:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 41  

                                           ; SOURCE LINE # 307
0027 907FB7            MOV     DPTR,#07FB7H
002A E4                CLR     A
002B 93                MOVC    A,@A+DPTR
002C B40405            CJNE    A,#04H,?C0134
002F 750007      R     MOV     boundary_check,#07H
0032 8003              SJMP    ?C0133
0034         ?C0134:
                                           ; SOURCE LINE # 308
0034 750003      R     MOV     boundary_check,#03H
0037         ?C0133:
                                           ; SOURCE LINE # 310
0037 75C90C            MOV     SFR_smart_load,#0CH
                                           ; SOURCE LINE # 311
003A E4                CLR     A
003B F5FA              MOV     SFR_dma_base+01H,A
003D F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 312
003F 75F8D8            MOV     SFR_dma_cntl,#0D8H
                                           ; SOURCE LINE # 315
0042 90FF57            MOV     DPTR,#sata+057H
0045 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 317
0046 907FBC            MOV     DPTR,#07FBCH
0049 93                MOVC    A,@A+DPTR
004A 90FF57            MOV     DPTR,#sata+057H
004D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 320
004E         chs_read_cont:
                                           ; SOURCE LINE # 321
004E E5D7              MOV     A,SFR_CHP_en
0050 6401              XRL     A,#01H
0052 7027              JNZ     ?C0143
                                           ; SOURCE LINE # 322
                                           ; SOURCE LINE # 323
0054 F500        R     MOV     temp_sel,A
                                           ; SOURCE LINE # 324
0056 90FF78            MOV     DPTR,#sata+078H
0059 E0                MOVX    A,@DPTR
005A FF                MOV     R7,A
;---- Variable 'temp_lba_low' assigned to Register 'R7' ----
005B         ?C0138:
                                           ; SOURCE LINE # 325
005B 20E848            JB      sata_burst_done,?C0142
                                           ; SOURCE LINE # 326
                                           ; SOURCE LINE # 327
;---- Variable 'temp8' assigned to Register 'R6' ----
005E AEFD              MOV     R6,SFR_dma_done_num_l
                                           ; SOURCE LINE # 328
0060 EF                MOV     A,R7
0061 2E                ADD     A,R6
0062 5500        R     ANL     A,boundary_check
0064 700D              JNZ     ?C0140
0066 E500        R     MOV     A,temp_sel
0068 6E                XRL     A,R6
0069 6008              JZ      ?C0140
                                           ; SOURCE LINE # 329
                                           ; SOURCE LINE # 330
006B 8E00        R     MOV     temp_sel,R6
                                           ; SOURCE LINE # 331
006D 90FF7E            MOV     DPTR,#sata+07EH
0070 742B              MOV     A,#02BH
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 42  

0072 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 332
0073         ?C0140:
                                           ; SOURCE LINE # 333
0073 7800        R     MOV     R0,#LOW g_current_fis_num
0075 E6                MOV     A,@R0
0076 659F              XRL     A,SFR_fis_num
0078 60E1              JZ      ?C0138
007A 22                RET     
                                           ; SOURCE LINE # 335
                                           ; SOURCE LINE # 337
007B         ?C0143:
                                           ; SOURCE LINE # 338
007B 20E828            JB      sata_burst_done,?C0142
                                           ; SOURCE LINE # 339
                                           ; SOURCE LINE # 340
007E 90FFC6            MOV     DPTR,#sata+0C6H
0081 E0                MOVX    A,@DPTR
0082 6500        R     XRL     A,temp_sel
0084 6018              JZ      ?C0145
                                           ; SOURCE LINE # 341
                                           ; SOURCE LINE # 342
0086 90FFCD            MOV     DPTR,#sata+0CDH
0089 E500        R     MOV     A,temp_sel
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 343
008C 90FF7E            MOV     DPTR,#sata+07EH
008F 742B              MOV     A,#02BH
0091 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 344
0092 90FFC6            MOV     DPTR,#sata+0C6H
0095 E0                MOVX    A,@DPTR
0096 F500        R     MOV     temp_sel,A
                                           ; SOURCE LINE # 345
0098 90FFCD            MOV     DPTR,#sata+0CDH
009B 74FF              MOV     A,#0FFH
009D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 346
009E         ?C0145:
                                           ; SOURCE LINE # 347
009E 7800        R     MOV     R0,#LOW g_current_fis_num
00A0 E6                MOV     A,@R0
00A1 659F              XRL     A,SFR_fis_num
00A3 60D6              JZ      ?C0143
00A5         ?C0941:
00A5 22                RET     
                                           ; SOURCE LINE # 349
00A6         ?C0142:
                                           ; SOURCE LINE # 351
00A6 20EA6D            JB      sata_burst_abort,chs_read_err
00A9         ?C0147:
                                           ; SOURCE LINE # 353
00A9 120000      R     LCALL   L?1065
                                           ; SOURCE LINE # 354
00AC 90FF5C            MOV     DPTR,#sata+05CH
00AF E0                MOVX    A,@DPTR
00B0 20E766            JB      ACC.7,chs_read_over
00B3 A3                INC     DPTR
00B4 E0                MOVX    A,@DPTR
00B5 20E761            JB      ACC.7,chs_read_over
00B8 A3                INC     DPTR
00B9 E0                MOVX    A,@DPTR
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 43  

00BA 20E75C            JB      ACC.7,chs_read_over
00BD A3                INC     DPTR
00BE E0                MOVX    A,@DPTR
00BF 20E757            JB      ACC.7,chs_read_over
00C2 90FF76            MOV     DPTR,#sata+076H
00C5 E0                MOVX    A,@DPTR
00C6 20E750            JB      ACC.7,chs_read_over
                                           ; SOURCE LINE # 355
                                           ; SOURCE LINE # 356
                                           ; SOURCE LINE # 357
00C9         ?C0149:
                                           ; SOURCE LINE # 359
00C9 75F818            MOV     SFR_dma_cntl,#018H
                                           ; SOURCE LINE # 362
00CC 120000      R     LCALL   soft_lba_add
                                           ; SOURCE LINE # 371
00CF E4                CLR     A
00D0 F5D9              MOV     SFR_watch_dog_high,A
00D2         ?C0152:
                                           ; SOURCE LINE # 372
                                           ; SOURCE LINE # 373
                                           ; SOURCE LINE # 374
00D2 7800        R     MOV     R0,#LOW g_current_fis_num
00D4 E6                MOV     A,@R0
00D5 659F              XRL     A,SFR_fis_num
00D7 6034              JZ      ?C0154
                                           ; SOURCE LINE # 375
                                           ; SOURCE LINE # 379
00D9 120000      R     LCALL   check_sec_cnt
                                           ; SOURCE LINE # 381
00DC E596              MOV     A,SFR_FIS0_2
00DE 64C8              XRL     A,#0C8H
00E0 7037              JNZ     chs_read_over
00E2 E5D1              MOV     A,SFR_cmd_aux
00E4 20E532            JB      ACC.5,chs_read_over
                                           ; SOURCE LINE # 382
                                           ; SOURCE LINE # 384
00E7 120000      R     LCALL   chs_cmp_lba
00EA EF                MOV     A,R7
00EB 602C              JZ      chs_read_over
00ED         ?C0156:
                                           ; SOURCE LINE # 387
00ED 7800        R     MOV     R0,#LOW g_current_fis_num
00EF A69F              MOV     @R0,SFR_fis_num
                                           ; SOURCE LINE # 388
00F1 90FF1E            MOV     DPTR,#sata+01EH
00F4 E0                MOVX    A,@DPTR
00F5 54FD              ANL     A,#0FDH
00F7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 392
00F8 7F01              MOV     R7,#01H
00FA 7E00              MOV     R6,#00H
00FC 120000      R     LCALL   _delay
                                           ; SOURCE LINE # 394
00FF 75C90C            MOV     SFR_smart_load,#0CH
                                           ; SOURCE LINE # 395
0102 E4                CLR     A
0103 F5FA              MOV     SFR_dma_base+01H,A
0105 F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 396
0107 75F8D8            MOV     SFR_dma_cntl,#0D8H
                                           ; SOURCE LINE # 397
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 44  

010A 020000      R     LJMP    chs_read_cont
                                           ; SOURCE LINE # 398
                                           ; SOURCE LINE # 399
                                           ; SOURCE LINE # 400
010D         ?C0154:
                                           ; SOURCE LINE # 401
010D E5D9              MOV     A,SFR_watch_dog_high
010F D3                SETB    C
0110 9420              SUBB    A,#020H
0112 40BE              JC      ?C0152
0114 8003              SJMP    chs_read_over
                                           ; SOURCE LINE # 403
                                           ; SOURCE LINE # 405
0116         chs_read_err:
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 408
0116 120000      R     LCALL   L?1051
                                           ; SOURCE LINE # 410
0119         chs_read_over:
                                           ; SOURCE LINE # 411
0119 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 413
011C         ?C0131:
011C 22                RET     
             ; FUNCTION chs_read_handle (END)

             ; FUNCTION chs_write_handle (BEGIN)
                                           ; SOURCE LINE # 416
                                           ; SOURCE LINE # 417
                                           ; SOURCE LINE # 419
0000 120000      R     LCALL   security_check_chs
                                           ; SOURCE LINE # 420
0003 120000      R     LCALL   reset_engine_read_write
                                           ; SOURCE LINE # 421
0006 7800        R     MOV     R0,#LOW g_current_fis_num
0008 E6                MOV     A,@R0
0009 659F              XRL     A,SFR_fis_num
000B 6003              JZ      $ + 5H
000D 020000      R     LJMP    ?C0160
0010         ?C0159:
                                           ; SOURCE LINE # 423
0010 E4                CLR     A
0011 90FF57            MOV     DPTR,#sata+057H
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 425
0015 907FBC            MOV     DPTR,#07FBCH
0018 93                MOVC    A,@A+DPTR
0019 90FF57            MOV     DPTR,#sata+057H
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 438
                                           ; SOURCE LINE # 439
001D 90FF7E            MOV     DPTR,#sata+07EH
0020 7430              MOV     A,#030H
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 440
0023 D200        R     SETB    g_cont_en
                                           ; SOURCE LINE # 441
0025 75C90C            MOV     SFR_smart_load,#0CH
                                           ; SOURCE LINE # 442
0028 E4                CLR     A
0029 F5FA              MOV     SFR_dma_base+01H,A
002B F5F9              MOV     SFR_dma_base,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 45  

                                           ; SOURCE LINE # 443
002D 75F898            MOV     SFR_dma_cntl,#098H
                                           ; SOURCE LINE # 444
                                           ; SOURCE LINE # 447
0030 90FF57            MOV     DPTR,#sata+057H
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 449
0034 907FBC            MOV     DPTR,#07FBCH
0037 93                MOVC    A,@A+DPTR
0038 90FF57            MOV     DPTR,#sata+057H
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 452
003C         chs_write_cont:
003C         ?C0162:
                                           ; SOURCE LINE # 453
003C 20E808            JB      sata_burst_done,?C0163
                                           ; SOURCE LINE # 454
                                           ; SOURCE LINE # 455
003F 7800        R     MOV     R0,#LOW g_current_fis_num
0041 E6                MOV     A,@R0
0042 659F              XRL     A,SFR_fis_num
0044 60F6              JZ      ?C0162
0046 22                RET     
0047         ?C0163:
                                           ; SOURCE LINE # 457
0047 20EA72            JB      sata_burst_abort,chs_write_err
004A         ?C0165:
004A         ?C0167:
                                           ; SOURCE LINE # 467
004A 20F808            JB      dma_done,?C0168
                                           ; SOURCE LINE # 468
                                           ; SOURCE LINE # 469
004D 7800        R     MOV     R0,#LOW g_current_fis_num
004F E6                MOV     A,@R0
0050 659F              XRL     A,SFR_fis_num
0052 60F6              JZ      ?C0167
0054         ?C0942:
0054 22                RET     
0055         ?C0168:
                                           ; SOURCE LINE # 472
0055 120000      R     LCALL   L?1065
                                           ; SOURCE LINE # 473
0058 90FF5C            MOV     DPTR,#sata+05CH
005B E0                MOVX    A,@DPTR
005C 20E760            JB      ACC.7,chs_write_over
005F A3                INC     DPTR
0060 E0                MOVX    A,@DPTR
0061 20E75B            JB      ACC.7,chs_write_over
0064 A3                INC     DPTR
0065 E0                MOVX    A,@DPTR
0066 20E756            JB      ACC.7,chs_write_over
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B 20E751            JB      ACC.7,chs_write_over
006E 90FF76            MOV     DPTR,#sata+076H
0071 E0                MOVX    A,@DPTR
0072 20E74A            JB      ACC.7,chs_write_over
                                           ; SOURCE LINE # 474
                                           ; SOURCE LINE # 475
                                           ; SOURCE LINE # 476
0075         ?C0170:
                                           ; SOURCE LINE # 477
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 46  

0075 75F818            MOV     SFR_dma_cntl,#018H
                                           ; SOURCE LINE # 480
0078 120000      R     LCALL   soft_lba_add
                                           ; SOURCE LINE # 489
007B E4                CLR     A
007C F5D9              MOV     SFR_watch_dog_high,A
007E         ?C0173:
                                           ; SOURCE LINE # 490
                                           ; SOURCE LINE # 491
                                           ; SOURCE LINE # 492
007E 7800        R     MOV     R0,#LOW g_current_fis_num
0080 E6                MOV     A,@R0
0081 659F              XRL     A,SFR_fis_num
0083 602C              JZ      ?C0175
                                           ; SOURCE LINE # 493
                                           ; SOURCE LINE # 495
0085 120000      R     LCALL   check_sec_cnt
                                           ; SOURCE LINE # 497
0088 E596              MOV     A,SFR_FIS0_2
008A 64CA              XRL     A,#0CAH
008C 7031              JNZ     chs_write_over
008E E5D1              MOV     A,SFR_cmd_aux
0090 20E52C            JB      ACC.5,chs_write_over
                                           ; SOURCE LINE # 498
                                           ; SOURCE LINE # 500
0093 120000      R     LCALL   chs_cmp_lba
0096 EF                MOV     A,R7
0097 6026              JZ      chs_write_over
0099         ?C0177:
                                           ; SOURCE LINE # 502
0099 7800        R     MOV     R0,#LOW g_current_fis_num
009B A69F              MOV     @R0,SFR_fis_num
                                           ; SOURCE LINE # 503
009D 90FF1E            MOV     DPTR,#sata+01EH
00A0 E0                MOVX    A,@DPTR
00A1 54FD              ANL     A,#0FDH
00A3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 504
00A4 75C90C            MOV     SFR_smart_load,#0CH
                                           ; SOURCE LINE # 505
00A7 E4                CLR     A
00A8 F5FA              MOV     SFR_dma_base+01H,A
00AA F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 506
00AC 75F898            MOV     SFR_dma_cntl,#098H
                                           ; SOURCE LINE # 507
00AF 808B              SJMP    ?C0162
                                           ; SOURCE LINE # 508
                                           ; SOURCE LINE # 509
                                           ; SOURCE LINE # 510
00B1         ?C0175:
                                           ; SOURCE LINE # 511
00B1 90FFBA            MOV     DPTR,#sata+0BAH
00B4 E0                MOVX    A,@DPTR
00B5 D3                SETB    C
00B6 9404              SUBB    A,#04H
00B8 40C4              JC      ?C0173
00BA 8003              SJMP    chs_write_over
                                           ; SOURCE LINE # 513
                                           ; SOURCE LINE # 515
00BC         chs_write_err:
                                           ; SOURCE LINE # 516
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 47  

                                           ; SOURCE LINE # 518
00BC 120000      R     LCALL   L?1051
                                           ; SOURCE LINE # 520
00BF         chs_write_over:
                                           ; SOURCE LINE # 521
00BF 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 523
00C2         ?C0160:
00C2 22                RET     
             ; FUNCTION chs_write_handle (END)

             ; FUNCTION read_handler (BEGIN)
                                           ; SOURCE LINE # 525
                                           ; SOURCE LINE # 526
                                           ; SOURCE LINE # 527
                                           ; SOURCE LINE # 540
0000 120000      R     LCALL   security_check_lba
                                           ; SOURCE LINE # 541
0003 90FF78            MOV     DPTR,#sata+078H
0006 E0                MOVX    A,@DPTR
;---- Variable 'temp_lba_low' assigned to Register 'R1' ----
0007 F9                MOV     R1,A
                                           ; SOURCE LINE # 542
0008 120000      R     LCALL   reset_engine_read_write
                                           ; SOURCE LINE # 543
000B 7800        R     MOV     R0,#LOW g_current_fis_num
000D E6                MOV     A,@R0
000E 659F              XRL     A,SFR_fis_num
0010 6003              JZ      $ + 5H
0012 020000      R     LJMP    ?C0181
0015         ?C0180:
                                           ; SOURCE LINE # 551
0015 90FF7E            MOV     DPTR,#sata+07EH
0018 7420              MOV     A,#020H
001A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 552
001B 75C90C            MOV     SFR_smart_load,#0CH
                                           ; SOURCE LINE # 553
001E E4                CLR     A
001F F5FA              MOV     SFR_dma_base+01H,A
0021 F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 554
0023 75F8DC            MOV     SFR_dma_cntl,#0DCH
                                           ; SOURCE LINE # 555
0026 D200        R     SETB    g_cont_en
                                           ; SOURCE LINE # 556
;---- Variable 'temp_sel' assigned to Register 'R2' ----
0028 FA                MOV     R2,A
                                           ; SOURCE LINE # 557
0029 907FB7            MOV     DPTR,#07FB7H
002C 93                MOVC    A,@A+DPTR
002D B40505            CJNE    A,#05H,?C0182
0030 75000F      R     MOV     boundary_check,#0FH
0033 8010              SJMP    read_cont
0035         ?C0182:
                                           ; SOURCE LINE # 558
0035 907FB7            MOV     DPTR,#07FB7H
0038 E4                CLR     A
0039 93                MOVC    A,@A+DPTR
003A B40405            CJNE    A,#04H,?C0184
003D 750007      R     MOV     boundary_check,#07H
0040 8003              SJMP    read_cont
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 48  

0042         ?C0184:
                                           ; SOURCE LINE # 559
0042 750003      R     MOV     boundary_check,#03H
                                           ; SOURCE LINE # 560
                                           ; SOURCE LINE # 561
0045         read_cont:
                                           ; SOURCE LINE # 562
0045 E5D7              MOV     A,SFR_CHP_en
0047 6401              XRL     A,#01H
0049 7022              JNZ     ?C0193
                                           ; SOURCE LINE # 563
004B         ?C0188:
                                           ; SOURCE LINE # 564
004B 20E847            JB      sata_burst_done,?C0192
                                           ; SOURCE LINE # 565
                                           ; SOURCE LINE # 566
004E 85FD00      R     MOV     temp8,SFR_dma_done_num_l
                                           ; SOURCE LINE # 567
0051 E500        R     MOV     A,temp8
0053 29                ADD     A,R1
0054 5500        R     ANL     A,boundary_check
0056 700D              JNZ     ?C0190
0058 EA                MOV     A,R2
0059 6500        R     XRL     A,temp8
005B 6008              JZ      ?C0190
                                           ; SOURCE LINE # 568
                                           ; SOURCE LINE # 569
005D AA00        R     MOV     R2,temp8
                                           ; SOURCE LINE # 570
005F 90FF7E            MOV     DPTR,#sata+07EH
0062 742B              MOV     A,#02BH
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 571
0065         ?C0190:
                                           ; SOURCE LINE # 572
0065 7800        R     MOV     R0,#LOW g_current_fis_num
0067 E6                MOV     A,@R0
0068 659F              XRL     A,SFR_fis_num
006A 60DF              JZ      ?C0188
006C 22                RET     
                                           ; SOURCE LINE # 574
                                           ; SOURCE LINE # 576
006D         ?C0193:
                                           ; SOURCE LINE # 577
006D 20E825            JB      sata_burst_done,?C0192
                                           ; SOURCE LINE # 578
                                           ; SOURCE LINE # 579
0070 90FFC6            MOV     DPTR,#sata+0C6H
0073 E0                MOVX    A,@DPTR
0074 6A                XRL     A,R2
0075 6016              JZ      ?C0195
                                           ; SOURCE LINE # 580
                                           ; SOURCE LINE # 581
0077 90FFCD            MOV     DPTR,#sata+0CDH
007A EA                MOV     A,R2
007B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 582
007C 90FF7E            MOV     DPTR,#sata+07EH
007F 742B              MOV     A,#02BH
0081 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 583
0082 90FFC6            MOV     DPTR,#sata+0C6H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 49  

0085 E0                MOVX    A,@DPTR
0086 FA                MOV     R2,A
                                           ; SOURCE LINE # 584
0087 90FFCD            MOV     DPTR,#sata+0CDH
008A 74FF              MOV     A,#0FFH
008C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 585
008D         ?C0195:
                                           ; SOURCE LINE # 586
008D 7800        R     MOV     R0,#LOW g_current_fis_num
008F E6                MOV     A,@R0
0090 659F              XRL     A,SFR_fis_num
0092 60D9              JZ      ?C0193
0094         ?C0943:
0094 22                RET     
                                           ; SOURCE LINE # 588
0095         ?C0192:
                                           ; SOURCE LINE # 590
0095 30EA03            JNB     sata_burst_abort,$ + 6H
0098 020000      R     LJMP    read_handler_err
009B         ?C0197:
                                           ; SOURCE LINE # 591
009B 120000      R     LCALL   L?1066
                                           ; SOURCE LINE # 592
009E 90FF5C            MOV     DPTR,#sata+05CH
00A1 E0                MOVX    A,@DPTR
00A2 30E703            JNB     ACC.7,$ + 6H
00A5 020000      R     LJMP    read_handler_over
00A8 A3                INC     DPTR
00A9 E0                MOVX    A,@DPTR
00AA 30E703            JNB     ACC.7,$ + 6H
00AD 020000      R     LJMP    read_handler_over
00B0 A3                INC     DPTR
00B1 E0                MOVX    A,@DPTR
00B2 30E703            JNB     ACC.7,$ + 6H
00B5 020000      R     LJMP    read_handler_over
00B8 A3                INC     DPTR
00B9 E0                MOVX    A,@DPTR
00BA 30E703            JNB     ACC.7,$ + 6H
00BD 020000      R     LJMP    read_handler_over
00C0 90FF76            MOV     DPTR,#sata+076H
00C3 E0                MOVX    A,@DPTR
00C4 30E703            JNB     ACC.7,$ + 6H
00C7 020000      R     LJMP    read_handler_over
                                           ; SOURCE LINE # 593
                                           ; SOURCE LINE # 594
                                           ; SOURCE LINE # 595
00CA         ?C0199:
                                           ; SOURCE LINE # 597
00CA E4                CLR     A
00CB F5D9              MOV     SFR_watch_dog_high,A
00CD         ?C0202:
                                           ; SOURCE LINE # 598
                                           ; SOURCE LINE # 599
                                           ; SOURCE LINE # 600
00CD E5D7              MOV     A,SFR_CHP_en
00CF 6401              XRL     A,#01H
00D1 601F              JZ      ?C0204
                                           ; SOURCE LINE # 601
                                           ; SOURCE LINE # 602
00D3 90FFC6            MOV     DPTR,#sata+0C6H
00D6 E0                MOVX    A,@DPTR
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 50  

00D7 6A                XRL     A,R2
00D8 602F              JZ      ?C0206
                                           ; SOURCE LINE # 603
                                           ; SOURCE LINE # 604
00DA 90FFCD            MOV     DPTR,#sata+0CDH
00DD EA                MOV     A,R2
00DE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 605
00DF 90FF7E            MOV     DPTR,#sata+07EH
00E2 742B              MOV     A,#02BH
00E4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 606
00E5 90FFC6            MOV     DPTR,#sata+0C6H
00E8 E0                MOVX    A,@DPTR
00E9 FA                MOV     R2,A
                                           ; SOURCE LINE # 607
00EA 90FFCD            MOV     DPTR,#sata+0CDH
00ED 74FF              MOV     A,#0FFH
00EF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 608
                                           ; SOURCE LINE # 609
00F0 8017              SJMP    ?C0206
00F2         ?C0204:
                                           ; SOURCE LINE # 611
                                           ; SOURCE LINE # 612
00F2 85FD00      R     MOV     temp8,SFR_dma_done_num_l
                                           ; SOURCE LINE # 613
00F5 E500        R     MOV     A,temp8
00F7 29                ADD     A,R1
00F8 5407              ANL     A,#07H
00FA 700D              JNZ     ?C0206
00FC EA                MOV     A,R2
00FD 6500        R     XRL     A,temp8
00FF 6008              JZ      ?C0206
                                           ; SOURCE LINE # 614
                                           ; SOURCE LINE # 615
0101 AA00        R     MOV     R2,temp8
                                           ; SOURCE LINE # 616
0103 90FF7E            MOV     DPTR,#sata+07EH
0106 742B              MOV     A,#02BH
0108 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 617
                                           ; SOURCE LINE # 619
0109         ?C0206:
                                           ; SOURCE LINE # 620
0109 7800        R     MOV     R0,#LOW g_current_fis_num
010B E6                MOV     A,@R0
010C 659F              XRL     A,SFR_fis_num
010E 6028              JZ      ?C0208
                                           ; SOURCE LINE # 621
                                           ; SOURCE LINE # 625
0110 E5D1              MOV     A,SFR_cmd_aux
0112 54C0              ANL     A,#0C0H
0114 64C0              XRL     A,#0C0H
0116 7027              JNZ     ?C0203
0118 300024      R     JNB     g_cont_en,?C0203
011B E59E              MOV     A,SFR_quick_cmd
011D 30E01F            JNB     ACC.0,?C0203
                                           ; SOURCE LINE # 626
                                           ; SOURCE LINE # 628
0120 7F01              MOV     R7,#01H
0122 7E00              MOV     R6,#00H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 51  

0124 120000      R     LCALL   _delay
                                           ; SOURCE LINE # 630
0127 75C930            MOV     SFR_smart_load,#030H
                                           ; SOURCE LINE # 631
012A D2ED              SETB    sata_burst_cont
                                           ; SOURCE LINE # 633
012C A69F              MOV     @R0,SFR_fis_num
                                           ; SOURCE LINE # 634
012E 90FF1E            MOV     DPTR,#sata+01EH
0131 E0                MOVX    A,@DPTR
0132 54FD              ANL     A,#0FDH
0134 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 635
0135 020000      R     LJMP    read_cont
                                           ; SOURCE LINE # 636
                                           ; SOURCE LINE # 637
                                           ; SOURCE LINE # 638
0138         ?C0208:
                                           ; SOURCE LINE # 639
0138 E5D9              MOV     A,SFR_watch_dog_high
013A D3                SETB    C
013B 9420              SUBB    A,#020H
013D 408E              JC      ?C0202
013F         ?C0203:
                                           ; SOURCE LINE # 642
013F 120000      R     LCALL   smart_read_cnt
                                           ; SOURCE LINE # 644
0142 8003              SJMP    read_handler_over
                                           ; SOURCE LINE # 646
0144         read_handler_err:
                                           ; SOURCE LINE # 648
                                           ; SOURCE LINE # 650
0144 120000      R     LCALL   L?1052
                                           ; SOURCE LINE # 653
0147         read_handler_over:
                                           ; SOURCE LINE # 654
0147 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 656
014A         ?C0181:
014A 22                RET     
             ; FUNCTION read_handler (END)

             ; FUNCTION write_handler (BEGIN)
                                           ; SOURCE LINE # 658
                                           ; SOURCE LINE # 659
                                           ; SOURCE LINE # 666
                                           ; SOURCE LINE # 667
0000 120000      R     LCALL   reset_engine_read_write
                                           ; SOURCE LINE # 668
0003 120000      R     LCALL   security_check_lba
                                           ; SOURCE LINE # 670
0006 7800        R     MOV     R0,#LOW g_current_fis_num
0008 E6                MOV     A,@R0
0009 659F              XRL     A,SFR_fis_num
000B 6003              JZ      $ + 5H
000D 020000      R     LJMP    ?C0213
0010         ?C0212:
                                           ; SOURCE LINE # 672
0010 E4                CLR     A
0011 90FF57            MOV     DPTR,#sata+057H
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 673
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 52  

0015 E500        R     MOV     A,security_mode
0017 B42009            CJNE    A,#020H,?C0216
001A 90FF7B            MOV     DPTR,#sata+07BH
001D E0                MOVX    A,@DPTR
001E C3                CLR     C
001F 940A              SUBB    A,#0AH
0021 4009              JC      ?C0214
0023         ?C0216:
0023 E500        R     MOV     A,security_mode
0025 B41004            CJNE    A,#010H,?C0214
0028 90FF7B            MOV     DPTR,#sata+07BH
002B E0                MOVX    A,@DPTR
002C         ?C0214:
                                           ; SOURCE LINE # 675
002C 907FBC            MOV     DPTR,#07FBCH
002F E4                CLR     A
0030 93                MOVC    A,@A+DPTR
0031 90FF57            MOV     DPTR,#sata+057H
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 688
                                           ; SOURCE LINE # 689
0035 90FF7E            MOV     DPTR,#sata+07EH
0038 7430              MOV     A,#030H
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 690
003B 75C90C            MOV     SFR_smart_load,#0CH
                                           ; SOURCE LINE # 691
003E E4                CLR     A
003F F5FA              MOV     SFR_dma_base+01H,A
0041 F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 692
0043 75F898            MOV     SFR_dma_cntl,#098H
                                           ; SOURCE LINE # 693
0046 D200        R     SETB    g_cont_en
                                           ; SOURCE LINE # 694
                                           ; SOURCE LINE # 695
                                           ; SOURCE LINE # 697
0048         write_cont:
0048         ?C0218:
                                           ; SOURCE LINE # 698
0048 20E808            JB      sata_burst_done,?C0219
                                           ; SOURCE LINE # 699
                                           ; SOURCE LINE # 700
004B 7800        R     MOV     R0,#LOW g_current_fis_num
004D E6                MOV     A,@R0
004E 659F              XRL     A,SFR_fis_num
0050 60F6              JZ      ?C0218
0052 22                RET     
0053         ?C0219:
                                           ; SOURCE LINE # 702
0053 20EA65            JB      sata_burst_abort,write_handler_err
0056         ?C0221:
0056         ?C0223:
                                           ; SOURCE LINE # 712
0056 20F808            JB      dma_done,?C0224
                                           ; SOURCE LINE # 713
                                           ; SOURCE LINE # 714
0059 7800        R     MOV     R0,#LOW g_current_fis_num
005B E6                MOV     A,@R0
005C 659F              XRL     A,SFR_fis_num
005E 60F6              JZ      ?C0223
0060         ?C0944:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 53  

0060 22                RET     
0061         ?C0224:
                                           ; SOURCE LINE # 717
0061 120000      R     LCALL   L?1066
                                           ; SOURCE LINE # 718
0064 90FF5C            MOV     DPTR,#sata+05CH
0067 E0                MOVX    A,@DPTR
0068 20E753            JB      ACC.7,write_handler_over
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D 20E74E            JB      ACC.7,write_handler_over
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 20E749            JB      ACC.7,write_handler_over
0075 A3                INC     DPTR
0076 E0                MOVX    A,@DPTR
0077 20E744            JB      ACC.7,write_handler_over
007A 90FF76            MOV     DPTR,#sata+076H
007D E0                MOVX    A,@DPTR
007E 20E73D            JB      ACC.7,write_handler_over
                                           ; SOURCE LINE # 719
                                           ; SOURCE LINE # 720
                                           ; SOURCE LINE # 721
0081         ?C0226:
                                           ; SOURCE LINE # 723
0081 E4                CLR     A
0082 F5D9              MOV     SFR_watch_dog_high,A
0084         ?C0229:
                                           ; SOURCE LINE # 724
                                           ; SOURCE LINE # 725
                                           ; SOURCE LINE # 726
0084 7800        R     MOV     R0,#LOW g_current_fis_num
0086 E6                MOV     A,@R0
0087 659F              XRL     A,SFR_fis_num
0089 6022              JZ      ?C0231
                                           ; SOURCE LINE # 727
                                           ; SOURCE LINE # 731
008B E5D1              MOV     A,SFR_cmd_aux
008D 54C0              ANL     A,#0C0H
008F 64C0              XRL     A,#0C0H
0091 7023              JNZ     ?C0230
0093 300020      R     JNB     g_cont_en,?C0230
0096 E59E              MOV     A,SFR_quick_cmd
0098 30E41B            JNB     ACC.4,?C0230
                                           ; SOURCE LINE # 732
                                           ; SOURCE LINE # 733
009B 75C930            MOV     SFR_smart_load,#030H
                                           ; SOURCE LINE # 734
009E D2ED              SETB    sata_burst_cont
                                           ; SOURCE LINE # 735
00A0 D2FD              SETB    dma_cont
                                           ; SOURCE LINE # 736
00A2 A69F              MOV     @R0,SFR_fis_num
                                           ; SOURCE LINE # 737
00A4 90FF1E            MOV     DPTR,#sata+01EH
00A7 E0                MOVX    A,@DPTR
00A8 54FD              ANL     A,#0FDH
00AA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 741
00AB 809B              SJMP    ?C0218
                                           ; SOURCE LINE # 742
                                           ; SOURCE LINE # 743
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 54  

                                           ; SOURCE LINE # 744
00AD         ?C0231:
                                           ; SOURCE LINE # 745
00AD 90FFBA            MOV     DPTR,#sata+0BAH
00B0 E0                MOVX    A,@DPTR
00B1 D3                SETB    C
00B2 9404              SUBB    A,#04H
00B4 40CE              JC      ?C0229
00B6         ?C0230:
                                           ; SOURCE LINE # 748
00B6 120000      R     LCALL   smart_write_cnt
                                           ; SOURCE LINE # 750
00B9 8003              SJMP    write_handler_over
                                           ; SOURCE LINE # 752
00BB         write_handler_err:
                                           ; SOURCE LINE # 753
                                           ; SOURCE LINE # 755
00BB 120000      R     LCALL   L?1052
                                           ; SOURCE LINE # 757
00BE         write_handler_over:
                                           ; SOURCE LINE # 759
00BE 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 761
00C1         ?C0213:
00C1 22                RET     
             ; FUNCTION write_handler (END)

             ; FUNCTION pio_read_handler (BEGIN)
                                           ; SOURCE LINE # 770
                                           ; SOURCE LINE # 771
                                           ; SOURCE LINE # 773
0000 E4                CLR     A
0001 7800        R     MOV     R0,#LOW pio_interrput
0003 F6                MOV     @R0,A
                                           ; SOURCE LINE # 775
0004 120000      R     LCALL   security_check_lba
                                           ; SOURCE LINE # 777
0007 300003      R     JNB     g_flag_lba_err,$ + 6H
000A 020000      R     LJMP    pio_handler_err
000D         ?C0235:
000D         ?C0239:
                                           ; SOURCE LINE # 780
                                           ; SOURCE LINE # 781
000D 120000      R     LCALL   reset_engine_read_write
                                           ; SOURCE LINE # 782
0010 7800        R     MOV     R0,#LOW g_current_fis_num
0012 E6                MOV     A,@R0
0013 659F              XRL     A,SFR_fis_num
0015 6003              JZ      $ + 5H
0017 020000      R     LJMP    ?C0241
001A         ?C0240:
                                           ; SOURCE LINE # 785
001A 90FF7E            MOV     DPTR,#sata+07EH
001D 7420              MOV     A,#020H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 786
0020 75FC00            MOV     SFR_dma_max_num+01H,#00H
0023 75FB01            MOV     SFR_dma_max_num,#01H
                                           ; SOURCE LINE # 788
                                           ; SOURCE LINE # 789
0026 E500        R     MOV     A,g_sec_cnt+01H
0028 6401              XRL     A,#01H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 55  

002A 4500        R     ORL     A,g_sec_cnt
002C 700D              JNZ     ?C0242
002E 850000      R     MOV     ?_tx_fis_5f?BYTE+03H,g_sec_cnt+01H
0031 850000      R     MOV     ?_tx_fis_5f?BYTE+04H,g_sec_cnt
0034 750050      R     MOV     ?_tx_fis_5f?BYTE+05H,#050H
0037 7BE0              MOV     R3,#0E0H
0039 800C              SJMP    ?C0945
003B         ?C0242:
                                           ; SOURCE LINE # 790
003B 850000      R     MOV     ?_tx_fis_5f?BYTE+03H,g_sec_cnt+01H
003E 850000      R     MOV     ?_tx_fis_5f?BYTE+04H,g_sec_cnt
0041 7500D0      R     MOV     ?_tx_fis_5f?BYTE+05H,#0D0H
0044 7BE0              MOV     R3,#0E0H
0046 E4                CLR     A
0047         ?C0945:
0047 FD                MOV     R5,A
0048 7F58              MOV     R7,#058H
004A 120000      R     LCALL   _tx_fis_5f
004D         ?C0243:
                                           ; SOURCE LINE # 791
                                           ; SOURCE LINE # 796
004D 75F8C8            MOV     SFR_dma_cntl,#0C8H
0050         ?C0244:
                                           ; SOURCE LINE # 798
0050 20E808            JB      sata_burst_done,?C0245
                                           ; SOURCE LINE # 799
                                           ; SOURCE LINE # 800
0053 7800        R     MOV     R0,#LOW g_current_fis_num
0055 E6                MOV     A,@R0
0056 659F              XRL     A,SFR_fis_num
0058 60F6              JZ      ?C0244
005A 22                RET     
005B         ?C0245:
                                           ; SOURCE LINE # 802
005B 20EA31            JB      sata_burst_abort,pio_handler_err
005E         ?C0247:
005E         ?C0248:
                                           ; SOURCE LINE # 805
005E 20F808            JB      dma_done,?C0249
                                           ; SOURCE LINE # 806
                                           ; SOURCE LINE # 807
0061 7800        R     MOV     R0,#LOW g_current_fis_num
0063 E6                MOV     A,@R0
0064 659F              XRL     A,SFR_fis_num
0066 60F6              JZ      ?C0248
0068 22                RET     
0069         ?C0249:
                                           ; SOURCE LINE # 811
0069 75F808            MOV     SFR_dma_cntl,#08H
                                           ; SOURCE LINE # 812
006C E500        R     MOV     A,g_sec_cnt+01H
006E 1500        R     DEC     g_sec_cnt+01H
0070 7002              JNZ     ?C0896
0072 1500        R     DEC     g_sec_cnt
0074         ?C0896:
                                           ; SOURCE LINE # 813
0074 75BE08            MOV     SFR_lba_comp,#08H
                                           ; SOURCE LINE # 815
0077 D3                SETB    C
0078 E500        R     MOV     A,g_sec_cnt+01H
007A 9400              SUBB    A,#00H
007C E500        R     MOV     A,g_sec_cnt
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 56  

007E 9400              SUBB    A,#00H
0080 508B              JNC     ?C0239
                                           ; SOURCE LINE # 816
0082 90FF14            MOV     DPTR,#sata+014H
0085 E500        R     MOV     A,g_sec_cnt+01H
0087 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 817
0088 A3                INC     DPTR
0089 E500        R     MOV     A,g_sec_cnt
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 820
                                           ; SOURCE LINE # 822
008C 020000      R     LJMP    smart_read_cnt
                                           ; SOURCE LINE # 823
                                           ; SOURCE LINE # 827
008F         pio_handler_err:
                                           ; SOURCE LINE # 828
                                           ; SOURCE LINE # 829
008F 120000      R     LCALL   L?1059
                                           ; SOURCE LINE # 831
0092 120000      R     LCALL   L?1053
                                           ; SOURCE LINE # 832
0095 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 835
0098         ?C0241:
0098 22                RET     
             ; FUNCTION pio_read_handler (END)

             ; FUNCTION pio_write_handler (BEGIN)
                                           ; SOURCE LINE # 839
                                           ; SOURCE LINE # 840
                                           ; SOURCE LINE # 842
0000 E4                CLR     A
0001 7800        R     MOV     R0,#LOW pio_interrput
0003 F6                MOV     @R0,A
                                           ; SOURCE LINE # 844
0004 120000      R     LCALL   security_check_lba
                                           ; SOURCE LINE # 846
0007 300003      R     JNB     g_flag_lba_err,$ + 6H
000A 020000      R     LJMP    pio_handler_err
000D         ?C0251:
                                           ; SOURCE LINE # 848
000D 120000      R     LCALL   reset_engine_read_write
                                           ; SOURCE LINE # 849
0010 7800        R     MOV     R0,#LOW g_current_fis_num
0012 E6                MOV     A,@R0
0013 659F              XRL     A,SFR_fis_num
0015 6003              JZ      $ + 5H
0017 020000      R     LJMP    ?C0254
001A         ?C0253:
                                           ; SOURCE LINE # 851
001A E4                CLR     A
001B 90FF57            MOV     DPTR,#sata+057H
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 853
001F 907FBC            MOV     DPTR,#07FBCH
0022 93                MOVC    A,@A+DPTR
0023 90FF57            MOV     DPTR,#sata+057H
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 863
                                           ; SOURCE LINE # 864
0027 90FF7E            MOV     DPTR,#sata+07EH
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 57  

002A 7430              MOV     A,#030H
002C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 865
002D 75FC00            MOV     SFR_dma_max_num+01H,#00H
0030 75FB01            MOV     SFR_dma_max_num,#01H
                                           ; SOURCE LINE # 866
0033         ?C0257:
                                           ; SOURCE LINE # 868
                                           ; SOURCE LINE # 872
                                           ; SOURCE LINE # 873
0033 7800        R     MOV     R0,#LOW pio_interrput
0035 E6                MOV     A,@R0
0036 FB                MOV     R3,A
0037 850000      R     MOV     ?_tx_fis_5f?BYTE+03H,g_sec_cnt+01H
003A 850000      R     MOV     ?_tx_fis_5f?BYTE+04H,g_sec_cnt
003D 7500D0      R     MOV     ?_tx_fis_5f?BYTE+05H,#0D0H
0040 E4                CLR     A
0041 FD                MOV     R5,A
0042 7F58              MOV     R7,#058H
0044 120000      R     LCALL   _tx_fis_5f
                                           ; SOURCE LINE # 874
0047 7640              MOV     @R0,#040H
                                           ; SOURCE LINE # 875
                                           ; SOURCE LINE # 881
                                           ; SOURCE LINE # 882
0049 75F888            MOV     SFR_dma_cntl,#088H
                                           ; SOURCE LINE # 883
004C         ?C0258:
                                           ; SOURCE LINE # 889
004C 20E808            JB      sata_burst_done,?C0259
                                           ; SOURCE LINE # 890
                                           ; SOURCE LINE # 891
004F 7800        R     MOV     R0,#LOW g_current_fis_num
0051 E6                MOV     A,@R0
0052 659F              XRL     A,SFR_fis_num
0054 60F6              JZ      ?C0258
0056 22                RET     
0057         ?C0259:
                                           ; SOURCE LINE # 893
0057 20EA3A            JB      sata_burst_abort,pio_handler_err
005A         ?C0261:
                                           ; SOURCE LINE # 899
005A         ?C0262:
                                           ; SOURCE LINE # 900
005A 20F808            JB      dma_done,?C0263
                                           ; SOURCE LINE # 901
                                           ; SOURCE LINE # 902
005D 7800        R     MOV     R0,#LOW g_current_fis_num
005F E6                MOV     A,@R0
0060 659F              XRL     A,SFR_fis_num
0062 60F6              JZ      ?C0262
0064 22                RET     
0065         ?C0263:
                                           ; SOURCE LINE # 904
                                           ; SOURCE LINE # 906
0065 75F808            MOV     SFR_dma_cntl,#08H
                                           ; SOURCE LINE # 907
0068 E500        R     MOV     A,g_sec_cnt+01H
006A 1500        R     DEC     g_sec_cnt+01H
006C 7002              JNZ     ?C0897
006E 1500        R     DEC     g_sec_cnt
0070         ?C0897:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 58  

                                           ; SOURCE LINE # 908
0070 75BE08            MOV     SFR_lba_comp,#08H
                                           ; SOURCE LINE # 910
0073 D3                SETB    C
0074 E500        R     MOV     A,g_sec_cnt+01H
0076 9400              SUBB    A,#00H
0078 E500        R     MOV     A,g_sec_cnt
007A 9400              SUBB    A,#00H
007C 50B5              JNC     ?C0257
                                           ; SOURCE LINE # 911
007E 90FF14            MOV     DPTR,#sata+014H
0081 E500        R     MOV     A,g_sec_cnt+01H
0083 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 912
0084 A3                INC     DPTR
0085 E500        R     MOV     A,g_sec_cnt
0087 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 915
                                           ; SOURCE LINE # 917
0088 120000      R     LCALL   smart_write_cnt
                                           ; SOURCE LINE # 918
                                           ; SOURCE LINE # 920
008B 7BFF              MOV     R3,#0FFH
008D E4                CLR     A
008E FD                MOV     R5,A
008F 7F50              MOV     R7,#050H
0091 020000      R     LJMP    _tx_fis_34
                                           ; SOURCE LINE # 923
0094         pio_handler_err:
                                           ; SOURCE LINE # 924
                                           ; SOURCE LINE # 925
0094 120000      R     LCALL   L?1060
                                           ; SOURCE LINE # 927
0097 120000      R     LCALL   L?1053
                                           ; SOURCE LINE # 928
009A 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 931
009D         ?C0254:
009D 22                RET     
             ; FUNCTION pio_write_handler (END)

             ; FUNCTION identify_device (BEGIN)
                                           ; SOURCE LINE # 951
                                           ; SOURCE LINE # 952
                                           ; SOURCE LINE # 953
;---- Variable 'i' assigned to Register 'R6/R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
0002 FE                MOV     R6,A
                                           ; SOURCE LINE # 961
0003 F5F2              MOV     SFR_ext_sram_addr+01H,A
0005 F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 962
0007 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 963
000A 7800        R     MOV     R0,#LOW g_tmp_addr
000C 767A              MOV     @R0,#07AH
000E 08                INC     R0
000F F6                MOV     @R0,A
                                           ; SOURCE LINE # 964
0010         ?C0265:
                                           ; SOURCE LINE # 965
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 59  

                                           ; SOURCE LINE # 966
0010 7800        R     MOV     R0,#LOW g_tmp_addr
0012 E6                MOV     A,@R0
0013 FC                MOV     R4,A
0014 08                INC     R0
0015 E6                MOV     A,@R0
0016 F582              MOV     DPL,A
0018 8C83              MOV     DPH,R4
001A E4                CLR     A
001B 93                MOVC    A,@A+DPTR
001C F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 967
001E 06                INC     @R0
001F E6                MOV     A,@R0
0020 18                DEC     R0
0021 7001              JNZ     ?C0898
0023 06                INC     @R0
0024         ?C0898:
                                           ; SOURCE LINE # 968
0024 0F                INC     R7
0025 BF0001            CJNE    R7,#00H,?C0899
0028 0E                INC     R6
0029         ?C0899:
0029 E4                CLR     A
002A B507E3            CJNE    A,AR7,?C0265
002D EE                MOV     A,R6
002E B402DF            CJNE    A,#02H,?C0265
0031         ?C0266:
                                           ; SOURCE LINE # 971
0031 E500        R     MOV     A,security_mode
0033 6420              XRL     A,#020H
0035 7002              JNZ     ?C0268
                                           ; SOURCE LINE # 972
                                           ; SOURCE LINE # 973
                                           ; SOURCE LINE # 974
                                           ; SOURCE LINE # 975
                                           ; SOURCE LINE # 976
                                           ; SOURCE LINE # 977
                                           ; SOURCE LINE # 979
                                           ; SOURCE LINE # 980
                                           ; SOURCE LINE # 981
                                           ; SOURCE LINE # 982
                                           ; SOURCE LINE # 983
                                           ; SOURCE LINE # 985
                                           ; SOURCE LINE # 986
                                           ; SOURCE LINE # 987
                                           ; SOURCE LINE # 988
                                           ; SOURCE LINE # 989
                                           ; SOURCE LINE # 990
0037 8006              SJMP    ?C0946
0039         ?C0268:
                                           ; SOURCE LINE # 991
0039 E500        R     MOV     A,security_mode
003B 6410              XRL     A,#010H
003D 703E              JNZ     ?C0269
                                           ; SOURCE LINE # 992
                                           ; SOURCE LINE # 993
003F         ?C0946:
003F F5F2              MOV     SFR_ext_sram_addr+01H,A
0041 75F178            MOV     SFR_ext_sram_addr,#078H
                                           ; SOURCE LINE # 994
0044 F5F3              MOV     SFR_ext_sram_data,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 60  

                                           ; SOURCE LINE # 995
0046 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 996
0048 75F3C0            MOV     SFR_ext_sram_data,#0C0H
                                           ; SOURCE LINE # 997
004B 75F308            MOV     SFR_ext_sram_data,#08H
                                           ; SOURCE LINE # 999
004E F5F2              MOV     SFR_ext_sram_addr+01H,A
0050 75F1C8            MOV     SFR_ext_sram_addr,#0C8H
                                           ; SOURCE LINE # 1000
0053 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 1001
0055 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 1002
0057 75F3C0            MOV     SFR_ext_sram_data,#0C0H
                                           ; SOURCE LINE # 1003
005A 75F308            MOV     SFR_ext_sram_data,#08H
                                           ; SOURCE LINE # 1005
005D 7800        R     MOV     R0,#LOW g_tmp_addr
005F 767A              MOV     @R0,#07AH
0061 08                INC     R0
0062 76AD              MOV     @R0,#0ADH
                                           ; SOURCE LINE # 1006
0064 18                DEC     R0
0065 E6                MOV     A,@R0
0066 FE                MOV     R6,A
0067 08                INC     R0
0068 E6                MOV     A,@R0
0069 F582              MOV     DPL,A
006B 8E83              MOV     DPH,R6
006D E4                CLR     A
006E 93                MOVC    A,@A+DPTR
006F F500        R     MOV     tmp1,A
                                           ; SOURCE LINE # 1007
0071 5300FB      R     ANL     tmp1,#0FBH
                                           ; SOURCE LINE # 1008
0074 75F200            MOV     SFR_ext_sram_addr+01H,#00H
0077 75F1AD            MOV     SFR_ext_sram_addr,#0ADH
                                           ; SOURCE LINE # 1009
007A 8500F3      R     MOV     SFR_ext_sram_data,tmp1
                                           ; SOURCE LINE # 1010
007D         ?C0269:
                                           ; SOURCE LINE # 1035
007D 75F201            MOV     SFR_ext_sram_addr+01H,#01H
0080 75F104            MOV     SFR_ext_sram_addr,#04H
                                           ; SOURCE LINE # 1036
0083 75F353            MOV     SFR_ext_sram_data,#053H
                                           ; SOURCE LINE # 1037
0086 75F341            MOV     SFR_ext_sram_data,#041H
                                           ; SOURCE LINE # 1038
0089 75F347            MOV     SFR_ext_sram_data,#047H
                                           ; SOURCE LINE # 1039
008C 75F345            MOV     SFR_ext_sram_data,#045H
                                           ; SOURCE LINE # 1040
                                           ; SOURCE LINE # 1045
008F 120000      R     LCALL   L?1069
;---- Variable 'tmp' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1046
0092 75F201            MOV     SFR_ext_sram_addr+01H,#01H
0095 75F1FF            MOV     SFR_ext_sram_addr,#0FFH
                                           ; SOURCE LINE # 1047
0098 8FF3              MOV     SFR_ext_sram_data,R7
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 61  

                                           ; SOURCE LINE # 1050
009A 750001      R     MOV     ?_tx_fis_5f?BYTE+03H,#01H
009D E4                CLR     A
009E F500        R     MOV     ?_tx_fis_5f?BYTE+04H,A
00A0 750050      R     MOV     ?_tx_fis_5f?BYTE+05H,#050H
00A3 7BE0              MOV     R3,#0E0H
00A5 FD                MOV     R5,A
00A6 7F58              MOV     R7,#058H
00A8 120000      R     LCALL   _tx_fis_5f
                                           ; SOURCE LINE # 1052
00AB 0D                INC     R5
00AC 7FC0              MOV     R7,#0C0H
00AE 120000      R     LCALL   _sata_burst
                                           ; SOURCE LINE # 1053
00B1 30EA09            JNB     sata_burst_abort,?C0272
                                           ; SOURCE LINE # 1054
                                           ; SOURCE LINE # 1055
                                           ; SOURCE LINE # 1056
00B4 120000      R     LCALL   L?1060
                                           ; SOURCE LINE # 1058
00B7 120000      R     LCALL   L?1053
                                           ; SOURCE LINE # 1059
00BA 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 1062
                                           ; SOURCE LINE # 1063
00BD         ?C0272:
00BD 22                RET     
             ; FUNCTION identify_device (END)

             ; FUNCTION set_feature (BEGIN)
                                           ; SOURCE LINE # 1065
                                           ; SOURCE LINE # 1066
                                           ; SOURCE LINE # 1068
0000 90FF14            MOV     DPTR,#sata+014H
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
;---- Variable 'tmp' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1069
0005 90FF10            MOV     DPTR,#sata+010H
0008 E0                MOVX    A,@DPTR
0009 120000      E     LCALL   ?C?CCASE
000C 0000        R     DW      ?C0274
000E 02                DB      02H
000F 0000        R     DW      ?C0276
0011 03                DB      03H
0012 0000        R     DW      ?C0284
0014 05                DB      05H
0015 0000        R     DW      ?C0286
0017 06                DB      06H
0018 0000        R     DW      ?C0288
001A 0B                DB      0BH
001B 0000        R     DW      ?C0292
001D 42                DB      042H
001E 0000        R     DW      ?C0290
0020 55                DB      055H
0021 0000        R     DW      ?C0273
0023 66                DB      066H
0024 0000        R     DW      ?C0275
0026 82                DB      082H
0027 0000        R     DW      ?C0285
0029 85                DB      085H
002A 0000        R     DW      ?C0287
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 62  

002C 86                DB      086H
002D 0000        R     DW      ?C0289
002F 8B                DB      08BH
0030 0000        R     DW      ?C0273
0032 90                DB      090H
0033 0000        R     DW      ?C0291
0035 AA                DB      0AAH
0036 0000        R     DW      ?C0293
0038 C2                DB      0C2H
0039 0000        R     DW      ?C0273
003B CC                DB      0CCH
003C 0000              DW      00H
003E 0000        R     DW      ?C0297
                                           ; SOURCE LINE # 1070
                                           ; SOURCE LINE # 1071
0040         ?C0274:
                                           ; SOURCE LINE # 1072
                                           ; SOURCE LINE # 1073
0040 D200        R     SETB    g_enable_write_cache
                                           ; SOURCE LINE # 1074
0042 907AAA            MOV     DPTR,#07AAAH
                                           ; SOURCE LINE # 1075
                                           ; SOURCE LINE # 1076
                                           ; SOURCE LINE # 1077
                                           ; SOURCE LINE # 1078
                                           ; SOURCE LINE # 1079
0045 807E              SJMP    ?C0947
                                           ; SOURCE LINE # 1080
                                           ; SOURCE LINE # 1082
0047         ?C0275:
                                           ; SOURCE LINE # 1083
                                           ; SOURCE LINE # 1084
0047 C200        R     CLR     g_enable_write_cache
                                           ; SOURCE LINE # 1085
0049 907AAA            MOV     DPTR,#07AAAH
                                           ; SOURCE LINE # 1086
                                           ; SOURCE LINE # 1087
                                           ; SOURCE LINE # 1088
                                           ; SOURCE LINE # 1089
                                           ; SOURCE LINE # 1090
004C 020000      R     LJMP    ?C0948
                                           ; SOURCE LINE # 1091
                                           ; SOURCE LINE # 1093
004F         ?C0276:
                                           ; SOURCE LINE # 1094
                                           ; SOURCE LINE # 1095
004F EF                MOV     A,R7
0050 30E61C            JNB     ACC.6,?C0277
                                           ; SOURCE LINE # 1096
                                           ; SOURCE LINE # 1097
0053 530707            ANL     AR7,#07H
                                           ; SOURCE LINE # 1098
0056 7401              MOV     A,#01H
0058 A807              MOV     R0,AR7
005A 08                INC     R0
005B 8002              SJMP    ?C0902
005D         ?C0901:
005D C3                CLR     C
005E 33                RLC     A
005F         ?C0902:
005F D8FC              DJNZ    R0,?C0901
0061 FF                MOV     R7,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 63  

                                           ; SOURCE LINE # 1099
0062 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1100
0065 907AB1            MOV     DPTR,#07AB1H
0068 EF                MOV     A,R7
0069 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1101
006A 907A7F            MOV     DPTR,#07A7FH
                                           ; SOURCE LINE # 1102
                                           ; SOURCE LINE # 1103
006D 801E              SJMP    ?C0949
006F         ?C0277:
                                           ; SOURCE LINE # 1104
006F EF                MOV     A,R7
0070 30E51E            JNB     ACC.5,?C0279
                                           ; SOURCE LINE # 1105
                                           ; SOURCE LINE # 1106
0073 530707            ANL     AR7,#07H
                                           ; SOURCE LINE # 1107
0076 7401              MOV     A,#01H
0078 A807              MOV     R0,AR7
007A 08                INC     R0
007B 8002              SJMP    ?C0904
007D         ?C0903:
007D C3                CLR     C
007E 33                RLC     A
007F         ?C0904:
007F D8FC              DJNZ    R0,?C0903
0081 FF                MOV     R7,A
                                           ; SOURCE LINE # 1108
0082 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1109
0085 907A7F            MOV     DPTR,#07A7FH
0088 EF                MOV     A,R7
0089 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1110
008A 907AB1            MOV     DPTR,#07AB1H
008D         ?C0949:
008D E4                CLR     A
                                           ; SOURCE LINE # 1111
                                           ; SOURCE LINE # 1112
008E 020000      R     LJMP    ?C0959
0091         ?C0279:
                                           ; SOURCE LINE # 1113
0091 EF                MOV     A,R7
0092 54F8              ANL     A,#0F8H
0094 7003              JNZ     $ + 5H
0096 020000      R     LJMP    ?C0273
                                           ; SOURCE LINE # 1114
                                           ; SOURCE LINE # 1121
0099         ?C0281:
                                           ; SOURCE LINE # 1122
0099 EF                MOV     A,R7
009A 20E303            JB      ACC.3,$ + 6H
009D 020000      R     LJMP    ?C0273
                                           ; SOURCE LINE # 1123
                                           ; SOURCE LINE # 1134
                                           ; SOURCE LINE # 1135
00A0 020000      R     LJMP    ?C0273
                                           ; SOURCE LINE # 1136
                                           ; SOURCE LINE # 1139
00A3         ?C0284:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 64  

                                           ; SOURCE LINE # 1140
                                           ; SOURCE LINE # 1141
00A3 907AAC            MOV     DPTR,#07AACH
00A6 E4                CLR     A
00A7 93                MOVC    A,@A+DPTR
00A8 FF                MOV     R7,A
                                           ; SOURCE LINE # 1142
00A9 430708            ORL     AR7,#08H
                                           ; SOURCE LINE # 1143
00AC 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1144
00AF EF                MOV     A,R7
00B0         ?C0950:
                                           ; SOURCE LINE # 1145
                                           ; SOURCE LINE # 1146
00B0 020000      R     LJMP    ?C0959
                                           ; SOURCE LINE # 1147
                                           ; SOURCE LINE # 1149
00B3         ?C0285:
                                           ; SOURCE LINE # 1150
                                           ; SOURCE LINE # 1151
00B3 907AAC            MOV     DPTR,#07AACH
00B6 E4                CLR     A
00B7 93                MOVC    A,@A+DPTR
00B8 FF                MOV     R7,A
                                           ; SOURCE LINE # 1152
00B9 5307F7            ANL     AR7,#0F7H
                                           ; SOURCE LINE # 1153
00BC 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1154
00BF EF                MOV     A,R7
00C0         ?C0951:
                                           ; SOURCE LINE # 1155
                                           ; SOURCE LINE # 1156
00C0 8076              SJMP    ?C0959
                                           ; SOURCE LINE # 1157
                                           ; SOURCE LINE # 1159
00C2         ?C0286:
                                           ; SOURCE LINE # 1160
                                           ; SOURCE LINE # 1161
00C2 907AAC            MOV     DPTR,#07AACH
00C5         ?C0947:
00C5 E4                CLR     A
00C6 93                MOVC    A,@A+DPTR
00C7 FF                MOV     R7,A
                                           ; SOURCE LINE # 1162
00C8 430720            ORL     AR7,#020H
                                           ; SOURCE LINE # 1163
00CB 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1164
00CE EF                MOV     A,R7
00CF         ?C0952:
                                           ; SOURCE LINE # 1165
                                           ; SOURCE LINE # 1166
00CF 8067              SJMP    ?C0959
                                           ; SOURCE LINE # 1167
                                           ; SOURCE LINE # 1169
00D1         ?C0287:
                                           ; SOURCE LINE # 1170
                                           ; SOURCE LINE # 1171
00D1 907AAC            MOV     DPTR,#07AACH
00D4         ?C0948:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 65  

00D4 E4                CLR     A
00D5 93                MOVC    A,@A+DPTR
00D6 FF                MOV     R7,A
                                           ; SOURCE LINE # 1172
00D7 5307DF            ANL     AR7,#0DFH
                                           ; SOURCE LINE # 1173
00DA 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1174
00DD EF                MOV     A,R7
00DE         ?C0953:
                                           ; SOURCE LINE # 1175
                                           ; SOURCE LINE # 1176
00DE 8058              SJMP    ?C0959
                                           ; SOURCE LINE # 1177
                                           ; SOURCE LINE # 1179
00E0         ?C0288:
                                           ; SOURCE LINE # 1180
                                           ; SOURCE LINE # 1181
00E0 907AF0            MOV     DPTR,#07AF0H
00E3 E4                CLR     A
00E4 93                MOVC    A,@A+DPTR
00E5 FF                MOV     R7,A
                                           ; SOURCE LINE # 1182
00E6 430702            ORL     AR7,#02H
                                           ; SOURCE LINE # 1183
00E9 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1184
00EC EF                MOV     A,R7
00ED         ?C0954:
                                           ; SOURCE LINE # 1185
                                           ; SOURCE LINE # 1186
00ED 8049              SJMP    ?C0959
                                           ; SOURCE LINE # 1187
                                           ; SOURCE LINE # 1189
00EF         ?C0289:
                                           ; SOURCE LINE # 1190
                                           ; SOURCE LINE # 1191
00EF 907AF0            MOV     DPTR,#07AF0H
00F2 E4                CLR     A
00F3 93                MOVC    A,@A+DPTR
00F4 FF                MOV     R7,A
                                           ; SOURCE LINE # 1192
00F5 5307FD            ANL     AR7,#0FDH
                                           ; SOURCE LINE # 1193
00F8 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1194
00FB EF                MOV     A,R7
00FC         ?C0955:
                                           ; SOURCE LINE # 1195
                                           ; SOURCE LINE # 1196
00FC 803A              SJMP    ?C0959
                                           ; SOURCE LINE # 1197
                                           ; SOURCE LINE # 1199
00FE         ?C0290:
                                           ; SOURCE LINE # 1200
                                           ; SOURCE LINE # 1201
00FE 907AAA            MOV     DPTR,#07AAAH
0101 E4                CLR     A
0102 93                MOVC    A,@A+DPTR
0103 FF                MOV     R7,A
                                           ; SOURCE LINE # 1202
0104 430740            ORL     AR7,#040H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 66  

                                           ; SOURCE LINE # 1203
0107 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1204
010A EF                MOV     A,R7
010B         ?C0956:
                                           ; SOURCE LINE # 1205
                                           ; SOURCE LINE # 1206
010B 802B              SJMP    ?C0959
                                           ; SOURCE LINE # 1207
                                           ; SOURCE LINE # 1209
010D         ?C0291:
                                           ; SOURCE LINE # 1210
                                           ; SOURCE LINE # 1211
010D 907AAA            MOV     DPTR,#07AAAH
0110 E4                CLR     A
0111 93                MOVC    A,@A+DPTR
0112 FF                MOV     R7,A
                                           ; SOURCE LINE # 1212
0113 5307BF            ANL     AR7,#0BFH
                                           ; SOURCE LINE # 1213
0116 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1214
0119 EF                MOV     A,R7
011A         ?C0957:
                                           ; SOURCE LINE # 1215
                                           ; SOURCE LINE # 1216
011A 801C              SJMP    ?C0959
                                           ; SOURCE LINE # 1217
                                           ; SOURCE LINE # 1219
011C         ?C0292:
                                           ; SOURCE LINE # 1220
                                           ; SOURCE LINE # 1221
011C 907AAD            MOV     DPTR,#07AADH
011F E4                CLR     A
0120 93                MOVC    A,@A+DPTR
0121 FF                MOV     R7,A
                                           ; SOURCE LINE # 1222
0122 430702            ORL     AR7,#02H
                                           ; SOURCE LINE # 1223
0125 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1224
0128 EF                MOV     A,R7
0129         ?C0958:
                                           ; SOURCE LINE # 1225
                                           ; SOURCE LINE # 1226
0129 800D              SJMP    ?C0959
                                           ; SOURCE LINE # 1227
                                           ; SOURCE LINE # 1229
012B         ?C0293:
                                           ; SOURCE LINE # 1230
                                           ; SOURCE LINE # 1231
012B 907AAD            MOV     DPTR,#07AADH
012E E4                CLR     A
012F 93                MOVC    A,@A+DPTR
0130 FF                MOV     R7,A
                                           ; SOURCE LINE # 1232
0131 5307FD            ANL     AR7,#0FDH
                                           ; SOURCE LINE # 1233
0134 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1234
0137 EF                MOV     A,R7
0138         ?C0959:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 67  

0138 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1235
0139 5387EF            ANL     TS8052_PCON,#0EFH
                                           ; SOURCE LINE # 1236
013C 8008              SJMP    ?C0273
                                           ; SOURCE LINE # 1237
                                           ; SOURCE LINE # 1239
                                           ; SOURCE LINE # 1240
                                           ; SOURCE LINE # 1241
                                           ; SOURCE LINE # 1242
                                           ; SOURCE LINE # 1244
                                           ; SOURCE LINE # 1245
                                           ; SOURCE LINE # 1246
                                           ; SOURCE LINE # 1247
                                           ; SOURCE LINE # 1249
                                           ; SOURCE LINE # 1250
                                           ; SOURCE LINE # 1251
                                           ; SOURCE LINE # 1252
                                           ; SOURCE LINE # 1253
013E         ?C0297:
                                           ; SOURCE LINE # 1254
                                           ; SOURCE LINE # 1255
013E 7BFF              MOV     R3,#0FFH
0140 7D04              MOV     R5,#04H
0142 7F51              MOV     R7,#051H
0144 8006              SJMP    ?C0960
                                           ; SOURCE LINE # 1257
                                           ; SOURCE LINE # 1258
0146         ?C0273:
                                           ; SOURCE LINE # 1259
0146 7BFF              MOV     R3,#0FFH
0148 E4                CLR     A
0149 FD                MOV     R5,A
014A 7F50              MOV     R7,#050H
014C         ?C0960:
014C 120000      R     LCALL   _tx_fis_34
                                           ; SOURCE LINE # 1260
014F         ?C0298:
014F 22                RET     
             ; FUNCTION set_feature (END)

             ; FUNCTION init_dev_para (BEGIN)
                                           ; SOURCE LINE # 1262
                                           ; SOURCE LINE # 1263
                                           ; SOURCE LINE # 1265
0000 90FF87            MOV     DPTR,#sata+087H
0003 E0                MOVX    A,@DPTR
0004 540F              ANL     A,#0FH
0006 640F              XRL     A,#0FH
0008 7024              JNZ     init_dev_para_err
000A         ?C0299:
                                           ; SOURCE LINE # 1266
000A 90FF8C            MOV     DPTR,#sata+08CH
000D E0                MOVX    A,@DPTR
000E 643F              XRL     A,#03FH
0010 701C              JNZ     init_dev_para_err
0012         ?C0301:
                                           ; SOURCE LINE # 1267
0012 907A6A            MOV     DPTR,#07A6AH
0015 E4                CLR     A
0016 93                MOVC    A,@A+DPTR
0017 7800        R     MOV     R0,#LOW tmp8
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 68  

0019 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1269
001A E6                MOV     A,@R0
001B 4401              ORL     A,#01H
001D F6                MOV     @R0,A
                                           ; SOURCE LINE # 1270
001E 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1271
0021 E6                MOV     A,@R0
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1272
0023 5387EF            ANL     TS8052_PCON,#0EFH
                                           ; SOURCE LINE # 1273
0026 7BFF              MOV     R3,#0FFH
0028 E4                CLR     A
0029 FD                MOV     R5,A
002A 7F50              MOV     R7,#050H
002C 801A              SJMP    ?C0961
                                           ; SOURCE LINE # 1275
002E         init_dev_para_err:
                                           ; SOURCE LINE # 1276
002E 907A6A            MOV     DPTR,#07A6AH
0031 E4                CLR     A
0032 93                MOVC    A,@A+DPTR
0033 7800        R     MOV     R0,#LOW tmp8
0035 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1278
0036 E6                MOV     A,@R0
0037 54FE              ANL     A,#0FEH
0039 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1279
003A 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 1280
003D E6                MOV     A,@R0
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1281
003F 5387EF            ANL     TS8052_PCON,#0EFH
                                           ; SOURCE LINE # 1282
0042 7BFF              MOV     R3,#0FFH
0044 7D04              MOV     R5,#04H
0046 7F51              MOV     R7,#051H
0048         ?C0961:
0048 120000      R     LCALL   _tx_fis_34
                                           ; SOURCE LINE # 1284
004B         ?C0302:
004B 22                RET     
             ; FUNCTION init_dev_para (END)

             ; FUNCTION _intial_data_partition (BEGIN)
                                           ; SOURCE LINE # 1307
;---- Variable 'all_partial' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1308
                                           ; SOURCE LINE # 1310
0000 EF                MOV     A,R7
0001 7003              JNZ     $ + 5H
0003 020000      R     LJMP    ?C0303
                                           ; SOURCE LINE # 1311
                                           ; SOURCE LINE # 1313
0006 7800        R     MOV     R0,#LOW g_tmp_addr
0008 767A              MOV     @R0,#07AH
000A 08                INC     R0
000B 76AD              MOV     @R0,#0ADH
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 69  

                                           ; SOURCE LINE # 1314
000D 18                DEC     R0
000E E6                MOV     A,@R0
000F FE                MOV     R6,A
0010 08                INC     R0
0011 E6                MOV     A,@R0
0012 F582              MOV     DPL,A
0014 8E83              MOV     DPH,R6
0016 E4                CLR     A
0017 93                MOVC    A,@A+DPTR
0018 30E208            JNB     ACC.2,?C0304
001B 18                DEC     R0
001C 767A              MOV     @R0,#07AH
001E 08                INC     R0
001F 76C8              MOV     @R0,#0C8H
0021 8007              SJMP    ?C0305
0023         ?C0304:
                                           ; SOURCE LINE # 1315
0023 7800        R     MOV     R0,#LOW g_tmp_addr
0025 767A              MOV     @R0,#07AH
0027 08                INC     R0
0028 7678              MOV     @R0,#078H
002A         ?C0305:
                                           ; SOURCE LINE # 1316
002A E4                CLR     A
002B F500        R     MOV     ii,A
002D         ?C0306:
                                           ; SOURCE LINE # 1317
                                           ; SOURCE LINE # 1318
002D 7800        R     MOV     R0,#LOW g_tmp_addr
002F E6                MOV     A,@R0
0030 FE                MOV     R6,A
0031 08                INC     R0
0032 E6                MOV     A,@R0
0033 F582              MOV     DPL,A
0035 8E83              MOV     DPH,R6
0037 E4                CLR     A
0038 93                MOVC    A,@A+DPTR
0039 FF                MOV     R7,A
003A C3                CLR     C
003B 7403              MOV     A,#03H
003D 9500        R     SUBB    A,ii
003F 2400        R     ADD     A,#LOW sum
0041 F8                MOV     R0,A
0042 A607              MOV     @R0,AR7
                                           ; SOURCE LINE # 1319
0044 7800        R     MOV     R0,#LOW g_tmp_addr+01H
0046 06                INC     @R0
0047 E6                MOV     A,@R0
0048 18                DEC     R0
0049 7001              JNZ     ?C0905
004B 06                INC     @R0
004C         ?C0905:
                                           ; SOURCE LINE # 1320
004C 0500        R     INC     ii
004E E500        R     MOV     A,ii
0050 B404DA            CJNE    A,#04H,?C0306
0053         ?C0307:
                                           ; SOURCE LINE # 1322
0053 E4                CLR     A
0054 90FF78            MOV     DPTR,#sata+078H
0057 F0                MOVX    @DPTR,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 70  

                                           ; SOURCE LINE # 1323
0058 A3                INC     DPTR
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1324
005A A3                INC     DPTR
005B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1325
005C A3                INC     DPTR
005D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1326
005E A3                INC     DPTR
005F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1327
0060 A3                INC     DPTR
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1330
0062 FD                MOV     R5,A
0063 FB                MOV     R3,A
0064 FE                MOV     R6,A
0065 120000      R     LCALL   L?1062
                                           ; SOURCE LINE # 1332
0068 7800        R     MOV     R0,#LOW g_tmp_addr
006A 767A              MOV     @R0,#07AH
006C 08                INC     R0
006D 76AD              MOV     @R0,#0ADH
                                           ; SOURCE LINE # 1333
006F 18                DEC     R0
0070 E6                MOV     A,@R0
0071 FE                MOV     R6,A
0072 08                INC     R0
0073 E6                MOV     A,@R0
0074 F582              MOV     DPL,A
0076 8E83              MOV     DPH,R6
0078 E4                CLR     A
0079 93                MOVC    A,@A+DPTR
007A 30E208            JNB     ACC.2,?C0309
007D 18                DEC     R0
007E 767A              MOV     @R0,#07AH
0080 08                INC     R0
0081 76C8              MOV     @R0,#0C8H
0083 8007              SJMP    ?C0310
0085         ?C0309:
                                           ; SOURCE LINE # 1335
0085 7800        R     MOV     R0,#LOW g_tmp_addr
0087 767A              MOV     @R0,#07AH
0089 08                INC     R0
008A 7678              MOV     @R0,#078H
008C         ?C0310:
                                           ; SOURCE LINE # 1336
008C E4                CLR     A
008D F500        R     MOV     ii,A
008F         ?C0311:
                                           ; SOURCE LINE # 1337
                                           ; SOURCE LINE # 1338
008F 7800        R     MOV     R0,#LOW g_tmp_addr
0091 E6                MOV     A,@R0
0092 FE                MOV     R6,A
0093 08                INC     R0
0094 E6                MOV     A,@R0
0095 F582              MOV     DPL,A
0097 8E83              MOV     DPH,R6
0099 E4                CLR     A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 71  

009A 93                MOVC    A,@A+DPTR
009B FF                MOV     R7,A
009C C3                CLR     C
009D 7403              MOV     A,#03H
009F 9500        R     SUBB    A,ii
00A1 2400        R     ADD     A,#LOW sum
00A3 F8                MOV     R0,A
00A4 A607              MOV     @R0,AR7
                                           ; SOURCE LINE # 1339
00A6 7800        R     MOV     R0,#LOW g_tmp_addr+01H
00A8 06                INC     @R0
00A9 E6                MOV     A,@R0
00AA 18                DEC     R0
00AB 7001              JNZ     ?C0906
00AD 06                INC     @R0
00AE         ?C0906:
                                           ; SOURCE LINE # 1340
00AE 0500        R     INC     ii
00B0 E500        R     MOV     A,ii
00B2 B404DA            CJNE    A,#04H,?C0311
00B5 8040              SJMP    ?C0314
                                           ; SOURCE LINE # 1342
00B7         ?C0303:
                                           ; SOURCE LINE # 1344
                                           ; SOURCE LINE # 1345
00B7 E500        R     MOV     A,security_erase
00B9 6410              XRL     A,#010H
00BB 700C              JNZ     ?C0315
                                           ; SOURCE LINE # 1346
                                           ; SOURCE LINE # 1348
00BD 90FF78            MOV     DPTR,#sata+078H
00C0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1349
00C1 A3                INC     DPTR
00C2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1350
00C3 A3                INC     DPTR
00C4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1351
00C5 A3                INC     DPTR
00C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1352
                                           ; SOURCE LINE # 1353
                                           ; SOURCE LINE # 1355
                                           ; SOURCE LINE # 1356
                                           ; SOURCE LINE # 1357
                                           ; SOURCE LINE # 1361
00C7 8015              SJMP    ?C0963
00C9         ?C0315:
                                           ; SOURCE LINE # 1362
00C9 E500        R     MOV     A,security_erase
00CB 6420              XRL     A,#020H
00CD 7028              JNZ     ?C0314
                                           ; SOURCE LINE # 1363
                                           ; SOURCE LINE # 1364
00CF 90FF78            MOV     DPTR,#sata+078H
00D2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1365
00D3 A3                INC     DPTR
00D4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1366
00D5 A3                INC     DPTR
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 72  

00D6 74C0              MOV     A,#0C0H
00D8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1367
00D9 A3                INC     DPTR
00DA 7408              MOV     A,#08H
00DC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1368
00DD E4                CLR     A
00DE         ?C0963:
00DE A3                INC     DPTR
00DF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1369
00E0 A3                INC     DPTR
00E1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1371
00E2 7800        R     MOV     R0,#LOW sum
00E4 120000      E     LCALL   ?C?LSTKIDATA
00E7 08                DB      08H
00E8 C0                DB      0C0H
00E9 00                DB      00H
00EA 00                DB      00H
                                           ; SOURCE LINE # 1372
00EB 120000      R     LCALL   L?1061
                                           ; SOURCE LINE # 1373
00EE 7800        R     MOV     R0,#LOW sum
00F0 120000      E     LCALL   ?C?LSTKIDATA
00F3 08                DB      08H
00F4 C0                DB      0C0H
00F5 00                DB      00H
00F6 00                DB      00H
                                           ; SOURCE LINE # 1377
                                           ; SOURCE LINE # 1379
00F7         ?C0314:
                                           ; SOURCE LINE # 1381
00F7 E4                CLR     A
00F8 F5F2              MOV     SFR_ext_sram_addr+01H,A
00FA F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 1382
00FC 75F410            MOV     SFR_ext_sram_cntl,#010H
00FF         ?C0318:
                                           ; SOURCE LINE # 1383
00FF C3                CLR     C
0100 E5F2              MOV     A,SFR_ext_sram_addr+01H
0102 9480              SUBB    A,#080H
0104 5005              JNC     ?C0319
0106 75F377            MOV     SFR_ext_sram_data,#077H
0109 80F4              SJMP    ?C0318
010B         ?C0319:
                                           ; SOURCE LINE # 1385
010B 907FCA            MOV     DPTR,#07FCAH
010E E4                CLR     A
010F 93                MOVC    A,@A+DPTR
0110 7800        R     MOV     R0,#LOW trim_addr_offset+03H
0112 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1386
0113 A3                INC     DPTR
0114 E4                CLR     A
0115 93                MOVC    A,@A+DPTR
0116 18                DEC     R0
0117 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1387
0118 E4                CLR     A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 73  

0119 18                DEC     R0
011A F6                MOV     @R0,A
                                           ; SOURCE LINE # 1388
011B 18                DEC     R0
011C F6                MOV     @R0,A
                                           ; SOURCE LINE # 1389
011D 120000      E     LCALL   ?C?LLDIDATA
0120 7803              MOV     R0,#03H
0122 120000      E     LCALL   ?C?LSHL
0125 7800        R     MOV     R0,#LOW trim_addr_offset
0127 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 1390
012A 7800        R     MOV     R0,#LOW sum
012C 120000      E     LCALL   ?C?LLDIDATA
012F 7800        R     MOV     R0,#LOW trim_addr_offset
0131 120000      E     LCALL   ?C?LLDIDATA0
0134 C3                CLR     C
0135 EF                MOV     A,R7
0136 9B                SUBB    A,R3
0137 FF                MOV     R7,A
0138 EE                MOV     A,R6
0139 9A                SUBB    A,R2
013A FE                MOV     R6,A
013B ED                MOV     A,R5
013C 99                SUBB    A,R1
013D FD                MOV     R5,A
013E EC                MOV     A,R4
013F 98                SUBB    A,R0
0140 FC                MOV     R4,A
0141 7800        R     MOV     R0,#LOW sum
0143 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 1391
0146 7800        R     MOV     R0,#LOW trim_addr_offset+02H
0148 E6                MOV     A,@R0
0149 F500        R     MOV     g_sec_cnt,A
014B 08                INC     R0
014C E6                MOV     A,@R0
014D F500        R     MOV     g_sec_cnt+01H,A
                                           ; SOURCE LINE # 1395
014F 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 1396
0152 7800        R     MOV     R0,#LOW sum+03H
0154 E6                MOV     A,@R0
0155 90FF78            MOV     DPTR,#sata+078H
0158 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1397
0159 18                DEC     R0
015A E6                MOV     A,@R0
015B A3                INC     DPTR
015C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1400
015D E500        R     MOV     A,security_mode
015F 7800        R     MOV     R0,#LOW sum
0161 B4200D            CJNE    A,#020H,?C0320
                                           ; SOURCE LINE # 1401
                                           ; SOURCE LINE # 1402
0164 E6                MOV     A,@R0
0165 2408              ADD     A,#08H
0167 90FF7B            MOV     DPTR,#sata+07BH
016A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1403
016B 08                INC     R0
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 74  

016C E6                MOV     A,@R0
016D 24C0              ADD     A,#0C0H
                                           ; SOURCE LINE # 1404
016F 8007              SJMP    ?C0962
0171         ?C0320:
                                           ; SOURCE LINE # 1406
                                           ; SOURCE LINE # 1407
0171 E6                MOV     A,@R0
0172 90FF7B            MOV     DPTR,#sata+07BH
0175 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1408
0176 08                INC     R0
0177 E6                MOV     A,@R0
0178         ?C0962:
0178 90FF7A            MOV     DPTR,#sata+07AH
017B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1409
017C         ?C0321:
                                           ; SOURCE LINE # 1411
017C E4                CLR     A
017D 90FF7C            MOV     DPTR,#sata+07CH
0180 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1412
0181 A3                INC     DPTR
0182 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1413
0183 A3                INC     DPTR
0184 7430              MOV     A,#030H
0186 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1414
0187 E4                CLR     A
0188 F5FA              MOV     SFR_dma_base+01H,A
018A F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 1416
018C E500        R     MOV     A,g_sec_cnt+01H
018E 7004              JNZ     ?C0323
0190 E500        R     MOV     A,g_sec_cnt
0192 6008              JZ      ?C0322
0194         ?C0323:
                                           ; SOURCE LINE # 1417
0194 8500FC      R     MOV     SFR_dma_max_num+01H,g_sec_cnt
0197 8500FB      R     MOV     SFR_dma_max_num,g_sec_cnt+01H
019A 8014              SJMP    ?C0324
019C         ?C0322:
                                           ; SOURCE LINE # 1419
                                           ; SOURCE LINE # 1420
019C E4                CLR     A
019D F5FC              MOV     SFR_dma_max_num+01H,A
019F F5FB              MOV     SFR_dma_max_num,A
                                           ; SOURCE LINE # 1421
01A1 90FF1E            MOV     DPTR,#sata+01EH
01A4 E0                MOVX    A,@DPTR
01A5 4420              ORL     A,#020H
01A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1422
01A8 7800        R     MOV     R0,#LOW trim_addr_offset+01H
01AA E6                MOV     A,@R0
01AB 16                DEC     @R0
01AC 18                DEC     R0
01AD 7001              JNZ     ?C0907
01AF 16                DEC     @R0
01B0         ?C0907:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 75  

                                           ; SOURCE LINE # 1423
01B0         ?C0324:
                                           ; SOURCE LINE # 1424
01B0 75F880            MOV     SFR_dma_cntl,#080H
01B3         ?C0325:
                                           ; SOURCE LINE # 1425
01B3 30F8FD            JNB     dma_done,?C0325
01B6         ?C0326:
01B6         ?C0327:
                                           ; SOURCE LINE # 1427
01B6 D3                SETB    C
01B7 7800        R     MOV     R0,#LOW trim_addr_offset+01H
01B9 E6                MOV     A,@R0
01BA 9400              SUBB    A,#00H
01BC 18                DEC     R0
01BD E6                MOV     A,@R0
01BE 9400              SUBB    A,#00H
01C0 4013              JC      ?C0328
                                           ; SOURCE LINE # 1428
                                           ; SOURCE LINE # 1429
01C2 E4                CLR     A
01C3 F5FC              MOV     SFR_dma_max_num+01H,A
01C5 F5FB              MOV     SFR_dma_max_num,A
                                           ; SOURCE LINE # 1430
01C7 90FF1E            MOV     DPTR,#sata+01EH
01CA E0                MOVX    A,@DPTR
01CB 4420              ORL     A,#020H
01CD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1431
01CE D2FD              SETB    dma_cont
01D0         ?C0329:
                                           ; SOURCE LINE # 1432
01D0 20F8E3            JB      dma_done,?C0327
01D3 80FB              SJMP    ?C0329
01D5         ?C0328:
                                           ; SOURCE LINE # 1436
01D5 75F818            MOV     SFR_dma_cntl,#018H
                                           ; SOURCE LINE # 1438
01D8 E4                CLR     A
01D9 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 1439
01DB 120000      R     LCALL   flush_delay
                                           ; SOURCE LINE # 1441
01DE         ?C0331:
01DE 22                RET     
             ; FUNCTION _intial_data_partition (END)

             ; FUNCTION chp_clock_off (BEGIN)
                                           ; SOURCE LINE # 122
                                           ; SOURCE LINE # 123
                                           ; SOURCE LINE # 126
0000 30000F      R     JNB     g_smart_read_handle,?C0332
                                           ; SOURCE LINE # 127
                                           ; SOURCE LINE # 128
0003 7800        R     MOV     R0,#LOW g_smart_read_cnt
0005 E6                MOV     A,@R0
0006 FD                MOV     R5,A
0007 7F7F              MOV     R7,#07FH
0009 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 129
000C E4                CLR     A
000D 7800        R     MOV     R0,#LOW g_smart_read_cnt
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 76  

000F F6                MOV     @R0,A
                                           ; SOURCE LINE # 130
0010 C200        R     CLR     g_smart_read_handle
                                           ; SOURCE LINE # 131
0012         ?C0332:
                                           ; SOURCE LINE # 132
0012 30000F      R     JNB     g_smart_write_handle,?C0333
                                           ; SOURCE LINE # 133
                                           ; SOURCE LINE # 134
0015 7800        R     MOV     R0,#LOW g_smart_write_cnt
0017 E6                MOV     A,@R0
0018 FD                MOV     R5,A
0019 7F73              MOV     R7,#073H
001B 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 135
001E E4                CLR     A
001F 7800        R     MOV     R0,#LOW g_smart_write_cnt
0021 F6                MOV     @R0,A
                                           ; SOURCE LINE # 136
0022 C200        R     CLR     g_smart_write_handle
                                           ; SOURCE LINE # 137
0024         ?C0333:
                                           ; SOURCE LINE # 138
0024 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 146
0027 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 147
002A 90FFF0            MOV     DPTR,#sata+0F0H
002D 740F              MOV     A,#0FH
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 151
0030 90FF34            MOV     DPTR,#sata+034H
0033 E0                MOVX    A,@DPTR
0034 90FF7E            MOV     DPTR,#sata+07EH
0037 30E712            JNB     ACC.7,?C0334
                                           ; SOURCE LINE # 152
                                           ; SOURCE LINE # 154
003A 74F5              MOV     A,#0F5H
003C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 156
003D 7F0A              MOV     R7,#0AH
003F 7E00              MOV     R6,#00H
0041 120000      R     LCALL   _delay
                                           ; SOURCE LINE # 158
0044 90FFCC            MOV     DPTR,#sata+0CCH
0047 74C0              MOV     A,#0C0H
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 160
004A 8009              SJMP    ?C0335
004C         ?C0334:
                                           ; SOURCE LINE # 162
                                           ; SOURCE LINE # 163
004C 740A              MOV     A,#0AH
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 164
004F 120000      R     LCALL   wait_chp_not_ready
                                           ; SOURCE LINE # 165
0052 120000      R     LCALL   L?1073
                                           ; SOURCE LINE # 166
0055         ?C0335:
                                           ; SOURCE LINE # 167
0055 C200        R     CLR     g_chp_active
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 77  

                                           ; SOURCE LINE # 168
0057 C200        R     CLR     g_cont_en
                                           ; SOURCE LINE # 188
0059 22                RET     
             ; FUNCTION chp_clock_off (END)

             ; FUNCTION chp_clock_on (BEGIN)
                                           ; SOURCE LINE # 190
                                           ; SOURCE LINE # 191
                                           ; SOURCE LINE # 195
0000 A200        R     MOV     C,g_chp_active
0002 B3                CPL     C
0003 5032              JNC     ?C0337
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 197
0005 90FF34            MOV     DPTR,#sata+034H
0008 E0                MOVX    A,@DPTR
0009 30E716            JNB     ACC.7,?C0338
                                           ; SOURCE LINE # 198
                                           ; SOURCE LINE # 199
000C 90FF7E            MOV     DPTR,#sata+07EH
000F 74F5              MOV     A,#0F5H
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 201
0012 907FBD            MOV     DPTR,#07FBDH
0015 E4                CLR     A
0016 93                MOVC    A,@A+DPTR
0017 90FFCC            MOV     DPTR,#sata+0CCH
001A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 202
001B 7F0A              MOV     R7,#0AH
001D 7E00              MOV     R6,#00H
001F 120000      R     LCALL   _delay
                                           ; SOURCE LINE # 203
0022         ?C0338:
                                           ; SOURCE LINE # 204
0022 90FF7E            MOV     DPTR,#sata+07EH
0025 7412              MOV     A,#012H
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 205
0028 120000      R     LCALL   L?1074
                                           ; SOURCE LINE # 206
002B 7412              MOV     A,#012H
002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 207
002E 120000      R     LCALL   _delay
                                           ; SOURCE LINE # 208
0031 7412              MOV     A,#012H
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 209
0034 120000      R     LCALL   wait_chp_ready
                                           ; SOURCE LINE # 210
0037         ?C0337:
                                           ; SOURCE LINE # 211
0037 D200        R     SETB    g_chp_active
                                           ; SOURCE LINE # 215
0039 22                RET     
             ; FUNCTION chp_clock_on (END)

             ; FUNCTION L?1046 (BEGIN)
0000         L?1047:
0000 120000      R     LCALL   gen_check_sum
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 78  

0003 75F201            MOV     SFR_ext_sram_addr+01H,#01H
0006 75F1FF            MOV     SFR_ext_sram_addr,#0FFH
0009 8FF3              MOV     SFR_ext_sram_data,R7
000B         L?1048:
000B E4                CLR     A
000C         L?1049:
000C FB                MOV     R3,A
000D         L?1050:
000D 7D01              MOV     R5,#01H
000F 7F30              MOV     R7,#030H
             ; FUNCTION _chp_burst (BEGIN)
                                           ; SOURCE LINE # 217
0011 8F00        R     MOV     cmd,R7
0013 8D00        R     MOV     cnt,R5
0015 8B00        R     MOV     base_addr,R3
                                           ; SOURCE LINE # 218
                                           ; SOURCE LINE # 219
0017 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 220
001A 120000      R     LCALL   save_lba
                                           ; SOURCE LINE # 221
001D 907FBE            MOV     DPTR,#07FBEH
0020 E4                CLR     A
0021 93                MOVC    A,@A+DPTR
0022 90FF78            MOV     DPTR,#sata+078H
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 222
0026 907FBF            MOV     DPTR,#07FBFH
0029 E4                CLR     A
002A 93                MOVC    A,@A+DPTR
002B 90FF79            MOV     DPTR,#sata+079H
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 223
002F 907FC0            MOV     DPTR,#07FC0H
0032 E4                CLR     A
0033 93                MOVC    A,@A+DPTR
0034 90FF7A            MOV     DPTR,#sata+07AH
0037 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 224
0038 907FC1            MOV     DPTR,#07FC1H
003B E4                CLR     A
003C 93                MOVC    A,@A+DPTR
003D 90FF7B            MOV     DPTR,#sata+07BH
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 225
0041 907FC2            MOV     DPTR,#07FC2H
0044 E4                CLR     A
0045 93                MOVC    A,@A+DPTR
0046 90FF7C            MOV     DPTR,#sata+07CH
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 226
004A 907FC3            MOV     DPTR,#07FC3H
004D E4                CLR     A
004E 93                MOVC    A,@A+DPTR
004F 90FF7D            MOV     DPTR,#sata+07DH
0052 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 227
0053         ?C0340:
0053 E500        R     MOV     A,base_addr
0055 D3                SETB    C
0056 9400              SUBB    A,#00H
0058 4007              JC      ?C0341
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 79  

                                           ; SOURCE LINE # 228
                                           ; SOURCE LINE # 229
005A 75BE08            MOV     SFR_lba_comp,#08H
                                           ; SOURCE LINE # 230
005D 1500        R     DEC     base_addr
005F 80F2              SJMP    ?C0340
0061         ?C0341:
                                           ; SOURCE LINE # 231
0061 90FF7E            MOV     DPTR,#sata+07EH
0064 E500        R     MOV     A,cmd
0066 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 232
0067 E4                CLR     A
0068 F5FA              MOV     SFR_dma_base+01H,A
006A F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 233
006C 8500FB      R     MOV     SFR_dma_max_num_l,cnt
                                           ; SOURCE LINE # 234
006F F5FC              MOV     SFR_dma_max_num_h,A
                                           ; SOURCE LINE # 235
0071 E500        R     MOV     A,cmd
0073 B43005            CJNE    A,#030H,?C0343
                                           ; SOURCE LINE # 236
                                           ; SOURCE LINE # 237
0076 75F880            MOV     SFR_dma_cntl,#080H
                                           ; SOURCE LINE # 238
0079 8003              SJMP    ?C0345
007B         ?C0343:
                                           ; SOURCE LINE # 240
                                           ; SOURCE LINE # 241
007B 75F8C0            MOV     SFR_dma_cntl,#0C0H
                                           ; SOURCE LINE # 242
007E         ?C0345:
                                           ; SOURCE LINE # 243
007E 30F8FD            JNB     dma_done,?C0345
0081         ?C0346:
                                           ; SOURCE LINE # 244
0081 75F818            MOV     SFR_dma_cntl,#018H
                                           ; SOURCE LINE # 245
0084 020000      R     LJMP    recover_lba
             ; FUNCTION _chp_burst (END)

             ; FUNCTION flush_delay (BEGIN)
                                           ; SOURCE LINE # 248
                                           ; SOURCE LINE # 249
                                           ; SOURCE LINE # 250
0000 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 252
0003 20000C      R     JB      g_smart_power_down_flag,?C0348
                                           ; SOURCE LINE # 253
                                           ; SOURCE LINE # 254
0006 7D01              MOV     R5,#01H
0008 7F1F              MOV     R7,#01FH
000A 120000      R     LCALL   _updata_smart_n
                                           ; SOURCE LINE # 255
000D D200        R     SETB    g_smart_power_down_flag
                                           ; SOURCE LINE # 256
000F 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 257
0012         ?C0348:
                                           ; SOURCE LINE # 259
0012 90FF7E            MOV     DPTR,#sata+07EH
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 80  

0015 7442              MOV     A,#042H
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 260
0018 120000      R     LCALL   wait_chp_ready
                                           ; SOURCE LINE # 261
001B 020000      R     LJMP    reset_engine
             ; FUNCTION flush_delay (END)

             ; FUNCTION smart_handler (BEGIN)
                                           ; SOURCE LINE # 3
                                           ; SOURCE LINE # 4
                                           ; SOURCE LINE # 6
0000 C200        R     CLR     g_smart_read_flag
                                           ; SOURCE LINE # 7
0002 20000B      R     JB      g_smart_operation,?C0351
0005 90FF10            MOV     DPTR,#sata+010H
0008 E0                MOVX    A,@DPTR
0009 64D8              XRL     A,#0D8H
000B 6003              JZ      $ + 5H
000D 020000      R     LJMP    smart_handler_err
0010         ?C0351:
                                           ; SOURCE LINE # 8
                                           ; SOURCE LINE # 9
0010 90FF10            MOV     DPTR,#sata+010H
0013 E0                MOVX    A,@DPTR
0014 2430              ADD     A,#030H
0016 B40B00            CJNE    A,#0BH,?C0908
0019         ?C0908:
0019 507C              JNC     ?C0365
001B 900000      R     MOV     DPTR,#?C0909
001E 75F003            MOV     B,#03H
0021 A4                MUL     AB
0022 C583              XCH     A,DPH
0024 25F0              ADD     A,B
0026 C583              XCH     A,DPH
0028 73                JMP     @A+DPTR
0029         ?C0909:
0029 020000      R     LJMP    ?C0361
002C 020000      R     LJMP    ?C0362
002F 020000      R     LJMP    ?C0356
0032 020000      R     LJMP    ?C0365
0035 020000      R     LJMP    ?C0360
0038 020000      R     LJMP    ?C0363
003B 020000      R     LJMP    ?C0364
003E 020000      R     LJMP    ?C0365
0041 020000      R     LJMP    ?C0354
0044 020000      R     LJMP    ?C0353
0047 020000      R     LJMP    ?C0355
                                           ; SOURCE LINE # 10
                                           ; SOURCE LINE # 14
004A         ?C0353:
                                           ; SOURCE LINE # 15
                                           ; SOURCE LINE # 17
004A C200        R     CLR     g_smart_operation
                                           ; SOURCE LINE # 18
004C 804B              SJMP    ?C0352
                                           ; SOURCE LINE # 19
                                           ; SOURCE LINE # 20
004E         ?C0354:
                                           ; SOURCE LINE # 21
                                           ; SOURCE LINE # 23
004E D200        R     SETB    g_smart_operation
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 81  

                                           ; SOURCE LINE # 24
0050 8047              SJMP    ?C0352
                                           ; SOURCE LINE # 25
                                           ; SOURCE LINE # 26
0052         ?C0355:
                                           ; SOURCE LINE # 27
                                           ; SOURCE LINE # 29
0052 120000      R     LCALL   smart_status
                                           ; SOURCE LINE # 30
0055 8042              SJMP    ?C0352
                                           ; SOURCE LINE # 31
                                           ; SOURCE LINE # 32
0057         ?C0356:
                                           ; SOURCE LINE # 33
                                           ; SOURCE LINE # 35
0057 90FF14            MOV     DPTR,#sata+014H
005A E0                MOVX    A,@DPTR
005B 7004              JNZ     ?C0357
                                           ; SOURCE LINE # 36
                                           ; SOURCE LINE # 38
005D C200        R     CLR     g_smart_attribute_autosave
                                           ; SOURCE LINE # 39
005F 8038              SJMP    ?C0352
0061         ?C0357:
                                           ; SOURCE LINE # 40
0061 90FF14            MOV     DPTR,#sata+014H
0064 E0                MOVX    A,@DPTR
0065 64F1              XRL     A,#0F1H
0067 7030              JNZ     ?C0352
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 43
0069 D200        R     SETB    g_smart_attribute_autosave
                                           ; SOURCE LINE # 44
                                           ; SOURCE LINE # 45
006B 802C              SJMP    ?C0352
                                           ; SOURCE LINE # 46
                                           ; SOURCE LINE # 48
006D         ?C0360:
                                           ; SOURCE LINE # 49
                                           ; SOURCE LINE # 51
006D 120000      R     LCALL   smart_offline
                                           ; SOURCE LINE # 52
0070 8027              SJMP    ?C0352
                                           ; SOURCE LINE # 53
                                           ; SOURCE LINE # 54
0072         ?C0361:
                                           ; SOURCE LINE # 55
                                           ; SOURCE LINE # 57
0072 7B20              MOV     R3,#020H
0074 7D01              MOV     R5,#01H
0076 E4                CLR     A
0077 FF                MOV     R7,A
                                           ; SOURCE LINE # 58
                                           ; SOURCE LINE # 59
0078 8006              SJMP    ?C0964
                                           ; SOURCE LINE # 60
                                           ; SOURCE LINE # 62
007A         ?C0362:
                                           ; SOURCE LINE # 63
                                           ; SOURCE LINE # 65
007A 7B20              MOV     R3,#020H
007C 7D01              MOV     R5,#01H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 82  

007E 7F01              MOV     R7,#01H
0080         ?C0964:
0080 120000      R     LCALL   _smart_data_handler
                                           ; SOURCE LINE # 66
0083 D200        R     SETB    g_smart_read_flag
                                           ; SOURCE LINE # 67
0085 8012              SJMP    ?C0352
                                           ; SOURCE LINE # 68
                                           ; SOURCE LINE # 70
0087         ?C0363:
                                           ; SOURCE LINE # 71
                                           ; SOURCE LINE # 74
0087 7F20              MOV     R7,#020H
0089 120000      R     LCALL   _smart_log
                                           ; SOURCE LINE # 75
008C D200        R     SETB    g_smart_read_flag
                                           ; SOURCE LINE # 76
008E 8009              SJMP    ?C0352
                                           ; SOURCE LINE # 77
                                           ; SOURCE LINE # 79
0090         ?C0364:
                                           ; SOURCE LINE # 80
                                           ; SOURCE LINE # 83
0090 7F30              MOV     R7,#030H
0092 120000      R     LCALL   _smart_log
                                           ; SOURCE LINE # 84
0095 8002              SJMP    ?C0352
                                           ; SOURCE LINE # 85
                                           ; SOURCE LINE # 86
0097         ?C0365:
                                           ; SOURCE LINE # 87
                                           ; SOURCE LINE # 88
0097 D200        R     SETB    g_smart_abort
                                           ; SOURCE LINE # 90
                                           ; SOURCE LINE # 91
0099         ?C0352:
                                           ; SOURCE LINE # 92
0099 20000C      R     JB      g_smart_abort,smart_handler_err
009C         ?C0366:
                                           ; SOURCE LINE # 93
009C 200014      R     JB      g_smart_read_flag,?C0369
009F 7BFF              MOV     R3,#0FFH
00A1 E4                CLR     A
00A2 FD                MOV     R5,A
00A3 7F50              MOV     R7,#050H
00A5 020000      R     LJMP    _tx_fis_34
                                           ; SOURCE LINE # 95
                                           ; SOURCE LINE # 96
00A8         smart_handler_err:
                                           ; SOURCE LINE # 97
00A8 C200        R     CLR     g_smart_abort
                                           ; SOURCE LINE # 98
                                           ; SOURCE LINE # 99
00AA 120000      R     LCALL   L?1060
                                           ; SOURCE LINE # 101
00AD 120000      R     LCALL   L?1053
                                           ; SOURCE LINE # 102
00B0 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 105
00B3         ?C0369:
00B3 22                RET     
             ; FUNCTION smart_handler (END)
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 83  


             ; FUNCTION smart_offline (BEGIN)
                                           ; SOURCE LINE # 106
                                           ; SOURCE LINE # 107
                                           ; SOURCE LINE # 108
0000 90FF84            MOV     DPTR,#sata+084H
0003 E0                MOVX    A,@DPTR
0004 24FE              ADD     A,#0FEH
0006 601D              JZ      ?C0378
0008 14                DEC     A
0009 601A              JZ      ?C0378
000B 2484              ADD     A,#084H
000D 6011              JZ      ?C0376
000F 24FE              ADD     A,#0FEH
0011 6012              JZ      ?C0378
0013 14                DEC     A
0014 600F              JZ      ?C0378
0016 14                DEC     A
0017 600C              JZ      ?C0378
0019 2482              ADD     A,#082H
001B 700B              JNZ     ?C0381
                                           ; SOURCE LINE # 109
                                           ; SOURCE LINE # 110
                                           ; SOURCE LINE # 111
                                           ; SOURCE LINE # 113
                                           ; SOURCE LINE # 114
                                           ; SOURCE LINE # 115
001D         ?C0372:
                                           ; SOURCE LINE # 116
                                           ; SOURCE LINE # 117
001D D200        R     SETB    g_smart_offline_flag
                                           ; SOURCE LINE # 118
001F 22                RET     
                                           ; SOURCE LINE # 119
                                           ; SOURCE LINE # 120
                                           ; SOURCE LINE # 124
                                           ; SOURCE LINE # 125
                                           ; SOURCE LINE # 129
                                           ; SOURCE LINE # 130
                                           ; SOURCE LINE # 131
                                           ; SOURCE LINE # 132
                                           ; SOURCE LINE # 133
                                           ; SOURCE LINE # 134
0020         ?C0376:
                                           ; SOURCE LINE # 135
                                           ; SOURCE LINE # 136
0020 D200        R     SETB    g_smart_offline_flag
                                           ; SOURCE LINE # 137
0022 D200        R     SETB    g_smart_test_int
                                           ; SOURCE LINE # 138
0024 22                RET     
                                           ; SOURCE LINE # 139
                                           ; SOURCE LINE # 140
                                           ; SOURCE LINE # 144
                                           ; SOURCE LINE # 145
0025         ?C0378:
                                           ; SOURCE LINE # 146
                                           ; SOURCE LINE # 147
0025 D200        R     SETB    g_smart_offline_flag
                                           ; SOURCE LINE # 148
0027 22                RET     
                                           ; SOURCE LINE # 149
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 84  

                                           ; SOURCE LINE # 150
0028         ?C0381:
0028 22                RET     
             ; FUNCTION smart_offline (END)

             ; FUNCTION _smart_log (BEGIN)
                                           ; SOURCE LINE # 162
0000 8F00        R     MOV     chp_cmd,R7
                                           ; SOURCE LINE # 163
                                           ; SOURCE LINE # 164
0002 C200        R     CLR     g_smart_abort
                                           ; SOURCE LINE # 166
0004 E500        R     MOV     A,chp_cmd
0006 B4300C            CJNE    A,#030H,?C0382
                                           ; SOURCE LINE # 167
                                           ; SOURCE LINE # 168
0009 90FF84            MOV     DPTR,#sata+084H
000C E0                MOVX    A,@DPTR
000D B40902            CJNE    A,#09H,?C0383
                                           ; SOURCE LINE # 169
                                           ; SOURCE LINE # 170
                                           ; SOURCE LINE # 171
0010 804A              SJMP    ?C0965
0012         ?C0383:
                                           ; SOURCE LINE # 173
                                           ; SOURCE LINE # 174
0012 D200        R     SETB    g_smart_abort
                                           ; SOURCE LINE # 175
                                           ; SOURCE LINE # 177
0014 22                RET     
                                           ; SOURCE LINE # 178
0015         ?C0382:
                                           ; SOURCE LINE # 180
0015 90FF84            MOV     DPTR,#sata+084H
0018 E0                MOVX    A,@DPTR
0019 C3                CLR     C
001A 940A              SUBB    A,#0AH
001C 4008              JC      ?C0386
                                           ; SOURCE LINE # 181
                                           ; SOURCE LINE # 189
001E E0                MOVX    A,@DPTR
001F FF                MOV     R7,A
0020 AB00        R     MOV     R3,chp_cmd
0022 7D01              MOV     R5,#01H
                                           ; SOURCE LINE # 190
0024 803C              SJMP    ?C0970
                                           ; SOURCE LINE # 191
0026         ?C0386:
                                           ; SOURCE LINE # 193
0026 90FF84            MOV     DPTR,#sata+084H
0029 E0                MOVX    A,@DPTR
002A 14                DEC     A
002B 6017              JZ      ?C0389
002D 14                DEC     A
002E 601C              JZ      ?C0390
0030 24FC              ADD     A,#0FCH
0032 6020              JZ      ?C0391
0034 24FD              ADD     A,#0FDH
0036 6024              JZ      ?C0392
0038 2409              ADD     A,#09H
003A 7029              JNZ     ?C0393
                                           ; SOURCE LINE # 194
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 85  

                                           ; SOURCE LINE # 195
003C         ?C0388:
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 197
003C AB00        R     MOV     R3,chp_cmd
003E 7D01              MOV     R5,#01H
0040 7F03              MOV     R7,#03H
0042         ?C0966:
                                           ; SOURCE LINE # 198
0042 801E              SJMP    ?C0970
                                           ; SOURCE LINE # 199
                                           ; SOURCE LINE # 200
0044         ?C0389:
                                           ; SOURCE LINE # 201
                                           ; SOURCE LINE # 202
0044 AB00        R     MOV     R3,chp_cmd
0046 7D01              MOV     R5,#01H
0048 7F04              MOV     R7,#04H
004A         ?C0967:
                                           ; SOURCE LINE # 203
004A 8016              SJMP    ?C0970
                                           ; SOURCE LINE # 204
                                           ; SOURCE LINE # 205
004C         ?C0390:
                                           ; SOURCE LINE # 206
                                           ; SOURCE LINE # 207
004C AB00        R     MOV     R3,chp_cmd
004E 7D01              MOV     R5,#01H
0050 7F05              MOV     R7,#05H
0052         ?C0968:
                                           ; SOURCE LINE # 208
0052 800E              SJMP    ?C0970
                                           ; SOURCE LINE # 209
                                           ; SOURCE LINE # 210
0054         ?C0391:
                                           ; SOURCE LINE # 211
                                           ; SOURCE LINE # 212
0054 AB00        R     MOV     R3,chp_cmd
0056 7D01              MOV     R5,#01H
0058 7F07              MOV     R7,#07H
005A         ?C0969:
                                           ; SOURCE LINE # 213
005A 8006              SJMP    ?C0970
                                           ; SOURCE LINE # 214
                                           ; SOURCE LINE # 215
005C         ?C0392:
                                           ; SOURCE LINE # 216
                                           ; SOURCE LINE # 217
005C         ?C0965:
005C AB00        R     MOV     R3,chp_cmd
005E 7D01              MOV     R5,#01H
0060 7F09              MOV     R7,#09H
0062         ?C0970:
0062 020000      R     LJMP    _smart_data_handler
                                           ; SOURCE LINE # 218
                                           ; SOURCE LINE # 219
                                           ; SOURCE LINE # 220
0065         ?C0393:
                                           ; SOURCE LINE # 221
                                           ; SOURCE LINE # 222
0065 D200        R     SETB    g_smart_abort
                                           ; SOURCE LINE # 223
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 86  

                                           ; SOURCE LINE # 224
                                           ; SOURCE LINE # 225
                                           ; SOURCE LINE # 226
0067         smart_log_over:
                                           ; SOURCE LINE # 229
0067         ?C0394:
0067 22                RET     
             ; FUNCTION _smart_log (END)

             ; FUNCTION smart_status (BEGIN)
                                           ; SOURCE LINE # 230
                                           ; SOURCE LINE # 231
                                           ; SOURCE LINE # 232
0000 90FF18            MOV     DPTR,#sata+018H
0003 744F              MOV     A,#04FH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 233
0006 90FF1A            MOV     DPTR,#sata+01AH
0009 74C2              MOV     A,#0C2H
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 234
000C 22                RET     
             ; FUNCTION smart_status (END)

             ; FUNCTION _smart_data_handler (BEGIN)
                                           ; SOURCE LINE # 235
0000 8F00        R     MOV     base_sec,R7
0002 8D00        R     MOV     sec_cnt,R5
0004 8B00        R     MOV     chp_cmd,R3
                                           ; SOURCE LINE # 236
                                           ; SOURCE LINE # 240
0006 E4                CLR     A
0007 F500        R     MOV     cur_cnt,A
                                           ; SOURCE LINE # 241
0009 F500        R     MOV     pio_interrput,A
                                           ; SOURCE LINE # 243
000B C200        R     CLR     g_smart_abort
000D         ?C0396:
                                           ; SOURCE LINE # 245
000D E500        R     MOV     A,sec_cnt
000F D3                SETB    C
0010 9400              SUBB    A,#00H
0012 4078              JC      ?C0397
                                           ; SOURCE LINE # 246
                                           ; SOURCE LINE # 248
0014 E500        R     MOV     A,chp_cmd
0016 6430              XRL     A,#030H
0018 7029              JNZ     ?C0398
                                           ; SOURCE LINE # 249
                                           ; SOURCE LINE # 251
001A 850000      R     MOV     ?_tx_fis_5f?BYTE+03H,sec_cnt
001D F500        R     MOV     ?_tx_fis_5f?BYTE+04H,A
001F 7500D0      R     MOV     ?_tx_fis_5f?BYTE+05H,#0D0H
0022 AB00        R     MOV     R3,pio_interrput
0024 FD                MOV     R5,A
0025 7F58              MOV     R7,#058H
0027 120000      R     LCALL   _tx_fis_5f
                                           ; SOURCE LINE # 252
002A 750040      R     MOV     pio_interrput,#040H
                                           ; SOURCE LINE # 254
002D 120000      R     LCALL   L?1070
                                           ; SOURCE LINE # 255
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 87  

0030 30EA02            JNB     sata_burst_abort,?C0399
0033 D200        R     SETB    g_smart_abort
0035         ?C0399:
                                           ; SOURCE LINE # 257
0035 E500        R     MOV     A,cur_cnt
0037 2500        R     ADD     A,base_sec
0039 FB                MOV     R3,A
003A 7D01              MOV     R5,#01H
003C AF00        R     MOV     R7,chp_cmd
003E 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 258
0041 8042              SJMP    ?C0400
0043         ?C0398:
                                           ; SOURCE LINE # 260
                                           ; SOURCE LINE # 262
0043 E500        R     MOV     A,sec_cnt
0045 B4010A            CJNE    A,#01H,?C0401
0048 F500        R     MOV     ?_tx_fis_5f?BYTE+03H,A
004A E4                CLR     A
004B F500        R     MOV     ?_tx_fis_5f?BYTE+04H,A
004D 750050      R     MOV     ?_tx_fis_5f?BYTE+05H,#050H
0050 8009              SJMP    ?C0971
0052         ?C0401:
                                           ; SOURCE LINE # 263
0052 850000      R     MOV     ?_tx_fis_5f?BYTE+03H,sec_cnt
0055 E4                CLR     A
0056 F500        R     MOV     ?_tx_fis_5f?BYTE+04H,A
0058 7500D0      R     MOV     ?_tx_fis_5f?BYTE+05H,#0D0H
005B         ?C0971:
005B 7BE0              MOV     R3,#0E0H
005D FD                MOV     R5,A
005E 7F58              MOV     R7,#058H
0060 120000      R     LCALL   _tx_fis_5f
0063         ?C0402:
                                           ; SOURCE LINE # 266
0063 E500        R     MOV     A,cur_cnt
0065 2500        R     ADD     A,base_sec
0067 FB                MOV     R3,A
0068 7D01              MOV     R5,#01H
006A AF00        R     MOV     R7,chp_cmd
006C 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 267
006F 300007      R     JNB     g_smart_offline_flag,?C0403
0072 E500        R     MOV     A,base_sec
0074 7003              JNZ     ?C0403
0076 120000      R     LCALL   self_test_routine
0079         ?C0403:
                                           ; SOURCE LINE # 268
0079 7D01              MOV     R5,#01H
007B 7FC0              MOV     R7,#0C0H
007D 120000      R     LCALL   _sata_burst
                                           ; SOURCE LINE # 269
0080 30EA02            JNB     sata_burst_abort,?C0400
0083 D200        R     SETB    g_smart_abort
                                           ; SOURCE LINE # 271
0085         ?C0400:
                                           ; SOURCE LINE # 272
0085 0500        R     INC     cur_cnt
                                           ; SOURCE LINE # 273
0087 1500        R     DEC     sec_cnt
                                           ; SOURCE LINE # 276
0089 020000      R     LJMP    ?C0396
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 88  

008C         ?C0397:
                                           ; SOURCE LINE # 277
008C 020000      R     LJMP    reset_engine
             ; FUNCTION _smart_data_handler (END)

             ; FUNCTION self_test_routine (BEGIN)
                                           ; SOURCE LINE # 283
                                           ; SOURCE LINE # 284
                                           ; SOURCE LINE # 287
0000 75F201            MOV     SFR_ext_sram_addr+01H,#01H
0003 75F16B            MOV     SFR_ext_sram_addr,#06BH
                                           ; SOURCE LINE # 288
0006 300005      R     JNB     g_smart_test_int,?C0406
                                           ; SOURCE LINE # 289
                                           ; SOURCE LINE # 290
0009 75F310            MOV     SFR_ext_sram_data,#010H
                                           ; SOURCE LINE # 292
000C 805D              SJMP    self_test_over
                                           ; SOURCE LINE # 293
000E         ?C0406:
                                           ; SOURCE LINE # 294
000E 7800        R     MOV     R0,#LOW g_smart_test_status
0010 E6                MOV     A,@R0
0011 B40A00            CJNE    A,#0AH,?C0910
0014         ?C0910:
0014 5055              JNC     self_test_over
0016 900000      R     MOV     DPTR,#?C0911
0019 F8                MOV     R0,A
001A 28                ADD     A,R0
001B 28                ADD     A,R0
001C 73                JMP     @A+DPTR
001D         ?C0911:
001D 020000      R     LJMP    ?C0409
0020 020000      R     LJMP    ?C0410
0023 020000      R     LJMP    ?C0411
0026 020000      R     LJMP    ?C0412
0029 020000      R     LJMP    ?C0413
002C 020000      R     LJMP    ?C0414
002F 020000      R     LJMP    ?C0415
0032 020000      R     LJMP    ?C0416
0035 020000      R     LJMP    ?C0417
0038 020000      R     LJMP    ?C0418
                                           ; SOURCE LINE # 295
                                           ; SOURCE LINE # 296
003B         ?C0409:
                                           ; SOURCE LINE # 297
                                           ; SOURCE LINE # 298
003B 75F3F9            MOV     SFR_ext_sram_data,#0F9H
                                           ; SOURCE LINE # 299
003E 802B              SJMP    self_test_over
                                           ; SOURCE LINE # 300
                                           ; SOURCE LINE # 301
0040         ?C0410:
                                           ; SOURCE LINE # 302
                                           ; SOURCE LINE # 303
0040 75F3F8            MOV     SFR_ext_sram_data,#0F8H
                                           ; SOURCE LINE # 304
0043 8026              SJMP    self_test_over
                                           ; SOURCE LINE # 305
                                           ; SOURCE LINE # 306
0045         ?C0411:
                                           ; SOURCE LINE # 307
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 89  

                                           ; SOURCE LINE # 308
0045 75F3F7            MOV     SFR_ext_sram_data,#0F7H
                                           ; SOURCE LINE # 309
0048 8021              SJMP    self_test_over
                                           ; SOURCE LINE # 310
                                           ; SOURCE LINE # 311
004A         ?C0412:
                                           ; SOURCE LINE # 312
                                           ; SOURCE LINE # 313
004A 75F3F6            MOV     SFR_ext_sram_data,#0F6H
                                           ; SOURCE LINE # 314
004D 801C              SJMP    self_test_over
                                           ; SOURCE LINE # 315
                                           ; SOURCE LINE # 316
004F         ?C0413:
                                           ; SOURCE LINE # 317
                                           ; SOURCE LINE # 318
004F 75F3F5            MOV     SFR_ext_sram_data,#0F5H
                                           ; SOURCE LINE # 319
0052 8017              SJMP    self_test_over
                                           ; SOURCE LINE # 320
                                           ; SOURCE LINE # 321
0054         ?C0414:
                                           ; SOURCE LINE # 322
                                           ; SOURCE LINE # 323
0054 75F3F4            MOV     SFR_ext_sram_data,#0F4H
                                           ; SOURCE LINE # 324
0057 8012              SJMP    self_test_over
                                           ; SOURCE LINE # 325
                                           ; SOURCE LINE # 326
0059         ?C0415:
                                           ; SOURCE LINE # 327
                                           ; SOURCE LINE # 328
0059 75F3F3            MOV     SFR_ext_sram_data,#0F3H
                                           ; SOURCE LINE # 329
005C 800D              SJMP    self_test_over
                                           ; SOURCE LINE # 330
                                           ; SOURCE LINE # 331
005E         ?C0416:
                                           ; SOURCE LINE # 332
                                           ; SOURCE LINE # 333
005E 75F3F2            MOV     SFR_ext_sram_data,#0F2H
                                           ; SOURCE LINE # 334
0061 8008              SJMP    self_test_over
                                           ; SOURCE LINE # 335
                                           ; SOURCE LINE # 336
0063         ?C0417:
                                           ; SOURCE LINE # 337
                                           ; SOURCE LINE # 338
0063 75F3F1            MOV     SFR_ext_sram_data,#0F1H
                                           ; SOURCE LINE # 339
0066 8003              SJMP    self_test_over
                                           ; SOURCE LINE # 340
                                           ; SOURCE LINE # 341
0068         ?C0418:
                                           ; SOURCE LINE # 342
                                           ; SOURCE LINE # 343
0068 E4                CLR     A
0069 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 344
                                           ; SOURCE LINE # 345
                                           ; SOURCE LINE # 346
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 90  

                                           ; SOURCE LINE # 347
006B         self_test_over:
                                           ; SOURCE LINE # 348
                                           ; SOURCE LINE # 349
006B 120000      R     LCALL   L?1069
;---- Variable 'tmp' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 350
006E 75F201            MOV     SFR_ext_sram_addr+01H,#01H
0071 75F1FF            MOV     SFR_ext_sram_addr,#0FFH
                                           ; SOURCE LINE # 351
0074 8FF3              MOV     SFR_ext_sram_data,R7
                                           ; SOURCE LINE # 352
0076 7800        R     MOV     R0,#LOW g_smart_test_status
0078 06                INC     @R0
                                           ; SOURCE LINE # 353
0079 E6                MOV     A,@R0
007A 640A              XRL     A,#0AH
007C 6003              JZ      ?C0420
007E 300008      R     JNB     g_smart_test_int,?C0421
0081         ?C0420:
                                           ; SOURCE LINE # 354
                                           ; SOURCE LINE # 355
0081 E4                CLR     A
0082 7800        R     MOV     R0,#LOW g_smart_test_status
0084 F6                MOV     @R0,A
                                           ; SOURCE LINE # 356
0085 C200        R     CLR     g_smart_offline_flag
                                           ; SOURCE LINE # 357
0087 C200        R     CLR     g_smart_test_int
                                           ; SOURCE LINE # 358
                                           ; SOURCE LINE # 359
0089         ?C0421:
0089 22                RET     
             ; FUNCTION self_test_routine (END)

             ; FUNCTION L?1051 (BEGIN)
0000         L?1052:
0000 7BFF              MOV     R3,#0FFH
0002 7D04              MOV     R5,#04H
0004 7F51              MOV     R7,#051H
0006 120000      R     LCALL   _tx_fis_34
0009         L?1053:
0009 7D01              MOV     R5,#01H
000B 7F5B              MOV     R7,#05BH
             ; FUNCTION _updata_smart (BEGIN)
                                           ; SOURCE LINE # 405
000D 8F00        R     MOV     smart_addr,R7
000F 8D00        R     MOV     smart_cnt,R5
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 409
0011 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 410
0014 E4                CLR     A
0015 FB                MOV     R3,A
0016 7D01              MOV     R5,#01H
0018 7F20              MOV     R7,#020H
001A 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 411
001D E4                CLR     A
001E F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 414
0020 AF00        R     MOV     R7,smart_addr
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 91  

0022 F5F2              MOV     SFR_ext_sram_addr+01H,A
0024 8FF1              MOV     SFR_ext_sram_addr,R7
                                           ; SOURCE LINE # 415
;---- Variable 'tmp_data' assigned to Register 'R7' ----
0026 AFF3              MOV     R7,SFR_ext_sram_data
                                           ; SOURCE LINE # 416
0028 E500        R     MOV     A,smart_cnt
002A 25F3              ADD     A,SFR_ext_sram_data
002C F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 419
002E EF                MOV     A,R7
002F D3                SETB    C
0030 95F3              SUBB    A,SFR_ext_sram_data
0032 4030              JC      ?C0422
                                           ; SOURCE LINE # 420
                                           ; SOURCE LINE # 421
0034 05F1              INC     SFR_ext_sram_addr
0036 E5F1              MOV     A,SFR_ext_sram_addr
0038 7002              JNZ     ?C0912
003A 05F2              INC     SFR_ext_sram_addr+01H
003C         ?C0912:
                                           ; SOURCE LINE # 422
003C AFF3              MOV     R7,SFR_ext_sram_data
                                           ; SOURCE LINE # 423
003E 05F3              INC     SFR_ext_sram_data
                                           ; SOURCE LINE # 425
0040 EF                MOV     A,R7
0041 D3                SETB    C
0042 95F3              SUBB    A,SFR_ext_sram_data
0044 401E              JC      ?C0422
                                           ; SOURCE LINE # 426
                                           ; SOURCE LINE # 427
0046 05F1              INC     SFR_ext_sram_addr
0048 E5F1              MOV     A,SFR_ext_sram_addr
004A 7002              JNZ     ?C0913
004C 05F2              INC     SFR_ext_sram_addr+01H
004E         ?C0913:
                                           ; SOURCE LINE # 428
004E AFF3              MOV     R7,SFR_ext_sram_data
                                           ; SOURCE LINE # 429
0050 05F3              INC     SFR_ext_sram_data
                                           ; SOURCE LINE # 431
0052 EF                MOV     A,R7
0053 D3                SETB    C
0054 95F3              SUBB    A,SFR_ext_sram_data
0056 400C              JC      ?C0422
                                           ; SOURCE LINE # 432
                                           ; SOURCE LINE # 433
0058 05F1              INC     SFR_ext_sram_addr
005A E5F1              MOV     A,SFR_ext_sram_addr
005C 7002              JNZ     ?C0914
005E 05F2              INC     SFR_ext_sram_addr+01H
0060         ?C0914:
                                           ; SOURCE LINE # 434
0060 AFF3              MOV     R7,SFR_ext_sram_data
                                           ; SOURCE LINE # 435
0062 05F3              INC     SFR_ext_sram_data
                                           ; SOURCE LINE # 436
                                           ; SOURCE LINE # 437
                                           ; SOURCE LINE # 438
0064         ?C0422:
                                           ; SOURCE LINE # 439
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 92  

;---- Variable 'tmp' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 440
                                           ; SOURCE LINE # 441
                                           ; SOURCE LINE # 442
0064 120000      R     LCALL   L?1046
                                           ; SOURCE LINE # 443
0067 020000      R     LJMP    reset_engine
             ; FUNCTION _updata_smart (END)

             ; FUNCTION _updata_smart_n (BEGIN)
                                           ; SOURCE LINE # 446
0000 8F00        R     MOV     smart_addr,R7
0002 8D00        R     MOV     smart_cnt,R5
                                           ; SOURCE LINE # 447
                                           ; SOURCE LINE # 450
0004 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 451
0007 E4                CLR     A
0008 FB                MOV     R3,A
0009 7D01              MOV     R5,#01H
000B 7F20              MOV     R7,#020H
000D 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 452
0010 E4                CLR     A
0011 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 455
0013 AF00        R     MOV     R7,smart_addr
0015 F5F2              MOV     SFR_ext_sram_addr+01H,A
0017 8FF1              MOV     SFR_ext_sram_addr,R7
                                           ; SOURCE LINE # 456
;---- Variable 'tmp_data' assigned to Register 'R7' ----
0019 AFF3              MOV     R7,SFR_ext_sram_data
                                           ; SOURCE LINE # 457
001B C3                CLR     C
001C E5F3              MOV     A,SFR_ext_sram_data
001E 9500        R     SUBB    A,smart_cnt
0020 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 460
0022 EF                MOV     A,R7
0023 C3                CLR     C
0024 95F3              SUBB    A,SFR_ext_sram_data
0026 5030              JNC     ?C0426
                                           ; SOURCE LINE # 461
                                           ; SOURCE LINE # 462
0028 05F1              INC     SFR_ext_sram_addr
002A E5F1              MOV     A,SFR_ext_sram_addr
002C 7002              JNZ     ?C0915
002E 05F2              INC     SFR_ext_sram_addr+01H
0030         ?C0915:
                                           ; SOURCE LINE # 463
0030 AFF3              MOV     R7,SFR_ext_sram_data
                                           ; SOURCE LINE # 464
0032 15F3              DEC     SFR_ext_sram_data
                                           ; SOURCE LINE # 466
0034 EF                MOV     A,R7
0035 C3                CLR     C
0036 95F3              SUBB    A,SFR_ext_sram_data
0038 501E              JNC     ?C0426
                                           ; SOURCE LINE # 467
                                           ; SOURCE LINE # 468
003A 05F1              INC     SFR_ext_sram_addr
003C E5F1              MOV     A,SFR_ext_sram_addr
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 93  

003E 7002              JNZ     ?C0916
0040 05F2              INC     SFR_ext_sram_addr+01H
0042         ?C0916:
                                           ; SOURCE LINE # 469
0042 AFF3              MOV     R7,SFR_ext_sram_data
                                           ; SOURCE LINE # 470
0044 15F3              DEC     SFR_ext_sram_data
                                           ; SOURCE LINE # 472
0046 EF                MOV     A,R7
0047 C3                CLR     C
0048 95F3              SUBB    A,SFR_ext_sram_data
004A 500C              JNC     ?C0426
                                           ; SOURCE LINE # 473
                                           ; SOURCE LINE # 474
004C 05F1              INC     SFR_ext_sram_addr
004E E5F1              MOV     A,SFR_ext_sram_addr
0050 7002              JNZ     ?C0917
0052 05F2              INC     SFR_ext_sram_addr+01H
0054         ?C0917:
                                           ; SOURCE LINE # 475
0054 AFF3              MOV     R7,SFR_ext_sram_data
                                           ; SOURCE LINE # 476
0056 15F3              DEC     SFR_ext_sram_data
                                           ; SOURCE LINE # 477
                                           ; SOURCE LINE # 478
                                           ; SOURCE LINE # 479
0058         ?C0426:
                                           ; SOURCE LINE # 480
;---- Variable 'tmp' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 481
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 483
0058 120000      R     LCALL   L?1046
                                           ; SOURCE LINE # 484
005B 020000      R     LJMP    reset_engine
             ; FUNCTION _updata_smart_n (END)

             ; FUNCTION smart_write_cnt (BEGIN)
                                           ; SOURCE LINE # 487
                                           ; SOURCE LINE # 488
                                           ; SOURCE LINE # 490
0000 D200        R     SETB    g_smart_write_handle
                                           ; SOURCE LINE # 492
0002 7800        R     MOV     R0,#LOW write_sec_cnt_l
0004 E6                MOV     A,@R0
0005 FE                MOV     R6,A
0006 08                INC     R0
0007 E6                MOV     A,@R0
0008 FF                MOV     R7,A
;---- Variable 'tmp' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 493
0009 E5CE              MOV     A,SFR_SATA_done_num
000B 26                ADD     A,@R0
000C F6                MOV     @R0,A
000D 18                DEC     R0
000E E5CF              MOV     A,SFR_SATA_done_num+01H
0010 36                ADDC    A,@R0
0011 F6                MOV     @R0,A
                                           ; SOURCE LINE # 494
0012 18                DEC     R0
0013 E5E5              MOV     A,SFR_SATA_done_num_h
0015 26                ADD     A,@R0
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 94  

0016 F6                MOV     @R0,A
                                           ; SOURCE LINE # 495
0017 D3                SETB    C
0018 7800        R     MOV     R0,#LOW write_sec_cnt_l+01H
001A E6                MOV     A,@R0
001B 9F                SUBB    A,R7
001C 18                DEC     R0
001D E6                MOV     A,@R0
001E 9E                SUBB    A,R6
001F 5002              JNC     ?C0431
0021 18                DEC     R0
0022 06                INC     @R0
0023         ?C0431:
                                           ; SOURCE LINE # 496
0023 7800        R     MOV     R0,#LOW write_sec_cnt_h
0025 E6                MOV     A,@R0
0026 C3                CLR     C
0027 9420              SUBB    A,#020H
0029 4009              JC      ?C0433
                                           ; SOURCE LINE # 497
                                           ; SOURCE LINE # 498
002B 74E0              MOV     A,#0E0H
002D 26                ADD     A,@R0
002E F6                MOV     @R0,A
                                           ; SOURCE LINE # 499
002F 7800        R     MOV     R0,#LOW g_smart_write_cnt
0031 06                INC     @R0
                                           ; SOURCE LINE # 500
0032 80EF              SJMP    ?C0431
                                           ; SOURCE LINE # 501
0034         ?C0433:
0034 22                RET     
             ; FUNCTION smart_write_cnt (END)

             ; FUNCTION smart_read_cnt (BEGIN)
                                           ; SOURCE LINE # 504
                                           ; SOURCE LINE # 505
                                           ; SOURCE LINE # 508
0000 D200        R     SETB    g_smart_read_handle
                                           ; SOURCE LINE # 509
0002 7800        R     MOV     R0,#LOW read_sec_cnt_l
0004 E6                MOV     A,@R0
0005 FE                MOV     R6,A
0006 08                INC     R0
0007 E6                MOV     A,@R0
0008 FF                MOV     R7,A
;---- Variable 'tmp' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 510
0009 E5CE              MOV     A,SFR_SATA_done_num
000B 26                ADD     A,@R0
000C F6                MOV     @R0,A
000D 18                DEC     R0
000E E5CF              MOV     A,SFR_SATA_done_num+01H
0010 36                ADDC    A,@R0
0011 F6                MOV     @R0,A
                                           ; SOURCE LINE # 511
0012 18                DEC     R0
0013 E5E5              MOV     A,SFR_SATA_done_num_h
0015 26                ADD     A,@R0
0016 F6                MOV     @R0,A
                                           ; SOURCE LINE # 512
0017 D3                SETB    C
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 95  

0018 7800        R     MOV     R0,#LOW read_sec_cnt_l+01H
001A E6                MOV     A,@R0
001B 9F                SUBB    A,R7
001C 18                DEC     R0
001D E6                MOV     A,@R0
001E 9E                SUBB    A,R6
001F 5002              JNC     ?C0435
0021 18                DEC     R0
0022 06                INC     @R0
0023         ?C0435:
                                           ; SOURCE LINE # 513
0023 7800        R     MOV     R0,#LOW read_sec_cnt_h
0025 E6                MOV     A,@R0
0026 C3                CLR     C
0027 9420              SUBB    A,#020H
0029 4009              JC      ?C0437
                                           ; SOURCE LINE # 514
                                           ; SOURCE LINE # 515
002B 74E0              MOV     A,#0E0H
002D 26                ADD     A,@R0
002E F6                MOV     @R0,A
                                           ; SOURCE LINE # 516
002F 7800        R     MOV     R0,#LOW g_smart_read_cnt
0031 06                INC     @R0
                                           ; SOURCE LINE # 517
0032 80EF              SJMP    ?C0435
                                           ; SOURCE LINE # 518
0034         ?C0437:
0034 22                RET     
             ; FUNCTION smart_read_cnt (END)

             ; FUNCTION smart_block_handle (BEGIN)
                                           ; SOURCE LINE # 521
                                           ; SOURCE LINE # 522
                                           ; SOURCE LINE # 531
0000         check_loop:
                                           ; SOURCE LINE # 532
0000 907FBA            MOV     DPTR,#07FBAH
0003 E4                CLR     A
0004 93                MOVC    A,@A+DPTR
0005 30E011            JNB     ACC.0,?C0439
0008 90FF5C            MOV     DPTR,#sata+05CH
000B E0                MOVX    A,@DPTR
000C 30E70A            JNB     ACC.7,?C0439
000F 750001      R     MOV     chp_sel,#01H
0012 90FF7F            MOV     DPTR,#sata+07FH
0015 7410              MOV     A,#010H
0017 8049              SJMP    ?C0974
0019         ?C0439:
                                           ; SOURCE LINE # 533
0019 907FBA            MOV     DPTR,#07FBAH
001C E4                CLR     A
001D 93                MOVC    A,@A+DPTR
001E 30E111            JNB     ACC.1,?C0442
0021 90FF5D            MOV     DPTR,#sata+05DH
0024 E0                MOVX    A,@DPTR
0025 30E70A            JNB     ACC.7,?C0442
0028 750002      R     MOV     chp_sel,#02H
002B 90FF7F            MOV     DPTR,#sata+07FH
002E 7420              MOV     A,#020H
0030         ?C0972:
0030 8030              SJMP    ?C0974
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 96  

0032         ?C0442:
                                           ; SOURCE LINE # 534
0032 907FBA            MOV     DPTR,#07FBAH
0035 E4                CLR     A
0036 93                MOVC    A,@A+DPTR
0037 30E211            JNB     ACC.2,?C0444
003A 90FF5E            MOV     DPTR,#sata+05EH
003D E0                MOVX    A,@DPTR
003E 30E70A            JNB     ACC.7,?C0444
0041 750004      R     MOV     chp_sel,#04H
0044 90FF7F            MOV     DPTR,#sata+07FH
0047 7440              MOV     A,#040H
0049         ?C0973:
0049 8017              SJMP    ?C0974
004B         ?C0444:
                                           ; SOURCE LINE # 535
004B 907FBA            MOV     DPTR,#07FBAH
004E E4                CLR     A
004F 93                MOVC    A,@A+DPTR
0050 30E317            JNB     ACC.3,?C0446
0053 90FF5F            MOV     DPTR,#sata+05FH
0056 E0                MOVX    A,@DPTR
0057 30E710            JNB     ACC.7,?C0446
005A 750008      R     MOV     chp_sel,#08H
005D 90FF7F            MOV     DPTR,#sata+07FH
0060 7480              MOV     A,#080H
0062         ?C0974:
0062 F0                MOVX    @DPTR,A
0063 E4                CLR     A
0064 90FF57            MOV     DPTR,#sata+057H
0067 F0                MOVX    @DPTR,A
0068 8023              SJMP    handle
006A         ?C0446:
                                           ; SOURCE LINE # 536
006A 907FBA            MOV     DPTR,#07FBAH
006D E4                CLR     A
006E 93                MOVC    A,@A+DPTR
006F 20E403            JB      ACC.4,$ + 6H
0072 020000      R     LJMP    ?C0459
0075 90FF76            MOV     DPTR,#sata+076H
0078 E0                MOVX    A,@DPTR
0079 20E703            JB      ACC.7,$ + 6H
007C 020000      R     LJMP    ?C0459
007F 750010      R     MOV     chp_sel,#010H
0082 E4                CLR     A
0083 90FF7F            MOV     DPTR,#sata+07FH
0086 F0                MOVX    @DPTR,A
0087 90FF57            MOV     DPTR,#sata+057H
008A 7410              MOV     A,#010H
008C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 537
                                           ; SOURCE LINE # 538
008D         handle:
                                           ; SOURCE LINE # 539
008D 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 540
0090 8500D7      R     MOV     SFR_CHP_en,chp_sel
                                           ; SOURCE LINE # 541
                                           ; SOURCE LINE # 542
0093 120000      R     LCALL   L?1055
                                           ; SOURCE LINE # 543
0096 E4                CLR     A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 97  

0097 F5FA              MOV     SFR_dma_base+01H,A
0099 F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 544
009B 75FB01            MOV     SFR_dma_max_num_l,#01H
                                           ; SOURCE LINE # 545
009E F5FC              MOV     SFR_dma_max_num_h,A
                                           ; SOURCE LINE # 546
00A0 90FF7E            MOV     DPTR,#sata+07EH
00A3 7470              MOV     A,#070H
00A5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 547
00A6 75F8C0            MOV     SFR_dma_cntl,#0C0H
00A9         ?C0451:
                                           ; SOURCE LINE # 548
00A9 30F8FD            JNB     dma_done,?C0451
00AC         ?C0452:
                                           ; SOURCE LINE # 549
00AC 120000      R     LCALL   wait_chp_ready
                                           ; SOURCE LINE # 550
00AF 75F818            MOV     SFR_dma_cntl,#018H
                                           ; SOURCE LINE # 552
00B2 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 553
00B5 E4                CLR     A
00B6 F5F2              MOV     SFR_ext_sram_addr+01H,A
00B8 F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 554
00BA 85F300      R     MOV     block_infor0,SFR_ext_sram_data
                                           ; SOURCE LINE # 555
00BD 85F300      R     MOV     block_infor1,SFR_ext_sram_data
                                           ; SOURCE LINE # 556
00C0 85F300      R     MOV     block_infor2,SFR_ext_sram_data
                                           ; SOURCE LINE # 557
00C3 85F300      R     MOV     block_infor3,SFR_ext_sram_data
                                           ; SOURCE LINE # 558
00C6 85F300      R     MOV     block_infor4,SFR_ext_sram_data
                                           ; SOURCE LINE # 559
00C9 85F300      R     MOV     block_infor5,SFR_ext_sram_data
                                           ; SOURCE LINE # 560
00CC 85F300      R     MOV     block_infor6,SFR_ext_sram_data
                                           ; SOURCE LINE # 562
00CF 907FBB            MOV     DPTR,#07FBBH
00D2 93                MOVC    A,@A+DPTR
00D3 90FF7F            MOV     DPTR,#sata+07FH
00D6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 563
00D7 907FBC            MOV     DPTR,#07FBCH
00DA E4                CLR     A
00DB 93                MOVC    A,@A+DPTR
00DC 90FF57            MOV     DPTR,#sata+057H
00DF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 566
00E0 7B10              MOV     R3,#010H
00E2 7D01              MOV     R5,#01H
00E4 7F20              MOV     R7,#020H
00E6 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 567
00E9 E4                CLR     A
00EA F5F2              MOV     SFR_ext_sram_addr+01H,A
00EC F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 568
00EE 75F410            MOV     SFR_ext_sram_cntl,#010H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 98  

                                           ; SOURCE LINE # 569
00F1 7800        R     MOV     R0,#LOW g_smart_block_cnt_h
00F3 A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 570
00F5 08                INC     R0
00F6 A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 571
00F8 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 574
00FA E6                MOV     A,@R0
00FB B4FF05            CJNE    A,#0FFH,?C0453
                                           ; SOURCE LINE # 575
                                           ; SOURCE LINE # 576
00FE E4                CLR     A
00FF 18                DEC     R0
0100 F6                MOV     @R0,A
                                           ; SOURCE LINE # 577
0101 08                INC     R0
0102 F6                MOV     @R0,A
                                           ; SOURCE LINE # 578
0103         ?C0453:
                                           ; SOURCE LINE # 580
0103 7800        R     MOV     R0,#LOW g_smart_block_cnt_l
0105 06                INC     @R0
                                           ; SOURCE LINE # 581
0106 E6                MOV     A,@R0
0107 B44005            CJNE    A,#040H,?C0454
                                           ; SOURCE LINE # 582
                                           ; SOURCE LINE # 583
010A 18                DEC     R0
010B 06                INC     @R0
                                           ; SOURCE LINE # 584
010C E4                CLR     A
010D 08                INC     R0
010E F6                MOV     @R0,A
                                           ; SOURCE LINE # 585
010F         ?C0454:
                                           ; SOURCE LINE # 586
010F 7800        R     MOV     R0,#LOW g_smart_block_cnt_h
0111 E6                MOV     A,@R0
0112 B43002            CJNE    A,#030H,?C0455
0115 E4                CLR     A
0116 F6                MOV     @R0,A
0117         ?C0455:
                                           ; SOURCE LINE # 589
0117 E4                CLR     A
0118 F5F2              MOV     SFR_ext_sram_addr+01H,A
011A F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 590
011C 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 591
011F 7800        R     MOV     R0,#LOW g_smart_block_cnt_h
0121 E6                MOV     A,@R0
0122 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 592
0124 08                INC     R0
0125 E6                MOV     A,@R0
0126 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 593
0128 E4                CLR     A
0129 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 594
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 99  

012B 7B10              MOV     R3,#010H
012D 120000      R     LCALL   L?1050
                                           ; SOURCE LINE # 597
0130 7800        R     MOV     R0,#LOW g_smart_block_cnt_h
0132 E6                MOV     A,@R0
0133 2410              ADD     A,#010H
0135 FB                MOV     R3,A
0136 7D01              MOV     R5,#01H
0138 7F20              MOV     R7,#020H
013A 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 599
013D 7800        R     MOV     R0,#LOW g_smart_block_cnt_l
013F E6                MOV     A,@R0
0140 75F008            MOV     B,#08H
0143 A4                MUL     AB
0144 85F0F2            MOV     SFR_ext_sram_addr+01H,B
0147 F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 600
0149 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 601
014C 8500F3      R     MOV     SFR_ext_sram_data,chp_sel
                                           ; SOURCE LINE # 602
014F 8500F3      R     MOV     SFR_ext_sram_data,block_infor0
                                           ; SOURCE LINE # 603
0152 8500F3      R     MOV     SFR_ext_sram_data,block_infor1
                                           ; SOURCE LINE # 604
0155 8500F3      R     MOV     SFR_ext_sram_data,block_infor2
                                           ; SOURCE LINE # 605
0158 8500F3      R     MOV     SFR_ext_sram_data,block_infor3
                                           ; SOURCE LINE # 606
015B 8500F3      R     MOV     SFR_ext_sram_data,block_infor4
                                           ; SOURCE LINE # 607
015E 8500F3      R     MOV     SFR_ext_sram_data,block_infor5
                                           ; SOURCE LINE # 608
0161 8500F3      R     MOV     SFR_ext_sram_data,block_infor6
                                           ; SOURCE LINE # 609
0164 E4                CLR     A
0165 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 610
0167 18                DEC     R0
0168 E6                MOV     A,@R0
0169 2410              ADD     A,#010H
016B 120000      R     LCALL   L?1049
                                           ; SOURCE LINE # 611
016E 7D01              MOV     R5,#01H
0170 7F4F              MOV     R7,#04FH
0172 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 612
0175 E500        R     MOV     A,block_infor6
0177 B48007            CJNE    A,#080H,?C0456
                                           ; SOURCE LINE # 613
                                           ; SOURCE LINE # 614
017A 7D01              MOV     R5,#01H
017C 7F43              MOV     R7,#043H
017E 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 615
0181         ?C0456:
                                           ; SOURCE LINE # 616
0181 E500        R     MOV     A,block_infor6
0183 B4040E            CJNE    A,#04H,?C0457
                                           ; SOURCE LINE # 617
                                           ; SOURCE LINE # 618
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 100 

0186 7D01              MOV     R5,#01H
0188 7FA3              MOV     R7,#0A3H
018A 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 619
018D 7D01              MOV     R5,#01H
018F 7F4F              MOV     R7,#04FH
0191 120000      R     LCALL   _updata_smart_n
                                           ; SOURCE LINE # 620
0194         ?C0457:
                                           ; SOURCE LINE # 621
0194 E500        R     MOV     A,block_infor6
0196 B41007            CJNE    A,#010H,?C0458
                                           ; SOURCE LINE # 622
                                           ; SOURCE LINE # 623
0199 7D01              MOV     R5,#01H
019B 7F4F              MOV     R7,#04FH
019D 120000      R     LCALL   _updata_smart_n
                                           ; SOURCE LINE # 624
01A0         ?C0458:
                                           ; SOURCE LINE # 625
01A0 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 626
01A3 907FBB            MOV     DPTR,#07FBBH
01A6 E4                CLR     A
01A7 93                MOVC    A,@A+DPTR
01A8 90FF7F            MOV     DPTR,#sata+07FH
01AB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 627
01AC 907FBC            MOV     DPTR,#07FBCH
01AF E4                CLR     A
01B0 93                MOVC    A,@A+DPTR
01B1 90FF57            MOV     DPTR,#sata+057H
01B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 628
01B5 E4                CLR     A
01B6 F5D9              MOV     SFR_watch_dog_high,A
                                           ; SOURCE LINE # 629
01B8 020000      R     LJMP    check_loop
                                           ; SOURCE LINE # 630
01BB         ?C0459:
01BB 22                RET     
             ; FUNCTION smart_block_handle (END)

             ; FUNCTION smart_card_update (BEGIN)
                                           ; SOURCE LINE # 633
                                           ; SOURCE LINE # 634
                                           ; SOURCE LINE # 645
0000 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 648
0003 75D701            MOV     SFR_CHP_en,#01H
                                           ; SOURCE LINE # 649
0006 90FF7F            MOV     DPTR,#sata+07FH
0009 7410              MOV     A,#010H
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 650
000C E4                CLR     A
000D 90FF57            MOV     DPTR,#sata+057H
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 652
0011 F5FA              MOV     SFR_dma_base+01H,A
0013 F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 653
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 101 

0015 75FB04            MOV     SFR_dma_max_num_l,#04H
                                           ; SOURCE LINE # 654
0018 F5FC              MOV     SFR_dma_max_num_h,A
                                           ; SOURCE LINE # 655
001A 90FF7E            MOV     DPTR,#sata+07EH
001D 7461              MOV     A,#061H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 656
0020 75F8C0            MOV     SFR_dma_cntl,#0C0H
0023         ?C0460:
                                           ; SOURCE LINE # 657
0023 30F8FD            JNB     dma_done,?C0460
0026         ?C0461:
                                           ; SOURCE LINE # 658
0026 75F818            MOV     SFR_dma_cntl,#018H
                                           ; SOURCE LINE # 659
0029 120000      R     LCALL   wait_chp_ready
                                           ; SOURCE LINE # 661
002C 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 662
002F E4                CLR     A
0030 F5F2              MOV     SFR_ext_sram_addr+01H,A
0032 F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 663
0034 85F300      R     MOV     card_infor0,SFR_ext_sram_data
                                           ; SOURCE LINE # 664
0037 85F300      R     MOV     card_infor1,SFR_ext_sram_data
                                           ; SOURCE LINE # 665
003A 85F300      R     MOV     card_infor2,SFR_ext_sram_data
                                           ; SOURCE LINE # 666
003D 85F300      R     MOV     card_infor3,SFR_ext_sram_data
                                           ; SOURCE LINE # 667
0040 85F300      R     MOV     card_infor40,SFR_ext_sram_data
                                           ; SOURCE LINE # 668
0043 85F300      R     MOV     card_infor41,SFR_ext_sram_data
                                           ; SOURCE LINE # 669
0046 85F300      R     MOV     card_infor42,SFR_ext_sram_data
                                           ; SOURCE LINE # 670
0049 85F300      R     MOV     card_infor43,SFR_ext_sram_data
                                           ; SOURCE LINE # 671
004C F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 673
004E 907FBA            MOV     DPTR,#07FBAH
0051 93                MOVC    A,@A+DPTR
0052 F5D7              MOV     SFR_CHP_en,A
                                           ; SOURCE LINE # 674
0054 A3                INC     DPTR
0055 E4                CLR     A
0056 93                MOVC    A,@A+DPTR
0057 90FF7F            MOV     DPTR,#sata+07FH
005A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 675
005B 907FBC            MOV     DPTR,#07FBCH
005E E4                CLR     A
005F 93                MOVC    A,@A+DPTR
0060 90FF57            MOV     DPTR,#sata+057H
0063 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 678
0064 E4                CLR     A
0065 FB                MOV     R3,A
0066 7D01              MOV     R5,#01H
0068 7F20              MOV     R7,#020H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 102 

006A 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 680
006D 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 682
0070 75F200            MOV     SFR_ext_sram_addr+01H,#00H
0073 75F18B            MOV     SFR_ext_sram_addr,#08BH
                                           ; SOURCE LINE # 683
0076 8500F3      R     MOV     SFR_ext_sram_data,card_infor0
                                           ; SOURCE LINE # 685
0079 75F200            MOV     SFR_ext_sram_addr+01H,#00H
007C 75F197            MOV     SFR_ext_sram_addr,#097H
                                           ; SOURCE LINE # 686
007F 8500F3      R     MOV     SFR_ext_sram_data,card_infor1
                                           ; SOURCE LINE # 688
0082 75F200            MOV     SFR_ext_sram_addr+01H,#00H
0085 75F1A3            MOV     SFR_ext_sram_addr,#0A3H
                                           ; SOURCE LINE # 689
0088 8500F3      R     MOV     SFR_ext_sram_data,card_infor2
                                           ; SOURCE LINE # 691
008B 75F200            MOV     SFR_ext_sram_addr+01H,#00H
008E 75F1AF            MOV     SFR_ext_sram_addr,#0AFH
                                           ; SOURCE LINE # 692
0091 8500F3      R     MOV     SFR_ext_sram_data,card_infor3
                                           ; SOURCE LINE # 695
0094 75F200            MOV     SFR_ext_sram_addr+01H,#00H
0097 75F1BB            MOV     SFR_ext_sram_addr,#0BBH
                                           ; SOURCE LINE # 696
009A 8500F3      R     MOV     SFR_ext_sram_data,card_infor40
                                           ; SOURCE LINE # 697
009D 8500F3      R     MOV     SFR_ext_sram_data,card_infor41
                                           ; SOURCE LINE # 698
00A0 8500F3      R     MOV     SFR_ext_sram_data,card_infor42
                                           ; SOURCE LINE # 699
00A3 8500F3      R     MOV     SFR_ext_sram_data,card_infor43
                                           ; SOURCE LINE # 700
00A6 E4                CLR     A
00A7 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 702
;---- Variable 'tmp' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 703
                                           ; SOURCE LINE # 704
                                           ; SOURCE LINE # 705
00A9 120000      R     LCALL   L?1047
                                           ; SOURCE LINE # 707
00AC 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 710
00AF         ?C0462:
00AF 22                RET     
             ; FUNCTION smart_card_update (END)

             ; FUNCTION smart_erase_handle (BEGIN)
                                           ; SOURCE LINE # 712
                                           ; SOURCE LINE # 713
                                           ; SOURCE LINE # 723
0000 750001      R     MOV     chp_sel,#01H
                                           ; SOURCE LINE # 724
0003 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 725
0006         handle:
                                           ; SOURCE LINE # 726
0006 8500D7      R     MOV     SFR_CHP_en,chp_sel
                                           ; SOURCE LINE # 727
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 103 

0009 E500        R     MOV     A,chp_sel
000B B4010B            CJNE    A,#01H,?C0464
000E 90FF7F            MOV     DPTR,#sata+07FH
0011 7410              MOV     A,#010H
0013 F0                MOVX    @DPTR,A
0014 E4                CLR     A
0015 90FF57            MOV     DPTR,#sata+057H
0018 F0                MOVX    @DPTR,A
0019         ?C0464:
                                           ; SOURCE LINE # 728
0019 E500        R     MOV     A,chp_sel
001B B4020B            CJNE    A,#02H,?C0465
001E 90FF7F            MOV     DPTR,#sata+07FH
0021 7420              MOV     A,#020H
0023 F0                MOVX    @DPTR,A
0024 E4                CLR     A
0025 90FF57            MOV     DPTR,#sata+057H
0028 F0                MOVX    @DPTR,A
0029         ?C0465:
                                           ; SOURCE LINE # 729
0029 E500        R     MOV     A,chp_sel
002B B4040B            CJNE    A,#04H,?C0466
002E 90FF7F            MOV     DPTR,#sata+07FH
0031 7440              MOV     A,#040H
0033 F0                MOVX    @DPTR,A
0034 E4                CLR     A
0035 90FF57            MOV     DPTR,#sata+057H
0038 F0                MOVX    @DPTR,A
0039         ?C0466:
                                           ; SOURCE LINE # 730
0039 E500        R     MOV     A,chp_sel
003B B4080B            CJNE    A,#08H,?C0467
003E 90FF7F            MOV     DPTR,#sata+07FH
0041 7480              MOV     A,#080H
0043 F0                MOVX    @DPTR,A
0044 E4                CLR     A
0045 90FF57            MOV     DPTR,#sata+057H
0048 F0                MOVX    @DPTR,A
0049         ?C0467:
                                           ; SOURCE LINE # 731
0049 E500        R     MOV     A,chp_sel
004B B4100B            CJNE    A,#010H,?C0468
004E E4                CLR     A
004F 90FF7F            MOV     DPTR,#sata+07FH
0052 F0                MOVX    @DPTR,A
0053 90FF57            MOV     DPTR,#sata+057H
0056 7410              MOV     A,#010H
0058 F0                MOVX    @DPTR,A
0059         ?C0468:
                                           ; SOURCE LINE # 732
                                           ; SOURCE LINE # 733
0059 120000      R     LCALL   L?1055
                                           ; SOURCE LINE # 734
005C E4                CLR     A
005D F5FA              MOV     SFR_dma_base+01H,A
005F F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 735
0061 75FB04            MOV     SFR_dma_max_num_l,#04H
                                           ; SOURCE LINE # 736
0064 F5FC              MOV     SFR_dma_max_num_h,A
                                           ; SOURCE LINE # 737
0066 90FF7E            MOV     DPTR,#sata+07EH
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 104 

0069 7461              MOV     A,#061H
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 738
006C 75F8C0            MOV     SFR_dma_cntl,#0C0H
006F         ?C0469:
                                           ; SOURCE LINE # 739
006F 30F8FD            JNB     dma_done,?C0469
0072         ?C0470:
                                           ; SOURCE LINE # 740
0072 75F818            MOV     SFR_dma_cntl,#018H
                                           ; SOURCE LINE # 741
0075 120000      R     LCALL   wait_chp_ready
                                           ; SOURCE LINE # 743
0078 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 744
007B 75F201            MOV     SFR_ext_sram_addr+01H,#01H
007E 75F160            MOV     SFR_ext_sram_addr,#060H
                                           ; SOURCE LINE # 745
0081 85F300      R     MOV     erase_infor0,SFR_ext_sram_data
                                           ; SOURCE LINE # 746
0084 85F300      R     MOV     erase_infor1,SFR_ext_sram_data
                                           ; SOURCE LINE # 747
0087 85F300      R     MOV     erase_infor2,SFR_ext_sram_data
                                           ; SOURCE LINE # 748
008A 85F300      R     MOV     erase_infor3,SFR_ext_sram_data
                                           ; SOURCE LINE # 750
008D 907FBB            MOV     DPTR,#07FBBH
0090 E4                CLR     A
0091 93                MOVC    A,@A+DPTR
0092 90FF7F            MOV     DPTR,#sata+07FH
0095 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 751
0096 907FBC            MOV     DPTR,#07FBCH
0099 E4                CLR     A
009A 93                MOVC    A,@A+DPTR
009B 90FF57            MOV     DPTR,#sata+057H
009E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 754
009F 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 755
00A2 75F200            MOV     SFR_ext_sram_addr+01H,#00H
00A5 75F110            MOV     SFR_ext_sram_addr,#010H
                                           ; SOURCE LINE # 757
00A8 85F300      R     MOV     erase+03H,SFR_ext_sram_data
                                           ; SOURCE LINE # 758
00AB 85F300      R     MOV     erase+02H,SFR_ext_sram_data
                                           ; SOURCE LINE # 759
00AE 85F300      R     MOV     erase+01H,SFR_ext_sram_data
                                           ; SOURCE LINE # 760
00B1 85F300      R     MOV     erase,SFR_ext_sram_data
                                           ; SOURCE LINE # 766
00B4 907FB3            MOV     DPTR,#07FB3H
00B7 E4                CLR     A
00B8 93                MOVC    A,@A+DPTR
00B9 F500        R     MOV     pe+03H,A
                                           ; SOURCE LINE # 767
00BB A3                INC     DPTR
00BC E4                CLR     A
00BD 93                MOVC    A,@A+DPTR
00BE F500        R     MOV     pe+02H,A
                                           ; SOURCE LINE # 768
00C0 A3                INC     DPTR
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 105 

00C1 E4                CLR     A
00C2 93                MOVC    A,@A+DPTR
00C3 F500        R     MOV     pe+01H,A
                                           ; SOURCE LINE # 769
00C5 A3                INC     DPTR
00C6 E4                CLR     A
00C7 93                MOVC    A,@A+DPTR
00C8 F500        R     MOV     pe,A
                                           ; SOURCE LINE # 774
00CA E4                CLR     A
00CB FF                MOV     R7,A
00CC FE                MOV     R6,A
00CD FD                MOV     R5,A
00CE FC                MOV     R4,A
00CF AB00        R     MOV     R3,pe+03H
00D1 AA00        R     MOV     R2,pe+02H
00D3 A900        R     MOV     R1,pe+01H
00D5 A800        R     MOV     R0,pe
00D7 C3                CLR     C
00D8 120000      E     LCALL   ?C?ULCMP
00DB 605A              JZ      ?C0471
                                           ; SOURCE LINE # 775
                                           ; SOURCE LINE # 776
00DD E4                CLR     A
00DE F500        R     MOV     cnt,A
00E0         ?C0472:
                                           ; SOURCE LINE # 777
00E0 AF00        R     MOV     R7,pe+03H
00E2 AE00        R     MOV     R6,pe+02H
00E4 AD00        R     MOV     R5,pe+01H
00E6 AC00        R     MOV     R4,pe
00E8 AB00        R     MOV     R3,erase+03H
00EA AA00        R     MOV     R2,erase+02H
00EC A900        R     MOV     R1,erase+01H
00EE A800        R     MOV     R0,erase
00F0 C3                CLR     C
00F1 120000      E     LCALL   ?C?ULCMP
00F4 401C              JC      ?C0473
                                           ; SOURCE LINE # 778
                                           ; SOURCE LINE # 779
00F6 0500        R     INC     cnt
                                           ; SOURCE LINE # 780
00F8 E500        R     MOV     A,erase+03H
00FA 9500        R     SUBB    A,pe+03H
00FC F500        R     MOV     erase+03H,A
00FE E500        R     MOV     A,erase+02H
0100 9500        R     SUBB    A,pe+02H
0102 F500        R     MOV     erase+02H,A
0104 E500        R     MOV     A,erase+01H
0106 9500        R     SUBB    A,pe+01H
0108 F500        R     MOV     erase+01H,A
010A E500        R     MOV     A,erase
010C 9500        R     SUBB    A,pe
010E F500        R     MOV     erase,A
                                           ; SOURCE LINE # 781
0110 80CE              SJMP    ?C0472
0112         ?C0473:
                                           ; SOURCE LINE # 783
0112 E4                CLR     A
0113 FB                MOV     R3,A
0114 7D01              MOV     R5,#01H
0116 7F20              MOV     R7,#020H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 106 

0118 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 784
011B E4                CLR     A
011C F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 785
011E F5F2              MOV     SFR_ext_sram_addr+01H,A
0120 75F165            MOV     SFR_ext_sram_addr,#065H
                                           ; SOURCE LINE # 786
0123 C3                CLR     C
0124 7464              MOV     A,#064H
0126 9500        R     SUBB    A,cnt
0128 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 787
012A E5F3              MOV     A,SFR_ext_sram_data
012C D3                SETB    C
012D 9464              SUBB    A,#064H
012F 4003              JC      ?C0474
0131 E4                CLR     A
0132 F5F3              MOV     SFR_ext_sram_data,A
0134         ?C0474:
                                           ; SOURCE LINE # 788
0134 120000      R     LCALL   L?1048
                                           ; SOURCE LINE # 789
0137         ?C0471:
                                           ; SOURCE LINE # 792
0137 E4                CLR     A
0138 FB                MOV     R3,A
0139 7D01              MOV     R5,#01H
013B 7F20              MOV     R7,#020H
013D 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 794
0140 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 795
0143 75F200            MOV     SFR_ext_sram_addr+01H,#00H
0146 75F18B            MOV     SFR_ext_sram_addr,#08BH
                                           ; SOURCE LINE # 796
0149 E500        R     MOV     A,chp_sel
014B 6401              XRL     A,#01H
014D 604F              JZ      ?C0475
                                           ; SOURCE LINE # 797
                                           ; SOURCE LINE # 799
014F 850000      R     MOV     tmp,erase_infor0
                                           ; SOURCE LINE # 800
0152 E500        R     MOV     A,tmp
0154 25F3              ADD     A,SFR_ext_sram_data
0156 F500        R     MOV     erase_infor0,A
                                           ; SOURCE LINE # 801
0158 E500        R     MOV     A,tmp
015A D3                SETB    C
015B 9500        R     SUBB    A,erase_infor0
015D 4002              JC      ?C0476
015F 0500        R     INC     erase_infor1
0161         ?C0476:
                                           ; SOURCE LINE # 803
0161 850000      R     MOV     tmp,erase_infor1
                                           ; SOURCE LINE # 804
0164 E500        R     MOV     A,tmp
0166 25F3              ADD     A,SFR_ext_sram_data
0168 F500        R     MOV     erase_infor1,A
                                           ; SOURCE LINE # 805
016A E500        R     MOV     A,tmp
016C D3                SETB    C
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 107 

016D 9500        R     SUBB    A,erase_infor1
016F 4002              JC      ?C0477
0171 0500        R     INC     erase_infor2
0173         ?C0477:
                                           ; SOURCE LINE # 807
0173 850000      R     MOV     tmp,erase_infor2
                                           ; SOURCE LINE # 808
0176 E500        R     MOV     A,tmp
0178 25F3              ADD     A,SFR_ext_sram_data
017A F500        R     MOV     erase_infor2,A
                                           ; SOURCE LINE # 809
017C E500        R     MOV     A,tmp
017E D3                SETB    C
017F 9500        R     SUBB    A,erase_infor2
0181 4002              JC      ?C0478
0183 0500        R     INC     erase_infor3
0185         ?C0478:
                                           ; SOURCE LINE # 811
0185 850000      R     MOV     tmp,erase_infor3
                                           ; SOURCE LINE # 812
0188 E500        R     MOV     A,tmp
018A 25F3              ADD     A,SFR_ext_sram_data
018C F500        R     MOV     erase_infor3,A
                                           ; SOURCE LINE # 813
018E E500        R     MOV     A,tmp
0190 D3                SETB    C
0191 9500        R     SUBB    A,erase_infor3
0193 4003              JC      ?C0479
0195 7500FF      R     MOV     erase_infor3,#0FFH
0198         ?C0479:
                                           ; SOURCE LINE # 815
0198 75F200            MOV     SFR_ext_sram_addr+01H,#00H
019B 75F18B            MOV     SFR_ext_sram_addr,#08BH
                                           ; SOURCE LINE # 816
019E         ?C0475:
                                           ; SOURCE LINE # 817
019E 8500F3      R     MOV     SFR_ext_sram_data,erase_infor0
                                           ; SOURCE LINE # 818
01A1 8500F3      R     MOV     SFR_ext_sram_data,erase_infor1
                                           ; SOURCE LINE # 819
01A4 8500F3      R     MOV     SFR_ext_sram_data,erase_infor2
                                           ; SOURCE LINE # 820
01A7 8500F3      R     MOV     SFR_ext_sram_data,erase_infor3
                                           ; SOURCE LINE # 821
01AA E4                CLR     A
01AB F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 822
01AD 120000      R     LCALL   gen_check_sum
01B0 8F00        R     MOV     tmp,R7
                                           ; SOURCE LINE # 823
01B2 75F201            MOV     SFR_ext_sram_addr+01H,#01H
01B5 75F1FF            MOV     SFR_ext_sram_addr,#0FFH
                                           ; SOURCE LINE # 824
01B8 8500F3      R     MOV     SFR_ext_sram_data,tmp
                                           ; SOURCE LINE # 825
01BB 120000      R     LCALL   L?1048
                                           ; SOURCE LINE # 826
01BE E500        R     MOV     A,chp_sel
01C0 25E0              ADD     A,ACC
01C2 F500        R     MOV     chp_sel,A
                                           ; SOURCE LINE # 827
01C4 907FBA            MOV     DPTR,#07FBAH
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 108 

01C7 E4                CLR     A
01C8 93                MOVC    A,@A+DPTR
01C9 5500        R     ANL     A,chp_sel
01CB 6003              JZ      $ + 5H
01CD 020000      R     LJMP    handle
                                           ; SOURCE LINE # 829
01D0         end_handle:
                                           ; SOURCE LINE # 830
01D0 907FBB            MOV     DPTR,#07FBBH
01D3 E4                CLR     A
01D4 93                MOVC    A,@A+DPTR
01D5 90FF7F            MOV     DPTR,#sata+07FH
01D8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 831
01D9 907FBC            MOV     DPTR,#07FBCH
01DC E4                CLR     A
01DD 93                MOVC    A,@A+DPTR
01DE 90FF57            MOV     DPTR,#sata+057H
01E1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 832
01E2 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 834
01E5         ?C0482:
01E5 22                RET     
             ; FUNCTION smart_erase_handle (END)

             ; FUNCTION smart_card_crc (BEGIN)
                                           ; SOURCE LINE # 838
                                           ; SOURCE LINE # 839
                                           ; SOURCE LINE # 846
0000         check_loop:
                                           ; SOURCE LINE # 847
0000 907FBA            MOV     DPTR,#07FBAH
0003 E4                CLR     A
0004 93                MOVC    A,@A+DPTR
0005 30E011            JNB     ACC.0,?C0484
0008 90FF5C            MOV     DPTR,#sata+05CH
000B E0                MOVX    A,@DPTR
000C B4FF0A            CJNE    A,#0FFH,?C0484
000F 750001      R     MOV     chp_sel,#01H
0012 90FF7F            MOV     DPTR,#sata+07FH
0015 7410              MOV     A,#010H
0017 8049              SJMP    ?C0977
0019         ?C0484:
                                           ; SOURCE LINE # 848
0019 907FBA            MOV     DPTR,#07FBAH
001C E4                CLR     A
001D 93                MOVC    A,@A+DPTR
001E 30E111            JNB     ACC.1,?C0487
0021 90FF5D            MOV     DPTR,#sata+05DH
0024 E0                MOVX    A,@DPTR
0025 B4FF0A            CJNE    A,#0FFH,?C0487
0028 750002      R     MOV     chp_sel,#02H
002B 90FF7F            MOV     DPTR,#sata+07FH
002E 7420              MOV     A,#020H
0030         ?C0975:
0030 8030              SJMP    ?C0977
0032         ?C0487:
                                           ; SOURCE LINE # 849
0032 907FBA            MOV     DPTR,#07FBAH
0035 E4                CLR     A
0036 93                MOVC    A,@A+DPTR
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 109 

0037 30E211            JNB     ACC.2,?C0489
003A 90FF5E            MOV     DPTR,#sata+05EH
003D E0                MOVX    A,@DPTR
003E B4FF0A            CJNE    A,#0FFH,?C0489
0041 750004      R     MOV     chp_sel,#04H
0044 90FF7F            MOV     DPTR,#sata+07FH
0047 7440              MOV     A,#040H
0049         ?C0976:
0049 8017              SJMP    ?C0977
004B         ?C0489:
                                           ; SOURCE LINE # 850
004B 907FBA            MOV     DPTR,#07FBAH
004E E4                CLR     A
004F 93                MOVC    A,@A+DPTR
0050 30E317            JNB     ACC.3,?C0491
0053 90FF5F            MOV     DPTR,#sata+05FH
0056 E0                MOVX    A,@DPTR
0057 B4FF10            CJNE    A,#0FFH,?C0491
005A 750008      R     MOV     chp_sel,#08H
005D 90FF7F            MOV     DPTR,#sata+07FH
0060 7480              MOV     A,#080H
0062         ?C0977:
0062 F0                MOVX    @DPTR,A
0063 E4                CLR     A
0064 90FF57            MOV     DPTR,#sata+057H
0067 F0                MOVX    @DPTR,A
0068 8022              SJMP    handle
006A         ?C0491:
                                           ; SOURCE LINE # 851
006A 907FBA            MOV     DPTR,#07FBAH
006D E4                CLR     A
006E 93                MOVC    A,@A+DPTR
006F 20E403            JB      ACC.4,$ + 6H
0072 020000      R     LJMP    end_loop
0075 90FF76            MOV     DPTR,#sata+076H
0078 E0                MOVX    A,@DPTR
0079 F4                CPL     A
007A 6003              JZ      $ + 5H
007C 020000      R     LJMP    end_loop
007F 750010      R     MOV     chp_sel,#010H
0082 90FF7F            MOV     DPTR,#sata+07FH
0085 F0                MOVX    @DPTR,A
0086 90FF57            MOV     DPTR,#sata+057H
0089 7410              MOV     A,#010H
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 852
                                           ; SOURCE LINE # 853
008C         handle:
                                           ; SOURCE LINE # 854
008C 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 855
008F 8500D7      R     MOV     SFR_CHP_en,chp_sel
                                           ; SOURCE LINE # 856
                                           ; SOURCE LINE # 857
0092 120000      R     LCALL   L?1055
                                           ; SOURCE LINE # 858
0095 E4                CLR     A
0096 F5FA              MOV     SFR_dma_base+01H,A
0098 F5F9              MOV     SFR_dma_base,A
                                           ; SOURCE LINE # 859
009A 75FB01            MOV     SFR_dma_max_num_l,#01H
                                           ; SOURCE LINE # 860
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 110 

009D F5FC              MOV     SFR_dma_max_num_h,A
                                           ; SOURCE LINE # 861
009F 90FF7E            MOV     DPTR,#sata+07EH
00A2 7465              MOV     A,#065H
00A4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 862
00A5 75F8C0            MOV     SFR_dma_cntl,#0C0H
00A8         ?C0496:
                                           ; SOURCE LINE # 863
00A8 30F8FD            JNB     dma_done,?C0496
00AB         ?C0497:
                                           ; SOURCE LINE # 864
00AB 120000      R     LCALL   wait_chp_ready
                                           ; SOURCE LINE # 865
00AE 75F818            MOV     SFR_dma_cntl,#018H
                                           ; SOURCE LINE # 867
00B1 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 868
00B4 E4                CLR     A
00B5 F5F2              MOV     SFR_ext_sram_addr+01H,A
00B7 F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 869
00B9 7800        R     MOV     R0,#LOW block_infor0
00BB A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 870
00BD 08                INC     R0
00BE A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 871
00C0 08                INC     R0
00C1 A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 872
00C3 08                INC     R0
00C4 A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 875
00C6 907FBB            MOV     DPTR,#07FBBH
00C9 93                MOVC    A,@A+DPTR
00CA 90FF7F            MOV     DPTR,#sata+07FH
00CD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 876
00CE 907FBC            MOV     DPTR,#07FBCH
00D1 E4                CLR     A
00D2 93                MOVC    A,@A+DPTR
00D3 90FF57            MOV     DPTR,#sata+057H
00D6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 877
00D7 E4                CLR     A
00D8 FB                MOV     R3,A
00D9 7D01              MOV     R5,#01H
00DB 7F20              MOV     R7,#020H
00DD 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 879
00E0 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 880
00E3 E500        R     MOV     A,chp_sel
00E5 24FE              ADD     A,#0FEH
00E7 6018              JZ      ?C0500
00E9 24FE              ADD     A,#0FEH
00EB 601C              JZ      ?C0501
00ED 24FC              ADD     A,#0FCH
00EF 6020              JZ      ?C0502
00F1 24F8              ADD     A,#0F8H
00F3 6024              JZ      ?C0503
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 111 

00F5 240F              ADD     A,#0FH
00F7 7054              JNZ     end_loop
                                           ; SOURCE LINE # 881
                                           ; SOURCE LINE # 882
00F9         ?C0499:
                                           ; SOURCE LINE # 883
                                           ; SOURCE LINE # 884
00F9 75F200            MOV     SFR_ext_sram_addr+01H,#00H
00FC 75F1C7            MOV     SFR_ext_sram_addr,#0C7H
                                           ; SOURCE LINE # 885
00FF 801E              SJMP    ?C0498
                                           ; SOURCE LINE # 886
                                           ; SOURCE LINE # 887
0101         ?C0500:
                                           ; SOURCE LINE # 888
                                           ; SOURCE LINE # 889
0101 75F200            MOV     SFR_ext_sram_addr+01H,#00H
0104 75F1D3            MOV     SFR_ext_sram_addr,#0D3H
                                           ; SOURCE LINE # 890
0107 8016              SJMP    ?C0498
                                           ; SOURCE LINE # 891
                                           ; SOURCE LINE # 892
0109         ?C0501:
                                           ; SOURCE LINE # 893
                                           ; SOURCE LINE # 894
0109 75F200            MOV     SFR_ext_sram_addr+01H,#00H
010C 75F1DF            MOV     SFR_ext_sram_addr,#0DFH
                                           ; SOURCE LINE # 895
010F 800E              SJMP    ?C0498
                                           ; SOURCE LINE # 896
                                           ; SOURCE LINE # 897
0111         ?C0502:
                                           ; SOURCE LINE # 898
                                           ; SOURCE LINE # 899
0111 75F200            MOV     SFR_ext_sram_addr+01H,#00H
0114 75F1EB            MOV     SFR_ext_sram_addr,#0EBH
                                           ; SOURCE LINE # 900
0117 8006              SJMP    ?C0498
                                           ; SOURCE LINE # 901
                                           ; SOURCE LINE # 902
0119         ?C0503:
                                           ; SOURCE LINE # 903
                                           ; SOURCE LINE # 904
0119 75F200            MOV     SFR_ext_sram_addr+01H,#00H
011C 75F1F7            MOV     SFR_ext_sram_addr,#0F7H
                                           ; SOURCE LINE # 905
                                           ; SOURCE LINE # 906
                                           ; SOURCE LINE # 907
                                           ; SOURCE LINE # 909
011F         ?C0498:
                                           ; SOURCE LINE # 910
011F 7800        R     MOV     R0,#LOW block_infor0
0121 E6                MOV     A,@R0
0122 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 911
0124 08                INC     R0
0125 E6                MOV     A,@R0
0126 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 912
0128 08                INC     R0
0129 E6                MOV     A,@R0
012A F5F3              MOV     SFR_ext_sram_data,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 112 

                                           ; SOURCE LINE # 913
012C 08                INC     R0
012D E6                MOV     A,@R0
012E F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 914
0130 E4                CLR     A
0131 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 915
0133 120000      R     LCALL   gen_check_sum
0136 8F00        R     MOV     tmp,R7
                                           ; SOURCE LINE # 916
0138 75F201            MOV     SFR_ext_sram_addr+01H,#01H
013B 75F1FF            MOV     SFR_ext_sram_addr,#0FFH
                                           ; SOURCE LINE # 917
013E 8500F3      R     MOV     SFR_ext_sram_data,tmp
                                           ; SOURCE LINE # 918
0141 120000      R     LCALL   L?1048
                                           ; SOURCE LINE # 919
0144 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 920
0147 E4                CLR     A
0148 F5D9              MOV     SFR_watch_dog_high,A
                                           ; SOURCE LINE # 921
014A 020000      R     LJMP    check_loop
                                           ; SOURCE LINE # 922
014D         end_loop:
                                           ; SOURCE LINE # 923
014D 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 925
0150         ?C0505:
0150 22                RET     
             ; FUNCTION smart_card_crc (END)

             ; FUNCTION trim_handler (BEGIN)
                                           ; SOURCE LINE # 11
                                           ; SOURCE LINE # 12
                                           ; SOURCE LINE # 17
0000 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 18
0003 E4                CLR     A
0004 7800        R     MOV     R0,#LOW sram_addr
0006 F6                MOV     @R0,A
0007 08                INC     R0
0008 F6                MOV     @R0,A
                                           ; SOURCE LINE # 19
0009 90FF14            MOV     DPTR,#sata+014H
000C E0                MOVX    A,@DPTR
000D 75DF00            MOV     SFR_sata_burst_cnt+01H,#00H
0010 F5DE              MOV     SFR_sata_burst_cnt,A
                                           ; SOURCE LINE # 20
0012 E4                CLR     A
0013 F5E7              MOV     SFR_sata_burst_base+01H,A
0015 F5E6              MOV     SFR_sata_burst_base,A
                                           ; SOURCE LINE # 21
0017 75E890            MOV     SFR_sata_burst_cntl,#090H
001A         ?C0506:
                                           ; SOURCE LINE # 22
001A 30E8FD            JNB     sata_burst_done,?C0506
001D         ?C0507:
                                           ; SOURCE LINE # 23
001D 30EA03            JNB     sata_burst_abort,?C0508
0020 020000      R     LJMP    ?C0978
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 113 

0023         ?C0508:
                                           ; SOURCE LINE # 24
0023 75E810            MOV     SFR_sata_burst_cntl,#010H
                                           ; SOURCE LINE # 27
0026 E500        R     MOV     A,security_mode
0028 6420              XRL     A,#020H
002A 6003              JZ      $ + 5H
002C 020000      R     LJMP    ?C0510
                                           ; SOURCE LINE # 28
                                           ; SOURCE LINE # 29
002F 90FF14            MOV     DPTR,#sata+014H
0032 E0                MOVX    A,@DPTR
0033 75F040            MOV     B,#040H
0036 A4                MUL     AB
0037 7800        R     MOV     R0,#LOW jj
0039 A6F0              MOV     @R0,B
003B 08                INC     R0
003C F6                MOV     @R0,A
                                           ; SOURCE LINE # 30
003D E4                CLR     A
003E F5F2              MOV     SFR_ext_sram_addr+01H,A
0040 F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 31
0042 08                INC     R0
0043 F6                MOV     @R0,A
0044 08                INC     R0
0045 F6                MOV     @R0,A
0046         ?C0511:
                                           ; SOURCE LINE # 32
0046 C3                CLR     C
0047 7900        R     MOV     R1,#LOW sram_addr+01H
0049 E7                MOV     A,@R1
004A 7800        R     MOV     R0,#LOW jj+01H
004C 96                SUBB    A,@R0
004D 19                DEC     R1
004E E7                MOV     A,@R1
004F 18                DEC     R0
0050 96                SUBB    A,@R0
0051 4003              JC      $ + 5H
0053 020000      R     LJMP    ?C0510
                                           ; SOURCE LINE # 33
                                           ; SOURCE LINE # 34
0056 7800        R     MOV     R0,#LOW sram_addr
0058 E6                MOV     A,@R0
0059 FE                MOV     R6,A
005A 08                INC     R0
005B E6                MOV     A,@R0
005C 7803              MOV     R0,#03H
005E         ?C0918:
005E C3                CLR     C
005F 33                RLC     A
0060 CE                XCH     A,R6
0061 33                RLC     A
0062 CE                XCH     A,R6
0063 D8F9              DJNZ    R0,?C0918
0065 2406              ADD     A,#06H
0067 FF                MOV     R7,A
0068 E4                CLR     A
0069 3E                ADDC    A,R6
006A F5F2              MOV     SFR_ext_sram_addr+01H,A
006C 8FF1              MOV     SFR_ext_sram_addr,R7
                                           ; SOURCE LINE # 35
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 114 

006E 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 36
0071 E5F3              MOV     A,SFR_ext_sram_data
0073 7004              JNZ     ?C0513
0075 E5F3              MOV     A,SFR_ext_sram_data
0077 6061              JZ      ?C0510
0079         ?C0513:
                                           ; SOURCE LINE # 38
0079 7800        R     MOV     R0,#LOW sram_addr
007B E6                MOV     A,@R0
007C FE                MOV     R6,A
007D 08                INC     R0
007E E6                MOV     A,@R0
007F 7803              MOV     R0,#03H
0081         ?C0919:
0081 C3                CLR     C
0082 33                RLC     A
0083 CE                XCH     A,R6
0084 33                RLC     A
0085 CE                XCH     A,R6
0086 D8F9              DJNZ    R0,?C0919
0088 8EF2              MOV     SFR_ext_sram_addr+01H,R6
008A F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 39
008C E4                CLR     A
008D F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 40
008F 85F3F3            MOV     SFR_ext_sram_data,SFR_ext_sram_data
                                           ; SOURCE LINE # 41
0092 05F1              INC     SFR_ext_sram_addr
0094 E5F1              MOV     A,SFR_ext_sram_addr
0096 7002              JNZ     ?C0920
0098 05F2              INC     SFR_ext_sram_addr+01H
009A         ?C0920:
                                           ; SOURCE LINE # 42
009A 85F3F3            MOV     SFR_ext_sram_data,SFR_ext_sram_data
                                           ; SOURCE LINE # 43
009D 05F1              INC     SFR_ext_sram_addr
009F E5F1              MOV     A,SFR_ext_sram_addr
00A1 7002              JNZ     ?C0921
00A3 05F2              INC     SFR_ext_sram_addr+01H
00A5         ?C0921:
                                           ; SOURCE LINE # 44
00A5 74C0              MOV     A,#0C0H
00A7 25F3              ADD     A,SFR_ext_sram_data
00A9 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 45
00AB 05F1              INC     SFR_ext_sram_addr
00AD E5F1              MOV     A,SFR_ext_sram_addr
00AF 7002              JNZ     ?C0922
00B1 05F2              INC     SFR_ext_sram_addr+01H
00B3         ?C0922:
                                           ; SOURCE LINE # 46
00B3 7408              MOV     A,#08H
00B5 25F3              ADD     A,SFR_ext_sram_data
00B7 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 47
00B9 05F1              INC     SFR_ext_sram_addr
00BB E5F1              MOV     A,SFR_ext_sram_addr
00BD 7002              JNZ     ?C0923
00BF 05F2              INC     SFR_ext_sram_addr+01H
00C1         ?C0923:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 115 

                                           ; SOURCE LINE # 48
00C1 85F3F3            MOV     SFR_ext_sram_data,SFR_ext_sram_data
                                           ; SOURCE LINE # 49
00C4 05F1              INC     SFR_ext_sram_addr
00C6 E5F1              MOV     A,SFR_ext_sram_addr
00C8 7002              JNZ     ?C0924
00CA 05F2              INC     SFR_ext_sram_addr+01H
00CC         ?C0924:
                                           ; SOURCE LINE # 50
00CC 85F3F3            MOV     SFR_ext_sram_data,SFR_ext_sram_data
                                           ; SOURCE LINE # 51
00CF 7800        R     MOV     R0,#LOW sram_addr+01H
00D1 06                INC     @R0
00D2 E6                MOV     A,@R0
00D3 18                DEC     R0
00D4 7001              JNZ     ?C0925
00D6 06                INC     @R0
00D7         ?C0925:
                                           ; SOURCE LINE # 52
00D7 020000      R     LJMP    ?C0511
                                           ; SOURCE LINE # 53
00DA         ?C0510:
                                           ; SOURCE LINE # 56
00DA 90FF14            MOV     DPTR,#sata+014H
00DD E0                MOVX    A,@DPTR
00DE 75F040            MOV     B,#040H
00E1 A4                MUL     AB
00E2 7800        R     MOV     R0,#LOW jj
00E4 A6F0              MOV     @R0,B
00E6 08                INC     R0
00E7 F6                MOV     @R0,A
                                           ; SOURCE LINE # 57
00E8 E4                CLR     A
00E9 F5F2              MOV     SFR_ext_sram_addr+01H,A
00EB F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 58
00ED 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 59
00F0 08                INC     R0
00F1 F6                MOV     @R0,A
00F2 08                INC     R0
00F3 F6                MOV     @R0,A
00F4         ?C0514:
                                           ; SOURCE LINE # 60
00F4 C3                CLR     C
00F5 7900        R     MOV     R1,#LOW sram_addr+01H
00F7 E7                MOV     A,@R1
00F8 7800        R     MOV     R0,#LOW jj+01H
00FA 96                SUBB    A,@R0
00FB 19                DEC     R1
00FC E7                MOV     A,@R1
00FD 18                DEC     R0
00FE 96                SUBB    A,@R0
00FF 4003              JC      $ + 5H
0101 020000      R     LJMP    ?C0515
                                           ; SOURCE LINE # 61
                                           ; SOURCE LINE # 62
0104 7800        R     MOV     R0,#LOW sram_addr
0106 E6                MOV     A,@R0
0107 FE                MOV     R6,A
0108 08                INC     R0
0109 E6                MOV     A,@R0
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 116 

010A FF                MOV     R7,A
010B 08                INC     R0
010C A606              MOV     @R0,AR6
010E 08                INC     R0
010F A607              MOV     @R0,AR7
                                           ; SOURCE LINE # 63
0111 7800        R     MOV     R0,#LOW sram_addr
0113 E6                MOV     A,@R0
0114 FE                MOV     R6,A
0115 08                INC     R0
0116 E6                MOV     A,@R0
0117 7803              MOV     R0,#03H
0119         ?C0926:
0119 C3                CLR     C
011A 33                RLC     A
011B CE                XCH     A,R6
011C 33                RLC     A
011D CE                XCH     A,R6
011E D8F9              DJNZ    R0,?C0926
0120 2406              ADD     A,#06H
0122 FF                MOV     R7,A
0123 E4                CLR     A
0124 3E                ADDC    A,R6
0125 F5F2              MOV     SFR_ext_sram_addr+01H,A
0127 8FF1              MOV     SFR_ext_sram_addr,R7
                                           ; SOURCE LINE # 64
0129 E5F3              MOV     A,SFR_ext_sram_data
012B 7007              JNZ     ?C0516
012D E5F3              MOV     A,SFR_ext_sram_data
012F 7003              JNZ     $ + 5H
0131 020000      R     LJMP    ?C0515
0134         ?C0516:
                                           ; SOURCE LINE # 65
0134 7800        R     MOV     R0,#LOW sum
0136 120000      E     LCALL   ?C?LSTKIDATA
0139 00                DB      00H
013A 00                DB      00H
013B 00                DB      00H
013C 00                DB      00H
                                           ; SOURCE LINE # 66
013D         ?C0517:
013D C3                CLR     C
013E 7900        R     MOV     R1,#LOW sram_addr+01H
0140 E7                MOV     A,@R1
0141 7800        R     MOV     R0,#LOW jj+01H
0143 96                SUBB    A,@R0
0144 19                DEC     R1
0145 E7                MOV     A,@R1
0146 18                DEC     R0
0147 96                SUBB    A,@R0
0148 5062              JNC     continue_end
                                           ; SOURCE LINE # 67
                                           ; SOURCE LINE # 68
014A 7800        R     MOV     R0,#LOW sram_addr
014C E6                MOV     A,@R0
014D FE                MOV     R6,A
014E 08                INC     R0
014F E6                MOV     A,@R0
0150 7803              MOV     R0,#03H
0152         ?C0927:
0152 C3                CLR     C
0153 33                RLC     A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 117 

0154 CE                XCH     A,R6
0155 33                RLC     A
0156 CE                XCH     A,R6
0157 D8F9              DJNZ    R0,?C0927
                                           ; SOURCE LINE # 69
0159 120000      R     LCALL   L?1075
                                           ; SOURCE LINE # 70
015C 7800        R     MOV     R0,#LOW trim_addr_offset+03H
015E A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 71
0160 18                DEC     R0
0161 A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 72
0163 E4                CLR     A
0164 18                DEC     R0
0165 F6                MOV     @R0,A
                                           ; SOURCE LINE # 73
0166 18                DEC     R0
0167 F6                MOV     @R0,A
                                           ; SOURCE LINE # 74
0168 120000      R     LCALL   lba_adder
                                           ; SOURCE LINE # 75
016B 7800        R     MOV     R0,#LOW sum
016D 120000      E     LCALL   ?C?LLDIDATA
0170 7800        R     MOV     R0,#LOW trim_addr_offset
0172 120000      E     LCALL   ?C?LLDIDATA0
0175 EF                MOV     A,R7
0176 2B                ADD     A,R3
0177 FF                MOV     R7,A
0178 EE                MOV     A,R6
0179 3A                ADDC    A,R2
017A FE                MOV     R6,A
017B ED                MOV     A,R5
017C 39                ADDC    A,R1
017D FD                MOV     R5,A
017E EC                MOV     A,R4
017F 38                ADDC    A,R0
0180 FC                MOV     R4,A
0181 7800        R     MOV     R0,#LOW sum
0183 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 76
0186 7800        R     MOV     R0,#LOW jj+01H
0188 E6                MOV     A,@R0
0189 24FF              ADD     A,#0FFH
018B FF                MOV     R7,A
018C 18                DEC     R0
018D E6                MOV     A,@R0
018E 34FF              ADDC    A,#0FFH
0190 FE                MOV     R6,A
0191 EF                MOV     A,R7
0192 7800        R     MOV     R0,#LOW sram_addr+01H
0194 66                XRL     A,@R0
0195 7003              JNZ     ?C0928
0197 EE                MOV     A,R6
0198 18                DEC     R0
0199 66                XRL     A,@R0
019A         ?C0928:
019A 6010              JZ      continue_end
019C         ?C0520:
                                           ; SOURCE LINE # 77
019C 120000      R     LCALL   cmp_lba
019F EF                MOV     A,R7
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 118 

01A0 700A              JNZ     continue_end
01A2         ?C0522:
                                           ; SOURCE LINE # 78
01A2         ?C0519:
01A2 7800        R     MOV     R0,#LOW sram_addr+01H
01A4 06                INC     @R0
01A5 E6                MOV     A,@R0
01A6 18                DEC     R0
01A7 7094              JNZ     ?C0517
01A9 06                INC     @R0
01AA         ?C0929:
01AA 8091              SJMP    ?C0517
                                           ; SOURCE LINE # 79
01AC         continue_end:
                                           ; SOURCE LINE # 81
01AC 120000      R     LCALL   trim_check_lba
01AF EF                MOV     A,R7
01B0 6005              JZ      ?C0523
01B2         ?C0978:
01B2 7BFF              MOV     R3,#0FFH
01B4 E4                CLR     A
01B5 8058              SJMP    ?C0979
01B7         ?C0523:
                                           ; SOURCE LINE # 82
01B7 7800        R     MOV     R0,#LOW ?fetch_block_border?BYTE
01B9 7C00        R     MOV     R4,#HIGH ?fetch_block_border?BYTE
01BB 7D00              MOV     R5,#00H
01BD 7B00              MOV     R3,#00H
01BF 7A00        R     MOV     R2,#HIGH addr_temp
01C1 7900        R     MOV     R1,#LOW addr_temp
01C3 7E00              MOV     R6,#00H
01C5 7F02              MOV     R7,#02H
01C7 120000      E     LCALL   ?C?COPY
01CA 120000      R     LCALL   fetch_block_border
                                           ; SOURCE LINE # 83
01CD 7800        R     MOV     R0,#LOW sram_addr+01H
01CF 06                INC     @R0
01D0 E6                MOV     A,@R0
01D1 18                DEC     R0
01D2 7001              JNZ     ?C0930
01D4 06                INC     @R0
01D5         ?C0930:
                                           ; SOURCE LINE # 84
01D5 7800        R     MOV     R0,#LOW trim_addr_offset
01D7 120000      E     LCALL   ?C?LLDIDATA
01DA 7800        R     MOV     R0,#LOW sum
01DC 120000      E     LCALL   ?C?LLDIDATA0
01DF D3                SETB    C
01E0 120000      E     LCALL   ?C?ULCMP
01E3 5003              JNC     $ + 5H
01E5 020000      R     LJMP    ?C0514
01E8         ?C0524:
                                           ; SOURCE LINE # 85
01E8 7800        R     MOV     R0,#LOW sum
01EA 120000      E     LCALL   ?C?LLDIDATA
01ED 7800        R     MOV     R0,#LOW trim_addr_offset
01EF 120000      E     LCALL   ?C?LLDIDATA0
01F2 C3                CLR     C
01F3 EF                MOV     A,R7
01F4 9B                SUBB    A,R3
01F5 FF                MOV     R7,A
01F6 EE                MOV     A,R6
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 119 

01F7 9A                SUBB    A,R2
01F8 FE                MOV     R6,A
01F9 ED                MOV     A,R5
01FA 99                SUBB    A,R1
01FB FD                MOV     R5,A
01FC EC                MOV     A,R4
01FD 98                SUBB    A,R0
01FE FC                MOV     R4,A
01FF 7800        R     MOV     R0,#LOW sum
0201 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 86
0204 120000      R     LCALL   L?1061
                                           ; SOURCE LINE # 87
0207 020000      R     LJMP    ?C0514
020A         ?C0515:
                                           ; SOURCE LINE # 88
020A E4                CLR     A
020B F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 89
020D 7BFF              MOV     R3,#0FFH
020F         ?C0979:
020F FD                MOV     R5,A
0210 7F50              MOV     R7,#050H
0212 120000      R     LCALL   _tx_fis_34
                                           ; SOURCE LINE # 90
0215         end_of_trim:
                                           ; SOURCE LINE # 91
0215 020000      R     LJMP    reset_engine
             ; FUNCTION trim_handler (END)

             ; FUNCTION fetch_block_border (BEGIN)
                                           ; SOURCE LINE # 93
                                           ; SOURCE LINE # 94
                                           ; SOURCE LINE # 102
0000 7800        R     MOV     R0,#LOW tmp
0002 120000      E     LCALL   ?C?LSTKIDATA
0005 00                DB      00H
0006 00                DB      00H
0007 00                DB      00H
0008 00                DB      00H
                                           ; SOURCE LINE # 103
0009 7800        R     MOV     R0,#LOW buf
000B 120000      E     LCALL   ?C?LSTKIDATA
000E 00                DB      00H
000F 00                DB      00H
0010 00                DB      00H
0011 00                DB      00H
                                           ; SOURCE LINE # 105
0012 E500        R     MOV     A,addr+01H
0014 AE00        R     MOV     R6,addr
0016 7803              MOV     R0,#03H
0018         ?C0931:
0018 C3                CLR     C
0019 33                RLC     A
001A CE                XCH     A,R6
001B 33                RLC     A
001C CE                XCH     A,R6
001D D8F9              DJNZ    R0,?C0931
                                           ; SOURCE LINE # 106
001F 120000      R     LCALL   L?1075
                                           ; SOURCE LINE # 108
0022 907FCA            MOV     DPTR,#07FCAH
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 120 

0025 E4                CLR     A
0026 93                MOVC    A,@A+DPTR
0027 7800        R     MOV     R0,#LOW tmp+03H
0029 F6                MOV     @R0,A
                                           ; SOURCE LINE # 109
002A A3                INC     DPTR
002B E4                CLR     A
002C 93                MOVC    A,@A+DPTR
002D 18                DEC     R0
002E F6                MOV     @R0,A
                                           ; SOURCE LINE # 112
002F 907FB8            MOV     DPTR,#07FB8H
0032 E4                CLR     A
0033 93                MOVC    A,@A+DPTR
0034 6405              XRL     A,#05H
0036 7003              JNZ     $ + 5H
0038 020000      R     LJMP    ?C0526
                                           ; SOURCE LINE # 113
                                           ; SOURCE LINE # 114
003B 7800        R     MOV     R0,#LOW tmp
003D 120000      E     LCALL   ?C?LLDIDATA
0040 907FB8            MOV     DPTR,#07FB8H
0043 E4                CLR     A
0044 93                MOVC    A,@A+DPTR
0045 FB                MOV     R3,A
0046 C3                CLR     C
0047 13                RRC     A
0048 F9                MOV     R1,A
0049 F8                MOV     R0,A
004A 120000      E     LCALL   ?C?LSHL
004D 7800        R     MOV     R0,#LOW tmp
004F 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 115
0052 7800        R     MOV     R0,#LOW tmp
0054 120000      E     LCALL   ?C?LLDIDATA
0057 EF                MOV     A,R7
0058 24FF              ADD     A,#0FFH
005A FF                MOV     R7,A
005B EE                MOV     A,R6
005C 34FF              ADDC    A,#0FFH
005E FE                MOV     R6,A
005F ED                MOV     A,R5
0060 34FF              ADDC    A,#0FFH
0062 FD                MOV     R5,A
0063 EC                MOV     A,R4
0064 34FF              ADDC    A,#0FFH
0066 FC                MOV     R4,A
0067 7800        R     MOV     R0,#LOW tmp
0069 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 116
006C E4                CLR     A
006D 90FF57            MOV     DPTR,#sata+057H
0070 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 117
0071 90FF78            MOV     DPTR,#sata+078H
0074 E0                MOVX    A,@DPTR
0075 7800        R     MOV     R0,#LOW tmp+03H
0077 56                ANL     A,@R0
0078 7900        R     MOV     R1,#LOW trim_addr_offset+03H
007A F7                MOV     @R1,A
                                           ; SOURCE LINE # 118
007B A3                INC     DPTR
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 121 

007C E0                MOVX    A,@DPTR
007D 18                DEC     R0
007E 56                ANL     A,@R0
007F 19                DEC     R1
0080 F7                MOV     @R1,A
                                           ; SOURCE LINE # 119
0081 A3                INC     DPTR
0082 E0                MOVX    A,@DPTR
0083 18                DEC     R0
0084 56                ANL     A,@R0
0085 19                DEC     R1
0086 F7                MOV     @R1,A
                                           ; SOURCE LINE # 120
0087 E4                CLR     A
0088 7800        R     MOV     R0,#LOW trim_addr_offset
008A F6                MOV     @R0,A
                                           ; SOURCE LINE # 121
008B 907FBC            MOV     DPTR,#07FBCH
008E 93                MOVC    A,@A+DPTR
008F 90FF57            MOV     DPTR,#sata+057H
0092 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 122
0093 7800        R     MOV     R0,#LOW trim_addr_offset+03H
0095 E6                MOV     A,@R0
0096 7009              JNZ     ?C0527
0098 18                DEC     R0
0099 E6                MOV     A,@R0
009A 7005              JNZ     ?C0527
009C 18                DEC     R0
009D E6                MOV     A,@R0
009E 7001              JNZ     ?C0527
00A0 22                RET     
00A1         ?C0527:
                                           ; SOURCE LINE # 124
                                           ; SOURCE LINE # 125
00A1 7800        R     MOV     R0,#LOW tmp
00A3 120000      E     LCALL   ?C?LLDIDATA
00A6 EF                MOV     A,R7
00A7 2401              ADD     A,#01H
00A9 FF                MOV     R7,A
00AA E4                CLR     A
00AB 3E                ADDC    A,R6
00AC FE                MOV     R6,A
00AD E4                CLR     A
00AE 3D                ADDC    A,R5
00AF FD                MOV     R5,A
00B0 E4                CLR     A
00B1 3C                ADDC    A,R4
00B2 FC                MOV     R4,A
00B3 7800        R     MOV     R0,#LOW tmp
00B5 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 126
00B8 7800        R     MOV     R0,#LOW trim_addr_offset
00BA 120000      E     LCALL   ?C?LLDIDATA0
00BD C000              PUSH    AR0
00BF 7800        R     MOV     R0,#LOW tmp
00C1 120000      E     LCALL   ?C?LLDIDATA
00C4 D000              POP     AR0
00C6 C3                CLR     C
00C7 EF                MOV     A,R7
00C8 9B                SUBB    A,R3
00C9 FF                MOV     R7,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 122 

00CA EE                MOV     A,R6
00CB 9A                SUBB    A,R2
00CC FE                MOV     R6,A
00CD ED                MOV     A,R5
00CE 99                SUBB    A,R1
00CF FD                MOV     R5,A
00D0 EC                MOV     A,R4
00D1 98                SUBB    A,R0
00D2 FC                MOV     R4,A
00D3 7800        R     MOV     R0,#LOW trim_addr_offset
00D5 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 127
                                           ; SOURCE LINE # 128
                                           ; SOURCE LINE # 129
00D8 020000      R     LJMP    ?C0980
00DB         ?C0526:
                                           ; SOURCE LINE # 131
                                           ; SOURCE LINE # 132
00DB 90FF7F            MOV     DPTR,#sata+07FH
00DE 74F1              MOV     A,#0F1H
00E0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 133
00E1 7800        R     MOV     R0,#LOW tmp
00E3 120000      E     LCALL   ?C?LLDIDATA
00E6 7800        R     MOV     R0,#LOW buf
00E8 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 134
00EB 7800        R     MOV     R0,#LOW tmp
00ED 120000      E     LCALL   ?C?LLDIDATA
00F0 C3                CLR     C
00F1 EF                MOV     A,R7
00F2 9401              SUBB    A,#01H
00F4 FF                MOV     R7,A
00F5 EE                MOV     A,R6
00F6 9400              SUBB    A,#00H
00F8 FE                MOV     R6,A
00F9 ED                MOV     A,R5
00FA 9400              SUBB    A,#00H
00FC FD                MOV     R5,A
00FD EC                MOV     A,R4
00FE 9400              SUBB    A,#00H
0100 FC                MOV     R4,A
0101 7800        R     MOV     R0,#LOW tmp
0103 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 135
0106 E4                CLR     A
0107 90FF57            MOV     DPTR,#sata+057H
010A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 136
010B 90FF78            MOV     DPTR,#sata+078H
010E E0                MOVX    A,@DPTR
010F 7800        R     MOV     R0,#LOW tmp+03H
0111 56                ANL     A,@R0
0112 7900        R     MOV     R1,#LOW trim_addr_offset+03H
0114 F7                MOV     @R1,A
                                           ; SOURCE LINE # 137
0115 A3                INC     DPTR
0116 E0                MOVX    A,@DPTR
0117 18                DEC     R0
0118 56                ANL     A,@R0
0119 19                DEC     R1
011A F7                MOV     @R1,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 123 

                                           ; SOURCE LINE # 138
011B A3                INC     DPTR
011C E0                MOVX    A,@DPTR
011D 18                DEC     R0
011E 56                ANL     A,@R0
011F 19                DEC     R1
0120 F7                MOV     @R1,A
                                           ; SOURCE LINE # 139
0121 E4                CLR     A
0122 7800        R     MOV     R0,#LOW trim_addr_offset
0124 F6                MOV     @R0,A
                                           ; SOURCE LINE # 140
0125 907FBC            MOV     DPTR,#07FBCH
0128 93                MOVC    A,@A+DPTR
0129 90FF57            MOV     DPTR,#sata+057H
012C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 141
012D 7800        R     MOV     R0,#LOW buf
012F 120000      E     LCALL   ?C?LLDIDATA
0132 7800        R     MOV     R0,#LOW tmp
0134 8020              SJMP    ?C0981
0136         ?C0531:
                                           ; SOURCE LINE # 142
0136 E4                CLR     A
0137 7F01              MOV     R7,#01H
0139 FE                MOV     R6,A
013A FD                MOV     R5,A
013B FC                MOV     R4,A
013C 7800        R     MOV     R0,#LOW buf
013E 120000      E     LCALL   ?C?LLDIDATA0
0141 C3                CLR     C
0142 120000      E     LCALL   ?C?ULCMP
0145 6014              JZ      ?C0532
                                           ; SOURCE LINE # 143
                                           ; SOURCE LINE # 144
0147 120000      R     LCALL   lba_shift_right
                                           ; SOURCE LINE # 145
014A 7800        R     MOV     R0,#LOW buf
014C 120000      E     LCALL   ?C?LLDIDATA
014F 7801              MOV     R0,#01H
0151 120000      E     LCALL   ?C?ULSHR
0154 7800        R     MOV     R0,#LOW buf
0156         ?C0981:
0156 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 146
0159 80DB              SJMP    ?C0531
015B         ?C0532:
                                           ; SOURCE LINE # 147
015B 7800        R     MOV     R0,#LOW buf
015D 120000      E     LCALL   ?C?LSTKIDATA
0160 00                DB      00H
0161 00                DB      00H
0162 00                DB      00H
0163 00                DB      00H
                                           ; SOURCE LINE # 148
0164 7800        R     MOV     R0,#LOW trim_addr_offset+03H
0166 E6                MOV     A,@R0
0167 7008              JNZ     ?C0534
0169 18                DEC     R0
016A E6                MOV     A,@R0
016B 7004              JNZ     ?C0534
016D 18                DEC     R0
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 124 

016E E6                MOV     A,@R0
016F 601E              JZ      ?C0537
0171         ?C0534:
0171 75BE08            MOV     SFR_lba_comp,#08H
0174 7800        R     MOV     R0,#LOW buf
0176 120000      E     LCALL   ?C?LLDIDATA
0179 7800        R     MOV     R0,#LOW tmp
017B 120000      E     LCALL   ?C?LLDIDATA0
017E EF                MOV     A,R7
017F 2B                ADD     A,R3
0180 FF                MOV     R7,A
0181 EE                MOV     A,R6
0182 3A                ADDC    A,R2
0183 FE                MOV     R6,A
0184 ED                MOV     A,R5
0185 39                ADDC    A,R1
0186 FD                MOV     R5,A
0187 EC                MOV     A,R4
0188 38                ADDC    A,R0
0189 FC                MOV     R4,A
018A 7800        R     MOV     R0,#LOW buf
018C 120000      E     LCALL   ?C?LSTIDATA
018F         ?C0537:
                                           ; SOURCE LINE # 149
                                           ; SOURCE LINE # 150
018F 90FFC6            MOV     DPTR,#sata+0C6H
0192 E0                MOVX    A,@DPTR
0193 6401              XRL     A,#01H
0195 6020              JZ      ?C0536
0197         ?C0538:
                                           ; SOURCE LINE # 151
0197 7800        R     MOV     R0,#LOW buf
0199 120000      E     LCALL   ?C?LLDIDATA
019C 7800        R     MOV     R0,#LOW tmp
019E 120000      E     LCALL   ?C?LLDIDATA0
01A1 EF                MOV     A,R7
01A2 2B                ADD     A,R3
01A3 FF                MOV     R7,A
01A4 EE                MOV     A,R6
01A5 3A                ADDC    A,R2
01A6 FE                MOV     R6,A
01A7 ED                MOV     A,R5
01A8 39                ADDC    A,R1
01A9 FD                MOV     R5,A
01AA EC                MOV     A,R4
01AB 38                ADDC    A,R0
01AC FC                MOV     R4,A
01AD 7800        R     MOV     R0,#LOW buf
01AF 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 152
01B2 75BE08            MOV     SFR_lba_comp,#08H
                                           ; SOURCE LINE # 153
01B5 80D8              SJMP    ?C0537
01B7         ?C0536:
                                           ; SOURCE LINE # 154
01B7 907FBB            MOV     DPTR,#07FBBH
01BA E4                CLR     A
01BB 93                MOVC    A,@A+DPTR
01BC 90FF7F            MOV     DPTR,#sata+07FH
01BF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 155
01C0 7800        R     MOV     R0,#LOW trim_addr_offset
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 125 

01C2 120000      E     LCALL   ?C?LLDIDATA0
01C5 C000              PUSH    AR0
01C7 7800        R     MOV     R0,#LOW buf
01C9 120000      E     LCALL   ?C?LLDIDATA
01CC D000              POP     AR0
01CE C3                CLR     C
01CF EF                MOV     A,R7
01D0 9B                SUBB    A,R3
01D1 FF                MOV     R7,A
01D2 EE                MOV     A,R6
01D3 9A                SUBB    A,R2
01D4 FE                MOV     R6,A
01D5 ED                MOV     A,R5
01D6 99                SUBB    A,R1
01D7 FD                MOV     R5,A
01D8 EC                MOV     A,R4
01D9 98                SUBB    A,R0
01DA FC                MOV     R4,A
01DB 7800        R     MOV     R0,#LOW trim_addr_offset
01DD 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 156
01E0 E500        R     MOV     A,addr+01H
01E2 AE00        R     MOV     R6,addr
01E4 7803              MOV     R0,#03H
01E6         ?C0932:
01E6 C3                CLR     C
01E7 33                RLC     A
01E8 CE                XCH     A,R6
01E9 33                RLC     A
01EA CE                XCH     A,R6
01EB D8F9              DJNZ    R0,?C0932
                                           ; SOURCE LINE # 157
01ED 120000      R     LCALL   L?1076
                                           ; SOURCE LINE # 158
01F0         ?C0980:
01F0 120000      R     LCALL   lba_adder
                                           ; SOURCE LINE # 159
                                           ; SOURCE LINE # 160
01F3         ?C0528:
01F3 22                RET     
             ; FUNCTION fetch_block_border (END)

             ; FUNCTION lba_adder (BEGIN)
                                           ; SOURCE LINE # 161
                                           ; SOURCE LINE # 162
                                           ; SOURCE LINE # 164
0000 E4                CLR     A
0001 F500        R     MOV     i,A
0003         ?C0539:
0003 E500        R     MOV     A,i
0005 C3                CLR     C
0006 7800        R     MOV     R0,#LOW trim_addr_offset+03H
0008 96                SUBB    A,@R0
0009 5007              JNC     ?C0540
000B 75BE08            MOV     SFR_lba_comp,#08H
000E 0500        R     INC     i
0010 80F1              SJMP    ?C0539
0012         ?C0540:
                                           ; SOURCE LINE # 165
0012 E4                CLR     A
0013 90FF57            MOV     DPTR,#sata+057H
0016 F0                MOVX    @DPTR,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 126 

                                           ; SOURCE LINE # 166
0017 90FF78            MOV     DPTR,#sata+078H
001A E0                MOVX    A,@DPTR
001B 7800        R     MOV     R0,#LOW buf
001D F6                MOV     @R0,A
                                           ; SOURCE LINE # 167
001E A3                INC     DPTR
001F E0                MOVX    A,@DPTR
0020 90FF78            MOV     DPTR,#sata+078H
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 168
0024 90FF7A            MOV     DPTR,#sata+07AH
0027 E0                MOVX    A,@DPTR
0028 90FF79            MOV     DPTR,#sata+079H
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 169
002C 90FF7B            MOV     DPTR,#sata+07BH
002F E0                MOVX    A,@DPTR
0030 90FF7A            MOV     DPTR,#sata+07AH
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 170
0034 90FF7C            MOV     DPTR,#sata+07CH
0037 E0                MOVX    A,@DPTR
0038 90FF7B            MOV     DPTR,#sata+07BH
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 171
003C 90FF7D            MOV     DPTR,#sata+07DH
003F E0                MOVX    A,@DPTR
0040 90FF7C            MOV     DPTR,#sata+07CH
0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 172
0044 E4                CLR     A
0045 F500        R     MOV     i,A
0047         ?C0542:
0047 E500        R     MOV     A,i
0049 C3                CLR     C
004A 7800        R     MOV     R0,#LOW trim_addr_offset+02H
004C 96                SUBB    A,@R0
004D 5007              JNC     ?C0543
004F 75BE08            MOV     SFR_lba_comp,#08H
0052 0500        R     INC     i
0054 80F1              SJMP    ?C0542
0056         ?C0543:
                                           ; SOURCE LINE # 173
0056 90FF78            MOV     DPTR,#sata+078H
0059 E0                MOVX    A,@DPTR
005A 7800        R     MOV     R0,#LOW buf+01H
005C F6                MOV     @R0,A
                                           ; SOURCE LINE # 174
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F 90FF78            MOV     DPTR,#sata+078H
0062 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 175
0063 90FF7A            MOV     DPTR,#sata+07AH
0066 E0                MOVX    A,@DPTR
0067 90FF79            MOV     DPTR,#sata+079H
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 176
006B 90FF7B            MOV     DPTR,#sata+07BH
006E E0                MOVX    A,@DPTR
006F 90FF7A            MOV     DPTR,#sata+07AH
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 127 

0072 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 177
0073 90FF7C            MOV     DPTR,#sata+07CH
0076 E0                MOVX    A,@DPTR
0077 90FF7B            MOV     DPTR,#sata+07BH
007A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 178
007B 90FF7D            MOV     DPTR,#sata+07DH
007E E0                MOVX    A,@DPTR
007F 90FF7C            MOV     DPTR,#sata+07CH
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 179
0083 E4                CLR     A
0084 F500        R     MOV     i,A
0086         ?C0545:
0086 E500        R     MOV     A,i
0088 C3                CLR     C
0089 7800        R     MOV     R0,#LOW trim_addr_offset+01H
008B 96                SUBB    A,@R0
008C 5007              JNC     ?C0546
008E 75BE08            MOV     SFR_lba_comp,#08H
0091 0500        R     INC     i
0093 80F1              SJMP    ?C0545
0095         ?C0546:
                                           ; SOURCE LINE # 180
0095 90FF7B            MOV     DPTR,#sata+07BH
0098 E0                MOVX    A,@DPTR
0099 90FF7D            MOV     DPTR,#sata+07DH
009C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 181
009D 90FF7A            MOV     DPTR,#sata+07AH
00A0 E0                MOVX    A,@DPTR
00A1 90FF7C            MOV     DPTR,#sata+07CH
00A4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 182
00A5 90FF79            MOV     DPTR,#sata+079H
00A8 E0                MOVX    A,@DPTR
00A9 90FF7B            MOV     DPTR,#sata+07BH
00AC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 183
00AD 90FF78            MOV     DPTR,#sata+078H
00B0 E0                MOVX    A,@DPTR
00B1 90FF7A            MOV     DPTR,#sata+07AH
00B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 184
00B5 7800        R     MOV     R0,#LOW buf+01H
00B7 E6                MOV     A,@R0
00B8 90FF79            MOV     DPTR,#sata+079H
00BB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 185
00BC 18                DEC     R0
00BD E6                MOV     A,@R0
00BE 90FF78            MOV     DPTR,#sata+078H
00C1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 186
00C2 907FBC            MOV     DPTR,#07FBCH
00C5 E4                CLR     A
00C6 93                MOVC    A,@A+DPTR
00C7 90FF57            MOV     DPTR,#sata+057H
00CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 187
00CB 75BE80            MOV     SFR_lba_comp,#080H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 128 

00CE 75BE08            MOV     SFR_lba_comp,#08H
                                           ; SOURCE LINE # 188
00D1 22                RET     
             ; FUNCTION lba_adder (END)

             ; FUNCTION cmp_lba (BEGIN)
                                           ; SOURCE LINE # 190
                                           ; SOURCE LINE # 191
                                           ; SOURCE LINE # 192
0000 E4                CLR     A
0001 90FF57            MOV     DPTR,#sata+057H
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 193
0005 90FF78            MOV     DPTR,#sata+078H
0008 E0                MOVX    A,@DPTR
0009 65F3              XRL     A,SFR_ext_sram_data
000B 7031              JNZ     discontinue
000D         ?C0549:
                                           ; SOURCE LINE # 194
000D 90FF79            MOV     DPTR,#sata+079H
0010 E0                MOVX    A,@DPTR
0011 65F3              XRL     A,SFR_ext_sram_data
0013 7029              JNZ     discontinue
0015         ?C0551:
                                           ; SOURCE LINE # 195
0015 90FF7A            MOV     DPTR,#sata+07AH
0018 E0                MOVX    A,@DPTR
0019 65F3              XRL     A,SFR_ext_sram_data
001B 7021              JNZ     discontinue
001D         ?C0552:
                                           ; SOURCE LINE # 196
001D 90FF7B            MOV     DPTR,#sata+07BH
0020 E0                MOVX    A,@DPTR
0021 B5F31A            CJNE    A,SFR_ext_sram_data,discontinue
0024         ?C0553:
                                           ; SOURCE LINE # 197
0024 90FF7C            MOV     DPTR,#sata+07CH
0027 E0                MOVX    A,@DPTR
0028 B5F313            CJNE    A,SFR_ext_sram_data,discontinue
002B         ?C0554:
                                           ; SOURCE LINE # 198
002B 90FF7D            MOV     DPTR,#sata+07DH
002E E0                MOVX    A,@DPTR
002F B5F30C            CJNE    A,SFR_ext_sram_data,discontinue
0032         ?C0555:
                                           ; SOURCE LINE # 199
0032 907FBC            MOV     DPTR,#07FBCH
0035 E4                CLR     A
0036 93                MOVC    A,@A+DPTR
0037 90FF57            MOV     DPTR,#sata+057H
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 200
003B 7F00              MOV     R7,#00H
003D 22                RET     
                                           ; SOURCE LINE # 201
003E         discontinue:
                                           ; SOURCE LINE # 202
003E 907FBC            MOV     DPTR,#07FBCH
0041 E4                CLR     A
0042 93                MOVC    A,@A+DPTR
0043 90FF57            MOV     DPTR,#sata+057H
0046 F0                MOVX    @DPTR,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 129 

                                           ; SOURCE LINE # 203
0047 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 204
0049         ?C0556:
0049 22                RET     
             ; FUNCTION cmp_lba (END)

             ; FUNCTION L?1061 (BEGIN)
0000 7D00              MOV     R5,#00H
0002 7B00              MOV     R3,#00H
0004 7E00              MOV     R6,#00H
0006         L?1062:
0006 7800        R     MOV     R0,#LOW ?send_trim_cmd?BYTE
0008 7C00        R     MOV     R4,#HIGH ?send_trim_cmd?BYTE
000A 7A00        R     MOV     R2,#HIGH sum
000C 7900        R     MOV     R1,#LOW sum
000E 7F04              MOV     R7,#04H
0010 120000      E     LCALL   ?C?COPY
             ; FUNCTION send_trim_cmd (BEGIN)
                                           ; SOURCE LINE # 205
                                           ; SOURCE LINE # 206
                                           ; SOURCE LINE # 213
0013 7800        R     MOV     R0,#LOW block_size
0015 120000      E     LCALL   ?C?LSTKIDATA
0018 00                DB      00H
0019 00                DB      00H
001A 00                DB      00H
001B 00                DB      00H
                                           ; SOURCE LINE # 215
001C 907FCA            MOV     DPTR,#07FCAH
001F E4                CLR     A
0020 93                MOVC    A,@A+DPTR
0021 7800        R     MOV     R0,#LOW block_size+03H
0023 F6                MOV     @R0,A
                                           ; SOURCE LINE # 216
0024 A3                INC     DPTR
0025 E4                CLR     A
0026 93                MOVC    A,@A+DPTR
0027 18                DEC     R0
0028 F6                MOV     @R0,A
                                           ; SOURCE LINE # 217
0029 90FF7F            MOV     DPTR,#sata+07FH
002C E0                MOVX    A,@DPTR
002D 540F              ANL     A,#0FH
002F 14                DEC     A
0030 FF                MOV     R7,A
0031 7401              MOV     A,#01H
0033 7E00              MOV     R6,#00H
0035 A807              MOV     R0,AR7
0037 08                INC     R0
0038 8005              SJMP    ?C0934
003A         ?C0933:
003A C3                CLR     C
003B 33                RLC     A
003C CE                XCH     A,R6
003D 33                RLC     A
003E CE                XCH     A,R6
003F         ?C0934:
003F D8F9              DJNZ    R0,?C0933
0041 FF                MOV     R7,A
0042 EE                MOV     A,R6
0043 33                RLC     A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 130 

0044 95E0              SUBB    A,ACC
0046 FD                MOV     R5,A
0047 FC                MOV     R4,A
0048 7800        R     MOV     R0,#LOW trim_addr_offset
004A 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 218
004D 907FB8            MOV     DPTR,#07FB8H
0050 E4                CLR     A
0051 93                MOVC    A,@A+DPTR
0052 6405              XRL     A,#05H
0054 6051              JZ      ?C0557
                                           ; SOURCE LINE # 219
                                           ; SOURCE LINE # 220
0056 7800        R     MOV     R0,#LOW block_size
0058 120000      E     LCALL   ?C?LLDIDATA
005B 907FB8            MOV     DPTR,#07FB8H
005E E4                CLR     A
005F 93                MOVC    A,@A+DPTR
0060 FB                MOV     R3,A
0061 C3                CLR     C
0062 13                RRC     A
0063 F9                MOV     R1,A
0064 F8                MOV     R0,A
0065 120000      E     LCALL   ?C?LSHL
0068 7800        R     MOV     R0,#LOW block_size
006A 120000      E     LCALL   ?C?LSTIDATA
006D         ?C0558:
                                           ; SOURCE LINE # 221
006D E4                CLR     A
006E 7F01              MOV     R7,#01H
0070 FE                MOV     R6,A
0071 FD                MOV     R5,A
0072 FC                MOV     R4,A
0073 7800        R     MOV     R0,#LOW block_size
0075 120000      E     LCALL   ?C?LLDIDATA0
0078 C3                CLR     C
0079 120000      E     LCALL   ?C?ULCMP
007C 7003              JNZ     $ + 5H
007E 020000      R     LJMP    ?C0560
                                           ; SOURCE LINE # 222
                                           ; SOURCE LINE # 223
0081 7800        R     MOV     R0,#LOW block_size
0083 120000      E     LCALL   ?C?LLDIDATA
0086 7801              MOV     R0,#01H
0088 120000      E     LCALL   ?C?ULSHR
008B 7800        R     MOV     R0,#LOW block_size
008D 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 224
0090 AF00        R     MOV     R7,sec_cnt+03H
0092 AE00        R     MOV     R6,sec_cnt+02H
0094 AD00        R     MOV     R5,sec_cnt+01H
0096 AC00        R     MOV     R4,sec_cnt
0098 7801              MOV     R0,#01H
009A 120000      E     LCALL   ?C?ULSHR
009D 8F00        R     MOV     sec_cnt+03H,R7
009F 8E00        R     MOV     sec_cnt+02H,R6
00A1 8D00        R     MOV     sec_cnt+01H,R5
00A3 8C00        R     MOV     sec_cnt,R4
                                           ; SOURCE LINE # 225
00A5 80C6              SJMP    ?C0558
                                           ; SOURCE LINE # 226
00A7         ?C0557:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 131 

                                           ; SOURCE LINE # 228
                                           ; SOURCE LINE # 229
00A7 120000      R     LCALL   save_lba
00AA         ?C0561:
                                           ; SOURCE LINE # 230
00AA E4                CLR     A
00AB 7F01              MOV     R7,#01H
00AD FE                MOV     R6,A
00AE FD                MOV     R5,A
00AF FC                MOV     R4,A
00B0 7800        R     MOV     R0,#LOW block_size
00B2 120000      E     LCALL   ?C?LLDIDATA0
00B5 C3                CLR     C
00B6 120000      E     LCALL   ?C?ULCMP
00B9 6026              JZ      ?C0562
                                           ; SOURCE LINE # 231
                                           ; SOURCE LINE # 232
00BB 7800        R     MOV     R0,#LOW block_size
00BD 120000      E     LCALL   ?C?LLDIDATA
00C0 7801              MOV     R0,#01H
00C2 120000      E     LCALL   ?C?ULSHR
00C5 7800        R     MOV     R0,#LOW block_size
00C7 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 233
00CA AF00        R     MOV     R7,sec_cnt+03H
00CC AE00        R     MOV     R6,sec_cnt+02H
00CE AD00        R     MOV     R5,sec_cnt+01H
00D0 AC00        R     MOV     R4,sec_cnt
00D2 7801              MOV     R0,#01H
00D4 120000      E     LCALL   ?C?ULSHR
00D7 8F00        R     MOV     sec_cnt+03H,R7
00D9 8E00        R     MOV     sec_cnt+02H,R6
00DB 8D00        R     MOV     sec_cnt+01H,R5
00DD 8C00        R     MOV     sec_cnt,R4
                                           ; SOURCE LINE # 234
00DF 80C9              SJMP    ?C0561
00E1         ?C0562:
                                           ; SOURCE LINE # 235
00E1 90FF7F            MOV     DPTR,#sata+07FH
00E4 74F1              MOV     A,#0F1H
00E6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 236
00E7 90FF78            MOV     DPTR,#sata+078H
00EA E500        R     MOV     A,sec_cnt+03H
00EC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 237
00ED A3                INC     DPTR
00EE E500        R     MOV     A,sec_cnt+02H
00F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 238
00F1 A3                INC     DPTR
00F2 E500        R     MOV     A,sec_cnt+01H
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 239
00F5 A3                INC     DPTR
00F6 E500        R     MOV     A,sec_cnt
00F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 240
00F9 E4                CLR     A
00FA A3                INC     DPTR
00FB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 241
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 132 

00FC A3                INC     DPTR
00FD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 242
00FE 7F1E              MOV     R7,#01EH
0100 FE                MOV     R6,A
0101 120000      R     LCALL   _delay
                                           ; SOURCE LINE # 244
0104 907FBC            MOV     DPTR,#07FBCH
0107 E4                CLR     A
0108 93                MOVC    A,@A+DPTR
0109 90FF57            MOV     DPTR,#sata+057H
010C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 245
010D 90FF78            MOV     DPTR,#sata+078H
0110 E0                MOVX    A,@DPTR
0111 F500        R     MOV     sec_cnt+03H,A
                                           ; SOURCE LINE # 246
0113 A3                INC     DPTR
0114 E0                MOVX    A,@DPTR
0115 F500        R     MOV     sec_cnt+02H,A
                                           ; SOURCE LINE # 247
0117 A3                INC     DPTR
0118 E0                MOVX    A,@DPTR
0119 F500        R     MOV     sec_cnt+01H,A
                                           ; SOURCE LINE # 248
011B A3                INC     DPTR
011C E0                MOVX    A,@DPTR
011D F500        R     MOV     sec_cnt,A
                                           ; SOURCE LINE # 249
011F 907FBC            MOV     DPTR,#07FBCH
0122 E4                CLR     A
0123 93                MOVC    A,@A+DPTR
0124 90FF57            MOV     DPTR,#sata+057H
0127 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 250
0128 907FBB            MOV     DPTR,#07FBBH
012B E4                CLR     A
012C 93                MOVC    A,@A+DPTR
012D 90FF7F            MOV     DPTR,#sata+07FH
0130 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 251
0131 120000      R     LCALL   recover_lba
                                           ; SOURCE LINE # 252
0134         ?C0560:
                                           ; SOURCE LINE # 253
0134 7800        R     MOV     R0,#LOW block_size
0136 120000      E     LCALL   ?C?LSTKIDATA
0139 00                DB      00H
013A 00                DB      00H
013B 00                DB      00H
013C 00                DB      00H
                                           ; SOURCE LINE # 254
013D 907FCA            MOV     DPTR,#07FCAH
0140 E4                CLR     A
0141 93                MOVC    A,@A+DPTR
0142 7800        R     MOV     R0,#LOW block_size+03H
0144 F6                MOV     @R0,A
                                           ; SOURCE LINE # 255
0145 A3                INC     DPTR
0146 E4                CLR     A
0147 93                MOVC    A,@A+DPTR
0148 18                DEC     R0
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 133 

0149 F6                MOV     @R0,A
                                           ; SOURCE LINE # 256
014A E4                CLR     A
014B FF                MOV     R7,A
014C FE                MOV     R6,A
014D FD                MOV     R5,A
014E FC                MOV     R4,A
014F AB00        R     MOV     R3,sec_cnt+03H
0151 AA00        R     MOV     R2,sec_cnt+02H
0153 A900        R     MOV     R1,sec_cnt+01H
0155 A800        R     MOV     R0,sec_cnt
0157 C3                CLR     C
0158 120000      E     LCALL   ?C?ULCMP
015B 7003              JNZ     $ + 5H
015D 020000      R     LJMP    ?C0564
0160         ?C0563:
0160         ?C0565:
                                           ; SOURCE LINE # 257
0160 E4                CLR     A
0161 7F01              MOV     R7,#01H
0163 FE                MOV     R6,A
0164 FD                MOV     R5,A
0165 FC                MOV     R4,A
0166 7800        R     MOV     R0,#LOW block_size
0168 120000      E     LCALL   ?C?LLDIDATA0
016B C3                CLR     C
016C 120000      E     LCALL   ?C?ULCMP
016F 6026              JZ      ?C0566
                                           ; SOURCE LINE # 258
                                           ; SOURCE LINE # 259
0171 AF00        R     MOV     R7,sec_cnt+03H
0173 AE00        R     MOV     R6,sec_cnt+02H
0175 AD00        R     MOV     R5,sec_cnt+01H
0177 AC00        R     MOV     R4,sec_cnt
0179 7801              MOV     R0,#01H
017B 120000      E     LCALL   ?C?LSHL
017E 8F00        R     MOV     sec_cnt+03H,R7
0180 8E00        R     MOV     sec_cnt+02H,R6
0182 8D00        R     MOV     sec_cnt+01H,R5
0184 8C00        R     MOV     sec_cnt,R4
                                           ; SOURCE LINE # 260
0186 7800        R     MOV     R0,#LOW block_size
0188 120000      E     LCALL   ?C?LLDIDATA
018B 7801              MOV     R0,#01H
018D 120000      E     LCALL   ?C?ULSHR
0190 7800        R     MOV     R0,#LOW block_size
0192 120000      E     LCALL   ?C?LSTIDATA
                                           ; SOURCE LINE # 261
0195 80C9              SJMP    ?C0565
0197         ?C0566:
                                           ; SOURCE LINE # 263
0197 907FBA            MOV     DPTR,#07FBAH
019A E4                CLR     A
019B 93                MOVC    A,@A+DPTR
019C F5D7              MOV     SFR_CHP_en,A
                                           ; SOURCE LINE # 264
019E 75BE80            MOV     SFR_lba_comp,#080H
01A1 75BE08            MOV     SFR_lba_comp,#08H
                                           ; SOURCE LINE # 265
                                           ; SOURCE LINE # 266
01A4 120000      R     LCALL   L?1055
                                           ; SOURCE LINE # 267
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 134 

01A7 75D701            MOV     SFR_CHP_en,#01H
                                           ; SOURCE LINE # 268
01AA E4                CLR     A
01AB F500        R     MOV     j,A
01AD         ?C0567:
01AD 907FB8            MOV     DPTR,#07FB8H
01B0 E4                CLR     A
01B1 93                MOVC    A,@A+DPTR
01B2 FF                MOV     R7,A
01B3 E500        R     MOV     A,j
01B5 C3                CLR     C
01B6 9F                SUBB    A,R7
01B7 5023              JNC     ?C0568
                                           ; SOURCE LINE # 269
                                           ; SOURCE LINE # 270
01B9 7800        R     MOV     R0,#LOW ?trim_burst?BYTE
01BB 7C00        R     MOV     R4,#HIGH ?trim_burst?BYTE
01BD 7D00              MOV     R5,#00H
01BF 7B00              MOV     R3,#00H
01C1 7A00        R     MOV     R2,#HIGH sec_cnt
01C3 7900        R     MOV     R1,#LOW sec_cnt
01C5 7E00              MOV     R6,#00H
01C7 7F04              MOV     R7,#04H
01C9 120000      E     LCALL   ?C?COPY
01CC 120000      R     LCALL   trim_burst
                                           ; SOURCE LINE # 271
01CF 120000      R     LCALL   lba_adder
                                           ; SOURCE LINE # 272
01D2 E5D7              MOV     A,SFR_CHP_en
01D4 25E0              ADD     A,ACC
01D6 F5D7              MOV     SFR_CHP_en,A
                                           ; SOURCE LINE # 273
01D8 0500        R     INC     j
01DA 80D1              SJMP    ?C0567
01DC         ?C0568:
                                           ; SOURCE LINE # 274
01DC 907FBA            MOV     DPTR,#07FBAH
01DF E4                CLR     A
01E0 93                MOVC    A,@A+DPTR
01E1 F5D7              MOV     SFR_CHP_en,A
                                           ; SOURCE LINE # 275
01E3 120000      R     LCALL   wait_chp_ready
                                           ; SOURCE LINE # 276
01E6         ?C0564:
01E6 22                RET     
             ; FUNCTION send_trim_cmd (END)

             ; FUNCTION trim_burst (BEGIN)
                                           ; SOURCE LINE # 277
                                           ; SOURCE LINE # 278
                                           ; SOURCE LINE # 279
0000 75F240            MOV     SFR_ext_sram_addr+01H,#040H
0003 75F106            MOV     SFR_ext_sram_addr,#06H
                                           ; SOURCE LINE # 280
0006 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 281
0009 E4                CLR     A
000A F500        R     MOV     i,A
000C         ?C0570:
                                           ; SOURCE LINE # 282
                                           ; SOURCE LINE # 283
000C 7400        R     MOV     A,#LOW block_num
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 135 

000E 2500        R     ADD     A,i
0010 F8                MOV     R0,A
0011 E6                MOV     A,@R0
0012 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 284
0014 0500        R     INC     i
0016 E500        R     MOV     A,i
0018 B404F1            CJNE    A,#04H,?C0570
001B         ?C0571:
                                           ; SOURCE LINE # 286
001B E4                CLR     A
001C 90FF57            MOV     DPTR,#sata+057H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 288
0020 907FBC            MOV     DPTR,#07FBCH
0023 93                MOVC    A,@A+DPTR
0024 90FF57            MOV     DPTR,#sata+057H
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 290
0028 75FC00            MOV     SFR_dma_max_num+01H,#00H
002B 75FB01            MOV     SFR_dma_max_num,#01H
                                           ; SOURCE LINE # 291
002E 75FA40            MOV     SFR_dma_base+01H,#040H
0031 75F900            MOV     SFR_dma_base,#00H
                                           ; SOURCE LINE # 292
0034 90FF7E            MOV     DPTR,#sata+07EH
0037 7450              MOV     A,#050H
0039 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 293
003A 75F880            MOV     SFR_dma_cntl,#080H
003D         ?C0573:
                                           ; SOURCE LINE # 294
003D 30F8FD            JNB     dma_done,?C0573
0040         ?C0574:
                                           ; SOURCE LINE # 295
0040 E4                CLR     A
0041 F5F8              MOV     SFR_dma_cntl,A
                                           ; SOURCE LINE # 296
0043 22                RET     
             ; FUNCTION trim_burst (END)

             ; FUNCTION lba_shift_right (BEGIN)
                                           ; SOURCE LINE # 297
                                           ; SOURCE LINE # 298
                                           ; SOURCE LINE # 299
0000 120000      R     LCALL   save_lba
                                           ; SOURCE LINE # 300
0003 E500        R     MOV     A,g_lba+01H
0005 C4                SWAP    A
0006 33                RLC     A
0007 33                RLC     A
0008 33                RLC     A
0009 5480              ANL     A,#080H
000B FF                MOV     R7,A
000C E500        R     MOV     A,g_lba
000E C3                CLR     C
000F 13                RRC     A
0010 2F                ADD     A,R7
0011 F500        R     MOV     g_lba,A
                                           ; SOURCE LINE # 301
0013 E500        R     MOV     A,g_lba+02H
0015 C4                SWAP    A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 136 

0016 33                RLC     A
0017 33                RLC     A
0018 33                RLC     A
0019 5480              ANL     A,#080H
001B FF                MOV     R7,A
001C E500        R     MOV     A,g_lba+01H
001E C3                CLR     C
001F 13                RRC     A
0020 2F                ADD     A,R7
0021 F500        R     MOV     g_lba+01H,A
                                           ; SOURCE LINE # 302
0023 E500        R     MOV     A,g_lba+03H
0025 C4                SWAP    A
0026 33                RLC     A
0027 33                RLC     A
0028 33                RLC     A
0029 5480              ANL     A,#080H
002B FF                MOV     R7,A
002C E500        R     MOV     A,g_lba+02H
002E C3                CLR     C
002F 13                RRC     A
0030 2F                ADD     A,R7
0031 F500        R     MOV     g_lba+02H,A
                                           ; SOURCE LINE # 303
0033 E500        R     MOV     A,g_lba+04H
0035 C4                SWAP    A
0036 33                RLC     A
0037 33                RLC     A
0038 33                RLC     A
0039 5480              ANL     A,#080H
003B FF                MOV     R7,A
003C E500        R     MOV     A,g_lba+03H
003E C3                CLR     C
003F 13                RRC     A
0040 2F                ADD     A,R7
0041 F500        R     MOV     g_lba+03H,A
                                           ; SOURCE LINE # 304
0043 E500        R     MOV     A,g_lba+05H
0045 C4                SWAP    A
0046 33                RLC     A
0047 33                RLC     A
0048 33                RLC     A
0049 5480              ANL     A,#080H
004B FF                MOV     R7,A
004C E500        R     MOV     A,g_lba+04H
004E C3                CLR     C
004F 13                RRC     A
0050 2F                ADD     A,R7
0051 F500        R     MOV     g_lba+04H,A
                                           ; SOURCE LINE # 305
0053 E500        R     MOV     A,g_lba+05H
0055 C3                CLR     C
0056 13                RRC     A
0057 F500        R     MOV     g_lba+05H,A
                                           ; SOURCE LINE # 306
0059 020000      R     LJMP    recover_lba
             ; FUNCTION lba_shift_right (END)

             ; FUNCTION L?1075 (BEGIN)
0000         L?1076:
0000 8EF2              MOV     SFR_ext_sram_addr+01H,R6
0002 F5F1              MOV     SFR_ext_sram_addr,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 137 

             ; FUNCTION fetch_table_lba (BEGIN)
                                           ; SOURCE LINE # 308
                                           ; SOURCE LINE # 309
                                           ; SOURCE LINE # 310
0004 90FF78            MOV     DPTR,#sata+078H
0007 E5F3              MOV     A,SFR_ext_sram_data
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 311
000A A3                INC     DPTR
000B E5F3              MOV     A,SFR_ext_sram_data
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 312
000E A3                INC     DPTR
000F E5F3              MOV     A,SFR_ext_sram_data
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 313
0012 A3                INC     DPTR
0013 E5F3              MOV     A,SFR_ext_sram_data
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 314
0016 A3                INC     DPTR
0017 E5F3              MOV     A,SFR_ext_sram_data
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 315
001A A3                INC     DPTR
001B E5F3              MOV     A,SFR_ext_sram_data
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 316
001E 22                RET     
             ; FUNCTION fetch_table_lba (END)

             ; FUNCTION trim_check_lba (BEGIN)
                                           ; SOURCE LINE # 318
                                           ; SOURCE LINE # 319
                                           ; SOURCE LINE # 321
0000 120000      R     LCALL   save_lba
                                           ; SOURCE LINE # 322
0003 E4                CLR     A
0004 7800        R     MOV     R0,#LOW i
0006 F6                MOV     @R0,A
0007         ?C0578:
                                           ; SOURCE LINE # 323
                                           ; SOURCE LINE # 324
0007 7800        R     MOV     R0,#LOW i
0009 E6                MOV     A,@R0
000A FF                MOV     R7,A
000B FD                MOV     R5,A
000C C3                CLR     C
000D 7405              MOV     A,#05H
000F 9D                SUBB    A,R5
0010 FD                MOV     R5,A
0011 E4                CLR     A
0012 9400              SUBB    A,#00H
0014 FC                MOV     R4,A
0015 74C0              MOV     A,#LOW sata+0C0H
0017 2D                ADD     A,R5
0018 F582              MOV     DPL,A
001A 74FF              MOV     A,#HIGH sata+0C0H
001C 3C                ADDC    A,R4
001D F583              MOV     DPH,A
001F E0                MOVX    A,@DPTR
0020 FE                MOV     R6,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 138 

0021 C3                CLR     C
0022 7405              MOV     A,#05H
0024 9F                SUBB    A,R7
0025 2400        R     ADD     A,#LOW g_lba
0027 F8                MOV     R0,A
0028 E6                MOV     A,@R0
0029 FD                MOV     R5,A
002A D3                SETB    C
002B 9E                SUBB    A,R6
002C 4003              JC      ?C0581
002E 7F01              MOV     R7,#01H
0030 22                RET     
0031         ?C0581:
                                           ; SOURCE LINE # 325
0031 7800        R     MOV     R0,#LOW i
0033 E6                MOV     A,@R0
0034 FF                MOV     R7,A
0035 C3                CLR     C
0036 7405              MOV     A,#05H
0038 9F                SUBB    A,R7
0039 FF                MOV     R7,A
003A E4                CLR     A
003B 9400              SUBB    A,#00H
003D FE                MOV     R6,A
003E 74C0              MOV     A,#LOW sata+0C0H
0040 2F                ADD     A,R7
0041 F582              MOV     DPL,A
0043 74FF              MOV     A,#HIGH sata+0C0H
0045 3E                ADDC    A,R6
0046 F583              MOV     DPH,A
0048 E0                MOVX    A,@DPTR
0049 FF                MOV     R7,A
004A ED                MOV     A,R5
004B C3                CLR     C
004C 9F                SUBB    A,R7
004D 5003              JNC     ?C0580
004F 7F00              MOV     R7,#00H
0051 22                RET     
                                           ; SOURCE LINE # 326
0052         ?C0580:
0052 7800        R     MOV     R0,#LOW i
0054 06                INC     @R0
0055 E6                MOV     A,@R0
0056 B406AE            CJNE    A,#06H,?C0578
0059         ?C0579:
                                           ; SOURCE LINE # 327
0059 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 328
005B         ?C0582:
005B 22                RET     
             ; FUNCTION trim_check_lba (END)

             ; FUNCTION L?1063 (BEGIN)
0000 C200        R     CLR     g_security_frozen
0002         L?1064:
0002 7B01              MOV     R3,#01H
0004 7D01              MOV     R5,#01H
0006 7FAA              MOV     R7,#0AAH
0008 7E00              MOV     R6,#00H
             ; FUNCTION _security_update_id (BEGIN)
                                           ; SOURCE LINE # 13
000A 8E00        R     MOV     base_addr,R6
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 139 

000C 8F00        R     MOV     base_addr+01H,R7
;---- Variable 'which' assigned to Register 'R5' ----
;---- Variable 'zro' assigned to Register 'R3' ----
                                           ; SOURCE LINE # 14
                                           ; SOURCE LINE # 15
000E E4                CLR     A
000F 2F                ADD     A,R7
0010 F582              MOV     DPL,A
0012 747A              MOV     A,#07AH
0014 3E                ADDC    A,R6
0015 F583              MOV     DPH,A
0017 E4                CLR     A
0018 93                MOVC    A,@A+DPTR
0019 7800        R     MOV     R0,#LOW temp_id
001B F6                MOV     @R0,A
                                           ; SOURCE LINE # 16
001C EB                MOV     A,R3
001D 7011              JNZ     ?C0584
001F 04                INC     A
0020 A805              MOV     R0,AR5
0022 08                INC     R0
0023 8002              SJMP    ?C0936
0025         ?C0935:
0025 C3                CLR     C
0026 33                RLC     A
0027         ?C0936:
0027 D8FC              DJNZ    R0,?C0935
0029 F4                CPL     A
002A 7800        R     MOV     R0,#LOW temp_id
002C 56                ANL     A,@R0
002D F6                MOV     @R0,A
002E 8011              SJMP    ?C0585
0030         ?C0584:
                                           ; SOURCE LINE # 17
0030 AF05              MOV     R7,AR5
0032 7401              MOV     A,#01H
0034 A807              MOV     R0,AR7
0036 08                INC     R0
0037 8002              SJMP    ?C0938
0039         ?C0937:
0039 C3                CLR     C
003A 33                RLC     A
003B         ?C0938:
003B D8FC              DJNZ    R0,?C0937
003D 7800        R     MOV     R0,#LOW temp_id
003F 46                ORL     A,@R0
0040 F6                MOV     @R0,A
0041         ?C0585:
                                           ; SOURCE LINE # 18
0041 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 19
0044 7800        R     MOV     R0,#LOW temp_id
0046 E6                MOV     A,@R0
0047 FF                MOV     R7,A
0048 E4                CLR     A
0049 2500        R     ADD     A,base_addr+01H
004B FD                MOV     R5,A
004C E500        R     MOV     A,base_addr
004E 347A              ADDC    A,#07AH
0050 8D82              MOV     DPL,R5
0052 F583              MOV     DPH,A
0054 EF                MOV     A,R7
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 140 

0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 20
0056 5387EF            ANL     TS8052_PCON,#0EFH
                                           ; SOURCE LINE # 21
0059 22                RET     
             ; FUNCTION _security_update_id (END)

             ; FUNCTION security_set_pwd (BEGIN)
                                           ; SOURCE LINE # 25
                                           ; SOURCE LINE # 26
                                           ; SOURCE LINE # 27
0000 120000      R     LCALL   L?1057
                                           ; SOURCE LINE # 28
0003 120000      R     LCALL   L?1070
                                           ; SOURCE LINE # 29
0006 30EA0B            JNB     sata_burst_abort,?C0587
                                           ; SOURCE LINE # 30
                                           ; SOURCE LINE # 31
0009 D200        R     SETB    g_security_abort
                                           ; SOURCE LINE # 33
000B 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 35
000E 120000      R     LCALL   L?1053
                                           ; SOURCE LINE # 36
0011 020000      R     LJMP    reset_engine
                                           ; SOURCE LINE # 39
0014         ?C0587:
                                           ; SOURCE LINE # 41
0014 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 42
0017 E4                CLR     A
0018 F5F2              MOV     SFR_ext_sram_addr+01H,A
001A F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 43
001C 7800        R     MOV     R0,#LOW temp_data0
001E A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 44
0020 08                INC     R0
0021 A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 45
0023 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 46
0025 18                DEC     R0
0026 E6                MOV     A,@R0
0027 30E05F            JNB     ACC.0,?C0589
                                           ; SOURCE LINE # 47
                                           ; SOURCE LINE # 48
002A 200005      R     JB      g_security_enable,?C0590
002D 750001      R     MOV     security_state_flag,#01H
0030 8003              SJMP    ?C0591
0032         ?C0590:
                                           ; SOURCE LINE # 49
0032 750005      R     MOV     security_state_flag,#05H
0035         ?C0591:
                                           ; SOURCE LINE # 50
0035 7B51              MOV     R3,#051H
0037 120000      R     LCALL   L?1050
                                           ; SOURCE LINE # 51
003A 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 52
003D 75F200            MOV     SFR_ext_sram_addr+01H,#00H
0040 75F122            MOV     SFR_ext_sram_addr,#022H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 141 

                                           ; SOURCE LINE # 53
0043 7800        R     MOV     R0,#LOW temp_data0
0045 A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 54
0047 08                INC     R0
0048 A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 55
004A 18                DEC     R0
004B E6                MOV     A,@R0
004C FF                MOV     R7,A
004D 7004              JNZ     ?C0593
004F 08                INC     R0
0050 E6                MOV     A,@R0
0051 6033              JZ      ?C0592
0053         ?C0593:
0053 EF                MOV     A,R7
0054 B4FF06            CJNE    A,#0FFH,?C0594
0057 7800        R     MOV     R0,#LOW temp_data1
0059 E6                MOV     A,@R0
005A F4                CPL     A
005B 6029              JZ      ?C0592
005D         ?C0594:
                                           ; SOURCE LINE # 56
                                           ; SOURCE LINE # 57
005D 438710            ORL     TS8052_PCON,#010H
                                           ; SOURCE LINE # 58
0060 7800        R     MOV     R0,#LOW temp_data0
0062 E6                MOV     A,@R0
0063 907AB8            MOV     DPTR,#07AB8H
0066 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 59
0067 08                INC     R0
0068 E6                MOV     A,@R0
0069 A3                INC     DPTR
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 60
006B 5387EF            ANL     TS8052_PCON,#0EFH
                                           ; SOURCE LINE # 62
006E 7B51              MOV     R3,#051H
0070 7D01              MOV     R5,#01H
0072 7F20              MOV     R7,#020H
0074 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 63
0077 E4                CLR     A
0078 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 64
007A F5F2              MOV     SFR_ext_sram_addr+01H,A
007C 75F150            MOV     SFR_ext_sram_addr,#050H
                                           ; SOURCE LINE # 65
007F 75F301            MOV     SFR_ext_sram_data,#01H
                                           ; SOURCE LINE # 66
0082 7B51              MOV     R3,#051H
                                           ; SOURCE LINE # 67
0084 803C              SJMP    ?C0982
0086         ?C0592:
                                           ; SOURCE LINE # 69
                                           ; SOURCE LINE # 70
0086 D200        R     SETB    g_security_abort
                                           ; SOURCE LINE # 72
                                           ; SOURCE LINE # 73
0088 22                RET     
0089         ?C0589:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 142 

                                           ; SOURCE LINE # 75
                                           ; SOURCE LINE # 76
0089 750005      R     MOV     security_state_flag,#05H
                                           ; SOURCE LINE # 77
008C 7B50              MOV     R3,#050H
008E 120000      R     LCALL   L?1050
                                           ; SOURCE LINE # 78
0091 7800        R     MOV     R0,#LOW temp_data1
0093 E6                MOV     A,@R0
0094 20E004            JB      ACC.0,?C0597
                                           ; SOURCE LINE # 79
                                           ; SOURCE LINE # 80
0097 C200        R     CLR     g_security_HrM
                                           ; SOURCE LINE # 81
0099 8002              SJMP    ?C0598
009B         ?C0597:
                                           ; SOURCE LINE # 83
                                           ; SOURCE LINE # 84
009B D200        R     SETB    g_security_HrM
                                           ; SOURCE LINE # 85
009D         ?C0598:
                                           ; SOURCE LINE # 86
009D 7B50              MOV     R3,#050H
009F 7D01              MOV     R5,#01H
00A1 7F20              MOV     R7,#020H
00A3 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 87
00A6 E4                CLR     A
00A7 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 88
00A9 F5F2              MOV     SFR_ext_sram_addr+01H,A
00AB 75F150            MOV     SFR_ext_sram_addr,#050H
                                           ; SOURCE LINE # 89
00AE 75F301            MOV     SFR_ext_sram_data,#01H
                                           ; SOURCE LINE # 90
00B1 F5F2              MOV     SFR_ext_sram_addr+01H,A
00B3 75F160            MOV     SFR_ext_sram_addr,#060H
                                           ; SOURCE LINE # 91
00B6 200004      R     JB      g_security_HrM,?C0599
00B9 F5F3              MOV     SFR_ext_sram_data,A
00BB 8003              SJMP    ?C0600
00BD         ?C0599:
                                           ; SOURCE LINE # 92
00BD 75F310            MOV     SFR_ext_sram_data,#010H
00C0         ?C0600:
                                           ; SOURCE LINE # 93
00C0 7B50              MOV     R3,#050H
00C2         ?C0982:
00C2 120000      R     LCALL   L?1050
                                           ; SOURCE LINE # 94
                                           ; SOURCE LINE # 96
00C5         ?C0588:
00C5 22                RET     
             ; FUNCTION security_set_pwd (END)

             ; FUNCTION security_dis_pwd (BEGIN)
                                           ; SOURCE LINE # 99
                                           ; SOURCE LINE # 100
                                           ; SOURCE LINE # 101
0000 120000      R     LCALL   L?1057
                                           ; SOURCE LINE # 102
0003 0D                INC     R5
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 143 

0004 7F80              MOV     R7,#080H
0006 120000      R     LCALL   _sata_burst
                                           ; SOURCE LINE # 103
0009 30EA0A            JNB     sata_burst_abort,?C0601
                                           ; SOURCE LINE # 104
                                           ; SOURCE LINE # 105
000C D200        R     SETB    g_security_abort
                                           ; SOURCE LINE # 107
000E 7F5B              MOV     R7,#05BH
0010 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 108
0013 020000      R     LJMP    reset_engine
                                           ; SOURCE LINE # 111
0016         ?C0601:
                                           ; SOURCE LINE # 113
0016 E4                CLR     A
0017 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 114
0019 F5F2              MOV     SFR_ext_sram_addr+01H,A
001B F5F1              MOV     SFR_ext_sram_addr,A
                                           ; SOURCE LINE # 115
001D E5F3              MOV     A,SFR_ext_sram_data
001F 5401              ANL     A,#01H
0021 7800        R     MOV     R0,#LOW temp_data0
0023 F6                MOV     @R0,A
                                           ; SOURCE LINE # 116
0024 20000F      R     JB      g_security_enable,?C0603
                                           ; SOURCE LINE # 117
                                           ; SOURCE LINE # 118
0027 E6                MOV     A,@R0
0028 7003              JNZ     ?C0604
                                           ; SOURCE LINE # 119
                                           ; SOURCE LINE # 120
002A D200        R     SETB    g_security_abort
002C 22                RET     
                                           ; SOURCE LINE # 122
002D         ?C0604:
                                           ; SOURCE LINE # 124
                                           ; SOURCE LINE # 125
002D 120000      R     LCALL   check_pwd
                                           ; SOURCE LINE # 126
0030 200021      R     JB      g_security_pass,?C0608
                                           ; SOURCE LINE # 127
                                           ; SOURCE LINE # 128
0033 D200        R     SETB    g_security_abort
0035 22                RET     
                                           ; SOURCE LINE # 130
                                           ; SOURCE LINE # 132
                                           ; SOURCE LINE # 134
                                           ; SOURCE LINE # 135
                                           ; SOURCE LINE # 136
0036         ?C0603:
                                           ; SOURCE LINE # 138
                                           ; SOURCE LINE # 139
0036 200009      R     JB      g_security_HrM,?C0609
                                           ; SOURCE LINE # 140
                                           ; SOURCE LINE # 141
0039 120000      R     LCALL   check_pwd
                                           ; SOURCE LINE # 142
003C 200015      R     JB      g_security_pass,?C0608
                                           ; SOURCE LINE # 143
                                           ; SOURCE LINE # 144
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 144 

003F D200        R     SETB    g_security_abort
0041 22                RET     
                                           ; SOURCE LINE # 146
                                           ; SOURCE LINE # 148
                                           ; SOURCE LINE # 150
                                           ; SOURCE LINE # 151
0042         ?C0609:
                                           ; SOURCE LINE # 153
                                           ; SOURCE LINE # 154
0042 7800        R     MOV     R0,#LOW temp_data0
0044 E6                MOV     A,@R0
0045 B40103            CJNE    A,#01H,?C0613
                                           ; SOURCE LINE # 155
                                           ; SOURCE LINE # 156
0048 D200        R     SETB    g_security_abort
004A 22                RET     
                                           ; SOURCE LINE # 158
004B         ?C0613:
                                           ; SOURCE LINE # 160
                                           ; SOURCE LINE # 161
004B 120000      R     LCALL   check_pwd
                                           ; SOURCE LINE # 162
004E 200003      R     JB      g_security_pass,?C0608
                                           ; SOURCE LINE # 163
                                           ; SOURCE LINE # 164
0051 D200        R     SETB    g_security_abort
0053 22                RET     
                                           ; SOURCE LINE # 166
                                           ; SOURCE LINE # 168
                                           ; SOURCE LINE # 170
                                           ; SOURCE LINE # 171
                                           ; SOURCE LINE # 172
                                           ; SOURCE LINE # 173
0054         ?C0608:
                                           ; SOURCE LINE # 174
0054 30003A      R     JNB     g_security_pass,?C0602
                                           ; SOURCE LINE # 175
                                           ; SOURCE LINE # 176
0057 E4                CLR     A
0058 FB                MOV     R3,A
0059 7D01              MOV     R5,#01H
005B 7FAA              MOV     R7,#0AAH
005D FE                MOV     R6,A
005E 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 177
0061 E4                CLR     A
0062 7D01              MOV     R5,#01H
0064 FF                MOV     R7,A
0065 0E                INC     R6
0066 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 178
0069 E4                CLR     A
006A FD                MOV     R5,A
006B 04                INC     A
006C FF                MOV     R7,A
006D 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 179
0070 C200        R     CLR     g_security_HrM
                                           ; SOURCE LINE # 181
0072 7B50              MOV     R3,#050H
0074 7D01              MOV     R5,#01H
0076 7F20              MOV     R7,#020H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 145 

0078 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 182
007B E4                CLR     A
007C F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 183
007E F5F2              MOV     SFR_ext_sram_addr+01H,A
0080 75F160            MOV     SFR_ext_sram_addr,#060H
                                           ; SOURCE LINE # 184
0083 F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 185
0085 F5F2              MOV     SFR_ext_sram_addr+01H,A
0087 75F150            MOV     SFR_ext_sram_addr,#050H
                                           ; SOURCE LINE # 186
008A F5F3              MOV     SFR_ext_sram_data,A
                                           ; SOURCE LINE # 187
008C 7B50              MOV     R3,#050H
008E 120000      R     LCALL   L?1050
                                           ; SOURCE LINE # 188
                                           ; SOURCE LINE # 191
0091         ?C0602:
0091 22                RET     
             ; FUNCTION security_dis_pwd (END)

             ; FUNCTION security_unlock (BEGIN)
                                           ; SOURCE LINE # 194
                                           ; SOURCE LINE # 195
                                           ; SOURCE LINE # 196
0000 120000      R     LCALL   L?1058
                                           ; SOURCE LINE # 197
0003 0D                INC     R5
0004 7F80              MOV     R7,#080H
0006 120000      R     LCALL   _sata_burst
                                           ; SOURCE LINE # 200
0009 30EA0A            JNB     sata_burst_abort,?C0618
                                           ; SOURCE LINE # 201
                                           ; SOURCE LINE # 202
000C D200        R     SETB    g_security_abort
                                           ; SOURCE LINE # 204
000E 7F5B              MOV     R7,#05BH
0010 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 205
0013 020000      R     LJMP    reset_engine
                                           ; SOURCE LINE # 208
0016         ?C0618:
                                           ; SOURCE LINE # 212
0016 E500        R     MOV     A,security_mode
0018 6420              XRL     A,#020H
001A 600B              JZ      ?C0621
001C E500        R     MOV     A,security_mode
001E 6410              XRL     A,#010H
0020 6005              JZ      ?C0621
0022 E500        R     MOV     A,security_mode
0024 B43004            CJNE    A,#030H,?C0620
0027         ?C0621:
                                           ; SOURCE LINE # 213
0027 D200        R     SETB    g_security_pass
0029 8003              SJMP    ?C0622
002B         ?C0620:
                                           ; SOURCE LINE # 215
002B 120000      R     LCALL   check_pwd
002E         ?C0622:
                                           ; SOURCE LINE # 217
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 146 

002E 200003      R     JB      g_security_pass,?C0623
                                           ; SOURCE LINE # 218
                                           ; SOURCE LINE # 219
0031 D200        R     SETB    g_security_abort
0033 22                RET     
                                           ; SOURCE LINE # 221
0034         ?C0623:
                                           ; SOURCE LINE # 223
                                           ; SOURCE LINE # 224
0034 E4                CLR     A
0035 FB                MOV     R3,A
0036 7D02              MOV     R5,#02H
0038 FF                MOV     R7,A
0039 7E01              MOV     R6,#01H
003B 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 230
                                           ; SOURCE LINE # 232
003E         ?C0619:
003E 22                RET     
             ; FUNCTION security_unlock (END)

             ; FUNCTION check_pwd (BEGIN)
                                           ; SOURCE LINE # 236
                                           ; SOURCE LINE # 237
                                           ; SOURCE LINE # 270
0000 C200        R     CLR     g_security_pass
                                           ; SOURCE LINE # 271
0002 75F200            MOV     SFR_ext_sram_addr+01H,#00H
0005 75F102            MOV     SFR_ext_sram_addr,#02H
                                           ; SOURCE LINE # 272
0008 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 273
000B 7800        R     MOV     R0,#LOW temp_data0
000D A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 274
000F 08                INC     R0
0010 A6F3              MOV     @R0,SFR_ext_sram_data
                                           ; SOURCE LINE # 275
0012 85F300      R     MOV     temp_data2,SFR_ext_sram_data
                                           ; SOURCE LINE # 276
0015 85F300      R     MOV     temp_data3,SFR_ext_sram_data
                                           ; SOURCE LINE # 277
0018 85F300      R     MOV     temp_data4,SFR_ext_sram_data
                                           ; SOURCE LINE # 278
001B 85F300      R     MOV     temp_data5,SFR_ext_sram_data
                                           ; SOURCE LINE # 279
001E 85F300      R     MOV     temp_data6,SFR_ext_sram_data
                                           ; SOURCE LINE # 280
0021 85F300      R     MOV     temp_data7,SFR_ext_sram_data
                                           ; SOURCE LINE # 281
0024 85F300      R     MOV     temp_data8,SFR_ext_sram_data
                                           ; SOURCE LINE # 282
0027 85F300      R     MOV     temp_data9,SFR_ext_sram_data
                                           ; SOURCE LINE # 283
002A 85F300      R     MOV     temp_data10,SFR_ext_sram_data
                                           ; SOURCE LINE # 284
002D 85F300      R     MOV     temp_data11,SFR_ext_sram_data
                                           ; SOURCE LINE # 285
0030 85F300      R     MOV     temp_data12,SFR_ext_sram_data
                                           ; SOURCE LINE # 286
0033 85F300      R     MOV     temp_data13,SFR_ext_sram_data
                                           ; SOURCE LINE # 287
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 147 

0036 85F300      R     MOV     temp_data14,SFR_ext_sram_data
                                           ; SOURCE LINE # 288
0039 85F300      R     MOV     temp_data15,SFR_ext_sram_data
                                           ; SOURCE LINE # 289
003C 85F300      R     MOV     temp_data16,SFR_ext_sram_data
                                           ; SOURCE LINE # 290
003F 85F300      R     MOV     temp_data17,SFR_ext_sram_data
                                           ; SOURCE LINE # 291
0042 85F300      R     MOV     temp_data18,SFR_ext_sram_data
                                           ; SOURCE LINE # 292
0045 85F300      R     MOV     temp_data19,SFR_ext_sram_data
                                           ; SOURCE LINE # 293
0048 85F300      R     MOV     temp_data20,SFR_ext_sram_data
                                           ; SOURCE LINE # 294
004B 85F300      R     MOV     temp_data21,SFR_ext_sram_data
                                           ; SOURCE LINE # 295
004E 85F300      R     MOV     temp_data22,SFR_ext_sram_data
                                           ; SOURCE LINE # 296
0051 85F300      R     MOV     temp_data23,SFR_ext_sram_data
                                           ; SOURCE LINE # 297
0054 85F300      R     MOV     temp_data24,SFR_ext_sram_data
                                           ; SOURCE LINE # 298
0057 85F300      R     MOV     temp_data25,SFR_ext_sram_data
                                           ; SOURCE LINE # 299
005A 85F300      R     MOV     temp_data26,SFR_ext_sram_data
                                           ; SOURCE LINE # 300
005D 85F300      R     MOV     temp_data27,SFR_ext_sram_data
                                           ; SOURCE LINE # 301
0060 85F300      R     MOV     temp_data28,SFR_ext_sram_data
                                           ; SOURCE LINE # 302
0063 85F300      R     MOV     temp_data29,SFR_ext_sram_data
                                           ; SOURCE LINE # 303
0066 85F300      R     MOV     temp_data30,SFR_ext_sram_data
                                           ; SOURCE LINE # 304
0069 85F300      R     MOV     temp_data31,SFR_ext_sram_data
                                           ; SOURCE LINE # 305
006C E4                CLR     A
006D F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 309
006F 7B50              MOV     R3,#050H
0071 7D01              MOV     R5,#01H
0073 7F20              MOV     R7,#020H
0075 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 312
0078 75F200            MOV     SFR_ext_sram_addr+01H,#00H
007B 75F102            MOV     SFR_ext_sram_addr,#02H
                                           ; SOURCE LINE # 313
007E 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 315
0081 7800        R     MOV     R0,#LOW temp_data0
0083 E6                MOV     A,@R0
0084 65F3              XRL     A,SFR_ext_sram_data
0086 6003              JZ      $ + 5H
0088 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 316
008B 08                INC     R0
008C E6                MOV     A,@R0
008D 65F3              XRL     A,SFR_ext_sram_data
008F 6003              JZ      $ + 5H
0091 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 317
0094 E500        R     MOV     A,temp_data2
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 148 

0096 65F3              XRL     A,SFR_ext_sram_data
0098 6003              JZ      $ + 5H
009A 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 318
009D E500        R     MOV     A,temp_data3
009F 65F3              XRL     A,SFR_ext_sram_data
00A1 6003              JZ      $ + 5H
00A3 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 319
00A6 E500        R     MOV     A,temp_data4
00A8 65F3              XRL     A,SFR_ext_sram_data
00AA 6003              JZ      $ + 5H
00AC 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 320
00AF E500        R     MOV     A,temp_data5
00B1 65F3              XRL     A,SFR_ext_sram_data
00B3 6003              JZ      $ + 5H
00B5 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 321
00B8 E500        R     MOV     A,temp_data6
00BA 65F3              XRL     A,SFR_ext_sram_data
00BC 6003              JZ      $ + 5H
00BE 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 322
00C1 E500        R     MOV     A,temp_data7
00C3 65F3              XRL     A,SFR_ext_sram_data
00C5 6003              JZ      $ + 5H
00C7 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 323
00CA E500        R     MOV     A,temp_data8
00CC 65F3              XRL     A,SFR_ext_sram_data
00CE 6003              JZ      $ + 5H
00D0 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 324
00D3 E500        R     MOV     A,temp_data9
00D5 65F3              XRL     A,SFR_ext_sram_data
00D7 6003              JZ      $ + 5H
00D9 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 325
00DC E500        R     MOV     A,temp_data10
00DE 65F3              XRL     A,SFR_ext_sram_data
00E0 6003              JZ      $ + 5H
00E2 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 326
00E5 E500        R     MOV     A,temp_data11
00E7 65F3              XRL     A,SFR_ext_sram_data
00E9 6003              JZ      $ + 5H
00EB 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 327
00EE E500        R     MOV     A,temp_data12
00F0 65F3              XRL     A,SFR_ext_sram_data
00F2 6003              JZ      $ + 5H
00F4 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 328
00F7 E500        R     MOV     A,temp_data13
00F9 65F3              XRL     A,SFR_ext_sram_data
00FB 6003              JZ      $ + 5H
00FD 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 329
0100 E500        R     MOV     A,temp_data14
0102 65F3              XRL     A,SFR_ext_sram_data
0104 6003              JZ      $ + 5H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 149 

0106 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 330
0109 E500        R     MOV     A,temp_data15
010B 65F3              XRL     A,SFR_ext_sram_data
010D 6003              JZ      $ + 5H
010F 020000      R     LJMP    ?C0625
                                           ; SOURCE LINE # 331
0112 E500        R     MOV     A,temp_data16
0114 65F3              XRL     A,SFR_ext_sram_data
0116 707A              JNZ     ?C0625
                                           ; SOURCE LINE # 332
0118 E500        R     MOV     A,temp_data17
011A 65F3              XRL     A,SFR_ext_sram_data
011C 7074              JNZ     ?C0625
                                           ; SOURCE LINE # 333
011E E500        R     MOV     A,temp_data18
0120 65F3              XRL     A,SFR_ext_sram_data
0122 706E              JNZ     ?C0625
                                           ; SOURCE LINE # 334
0124 E500        R     MOV     A,temp_data19
0126 65F3              XRL     A,SFR_ext_sram_data
0128 7068              JNZ     ?C0625
                                           ; SOURCE LINE # 335
012A E500        R     MOV     A,temp_data20
012C 65F3              XRL     A,SFR_ext_sram_data
012E 7062              JNZ     ?C0625
                                           ; SOURCE LINE # 336
0130 E500        R     MOV     A,temp_data21
0132 65F3              XRL     A,SFR_ext_sram_data
0134 705C              JNZ     ?C0625
                                           ; SOURCE LINE # 337
0136 E500        R     MOV     A,temp_data22
0138 65F3              XRL     A,SFR_ext_sram_data
013A 7056              JNZ     ?C0625
                                           ; SOURCE LINE # 338
013C E500        R     MOV     A,temp_data23
013E 65F3              XRL     A,SFR_ext_sram_data
0140 7050              JNZ     ?C0625
                                           ; SOURCE LINE # 339
0142 E500        R     MOV     A,temp_data24
0144 65F3              XRL     A,SFR_ext_sram_data
0146 704A              JNZ     ?C0625
                                           ; SOURCE LINE # 340
0148 E500        R     MOV     A,temp_data25
014A 65F3              XRL     A,SFR_ext_sram_data
014C 7044              JNZ     ?C0625
                                           ; SOURCE LINE # 341
014E E500        R     MOV     A,temp_data26
0150 65F3              XRL     A,SFR_ext_sram_data
0152 703E              JNZ     ?C0625
                                           ; SOURCE LINE # 342
0154 E500        R     MOV     A,temp_data27
0156 65F3              XRL     A,SFR_ext_sram_data
0158 7038              JNZ     ?C0625
                                           ; SOURCE LINE # 343
015A E500        R     MOV     A,temp_data28
015C 65F3              XRL     A,SFR_ext_sram_data
015E 7032              JNZ     ?C0625
                                           ; SOURCE LINE # 344
0160 E500        R     MOV     A,temp_data29
0162 65F3              XRL     A,SFR_ext_sram_data
0164 702C              JNZ     ?C0625
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 150 

                                           ; SOURCE LINE # 345
0166 E500        R     MOV     A,temp_data30
0168 65F3              XRL     A,SFR_ext_sram_data
016A 7026              JNZ     ?C0625
                                           ; SOURCE LINE # 346
016C E500        R     MOV     A,temp_data31
016E B5F321            CJNE    A,SFR_ext_sram_data,?C0625
                                           ; SOURCE LINE # 347
                                           ; SOURCE LINE # 348
0171 D200        R     SETB    g_security_pass
                                           ; SOURCE LINE # 350
0173 E500        R     MOV     A,security_mode
0175 6420              XRL     A,#020H
0177 6019              JZ      ?C0625
0179 E500        R     MOV     A,security_mode
017B 6410              XRL     A,#010H
017D 6013              JZ      ?C0625
017F E500        R     MOV     A,security_mode
0181 6430              XRL     A,#030H
0183 600D              JZ      ?C0625
0185         ?C0657:
                                           ; SOURCE LINE # 353
                                           ; SOURCE LINE # 354
0185 E500        R     MOV     A,g_TJ_ZSD
0187 B40105            CJNE    A,#01H,?C0660
                                           ; SOURCE LINE # 355
018A 750010      R     MOV     security_mode,#010H
018D 8003              SJMP    ?C0625
018F         ?C0660:
                                           ; SOURCE LINE # 357
018F 750030      R     MOV     security_mode,#030H
                                           ; SOURCE LINE # 358
                                           ; SOURCE LINE # 359
0192         ?C0625:
                                           ; SOURCE LINE # 361
0192 300003      R     JNB     g_security_pass,$ + 6H
0195 020000      R     LJMP    check_over
0198         ?C0662:
                                           ; SOURCE LINE # 364
0198 7B51              MOV     R3,#051H
019A 7D01              MOV     R5,#01H
019C 7F20              MOV     R7,#020H
019E 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 367
01A1 75F200            MOV     SFR_ext_sram_addr+01H,#00H
01A4 75F102            MOV     SFR_ext_sram_addr,#02H
                                           ; SOURCE LINE # 368
01A7 75F410            MOV     SFR_ext_sram_cntl,#010H
                                           ; SOURCE LINE # 370
01AA 7800        R     MOV     R0,#LOW temp_data0
01AC E6                MOV     A,@R0
01AD 65F3              XRL     A,SFR_ext_sram_data
01AF 6003              JZ      $ + 5H
01B1 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 371
01B4 08                INC     R0
01B5 E6                MOV     A,@R0
01B6 65F3              XRL     A,SFR_ext_sram_data
01B8 6003              JZ      $ + 5H
01BA 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 372
01BD E500        R     MOV     A,temp_data2
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 151 

01BF 65F3              XRL     A,SFR_ext_sram_data
01C1 6003              JZ      $ + 5H
01C3 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 373
01C6 E500        R     MOV     A,temp_data3
01C8 65F3              XRL     A,SFR_ext_sram_data
01CA 6003              JZ      $ + 5H
01CC 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 374
01CF E500        R     MOV     A,temp_data4
01D1 65F3              XRL     A,SFR_ext_sram_data
01D3 6003              JZ      $ + 5H
01D5 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 375
01D8 E500        R     MOV     A,temp_data5
01DA 65F3              XRL     A,SFR_ext_sram_data
01DC 6003              JZ      $ + 5H
01DE 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 376
01E1 E500        R     MOV     A,temp_data6
01E3 65F3              XRL     A,SFR_ext_sram_data
01E5 6003              JZ      $ + 5H
01E7 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 377
01EA E500        R     MOV     A,temp_data7
01EC 65F3              XRL     A,SFR_ext_sram_data
01EE 6003              JZ      $ + 5H
01F0 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 378
01F3 E500        R     MOV     A,temp_data8
01F5 65F3              XRL     A,SFR_ext_sram_data
01F7 6003              JZ      $ + 5H
01F9 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 379
01FC E500        R     MOV     A,temp_data9
01FE 65F3              XRL     A,SFR_ext_sram_data
0200 6003              JZ      $ + 5H
0202 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 380
0205 E500        R     MOV     A,temp_data10
0207 65F3              XRL     A,SFR_ext_sram_data
0209 6003              JZ      $ + 5H
020B 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 381
020E E500        R     MOV     A,temp_data11
0210 65F3              XRL     A,SFR_ext_sram_data
0212 6003              JZ      $ + 5H
0214 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 382
0217 E500        R     MOV     A,temp_data12
0219 65F3              XRL     A,SFR_ext_sram_data
021B 6003              JZ      $ + 5H
021D 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 383
0220 E500        R     MOV     A,temp_data13
0222 65F3              XRL     A,SFR_ext_sram_data
0224 6003              JZ      $ + 5H
0226 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 384
0229 E500        R     MOV     A,temp_data14
022B 65F3              XRL     A,SFR_ext_sram_data
022D 6003              JZ      $ + 5H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 152 

022F 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 385
0232 E500        R     MOV     A,temp_data15
0234 65F3              XRL     A,SFR_ext_sram_data
0236 6003              JZ      $ + 5H
0238 020000      R     LJMP    check_over
                                           ; SOURCE LINE # 386
023B E500        R     MOV     A,temp_data16
023D 65F3              XRL     A,SFR_ext_sram_data
023F 707A              JNZ     check_over
                                           ; SOURCE LINE # 387
0241 E500        R     MOV     A,temp_data17
0243 65F3              XRL     A,SFR_ext_sram_data
0245 7074              JNZ     check_over
                                           ; SOURCE LINE # 388
0247 E500        R     MOV     A,temp_data18
0249 65F3              XRL     A,SFR_ext_sram_data
024B 706E              JNZ     check_over
                                           ; SOURCE LINE # 389
024D E500        R     MOV     A,temp_data19
024F 65F3              XRL     A,SFR_ext_sram_data
0251 7068              JNZ     check_over
                                           ; SOURCE LINE # 390
0253 E500        R     MOV     A,temp_data20
0255 65F3              XRL     A,SFR_ext_sram_data
0257 7062              JNZ     check_over
                                           ; SOURCE LINE # 391
0259 E500        R     MOV     A,temp_data21
025B 65F3              XRL     A,SFR_ext_sram_data
025D 705C              JNZ     check_over
                                           ; SOURCE LINE # 392
025F E500        R     MOV     A,temp_data22
0261 65F3              XRL     A,SFR_ext_sram_data
0263 7056              JNZ     check_over
                                           ; SOURCE LINE # 393
0265 E500        R     MOV     A,temp_data23
0267 65F3              XRL     A,SFR_ext_sram_data
0269 7050              JNZ     check_over
                                           ; SOURCE LINE # 394
026B E500        R     MOV     A,temp_data24
026D 65F3              XRL     A,SFR_ext_sram_data
026F 704A              JNZ     check_over
                                           ; SOURCE LINE # 395
0271 E500        R     MOV     A,temp_data25
0273 65F3              XRL     A,SFR_ext_sram_data
0275 7044              JNZ     check_over
                                           ; SOURCE LINE # 396
0277 E500        R     MOV     A,temp_data26
0279 65F3              XRL     A,SFR_ext_sram_data
027B 703E              JNZ     check_over
                                           ; SOURCE LINE # 397
027D E500        R     MOV     A,temp_data27
027F 65F3              XRL     A,SFR_ext_sram_data
0281 7038              JNZ     check_over
                                           ; SOURCE LINE # 398
0283 E500        R     MOV     A,temp_data28
0285 65F3              XRL     A,SFR_ext_sram_data
0287 7032              JNZ     check_over
                                           ; SOURCE LINE # 399
0289 E500        R     MOV     A,temp_data29
028B 65F3              XRL     A,SFR_ext_sram_data
028D 702C              JNZ     check_over
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 153 

                                           ; SOURCE LINE # 400
028F E500        R     MOV     A,temp_data30
0291 65F3              XRL     A,SFR_ext_sram_data
0293 7026              JNZ     check_over
                                           ; SOURCE LINE # 401
0295 E500        R     MOV     A,temp_data31
0297 B5F321            CJNE    A,SFR_ext_sram_data,check_over
                                           ; SOURCE LINE # 402
                                           ; SOURCE LINE # 403
029A D200        R     SETB    g_security_pass
                                           ; SOURCE LINE # 405
029C E500        R     MOV     A,security_mode
029E 6420              XRL     A,#020H
02A0 6019              JZ      check_over
02A2 E500        R     MOV     A,security_mode
02A4 6410              XRL     A,#010H
02A6 6013              JZ      check_over
02A8 E500        R     MOV     A,security_mode
02AA 6430              XRL     A,#030H
02AC 600D              JZ      check_over
02AE         ?C0696:
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 410
02AE E500        R     MOV     A,g_TJ_ZSD
02B0 B40105            CJNE    A,#01H,?C0699
                                           ; SOURCE LINE # 411
02B3 750020      R     MOV     security_mode,#020H
02B6 8003              SJMP    check_over
02B8         ?C0699:
                                           ; SOURCE LINE # 413
02B8 750030      R     MOV     security_erase,#030H
                                           ; SOURCE LINE # 415
                                           ; SOURCE LINE # 416
                                           ; SOURCE LINE # 418
                                           ; SOURCE LINE # 420
02BB         check_over:
                                           ; SOURCE LINE # 421
02BB E4                CLR     A
02BC F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 423
02BE         ?C0701:
02BE 22                RET     
             ; FUNCTION check_pwd (END)

             ; FUNCTION security_initial (BEGIN)
                                           ; SOURCE LINE # 426
                                           ; SOURCE LINE # 427
                                           ; SOURCE LINE # 428
0000 7B50              MOV     R3,#050H
0002 7D01              MOV     R5,#01H
0004 7F20              MOV     R7,#020H
0006 120000      R     LCALL   _chp_burst
                                           ; SOURCE LINE # 429
0009 E4                CLR     A
000A F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 431
000C F5F2              MOV     SFR_ext_sram_addr+01H,A
000E 75F160            MOV     SFR_ext_sram_addr,#060H
                                           ; SOURCE LINE # 432
0011 E5F3              MOV     A,SFR_ext_sram_data
0013 B41004            CJNE    A,#010H,?C0702
                                           ; SOURCE LINE # 433
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 154 

                                           ; SOURCE LINE # 434
0016 D200        R     SETB    g_security_HrM
                                           ; SOURCE LINE # 435
0018 8002              SJMP    ?C0703
001A         ?C0702:
                                           ; SOURCE LINE # 437
                                           ; SOURCE LINE # 438
001A C200        R     CLR     g_security_HrM
                                           ; SOURCE LINE # 439
001C         ?C0703:
                                           ; SOURCE LINE # 441
001C 75F200            MOV     SFR_ext_sram_addr+01H,#00H
001F 75F150            MOV     SFR_ext_sram_addr,#050H
                                           ; SOURCE LINE # 448
0022 E500        R     MOV     A,g_SYS_YD
0024 7002              JNZ     ?C0704
                                           ; SOURCE LINE # 449
                                           ; SOURCE LINE # 450
                                           ; SOURCE LINE # 451
0026 8020              SJMP    ?C0983
0028         ?C0704:
                                           ; SOURCE LINE # 452
0028 E500        R     MOV     A,security_mode
002A 6420              XRL     A,#020H
002C 600B              JZ      ?C0707
002E E500        R     MOV     A,security_mode
0030 6410              XRL     A,#010H
0032 6005              JZ      ?C0707
0034 E500        R     MOV     A,security_mode
0036 B43005            CJNE    A,#030H,?C0706
0039         ?C0707:
                                           ; SOURCE LINE # 453
                                           ; SOURCE LINE # 454
0039 750005      R     MOV     security_state_flag,#05H
                                           ; SOURCE LINE # 455
003C 800D              SJMP    ?C0705
003E         ?C0706:
                                           ; SOURCE LINE # 457
                                           ; SOURCE LINE # 458
003E E5F3              MOV     A,SFR_ext_sram_data
0040 B40105            CJNE    A,#01H,?C0709
                                           ; SOURCE LINE # 459
                                           ; SOURCE LINE # 460
0043 750004      R     MOV     security_state_flag,#04H
                                           ; SOURCE LINE # 461
0046 8003              SJMP    ?C0705
0048         ?C0709:
                                           ; SOURCE LINE # 463
                                           ; SOURCE LINE # 464
0048         ?C0983:
0048 750001      R     MOV     security_state_flag,#01H
                                           ; SOURCE LINE # 465
                                           ; SOURCE LINE # 466
004B         ?C0705:
                                           ; SOURCE LINE # 467
004B 120000      R     LCALL   analyze_states
                                           ; SOURCE LINE # 469
004E         ?C0711:
004E 22                RET     
             ; FUNCTION security_initial (END)

             ; FUNCTION analyze_states (BEGIN)
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 155 

                                           ; SOURCE LINE # 471
                                           ; SOURCE LINE # 472
                                           ; SOURCE LINE # 473
0000 E500        R     MOV     A,security_state_flag
0002 24FE              ADD     A,#0FEH
0004 6059              JZ      ?C0716
0006 24FE              ADD     A,#0FEH
0008 7003              JNZ     $ + 5H
000A 020000      R     LJMP    ?C0721
000D 14                DEC     A
000E 7003              JNZ     $ + 5H
0010 020000      R     LJMP    ?C0726
0013 14                DEC     A
0014 7003              JNZ     $ + 5H
0016 020000      R     LJMP    ?C0731
0019 2405              ADD     A,#05H
001B 6003              JZ      $ + 5H
001D 020000      R     LJMP    ?C0737
                                           ; SOURCE LINE # 474
                                           ; SOURCE LINE # 475
0020         ?C0713:
                                           ; SOURCE LINE # 476
                                           ; SOURCE LINE # 477
0020 C200        R     CLR     g_security_enable
                                           ; SOURCE LINE # 478
0022 C200        R     CLR     g_security_lock
                                           ; SOURCE LINE # 479
0024 C200        R     CLR     g_security_frozen
                                           ; SOURCE LINE # 481
0026 E4                CLR     A
0027 FB                MOV     R3,A
0028 7D01              MOV     R5,#01H
002A 7FAA              MOV     R7,#0AAH
002C FE                MOV     R6,A
002D 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 482
0030 E4                CLR     A
0031 7D01              MOV     R5,#01H
0033 FF                MOV     R7,A
0034 0E                INC     R6
0035 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 483
0038 E4                CLR     A
0039 7D02              MOV     R5,#02H
003B FF                MOV     R7,A
003C 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 484
003F E4                CLR     A
0040 7D03              MOV     R5,#03H
0042 FF                MOV     R7,A
0043 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 485
0046 200006      R     JB      g_security_cnt_expired,?C0714
0049 E4                CLR     A
004A 7D04              MOV     R5,#04H
004C FF                MOV     R7,A
004D 8008              SJMP    ?C0988
004F         ?C0714:
                                           ; SOURCE LINE # 486
004F 7B01              MOV     R3,#01H
0051 7D04              MOV     R5,#04H
0053 7F00              MOV     R7,#00H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 156 

0055 7E01              MOV     R6,#01H
0057         ?C0988:
0057 120000      R     LCALL   _security_update_id
005A         ?C0715:
                                           ; SOURCE LINE # 487
005A E4                CLR     A
005B FB                MOV     R3,A
                                           ; SOURCE LINE # 488
005C 020000      R     LJMP    ?C0995
                                           ; SOURCE LINE # 489
                                           ; SOURCE LINE # 491
005F         ?C0716:
                                           ; SOURCE LINE # 492
                                           ; SOURCE LINE # 493
005F C200        R     CLR     g_security_enable
                                           ; SOURCE LINE # 494
0061 C200        R     CLR     g_security_lock
                                           ; SOURCE LINE # 495
0063 D200        R     SETB    g_security_frozen
                                           ; SOURCE LINE # 497
0065 E4                CLR     A
0066 FB                MOV     R3,A
0067 7D01              MOV     R5,#01H
0069 7FAA              MOV     R7,#0AAH
006B FE                MOV     R6,A
006C 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 498
006F E4                CLR     A
0070 7D01              MOV     R5,#01H
0072 FF                MOV     R7,A
0073 0E                INC     R6
0074 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 499
0077 E4                CLR     A
0078 7D02              MOV     R5,#02H
007A FF                MOV     R7,A
007B 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 500
007E 0B                INC     R3
007F 7D03              MOV     R5,#03H
0081 7F00              MOV     R7,#00H
0083 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 501
0086 200007      R     JB      g_security_cnt_expired,?C0717
0089 E4                CLR     A
008A 1B                DEC     R3
008B 7D04              MOV     R5,#04H
008D FF                MOV     R7,A
008E 8008              SJMP    ?C0990
0090         ?C0717:
                                           ; SOURCE LINE # 502
0090 7B01              MOV     R3,#01H
0092 7D04              MOV     R5,#04H
0094 7F00              MOV     R7,#00H
0096 7E01              MOV     R6,#01H
0098         ?C0990:
0098 120000      R     LCALL   _security_update_id
009B         ?C0718:
                                           ; SOURCE LINE # 503
009B 200004      R     JB      g_security_HrM,?C0719
009E E4                CLR     A
009F FB                MOV     R3,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 157 

00A0 8003              SJMP    ?C0984
00A2         ?C0719:
                                           ; SOURCE LINE # 504
00A2 7B01              MOV     R3,#01H
00A4 E4                CLR     A
00A5         ?C0984:
00A5         ?C0989:
                                           ; SOURCE LINE # 505
00A5 020000      R     LJMP    ?C0995
                                           ; SOURCE LINE # 506
                                           ; SOURCE LINE # 508
00A8         ?C0721:
                                           ; SOURCE LINE # 509
                                           ; SOURCE LINE # 510
00A8 D200        R     SETB    g_security_enable
                                           ; SOURCE LINE # 511
00AA D200        R     SETB    g_security_lock
                                           ; SOURCE LINE # 512
                                           ; SOURCE LINE # 514
00AC 120000      R     LCALL   L?1063
                                           ; SOURCE LINE # 515
00AF 7D01              MOV     R5,#01H
00B1 7F00              MOV     R7,#00H
00B3 0E                INC     R6
00B4 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 516
00B7 7D02              MOV     R5,#02H
00B9 7F00              MOV     R7,#00H
00BB 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 517
00BE E4                CLR     A
00BF 1B                DEC     R3
00C0 7D03              MOV     R5,#03H
00C2 FF                MOV     R7,A
00C3 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 518
00C6 200006      R     JB      g_security_cnt_expired,?C0722
00C9 E4                CLR     A
00CA 7D04              MOV     R5,#04H
00CC FF                MOV     R7,A
00CD 8008              SJMP    ?C0992
00CF         ?C0722:
                                           ; SOURCE LINE # 519
00CF 7B01              MOV     R3,#01H
00D1 7D04              MOV     R5,#04H
00D3 7F00              MOV     R7,#00H
00D5 7E01              MOV     R6,#01H
00D7         ?C0992:
00D7 120000      R     LCALL   _security_update_id
00DA         ?C0723:
                                           ; SOURCE LINE # 520
00DA 200004      R     JB      g_security_HrM,?C0724
00DD E4                CLR     A
00DE FB                MOV     R3,A
00DF 8003              SJMP    ?C0985
00E1         ?C0724:
                                           ; SOURCE LINE # 521
00E1 7B01              MOV     R3,#01H
00E3 E4                CLR     A
00E4         ?C0985:
00E4         ?C0991:
                                           ; SOURCE LINE # 522
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 158 

00E4 020000      R     LJMP    ?C0995
                                           ; SOURCE LINE # 523
                                           ; SOURCE LINE # 525
00E7         ?C0726:
                                           ; SOURCE LINE # 526
                                           ; SOURCE LINE # 527
00E7 D200        R     SETB    g_security_enable
                                           ; SOURCE LINE # 528
00E9 C200        R     CLR     g_security_lock
                                           ; SOURCE LINE # 529
                                           ; SOURCE LINE # 531
00EB 120000      R     LCALL   L?1063
                                           ; SOURCE LINE # 532
00EE 7D01              MOV     R5,#01H
00F0 7F00              MOV     R7,#00H
00F2 0E                INC     R6
00F3 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 533
00F6 E4                CLR     A
00F7 1B                DEC     R3
00F8 7D02              MOV     R5,#02H
00FA FF                MOV     R7,A
00FB 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 534
00FE E4                CLR     A
00FF 7D03              MOV     R5,#03H
0101 FF                MOV     R7,A
0102 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 535
0105 200006      R     JB      g_security_cnt_expired,?C0727
0108 E4                CLR     A
0109 7D04              MOV     R5,#04H
010B FF                MOV     R7,A
010C 8008              SJMP    ?C0994
010E         ?C0727:
                                           ; SOURCE LINE # 536
010E 7B01              MOV     R3,#01H
0110 7D04              MOV     R5,#04H
0112 7F00              MOV     R7,#00H
0114 7E01              MOV     R6,#01H
0116         ?C0994:
0116 120000      R     LCALL   _security_update_id
0119         ?C0728:
                                           ; SOURCE LINE # 537
0119 200004      R     JB      g_security_HrM,?C0729
011C E4                CLR     A
011D FB                MOV     R3,A
011E 8003              SJMP    ?C0986
0120         ?C0729:
                                           ; SOURCE LINE # 538
0120 7B01              MOV     R3,#01H
0122 E4                CLR     A
0123         ?C0986:
0123         ?C0993:
                                           ; SOURCE LINE # 539
0123 803E              SJMP    ?C0995
                                           ; SOURCE LINE # 540
                                           ; SOURCE LINE # 542
0125         ?C0731:
                                           ; SOURCE LINE # 543
                                           ; SOURCE LINE # 544
0125 D200        R     SETB    g_security_enable
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 159 

                                           ; SOURCE LINE # 545
0127 C200        R     CLR     g_security_lock
                                           ; SOURCE LINE # 546
0129 D200        R     SETB    g_security_frozen
                                           ; SOURCE LINE # 548
012B 120000      R     LCALL   L?1064
                                           ; SOURCE LINE # 549
012E 7D01              MOV     R5,#01H
0130 7F00              MOV     R7,#00H
0132 0E                INC     R6
0133 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 550
0136 E4                CLR     A
0137 1B                DEC     R3
0138 7D02              MOV     R5,#02H
013A FF                MOV     R7,A
013B 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 551
013E E4                CLR     A
013F 7D03              MOV     R5,#03H
0141 FF                MOV     R7,A
0142 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 552
0145 200006      R     JB      g_security_cnt_expired,?C0732
0148 E4                CLR     A
0149 7D04              MOV     R5,#04H
014B FF                MOV     R7,A
014C 8008              SJMP    ?C0996
014E         ?C0732:
                                           ; SOURCE LINE # 553
014E 7B01              MOV     R3,#01H
0150 7D04              MOV     R5,#04H
0152 7F00              MOV     R7,#00H
0154 7E01              MOV     R6,#01H
0156         ?C0996:
0156 120000      R     LCALL   _security_update_id
0159         ?C0733:
                                           ; SOURCE LINE # 554
0159 200004      R     JB      g_security_HrM,?C0734
015C E4                CLR     A
015D FB                MOV     R3,A
015E 8003              SJMP    ?C0987
0160         ?C0734:
                                           ; SOURCE LINE # 555
0160 7B01              MOV     R3,#01H
0162 E4                CLR     A
0163         ?C0987:
0163         ?C0995:
0163 FD                MOV     R5,A
0164 04                INC     A
0165 FF                MOV     R7,A
0166 FE                MOV     R6,A
0167 120000      R     LCALL   _security_update_id
                                           ; SOURCE LINE # 556
                                           ; SOURCE LINE # 557
                                           ; SOURCE LINE # 558
                                           ; SOURCE LINE # 559
                                           ; SOURCE LINE # 560
016A         ?C0737:
016A 22                RET     
             ; FUNCTION analyze_states (END)

C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 160 

             ; FUNCTION choose_lba (BEGIN)
                                           ; SOURCE LINE # 625
                                           ; SOURCE LINE # 626
                                           ; SOURCE LINE # 628
0000 E500        R     MOV     A,security_mode
0002 B42026            CJNE    A,#020H,?C0739
                                           ; SOURCE LINE # 629
0005 E4                CLR     A
0006 90FF57            MOV     DPTR,#sata+057H
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 630
000A 90FF7B            MOV     DPTR,#sata+07BH
000D E0                MOVX    A,@DPTR
000E FF                MOV     R7,A
;---- Variable 'temp_lba' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 631
000F 90FF7A            MOV     DPTR,#sata+07AH
0012 E0                MOVX    A,@DPTR
0013 FE                MOV     R6,A
;---- Variable 'temp_lba2' assigned to Register 'R6' ----
                                           ; SOURCE LINE # 632
0014 907FBC            MOV     DPTR,#07FBCH
0017 E4                CLR     A
0018 93                MOVC    A,@A+DPTR
0019 90FF57            MOV     DPTR,#sata+057H
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 634
001D EF                MOV     A,R7
001E 2408              ADD     A,#08H
0020 90FF7B            MOV     DPTR,#sata+07BH
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 635
0024 EE                MOV     A,R6
0025 24C0              ADD     A,#0C0H
0027 90FF7A            MOV     DPTR,#sata+07AH
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 644
                                           ; SOURCE LINE # 646
002B         ?C0739:
002B 22                RET     
             ; FUNCTION choose_lba (END)

             ; FUNCTION GPIO_security_init (BEGIN)
                                           ; SOURCE LINE # 650
                                           ; SOURCE LINE # 651
                                           ; SOURCE LINE # 652
0000 43ABE0            ORL     SFR_spi_set,#0E0H
                                           ; SOURCE LINE # 653
0003 120000      R     LCALL   L?1068
                                           ; SOURCE LINE # 654
0006 750001      R     MOV     g_TJ_ZSD,#01H
                                           ; SOURCE LINE # 655
0009 750001      R     MOV     g_SYS_YD,#01H
                                           ; SOURCE LINE # 656
000C 22                RET     
             ; FUNCTION GPIO_security_init (END)

             ; FUNCTION _GPIO_security_cmd (BEGIN)
                                           ; SOURCE LINE # 679
;---- Variable 'mode' assigned to Register 'R1' ----
0000 A907              MOV     R1,AR7
                                           ; SOURCE LINE # 680
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 161 

                                           ; SOURCE LINE # 683
;---- Variable 'tmp_value' assigned to Register 'R7' ----
0002 AFAC              MOV     R7,SFR_spi_io
                                           ; SOURCE LINE # 684
0004 EF                MOV     A,R7
0005 540F              ANL     A,#0FH
0007 B50001      R     CJNE    A,GPIO_old_value,?C0741
000A 22                RET     
000B         ?C0741:
                                           ; SOURCE LINE # 687
000B 8F00        R     MOV     GPIO_old_value,R7
000D         ?C0743:
                                           ; SOURCE LINE # 690
000D EF                MOV     A,R7
000E 540F              ANL     A,#0FH
0010 FE                MOV     R6,A
0011 BE0F01            CJNE    R6,#0FH,?C0744
0014         ?C0997:
0014 22                RET     
0015         ?C0744:
                                           ; SOURCE LINE # 693
                                           ; SOURCE LINE # 694
0015 120000      R     LCALL   L?1068
                                           ; SOURCE LINE # 695
0018 AFAC              MOV     R7,SFR_spi_io
                                           ; SOURCE LINE # 696
001A EF                MOV     A,R7
001B 540F              ANL     A,#0FH
001D FE                MOV     R6,A
001E BE0F01            CJNE    R6,#0FH,?C0746
0021         ?C0998:
0021 22                RET     
0022         ?C0746:
                                           ; SOURCE LINE # 699
                                           ; SOURCE LINE # 700
0022 AF06              MOV     R7,AR6
                                           ; SOURCE LINE # 702
0024 EF                MOV     A,R7
0025 7003              JNZ     $ + 5H
0027 020000      R     LJMP    ?C0770
002A 14                DEC     A
002B 7003              JNZ     $ + 5H
002D 020000      R     LJMP    ?C0761
0030 14                DEC     A
0031 7003              JNZ     $ + 5H
0033 020000      R     LJMP    ?C0764
0036 14                DEC     A
0037 604E              JZ      ?C0755
0039 24FD              ADD     A,#0FDH
003B 7003              JNZ     $ + 5H
003D 020000      R     LJMP    ?C0771
0040 24FE              ADD     A,#0FEH
0042 606F              JZ      ?C0762
0044 24FC              ADD     A,#0FCH
0046 606F              JZ      ?C0763
0048 2407              ADD     A,#07H
004A 6003              JZ      $ + 5H
004C 020000      R     LJMP    ?C0742
                                           ; SOURCE LINE # 703
                                           ; SOURCE LINE # 704
004F         ?C0749:
                                           ; SOURCE LINE # 705
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 162 

004F E500        R     MOV     A,g_SYS_YD
0051 B4011B            CJNE    A,#01H,?C0750
0054 E500        R     MOV     A,security_mode
0056 6420              XRL     A,#020H
0058 7003              JNZ     $ + 5H
005A 020000      R     LJMP    ?C0742
005D E500        R     MOV     A,security_mode
005F 6410              XRL     A,#010H
0061 7003              JNZ     $ + 5H
0063 020000      R     LJMP    ?C0742
0066 E500        R     MOV     A,security_mode
0068 6430              XRL     A,#030H
006A 7003              JNZ     $ + 5H
006C 020000      R     LJMP    ?C0742
006F         ?C0750:
                                           ; SOURCE LINE # 706
006F E9                MOV     A,R1
0070 6401              XRL     A,#01H
0072 6003              JZ      $ + 5H
0074 020000      R     LJMP    ?C0742
                                           ; SOURCE LINE # 707
                                           ; SOURCE LINE # 708
0077 750020      R     MOV     security_mode,#020H
                                           ; SOURCE LINE # 710
007A 300030      R     JNB     g_security_enable,?C0999
007D E500        R     MOV     A,g_SYS_YD
007F 6003              JZ      $ + 5H
0081 020000      R     LJMP    ?C0742
0084         ?C0754:
                                           ; SOURCE LINE # 711
                                           ; SOURCE LINE # 712
                                           ; SOURCE LINE # 713
0084 020000      R     LJMP    ?C1002
                                           ; SOURCE LINE # 715
0087         ?C0755:
                                           ; SOURCE LINE # 716
0087 E500        R     MOV     A,g_SYS_YD
0089 B40112            CJNE    A,#01H,?C0756
008C E500        R     MOV     A,security_mode
008E 6420              XRL     A,#020H
0090 607A              JZ      ?C0742
0092 E500        R     MOV     A,security_mode
0094 6410              XRL     A,#010H
0096 6074              JZ      ?C0742
0098 E500        R     MOV     A,security_mode
009A 6430              XRL     A,#030H
009C 606E              JZ      ?C0742
009E         ?C0756:
                                           ; SOURCE LINE # 717
009E E9                MOV     A,R1
009F 6401              XRL     A,#01H
00A1 7069              JNZ     ?C0742
                                           ; SOURCE LINE # 718
                                           ; SOURCE LINE # 719
00A3 750010      R     MOV     security_mode,#010H
                                           ; SOURCE LINE # 721
00A6 300004      R     JNB     g_security_enable,?C0760
00A9 E500        R     MOV     A,g_SYS_YD
00AB 705F              JNZ     ?C0742
00AD         ?C0760:
                                           ; SOURCE LINE # 722
00AD         ?C0999:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 163 

                                           ; SOURCE LINE # 723
                                           ; SOURCE LINE # 724
00AD 805A              SJMP    ?C1002
                                           ; SOURCE LINE # 726
00AF         ?C0761:
                                           ; SOURCE LINE # 727
00AF 750010      R     MOV     security_erase,#010H
                                           ; SOURCE LINE # 728
00B2 22                RET     
                                           ; SOURCE LINE # 729
00B3         ?C0762:
                                           ; SOURCE LINE # 730
00B3 750020      R     MOV     security_erase,#020H
                                           ; SOURCE LINE # 731
00B6 22                RET     
                                           ; SOURCE LINE # 732
00B7         ?C0763:
                                           ; SOURCE LINE # 734
                                           ; SOURCE LINE # 735
00B7 8028              SJMP    ?C1001
                                           ; SOURCE LINE # 736
00B9         ?C0764:
                                           ; SOURCE LINE # 737
00B9 E500        R     MOV     A,g_SYS_YD
00BB B40112            CJNE    A,#01H,?C0765
00BE E500        R     MOV     A,security_mode
00C0 6420              XRL     A,#020H
00C2 6048              JZ      ?C0742
00C4 E500        R     MOV     A,security_mode
00C6 6410              XRL     A,#010H
00C8 6042              JZ      ?C0742
00CA E500        R     MOV     A,security_mode
00CC 6430              XRL     A,#030H
00CE 603C              JZ      ?C0742
00D0         ?C0765:
                                           ; SOURCE LINE # 738
00D0 E9                MOV     A,R1
00D1 6401              XRL     A,#01H
00D3 7037              JNZ     ?C0742
                                           ; SOURCE LINE # 739
                                           ; SOURCE LINE # 740
00D5 750030      R     MOV     security_mode,#030H
                                           ; SOURCE LINE # 742
00D8 300004      R     JNB     g_security_enable,?C0769
00DB E500        R     MOV     A,g_SYS_YD
00DD 702D              JNZ     ?C0742
00DF         ?C0769:
                                           ; SOURCE LINE # 743
00DF         ?C1000:
                                           ; SOURCE LINE # 745
                                           ; SOURCE LINE # 746
00DF 8028              SJMP    ?C1002
                                           ; SOURCE LINE # 748
00E1         ?C0770:
                                           ; SOURCE LINE # 749
00E1         ?C1001:
00E1 750030      R     MOV     security_erase,#030H
                                           ; SOURCE LINE # 751
00E4 22                RET     
                                           ; SOURCE LINE # 753
00E5         ?C0771:
                                           ; SOURCE LINE # 754
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 164 

00E5 E500        R     MOV     A,g_SYS_YD
00E7 B40112            CJNE    A,#01H,?C0772
00EA E500        R     MOV     A,security_mode
00EC 6420              XRL     A,#020H
00EE 601C              JZ      ?C0742
00F0 E500        R     MOV     A,security_mode
00F2 6410              XRL     A,#010H
00F4 6016              JZ      ?C0742
00F6 E500        R     MOV     A,security_mode
00F8 6430              XRL     A,#030H
00FA 6010              JZ      ?C0742
00FC         ?C0772:
                                           ; SOURCE LINE # 755
00FC B9010D            CJNE    R1,#01H,?C0742
                                           ; SOURCE LINE # 756
                                           ; SOURCE LINE # 757
00FF 750030      R     MOV     security_mode,#030H
                                           ; SOURCE LINE # 759
0102 300004      R     JNB     g_security_enable,?C0776
0105 E500        R     MOV     A,g_SYS_YD
0107 7003              JNZ     ?C0742
0109         ?C0776:
                                           ; SOURCE LINE # 760
0109         ?C1002:
0109 750001      R     MOV     uart_show,#01H
                                           ; SOURCE LINE # 762
                                           ; SOURCE LINE # 763
                                           ; SOURCE LINE # 765
                                           ; SOURCE LINE # 767
                                           ; SOURCE LINE # 768
                                           ; SOURCE LINE # 770
                                           ; SOURCE LINE # 772
                                           ; SOURCE LINE # 773
                                           ; SOURCE LINE # 774
                                           ; SOURCE LINE # 775
010C         ?C0742:
010C 22                RET     
             ; FUNCTION _GPIO_security_cmd (END)

             ; FUNCTION L?1071 (BEGIN)
0000         L?1072:
0000 7D01              MOV     R5,#01H
0002 7F4E              MOV     R7,#04EH
             ; FUNCTION _security_cmd_info_write (BEGIN)
                                           ; SOURCE LINE # 780
;---- Variable 'addr' assigned to Register 'R5' ----
;---- Variable 'value' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 781
                                           ; SOURCE LINE # 782
0004 E4                CLR     A
0005 F5F4              MOV     SFR_ext_sram_cntl,A
                                           ; SOURCE LINE # 783
0007 75F200            MOV     SFR_ext_sram_addr+01H,#00H
000A 8DF1              MOV     SFR_ext_sram_addr,R5
                                           ; SOURCE LINE # 784
000C 8FF3              MOV     SFR_ext_sram_data,R7
                                           ; SOURCE LINE # 785
000E 7B53              MOV     R3,#053H
0010 7D01              MOV     R5,#01H
0012 7F30              MOV     R7,#030H
0014 020000      R     LJMP    _chp_burst
             ; FUNCTION _security_cmd_info_write (END)
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 165 


             ; FUNCTION main (BEGIN)
                                           ; SOURCE LINE # 32
                                           ; SOURCE LINE # 33
                                           ; SOURCE LINE # 34
0000 E4                CLR     A
0001 FF                MOV     R7,A
0002 120000      R     LCALL   _init
                                           ; SOURCE LINE # 38
0005 120000      R     LCALL   GPIO_security_init
0008         ?C0780:
                                           ; SOURCE LINE # 52
                                           ; SOURCE LINE # 53
                                           ; SOURCE LINE # 58
0008 E500        R     MOV     A,security_mode
000A 6420              XRL     A,#020H
000C 6010              JZ      ?C0782
000E E500        R     MOV     A,security_mode
0010 6410              XRL     A,#010H
0012 600A              JZ      ?C0782
0014 E500        R     MOV     A,security_mode
0016 6430              XRL     A,#030H
0018 6004              JZ      ?C0782
                                           ; SOURCE LINE # 59
                                           ; SOURCE LINE # 60
001A D200        R     SETB    g_security_lock
                                           ; SOURCE LINE # 61
                                           ; SOURCE LINE # 62
001C 800B              SJMP    ?C1003
001E         ?C0782:
                                           ; SOURCE LINE # 64
                                           ; SOURCE LINE # 65
001E C200        R     CLR     g_security_lock
                                           ; SOURCE LINE # 66
0020 E500        R     MOV     A,g_SYS_YD
0022 B40104            CJNE    A,#01H,?C0784
                                           ; SOURCE LINE # 67
                                           ; SOURCE LINE # 68
0025 E4                CLR     A
0026 FF                MOV     R7,A
                                           ; SOURCE LINE # 69
0027 8002              SJMP    ?C1004
0029         ?C0784:
                                           ; SOURCE LINE # 71
                                           ; SOURCE LINE # 72
0029         ?C1003:
0029 7F01              MOV     R7,#01H
002B         ?C1004:
002B 120000      R     LCALL   _GPIO_security_cmd
                                           ; SOURCE LINE # 73
                                           ; SOURCE LINE # 74
002E         ?C0783:
                                           ; SOURCE LINE # 79
002E E500        R     MOV     A,security_erase
0030 6420              XRL     A,#020H
0032 6005              JZ      ?C0787
0034 E500        R     MOV     A,security_erase
0036 B41007            CJNE    A,#010H,?C0786
0039         ?C0787:
                                           ; SOURCE LINE # 80
                                           ; SOURCE LINE # 81
0039 120000      R     LCALL   L?1071
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 166 

                                           ; SOURCE LINE # 83
003C E4                CLR     A
003D FF                MOV     R7,A
                                           ; SOURCE LINE # 84
                                           ; SOURCE LINE # 86
003E 800A              SJMP    ?C1005
0040         ?C0786:
                                           ; SOURCE LINE # 87
0040 E500        R     MOV     A,security_erase
0042 B4300B            CJNE    A,#030H,?C0788
                                           ; SOURCE LINE # 88
                                           ; SOURCE LINE # 89
0045 120000      R     LCALL   L?1072
                                           ; SOURCE LINE # 91
0048 7F01              MOV     R7,#01H
004A         ?C1005:
004A 120000      R     LCALL   _intial_data_partition
                                           ; SOURCE LINE # 92
004D E4                CLR     A
004E F500        R     MOV     security_erase,A
                                           ; SOURCE LINE # 94
0050         ?C0788:
                                           ; SOURCE LINE # 97
0050 E500        R     MOV     A,uart_show
0052 6024              JZ      ?C0790
                                           ; SOURCE LINE # 98
                                           ; SOURCE LINE # 99
0054 E500        R     MOV     A,security_mode
0056 B42002            CJNE    A,#020H,?C0791
                                           ; SOURCE LINE # 100
                                           ; SOURCE LINE # 102
                                           ; SOURCE LINE # 103
0059 800C              SJMP    ?C1007
005B         ?C0791:
                                           ; SOURCE LINE # 104
005B E500        R     MOV     A,security_mode
005D B41002            CJNE    A,#010H,?C0793
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 107
0060         ?C1006:
                                           ; SOURCE LINE # 108
0060 8005              SJMP    ?C1007
0062         ?C0793:
                                           ; SOURCE LINE # 109
0062 E500        R     MOV     A,security_mode
0064 B43003            CJNE    A,#030H,?C0792
                                           ; SOURCE LINE # 110
                                           ; SOURCE LINE # 112
0067         ?C1007:
0067 E4                CLR     A
0068 F500        R     MOV     uart_show,A
                                           ; SOURCE LINE # 113
006A         ?C0792:
                                           ; SOURCE LINE # 114
006A 7BFF              MOV     R3,#0FFH
006C E4                CLR     A
006D FD                MOV     R5,A
006E 7F50              MOV     R7,#050H
0070 120000      R     LCALL   _tx_fis_A1
                                           ; SOURCE LINE # 116
0073 7F01              MOV     R7,#01H
0075 120000      R     LCALL   _init
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 167 

                                           ; SOURCE LINE # 117
0078         ?C0790:
                                           ; SOURCE LINE # 131
0078 7800        R     MOV     R0,#LOW g_current_fis_num
007A E6                MOV     A,@R0
007B 659F              XRL     A,SFR_fis_num
007D 7003              JNZ     $ + 5H
007F 020000      R     LJMP    ?C0887
                                           ; SOURCE LINE # 132
                                           ; SOURCE LINE # 134
0082 90FFF0            MOV     DPTR,#sata+0F0H
0085 7444              MOV     A,#044H
0087 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 139
0088 A69F              MOV     @R0,SFR_fis_num
                                           ; SOURCE LINE # 142
008A 90FF1E            MOV     DPTR,#sata+01EH
008D E0                MOVX    A,@DPTR
008E 54FD              ANL     A,#0FDH
0090 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 160
0091 120000      R     LCALL   chp_clock_on
                                           ; SOURCE LINE # 163
0094 30000C      R     JNB     g_smart_power_down_flag,?C0797
                                           ; SOURCE LINE # 164
                                           ; SOURCE LINE # 165
0097 7D01              MOV     R5,#01H
0099 7F1F              MOV     R7,#01FH
009B 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 166
009E C200        R     CLR     g_smart_power_down_flag
                                           ; SOURCE LINE # 167
00A0 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 168
00A3         ?C0797:
                                           ; SOURCE LINE # 172
00A3 120000      R     LCALL   check_sec_cnt
                                           ; SOURCE LINE # 174
00A6 120000      R     LCALL   check_lba
                                           ; SOURCE LINE # 177
00A9 E59E              MOV     A,SFR_quick_cmd
00AB 6050              JZ      ?C0798
                                           ; SOURCE LINE # 178
                                           ; SOURCE LINE # 181
00AD C200        R     CLR     g_security_prepared
                                           ; SOURCE LINE # 182
00AF 300003      R     JNB     g_security_lock,?C0799
                                           ; SOURCE LINE # 183
                                           ; SOURCE LINE # 184
                                           ; SOURCE LINE # 185
00B2 020000      R     LJMP    ?C1012
00B5         ?C0799:
                                           ; SOURCE LINE # 188
                                           ; SOURCE LINE # 248
00B5 E59E              MOV     A,SFR_quick_cmd
00B7 30E411            JNB     ACC.4,?C0801
                                           ; SOURCE LINE # 249
                                           ; SOURCE LINE # 250
00BA E5D1              MOV     A,SFR_cmd_aux
00BC 20E506            JB      ACC.5,?C0802
00BF 120000      R     LCALL   chs_write_handle
00C2 020000      R     LJMP    ?C1009
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 168 

00C5         ?C0802:
                                           ; SOURCE LINE # 251
00C5 120000      R     LCALL   write_handler
                                           ; SOURCE LINE # 252
00C8 020000      R     LJMP    ?C1009
00CB         ?C0801:
                                           ; SOURCE LINE # 258
00CB E59E              MOV     A,SFR_quick_cmd
00CD 30E011            JNB     ACC.0,?C0805
                                           ; SOURCE LINE # 259
                                           ; SOURCE LINE # 261
00D0 E5D1              MOV     A,SFR_cmd_aux
00D2 20E506            JB      ACC.5,?C0806
00D5 120000      R     LCALL   chs_read_handle
00D8 020000      R     LJMP    ?C1009
00DB         ?C0806:
                                           ; SOURCE LINE # 262
00DB 120000      R     LCALL   read_handler
                                           ; SOURCE LINE # 264
00DE 020000      R     LJMP    ?C1009
00E1         ?C0805:
                                           ; SOURCE LINE # 265
00E1 E59E              MOV     A,SFR_quick_cmd
00E3 5460              ANL     A,#060H
00E5 6008              JZ      ?C0809
                                           ; SOURCE LINE # 266
                                           ; SOURCE LINE # 267
00E7 C200        R     CLR     g_flag_dir
                                           ; SOURCE LINE # 268
00E9 120000      R     LCALL   pio_write_handler
                                           ; SOURCE LINE # 269
00EC 020000      R     LJMP    ?C1009
00EF         ?C0809:
                                           ; SOURCE LINE # 273
00EF E59E              MOV     A,SFR_quick_cmd
00F1 5406              ANL     A,#06H
00F3 6005              JZ      ?C0804
                                           ; SOURCE LINE # 274
                                           ; SOURCE LINE # 275
00F5 D200        R     SETB    g_flag_dir
                                           ; SOURCE LINE # 276
00F7 120000      R     LCALL   pio_read_handler
                                           ; SOURCE LINE # 277
00FA         ?C0804:
                                           ; SOURCE LINE # 278
                                           ; SOURCE LINE # 279
                                           ; SOURCE LINE # 280
00FA 020000      R     LJMP    ?C1009
00FD         ?C0798:
                                           ; SOURCE LINE # 281
00FD E591              MOV     A,SFR_FIS0_0
00FF 6427              XRL     A,#027H
0101 6003              JZ      $ + 5H
0103 020000      R     LJMP    ?C0813
                                           ; SOURCE LINE # 282
                                           ; SOURCE LINE # 287
0106 E595              MOV     A,SFR_FIS0_1
0108 20E703            JB      ACC.7,$ + 6H
010B 020000      R     LJMP    ?C0814
                                           ; SOURCE LINE # 289
                                           ; SOURCE LINE # 291
010E E596              MOV     A,SFR_FIS0_2
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 169 

0110 64F4              XRL     A,#0F4H
0112 6002              JZ      ?C0815
0114 C200        R     CLR     g_security_prepared
0116         ?C0815:
                                           ; SOURCE LINE # 293
0116 E596              MOV     A,SFR_FIS0_2
0118 B43D06            CJNE    A,#03DH,?C0816
                                           ; SOURCE LINE # 294
                                           ; SOURCE LINE # 295
011B 120000      R     LCALL   write_handler
                                           ; SOURCE LINE # 296
                                           ; SOURCE LINE # 297
011E 020000      R     LJMP    ?C1014
0121         ?C0816:
                                           ; SOURCE LINE # 298
0121 E596              MOV     A,SFR_FIS0_2
0123 B4CE08            CJNE    A,#0CEH,?C0818
                                           ; SOURCE LINE # 299
                                           ; SOURCE LINE # 300
0126 C200        R     CLR     g_flag_dir
                                           ; SOURCE LINE # 301
0128 120000      R     LCALL   pio_write_handler
                                           ; SOURCE LINE # 302
012B         ?C1010:
                                           ; SOURCE LINE # 303
012B 020000      R     LJMP    ?C1014
012E         ?C0818:
                                           ; SOURCE LINE # 320
                                           ; SOURCE LINE # 321
012E 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 322
0131 AF96              MOV     R7,SFR_FIS0_2
0133 EF                MOV     A,R7
0134 120000      E     LCALL   ?C?CCASE
0137 0000        R     DW      ?C0821
0139 00                DB      00H
013A 0000        R     DW      ?C0837
013C 06                DB      06H
013D 0000        R     DW      ?C0825
013F 10                DB      010H
0140 0000        R     DW      ?C0830
0142 40                DB      040H
0143 0000        R     DW      ?C0833
0145 42                DB      042H
0146 0000        R     DW      ?C0822
0148 70                DB      070H
0149 0000        R     DW      ?C0826
014B 90                DB      090H
014C 0000        R     DW      ?C0827
014E 91                DB      091H
014F 0000        R     DW      ?C0876
0151 92                DB      092H
0152 0000        R     DW      ?C0836
0154 B0                DB      0B0H
0155 0000        R     DW      ?C0848
0157 C6                DB      0C6H
0158 0000        R     DW      ?C0846
015A E0                DB      0E0H
015B 0000        R     DW      ?C0843
015D E1                DB      0E1H
015E 0000        R     DW      ?C0845
0160 E2                DB      0E2H
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 170 

0161 0000        R     DW      ?C0842
0163 E3                DB      0E3H
0164 0000        R     DW      ?C0841
0166 E5                DB      0E5H
0167 0000        R     DW      ?C0844
0169 E6                DB      0E6H
016A 0000        R     DW      ?C0828
016C E7                DB      0E7H
016D 0000        R     DW      ?C0829
016F EA                DB      0EAH
0170 0000        R     DW      ?C0847
0172 EC                DB      0ECH
0173 0000        R     DW      ?C0851
0175 EF                DB      0EFH
0176 0000        R     DW      ?C0868
0178 F1                DB      0F1H
0179 0000        R     DW      ?C0873
017B F2                DB      0F2H
017C 0000        R     DW      ?C0857
017E F3                DB      0F3H
017F 0000        R     DW      ?C0860
0181 F4                DB      0F4H
0182 0000        R     DW      ?C0852
0184 F5                DB      0F5H
0185 0000        R     DW      ?C0863
0187 F6                DB      0F6H
0188 0000              DW      00H
018A 0000        R     DW      ?C0879
                                           ; SOURCE LINE # 323
                                           ; SOURCE LINE # 352
018C         ?C0821:
                                           ; SOURCE LINE # 353
                                           ; SOURCE LINE # 355
018C         ?C1008:
                                           ; SOURCE LINE # 356
018C 020000      R     LJMP    ?C1012
                                           ; SOURCE LINE # 357
                                           ; SOURCE LINE # 358
018F         ?C0822:
                                           ; SOURCE LINE # 359
                                           ; SOURCE LINE # 362
018F 7BFF              MOV     R3,#0FFH
0191 300006      R     JNB     g_flag_lba_err,?C0823
0194 7D04              MOV     R5,#04H
0196 7F51              MOV     R7,#051H
0198 8004              SJMP    ?C1013
019A         ?C0823:
                                           ; SOURCE LINE # 363
019A E4                CLR     A
019B FD                MOV     R5,A
019C 7F50              MOV     R7,#050H
019E         ?C1013:
019E 120000      R     LCALL   _tx_fis_34
01A1         ?C0824:
                                           ; SOURCE LINE # 364
01A1         ?C1009:
01A1         ?C1011:
                                           ; SOURCE LINE # 365
01A1 802E              SJMP    ?C1014
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 367
01A3         ?C0825:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 171 

                                           ; SOURCE LINE # 368
                                           ; SOURCE LINE # 370
                                           ; SOURCE LINE # 371
01A3 8065              SJMP    ?C1015
                                           ; SOURCE LINE # 372
                                           ; SOURCE LINE # 373
01A5         ?C0826:
                                           ; SOURCE LINE # 374
                                           ; SOURCE LINE # 375
01A5 120000      R     LCALL   init_tx_fis
                                           ; SOURCE LINE # 376
01A8 7BFF              MOV     R3,#0FFH
01AA 7D01              MOV     R5,#01H
                                           ; SOURCE LINE # 377
01AC 020000      R     LJMP    ?C1036
                                           ; SOURCE LINE # 378
                                           ; SOURCE LINE # 379
01AF         ?C0827:
                                           ; SOURCE LINE # 380
                                           ; SOURCE LINE # 383
01AF 120000      R     LCALL   init_dev_para
                                           ; SOURCE LINE # 384
01B2 020000      R     LJMP    ?C0812
                                           ; SOURCE LINE # 385
                                           ; SOURCE LINE # 386
01B5         ?C0828:
                                           ; SOURCE LINE # 387
                                           ; SOURCE LINE # 393
                                           ; SOURCE LINE # 394
                                           ; SOURCE LINE # 395
                                           ; SOURCE LINE # 396
01B5 8000              SJMP    ?C1017
                                           ; SOURCE LINE # 397
                                           ; SOURCE LINE # 398
01B7         ?C0829:
                                           ; SOURCE LINE # 399
                                           ; SOURCE LINE # 400
01B7         ?C1017:
01B7 120000      R     LCALL   flush_delay
                                           ; SOURCE LINE # 401
01BA 120000      R     LCALL   L?1066
                                           ; SOURCE LINE # 402
                                           ; SOURCE LINE # 403
01BD 8026              SJMP    ?C1020
                                           ; SOURCE LINE # 404
                                           ; SOURCE LINE # 405
01BF         ?C0830:
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 407
01BF 7BFF              MOV     R3,#0FFH
01C1 300006      R     JNB     g_flag_lba_err,?C0831
01C4 7D04              MOV     R5,#04H
01C6 7F51              MOV     R7,#051H
01C8 8004              SJMP    ?C1019
01CA         ?C0831:
                                           ; SOURCE LINE # 408
01CA E4                CLR     A
01CB FD                MOV     R5,A
01CC 7F50              MOV     R7,#050H
01CE         ?C1019:
01CE 120000      R     LCALL   _tx_fis_34
01D1         ?C0832:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 172 

                                           ; SOURCE LINE # 409
01D1         ?C1014:
01D1         ?C1018:
                                           ; SOURCE LINE # 410
01D1 8012              SJMP    ?C1020
                                           ; SOURCE LINE # 411
                                           ; SOURCE LINE # 412
01D3         ?C0833:
                                           ; SOURCE LINE # 413
                                           ; SOURCE LINE # 414
01D3 7BFF              MOV     R3,#0FFH
01D5 300006      R     JNB     g_flag_lba_err,?C0834
01D8 7D04              MOV     R5,#04H
01DA 7F51              MOV     R7,#051H
01DC 8004              SJMP    ?C1021
01DE         ?C0834:
                                           ; SOURCE LINE # 415
01DE E4                CLR     A
01DF FD                MOV     R5,A
01E0 7F50              MOV     R7,#050H
01E2         ?C1021:
01E2 120000      R     LCALL   _tx_fis_34
01E5         ?C0835:
                                           ; SOURCE LINE # 416
01E5         ?C1020:
01E5 7500FF      R     MOV     g_power_mode,#0FFH
                                           ; SOURCE LINE # 417
01E8 020000      R     LJMP    ?C0812
                                           ; SOURCE LINE # 418
                                           ; SOURCE LINE # 422
01EB         ?C0836:
                                           ; SOURCE LINE # 423
                                           ; SOURCE LINE # 425
01EB 120000      R     LCALL   smart_handler
                                           ; SOURCE LINE # 426
01EE 020000      R     LJMP    ?C0812
                                           ; SOURCE LINE # 427
                                           ; SOURCE LINE # 432
01F1         ?C0837:
                                           ; SOURCE LINE # 433
                                           ; SOURCE LINE # 438
01F1 90FF15            MOV     DPTR,#sata+015H
01F4 E0                MOVX    A,@DPTR
01F5 7013              JNZ     ?C0839
01F7 90FF14            MOV     DPTR,#sata+014H
01FA E0                MOVX    A,@DPTR
01FB D3                SETB    C
01FC 9420              SUBB    A,#020H
01FE 500A              JNC     ?C0839
0200 A3                INC     DPTR
0201 E0                MOVX    A,@DPTR
0202 700D              JNZ     ?C0838
0204 90FF14            MOV     DPTR,#sata+014H
0207 E0                MOVX    A,@DPTR
0208 7007              JNZ     ?C0838
020A         ?C0839:
                                           ; SOURCE LINE # 439
                                           ; SOURCE LINE # 440
020A         ?C1015:
020A 7BFF              MOV     R3,#0FFH
020C E4                CLR     A
020D FD                MOV     R5,A
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 173 

020E         ?C1016:
                                           ; SOURCE LINE # 441
020E 020000      R     LJMP    ?C1036
0211         ?C0838:
                                           ; SOURCE LINE # 442
0211 120000      R     LCALL   trim_handler
                                           ; SOURCE LINE # 447
0214 020000      R     LJMP    ?C0812
                                           ; SOURCE LINE # 449
                                           ; SOURCE LINE # 455
0217         ?C0841:
                                           ; SOURCE LINE # 456
                                           ; SOURCE LINE # 457
0217 90FF14            MOV     DPTR,#sata+014H
021A E500        R     MOV     A,g_power_mode
021C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 458
021D 7BFF              MOV     R3,#0FFH
021F E4                CLR     A
0220 FD                MOV     R5,A
0221         ?C1022:
                                           ; SOURCE LINE # 460
0221 020000      R     LJMP    ?C1036
                                           ; SOURCE LINE # 461
                                           ; SOURCE LINE # 462
0224         ?C0842:
                                           ; SOURCE LINE # 463
                                           ; SOURCE LINE # 464
0224 120000      R     LCALL   flush_delay
                                           ; SOURCE LINE # 465
0227 750080      R     MOV     g_power_mode,#080H
                                           ; SOURCE LINE # 466
022A 7BFF              MOV     R3,#0FFH
022C E4                CLR     A
022D FD                MOV     R5,A
022E         ?C1023:
                                           ; SOURCE LINE # 467
022E 020000      R     LJMP    ?C1036
                                           ; SOURCE LINE # 468
                                           ; SOURCE LINE # 469
0231         ?C0843:
                                           ; SOURCE LINE # 470
                                           ; SOURCE LINE # 471
0231 120000      R     LCALL   flush_delay
                                           ; SOURCE LINE # 472
0234 750080      R     MOV     g_power_mode,#080H
                                           ; SOURCE LINE # 473
0237 7BFF              MOV     R3,#0FFH
0239 E4                CLR     A
023A FD                MOV     R5,A
023B         ?C1024:
                                           ; SOURCE LINE # 474
023B 020000      R     LJMP    ?C1036
                                           ; SOURCE LINE # 475
                                           ; SOURCE LINE # 476
023E         ?C0844:
                                           ; SOURCE LINE # 477
                                           ; SOURCE LINE # 478
023E 120000      R     LCALL   flush_delay
                                           ; SOURCE LINE # 479
0241 750001      R     MOV     g_power_mode,#01H
                                           ; SOURCE LINE # 480
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 174 

0244 7BFF              MOV     R3,#0FFH
0246 E4                CLR     A
0247 FD                MOV     R5,A
0248         ?C1025:
                                           ; SOURCE LINE # 481
0248 020000      R     LJMP    ?C1036
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 483
024B         ?C0845:
                                           ; SOURCE LINE # 484
                                           ; SOURCE LINE # 485
024B 120000      R     LCALL   flush_delay
                                           ; SOURCE LINE # 486
024E E4                CLR     A
024F F500        R     MOV     g_power_mode,A
                                           ; SOURCE LINE # 487
0251 7BFF              MOV     R3,#0FFH
0253 FD                MOV     R5,A
0254         ?C1026:
                                           ; SOURCE LINE # 488
0254 020000      R     LJMP    ?C1036
                                           ; SOURCE LINE # 489
                                           ; SOURCE LINE # 490
0257         ?C0846:
                                           ; SOURCE LINE # 491
                                           ; SOURCE LINE # 492
0257 120000      R     LCALL   flush_delay
                                           ; SOURCE LINE # 493
025A E4                CLR     A
025B F500        R     MOV     g_power_mode,A
                                           ; SOURCE LINE # 494
025D 7BFF              MOV     R3,#0FFH
025F FD                MOV     R5,A
0260         ?C1027:
                                           ; SOURCE LINE # 495
0260 020000      R     LJMP    ?C1036
                                           ; SOURCE LINE # 496
                                           ; SOURCE LINE # 500
0263         ?C0847:
                                           ; SOURCE LINE # 501
                                           ; SOURCE LINE # 502
0263 120000      R     LCALL   identify_device
                                           ; SOURCE LINE # 503
0266 020000      R     LJMP    ?C0812
                                           ; SOURCE LINE # 504
                                           ; SOURCE LINE # 505
0269         ?C0848:
                                           ; SOURCE LINE # 506
                                           ; SOURCE LINE # 507
0269 90FF8C            MOV     DPTR,#sata+08CH
026C E0                MOVX    A,@DPTR
026D 7BFF              MOV     R3,#0FFH
026F B40105            CJNE    A,#01H,?C0849
                                           ; SOURCE LINE # 508
                                           ; SOURCE LINE # 514
0272 E4                CLR     A
0273 FD                MOV     R5,A
0274         ?C1028:
                                           ; SOURCE LINE # 515
0274 020000      R     LJMP    ?C1036
                                           ; SOURCE LINE # 516
0277         ?C0849:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 175 

                                           ; SOURCE LINE # 518
                                           ; SOURCE LINE # 519
                                           ; SOURCE LINE # 520
0277 020000      R     LJMP    ?C1040
                                           ; SOURCE LINE # 521
                                           ; SOURCE LINE # 522
                                           ; SOURCE LINE # 523
027A         ?C0851:
                                           ; SOURCE LINE # 524
                                           ; SOURCE LINE # 525
027A 120000      R     LCALL   set_feature
                                           ; SOURCE LINE # 527
027D 020000      R     LJMP    ?C0812
                                           ; SOURCE LINE # 528
                                           ; SOURCE LINE # 529
0280         ?C0852:
                                           ; SOURCE LINE # 530
                                           ; SOURCE LINE # 532
0280 300005      R     JNB     g_security_lock,?C0853
                                           ; SOURCE LINE # 533
                                           ; SOURCE LINE # 534
0283         ?C1012:
0283 7BFF              MOV     R3,#0FFH
0285         ?C1030:
                                           ; SOURCE LINE # 535
0285 020000      R     LJMP    ?C1040
0288         ?C0853:
                                           ; SOURCE LINE # 537
                                           ; SOURCE LINE # 538
0288 200005      R     JB      g_security_enable,?C0855
028B 750002      R     MOV     security_state_flag,#02H
028E 8003              SJMP    ?C0856
0290         ?C0855:
                                           ; SOURCE LINE # 539
0290 750006      R     MOV     security_state_flag,#06H
0293         ?C0856:
                                           ; SOURCE LINE # 540
0293 120000      R     LCALL   analyze_states
                                           ; SOURCE LINE # 541
0296 7BFF              MOV     R3,#0FFH
0298 E4                CLR     A
0299 FD                MOV     R5,A
029A         ?C1029:
                                           ; SOURCE LINE # 542
                                           ; SOURCE LINE # 546
029A 020000      R     LJMP    ?C1036
                                           ; SOURCE LINE # 547
                                           ; SOURCE LINE # 552
029D         ?C0857:
                                           ; SOURCE LINE # 553
                                           ; SOURCE LINE # 554
029D 300007      R     JNB     g_security_frozen,?C0858
                                           ; SOURCE LINE # 555
                                           ; SOURCE LINE # 556
02A0 C200        R     CLR     g_security_prepared
                                           ; SOURCE LINE # 557
02A2 7BFF              MOV     R3,#0FFH
02A4         ?C1031:
                                           ; SOURCE LINE # 558
02A4 020000      R     LJMP    ?C1040
02A7         ?C0858:
                                           ; SOURCE LINE # 560
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 176 

                                           ; SOURCE LINE # 563
02A7 7BFF              MOV     R3,#0FFH
02A9 E4                CLR     A
02AA FD                MOV     R5,A
02AB         ?C1032:
                                           ; SOURCE LINE # 564
                                           ; SOURCE LINE # 566
02AB 020000      R     LJMP    ?C1036
                                           ; SOURCE LINE # 567
                                           ; SOURCE LINE # 569
02AE         ?C0860:
                                           ; SOURCE LINE # 570
                                           ; SOURCE LINE # 571
02AE 300007      R     JNB     g_security_frozen,?C0861
                                           ; SOURCE LINE # 572
                                           ; SOURCE LINE # 573
02B1 C200        R     CLR     g_security_prepared
                                           ; SOURCE LINE # 574
02B3 7BFF              MOV     R3,#0FFH
02B5         ?C1033:
                                           ; SOURCE LINE # 575
02B5 020000      R     LJMP    ?C1040
02B8         ?C0861:
                                           ; SOURCE LINE # 577
                                           ; SOURCE LINE # 589
02B8 7BFF              MOV     R3,#0FFH
02BA E4                CLR     A
02BB FD                MOV     R5,A
02BC         ?C1034:
                                           ; SOURCE LINE # 592
                                           ; SOURCE LINE # 593
02BC 807C              SJMP    ?C1036
                                           ; SOURCE LINE # 594
                                           ; SOURCE LINE # 596
02BE         ?C0863:
                                           ; SOURCE LINE # 597
                                           ; SOURCE LINE # 599
02BE 300006      R     JNB     g_security_lock,?C0864
                                           ; SOURCE LINE # 600
                                           ; SOURCE LINE # 601
02C1 C200        R     CLR     g_security_prepared
                                           ; SOURCE LINE # 602
02C3 7BFF              MOV     R3,#0FFH
02C5         ?C1035:
                                           ; SOURCE LINE # 603
02C5 8079              SJMP    ?C1040
02C7         ?C0864:
                                           ; SOURCE LINE # 605
                                           ; SOURCE LINE # 606
02C7 120000      R     LCALL   security_dis_pwd
                                           ; SOURCE LINE # 607
02CA 30000A      R     JNB     g_security_abort,?C0866
                                           ; SOURCE LINE # 608
                                           ; SOURCE LINE # 609
02CD C200        R     CLR     g_security_abort
                                           ; SOURCE LINE # 610
02CF 7BFF              MOV     R3,#0FFH
02D1 7D04              MOV     R5,#04H
02D3 7F51              MOV     R7,#051H
                                           ; SOURCE LINE # 611
02D5 8009              SJMP    ?C1038
02D7         ?C0866:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 177 

                                           ; SOURCE LINE # 613
                                           ; SOURCE LINE # 614
02D7 750001      R     MOV     security_state_flag,#01H
                                           ; SOURCE LINE # 615
02DA 7BFF              MOV     R3,#0FFH
02DC E4                CLR     A
02DD FD                MOV     R5,A
02DE 7F50              MOV     R7,#050H
02E0         ?C1038:
02E0 120000      R     LCALL   _tx_fis_34
                                           ; SOURCE LINE # 616
02E3         ?C0867:
                                           ; SOURCE LINE # 617
                                           ; SOURCE LINE # 618
                                           ; SOURCE LINE # 619
02E3 8040              SJMP    ?C1042
                                           ; SOURCE LINE # 620
                                           ; SOURCE LINE # 622
02E5         ?C0868:
                                           ; SOURCE LINE # 623
                                           ; SOURCE LINE # 624
02E5 300006      R     JNB     g_security_frozen,?C0869
                                           ; SOURCE LINE # 625
                                           ; SOURCE LINE # 626
02E8 C200        R     CLR     g_security_prepared
                                           ; SOURCE LINE # 627
02EA 7BFF              MOV     R3,#0FFH
02EC         ?C1037:
                                           ; SOURCE LINE # 628
02EC 8052              SJMP    ?C1040
02EE         ?C0869:
                                           ; SOURCE LINE # 630
                                           ; SOURCE LINE # 631
02EE 120000      R     LCALL   security_set_pwd
                                           ; SOURCE LINE # 632
02F1 30000A      R     JNB     g_security_abort,?C0871
                                           ; SOURCE LINE # 633
                                           ; SOURCE LINE # 634
02F4 C200        R     CLR     g_security_abort
                                           ; SOURCE LINE # 635
02F6 7BFF              MOV     R3,#0FFH
02F8 7D04              MOV     R5,#04H
02FA 7F51              MOV     R7,#051H
                                           ; SOURCE LINE # 636
02FC 8006              SJMP    ?C1041
02FE         ?C0871:
                                           ; SOURCE LINE # 637
02FE 7BFF              MOV     R3,#0FFH
0300 E4                CLR     A
0301 FD                MOV     R5,A
0302 7F50              MOV     R7,#050H
0304         ?C1041:
0304 120000      R     LCALL   _tx_fis_34
0307         ?C0872:
                                           ; SOURCE LINE # 638
0307         ?C1039:
                                           ; SOURCE LINE # 639
                                           ; SOURCE LINE # 640
0307 801C              SJMP    ?C1042
                                           ; SOURCE LINE # 641
                                           ; SOURCE LINE # 643
0309         ?C0873:
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 178 

                                           ; SOURCE LINE # 644
                                           ; SOURCE LINE # 647
0309 120000      R     LCALL   security_unlock
                                           ; SOURCE LINE # 648
030C 30000A      R     JNB     g_security_abort,?C0874
                                           ; SOURCE LINE # 649
                                           ; SOURCE LINE # 650
030F C200        R     CLR     g_security_abort
                                           ; SOURCE LINE # 651
0311 7BFF              MOV     R3,#0FFH
0313 7D04              MOV     R5,#04H
0315 7F51              MOV     R7,#051H
                                           ; SOURCE LINE # 652
0317 8009              SJMP    ?C1043
0319         ?C0874:
                                           ; SOURCE LINE # 654
                                           ; SOURCE LINE # 656
0319 750005      R     MOV     security_state_flag,#05H
                                           ; SOURCE LINE # 657
031C 7BFF              MOV     R3,#0FFH
031E E4                CLR     A
031F FD                MOV     R5,A
0320 7F50              MOV     R7,#050H
0322         ?C1043:
0322 120000      R     LCALL   _tx_fis_34
                                           ; SOURCE LINE # 658
0325         ?C0875:
                                           ; SOURCE LINE # 659
0325         ?C1042:
0325 120000      R     LCALL   analyze_states
                                           ; SOURCE LINE # 660
0328 8076              SJMP    ?C0812
                                           ; SOURCE LINE # 661
                                           ; SOURCE LINE # 666
032A         ?C0876:
                                           ; SOURCE LINE # 667
                                           ; SOURCE LINE # 668
032A 90FF10            MOV     DPTR,#sata+010H
032D E0                MOVX    A,@DPTR
032E B4CC0D            CJNE    A,#0CCH,?C0877
                                           ; SOURCE LINE # 669
                                           ; SOURCE LINE # 670
0331 7F01              MOV     R7,#01H
0333 120000      R     LCALL   _intial_data_partition
                                           ; SOURCE LINE # 672
0336 7BFF              MOV     R3,#0FFH
0338 E4                CLR     A
0339 FD                MOV     R5,A
033A         ?C1036:
033A 7F50              MOV     R7,#050H
                                           ; SOURCE LINE # 673
033C 800E              SJMP    ?C1045
                                           ; SOURCE LINE # 674
033E         ?C0877:
                                           ; SOURCE LINE # 676
                                           ; SOURCE LINE # 677
033E 7BFF              MOV     R3,#0FFH
0340         ?C1040:
0340 7D04              MOV     R5,#04H
0342 7F51              MOV     R7,#051H
0344         ?C1044:
                                           ; SOURCE LINE # 678
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 179 

0344 8006              SJMP    ?C1045
                                           ; SOURCE LINE # 679
                                           ; SOURCE LINE # 680
                                           ; SOURCE LINE # 691
0346         ?C0879:
                                           ; SOURCE LINE # 692
                                           ; SOURCE LINE # 693
0346 7BFF              MOV     R3,#0FFH
0348 7D04              MOV     R5,#04H
034A 7F51              MOV     R7,#051H
034C         ?C1045:
034C 120000      R     LCALL   _tx_fis_34
                                           ; SOURCE LINE # 694
034F 804F              SJMP    ?C0812
                                           ; SOURCE LINE # 695
                                           ; SOURCE LINE # 696
                                           ; SOURCE LINE # 697
                                           ; SOURCE LINE # 698
0351         ?C0814:
                                           ; SOURCE LINE # 701
                                           ; SOURCE LINE # 705
0351 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 708
0354 E5D1              MOV     A,SFR_cmd_aux
0356 30E00E            JNB     ACC.0,?C0881
                                           ; SOURCE LINE # 709
0359         ?C0882:
                                           ; SOURCE LINE # 711
0359 90FF8F            MOV     DPTR,#sata+08FH
035C E0                MOVX    A,@DPTR
035D 20E2F9            JB      ACC.2,?C0882
0360         ?C0883:
                                           ; SOURCE LINE # 715
0360 E4                CLR     A
0361 F5D1              MOV     SFR_cmd_aux,A
                                           ; SOURCE LINE # 716
0363 7800        R     MOV     R0,#LOW g_current_fis_num
0365 A69F              MOV     @R0,SFR_fis_num
                                           ; SOURCE LINE # 718
0367         ?C0881:
                                           ; SOURCE LINE # 721
0367 E500        R     MOV     A,g_power_mode
0369 6401              XRL     A,#01H
036B 6033              JZ      ?C0812
                                           ; SOURCE LINE # 722
                                           ; SOURCE LINE # 723
036D 120000      R     LCALL   init_tx_fis
                                           ; SOURCE LINE # 726
0370 90FF34            MOV     DPTR,#sata+034H
0373 E0                MOVX    A,@DPTR
0374 440C              ORL     A,#0CH
0376 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 727
0377 7F05              MOV     R7,#05H
0379 7E00              MOV     R6,#00H
037B 120000      R     LCALL   _delay
                                           ; SOURCE LINE # 728
037E 90FF1E            MOV     DPTR,#sata+01EH
0381 E0                MOVX    A,@DPTR
0382 54FD              ANL     A,#0FDH
0384 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 729
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 180 

0385 E4                CLR     A
0386 FB                MOV     R3,A
0387 7D01              MOV     R5,#01H
0389 7F50              MOV     R7,#050H
038B 120000      R     LCALL   _tx_fis_34
                                           ; SOURCE LINE # 731
038E 7F2B              MOV     R7,#02BH
0390 120000      R     LCALL   _updata_smart
                                           ; SOURCE LINE # 732
0393 120000      R     LCALL   reset_engine
                                           ; SOURCE LINE # 734
                                           ; SOURCE LINE # 735
                                           ; SOURCE LINE # 736
0396 8008              SJMP    ?C0812
0398         ?C0813:
                                           ; SOURCE LINE # 737
0398 E591              MOV     A,SFR_FIS0_0
039A B45803            CJNE    A,#058H,?C0812
                                           ; SOURCE LINE # 738
                                           ; SOURCE LINE # 739
039D 120000      R     LCALL   bist_handler
                                           ; SOURCE LINE # 740
03A0         ?C0812:
                                           ; SOURCE LINE # 741
03A0 E4                CLR     A
03A1 F5D9              MOV     SFR_watch_dog_high,A
                                           ; SOURCE LINE # 742
                                           ; SOURCE LINE # 744
                                           ; SOURCE LINE # 751
03A3         ?C0887:
                                           ; SOURCE LINE # 753
03A3 90FF34            MOV     DPTR,#sata+034H
03A6 E0                MOVX    A,@DPTR
03A7 30E705            JNB     ACC.7,?C0888
03AA 120000      R     LCALL   smart_card_crc
03AD 8003              SJMP    ?C0889
03AF         ?C0888:
                                           ; SOURCE LINE # 754
03AF 120000      R     LCALL   smart_block_handle
03B2         ?C0889:
                                           ; SOURCE LINE # 763
03B2 E5D9              MOV     A,SFR_watch_dog_high
03B4 D3                SETB    C
03B5 9430              SUBB    A,#030H
03B7 5003              JNC     $ + 5H
03B9 020000      R     LJMP    ?C0780
03BC 200003      R     JB      g_chp_active,$ + 6H
03BF 020000      R     LJMP    ?C0780
03C2 120000      R     LCALL   chp_clock_off
                                           ; SOURCE LINE # 764
03C5 020000      R     LJMP    ?C0780
             ; FUNCTION main (END)

C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 181 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


g_security_prepared. . . . . . . . . .  ABSBIT   -----  BIT      0005H  1
security_check_chs . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
security_state_flag. . . . . . . . . .  PUBLIC   DATA   U_CHAR   0000H  1
SFR_sata_burst_cnt_l . . . . . . . . .  SFR      DATA   U_CHAR   00DEH  1
g_power_mode . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0001H  1
wait_chp_not_ready . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
reset_engine . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0009H  -----
trim_handler . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  jj . . . . . . . . . . . . . . . . .  AUTO     IDATA  UNION    0000H  2
  sram_addr. . . . . . . . . . . . . .  AUTO     IDATA  UNION    0002H  2
  addr_temp. . . . . . . . . . . . . .  AUTO     IDATA  UNION    0004H  2
  end_of_trim. . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  continue_end . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
DWORD. . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_LONG   -----  4
g_trim_flag. . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0001H  1
g_lba_add. . . . . . . . . . . . . . .  PUBLIC   DATA   ARRAY    0002H  4
SFR_quick_cmd. . . . . . . . . . . . .  SFR      DATA   U_CHAR   009EH  1
g_smart_flag_6 . . . . . . . . . . . .  ABSBIT   -----  BIT      0016H  1
g_flag_dir . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0019H  1
security_mode. . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0006H  1
SFR_cpu_reboot . . . . . . . . . . . .  SFR      DATA   U_CHAR   00F6H  1
SFR_watch_dog_high . . . . . . . . . .  SFR      DATA   U_CHAR   00D9H  1
SFR_dma_done_num_l . . . . . . . . . .  SFR      DATA   U_CHAR   00FDH  1
fetch_table_lba. . . . . . . . . . . .  PUBLIC   CODE   PROC     0004H  -----
SFR_sata_burst_base. . . . . . . . . .  SFR      DATA   U_INT    00E6H  2
TS8052_PCON. . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0087H  1
pio_read_handler . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  pio_interrput. . . . . . . . . . . .  AUTO     IDATA  U_CHAR   0000H  1
  pio_handler_err. . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
recover_lba. . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
_tx_fis_5f . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     000DH  -----
  status . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0007H  1
  error. . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0005H  1
  flag . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0003H  1
  seccnt . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0003H  1
  seccnt_ext . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0004H  1
  estatus. . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0005H  1
TS8052_SCON. . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0098H  1
_updata_smart. . . . . . . . . . . . .  PUBLIC   CODE   PROC     000DH  -----
  smart_addr . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  smart_cnt. . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  tmp. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  tmp_data . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
TS8052_TCON. . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0088H  1
smart_card_update. . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  tmp. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  card_infor0. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  card_infor1. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  card_infor2. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
  card_infor3. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0003H  1
  card_infor40 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0004H  1
  card_infor41 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0005H  1
  card_infor42 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0006H  1
  card_infor43 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0007H  1
chs_read_handle. . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  temp_sel . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  temp8. . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0006H  1
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 182 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  temp_lba_low . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  boundary_check . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  chs_read_cont. . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  chs_read_err . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  chs_read_over. . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
reset_engine_read_write. . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
SFR_lba_comp . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00BEH  1
g_security_enable. . . . . . . . . . .  ABSBIT   -----  BIT      0000H  1
lbaa . . . . . . . . . . . . . . . . .  PUBLIC   IDATA  ARRAY    0000H  6
check_lba. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
_delay . . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0004H  -----
  cnt. . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0006H  2
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   U_INT    0004H  2
size_t . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
_security_update_id. . . . . . . . . .  PUBLIC   CODE   PROC     000AH  -----
  base_addr. . . . . . . . . . . . . .  AUTO     DATA   U_INT    0000H  2
  which. . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0005H  1
  zro. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0003H  1
lba_adder. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  buf. . . . . . . . . . . . . . . . .  AUTO     IDATA  ARRAY    0000H  2
g_trim_flag_1. . . . . . . . . . . . .  ABSBIT   -----  BIT      0009H  1
SFR_dma_cntl . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00F8H  1
g_trim_flag_2. . . . . . . . . . . . .  ABSBIT   -----  BIT      000AH  1
choose_lba . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  temp_lba . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  temp_lba2. . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0006H  1
g_trim_flag_3. . . . . . . . . . . . .  ABSBIT   -----  BIT      000BH  1
g_trim_burst_abort . . . . . . . . . .  ABSBIT   -----  BIT      0008H  1
g_trim_flag_4. . . . . . . . . . . . .  ABSBIT   -----  BIT      000CH  1
g_ncq_halt . . . . . . . . . . . . . .  ABSBIT   -----  BIT      001BH  1
g_trim_flag_5. . . . . . . . . . . . .  ABSBIT   -----  BIT      000DH  1
g_smart_read_cnt . . . . . . . . . . .  PUBLIC   IDATA  U_CHAR   0006H  1
flush_delay. . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
g_tmp_addr . . . . . . . . . . . . . .  PUBLIC   IDATA  U_INT    0007H  2
g_trim_flag_6. . . . . . . . . . . . .  ABSBIT   -----  BIT      000EH  1
g_enable_write_cache . . . . . . . . .  ABSBIT   -----  BIT      001FH  1
g_trim_flag_7. . . . . . . . . . . . .  ABSBIT   -----  BIT      000FH  1
g_smart_log_find . . . . . . . . . . .  ABSBIT   -----  BIT      0014H  1
g_tmp. . . . . . . . . . . . . . . . .  PUBLIC   IDATA  ARRAY    0009H  16
g_smart_power_down_flag. . . . . . . .  ABSBIT   -----  BIT      0027H  1
pio_write_handler. . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  pio_interrput. . . . . . . . . . . .  AUTO     IDATA  U_CHAR   0000H  1
  pio_handler_err. . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
g_smart_test_status. . . . . . . . . .  PUBLIC   IDATA  U_CHAR   0019H  1
SFR_smart_cnt. . . . . . . . . . . . .  SFR      DATA   U_INT    00BCH  2
chs_write_handle . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  chs_write_cont . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  chs_write_err. . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  chs_write_over . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
set_feature. . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  tmp. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
SFR_sata_burst_cntl. . . . . . . . . .  SFR      DATA   U_CHAR   00E8H  1
g_flag_lba_err . . . . . . . . . . . .  ABSBIT   -----  BIT      0018H  1
g_ncq_cont . . . . . . . . . . . . . .  ABSBIT   -----  BIT      001AH  1
SFR_dma_max_num_h. . . . . . . . . . .  SFR      DATA   U_CHAR   00FCH  1
_GPIO_security_cmd . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  mode . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0001H  1
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 183 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  tmp_value. . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
GPIO_security_init . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
g_current_fis_num. . . . . . . . . . .  PUBLIC   IDATA  U_CHAR   001AH  1
main . . . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
SFR_dma_max_num_l. . . . . . . . . . .  SFR      DATA   U_CHAR   00FBH  1
trim_addr_offset . . . . . . . . . . .  PUBLIC   IDATA  UNION    001BH  4
g_smart_write_cnt. . . . . . . . . . .  PUBLIC   IDATA  U_CHAR   001FH  1
init_tx_fis. . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
g_smart_operation. . . . . . . . . . .  ABSBIT   -----  BIT      0010H  1
read_sec_cnt_h . . . . . . . . . . . .  PUBLIC   IDATA  U_CHAR   0020H  1
sata . . . . . . . . . . . . . . . . .  PUBLIC   XDATA  STRUCT   FF00H  248
g_sec_cnt. . . . . . . . . . . . . . .  PUBLIC   DATA   UNION    0007H  2
u8 . . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
BOOL . . . . . . . . . . . . . . . . .  TYPEDEF  -----  INT      -----  2
check_pwd. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  temp_data2 . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  temp_data3 . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  temp_data4 . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
  temp_data5 . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0003H  1
  temp_data6 . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0004H  1
  temp_data7 . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0005H  1
  temp_data8 . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0006H  1
  temp_data9 . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0007H  1
  temp_data10. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0008H  1
  temp_data11. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0009H  1
  temp_data12. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   000AH  1
  temp_data13. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   000BH  1
  temp_data14. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   000CH  1
  temp_data15. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   000DH  1
  temp_data16. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   000EH  1
  temp_data17. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   000FH  1
  temp_data18. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0010H  1
  temp_data19. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0011H  1
  temp_data20. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0012H  1
  temp_data21. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0013H  1
  temp_data22. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0014H  1
  temp_data23. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0015H  1
  temp_data24. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0016H  1
  temp_data25. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0017H  1
  temp_data26. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0018H  1
  temp_data27. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0019H  1
  temp_data28. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   001AH  1
  temp_data29. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   001BH  1
  temp_data30. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   001CH  1
  temp_data31. . . . . . . . . . . . .  AUTO     DATA   U_CHAR   001DH  1
  check_over . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
g_security_HrM . . . . . . . . . . . .  ABSBIT   -----  BIT      0003H  1
read_sec_cnt_l . . . . . . . . . . . .  PUBLIC   IDATA  U_INT    0021H  2
uart_int_handler . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  uart_cmd_byte. . . . . . . . . . . .  * REG *  DATA   U_CHAR   0002H  1
  uart_b3. . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0003H  1
  uart_b2. . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0004H  1
  uart_b1. . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0001H  1
  uart_b0. . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  reg_addr . . . . . . . . . . . . . .  AUTO     DATA   UNION    0000H  2
_uart_send_R1. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  tx_data. . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 184 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


u32_t. . . . . . . . . . . . . . . . .  TYPEDEF  -----  UNION    -----  4
  Word . . . . . . . . . . . . . . . .  MEMBER   -----  ARRAY    0000H  4
  Number . . . . . . . . . . . . . . .  MEMBER   -----  U_LONG   0000H  4
  No . . . . . . . . . . . . . . . . .  MEMBER   -----  ARRAY    0000H  4
trim_check_lba . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  AUTO     IDATA  U_CHAR   0000H  1
u16_t. . . . . . . . . . . . . . . . .  TYPEDEF  -----  UNION    -----  2
  byte . . . . . . . . . . . . . . . .  MEMBER   -----  STRUCT   0000H  2
  word . . . . . . . . . . . . . . . .  MEMBER   -----  U_INT    0000H  2
_security_cmd_info_write . . . . . . .  PUBLIC   CODE   PROC     0004H  -----
  value. . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  addr . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0005H  1
SFR_ext_sram_data. . . . . . . . . . .  SFR      DATA   U_CHAR   00F3H  1
SFR_cmd_aux. . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D1H  1
SFR_SATA_done_num. . . . . . . . . . .  SFR      DATA   U_INT    00CEH  2
g_cont_en. . . . . . . . . . . . . . .  ABSBIT   -----  BIT      001DH  1
smart_status . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
SFR_ext_sram_addr. . . . . . . . . . .  SFR      DATA   U_INT    00F1H  2
SFR_sata_burst_cnt . . . . . . . . . .  SFR      DATA   U_INT    00DEH  2
lba_shift_right. . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
u64_t. . . . . . . . . . . . . . . . .  TYPEDEF  -----  UNION    -----  8
  word . . . . . . . . . . . . . . . .  MEMBER   -----  ARRAY    0000H  8
  No . . . . . . . . . . . . . . . . .  MEMBER   -----  ARRAY    0000H  8
BYTE . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_CHAR   -----  1
identify_device. . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   U_INT    0006H  2
  tmp. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  tmp1 . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
check_power_loss . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
_init. . . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  mode . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  ii . . . . . . . . . . . . . . . . .  AUTO     DATA   U_INT    0000H  2
  start_phy. . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
g_smart_offline_flag . . . . . . . . .  ABSBIT   -----  BIT      0012H  1
g_TJ_ZSD . . . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0009H  1
g_tmp_tag. . . . . . . . . . . . . . .  PUBLIC   IDATA  U_CHAR   0023H  1
self_test_routine. . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  tmp. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  self_test_over . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
write_sec_cnt_h. . . . . . . . . . . .  PUBLIC   IDATA  U_CHAR   0024H  1
sata_burst_abort . . . . . . . . . . .  ABSBIT   -----  BIT      00EAH  1
dma_done . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00F8H  1
g_smart_nfirst_handle. . . . . . . . .  ABSBIT   -----  BIT      0020H  1
WORD . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
g_security_frozen. . . . . . . . . . .  ABSBIT   -----  BIT      0002H  1
TS8052_IPL . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B8H  1
write_sec_cnt_l. . . . . . . . . . . .  PUBLIC   IDATA  U_INT    0025H  2
g_smart_handle_flag. . . . . . . . . .  PUBLIC   DATA   U_CHAR   0004H  1
_sata_burst. . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0003H  -----
  dir. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  cnt. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0005H  1
int0_handler . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
TS8052_T2CON . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C8H  1
g_security_abort . . . . . . . . . . .  ABSBIT   -----  BIT      0007H  1
smart_card_crc . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  chp_sel. . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  tmp. . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 185 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  block_infor0 . . . . . . . . . . . .  AUTO     IDATA  U_CHAR   0000H  1
  block_infor1 . . . . . . . . . . . .  AUTO     IDATA  U_CHAR   0001H  1
  block_infor2 . . . . . . . . . . . .  AUTO     IDATA  U_CHAR   0002H  1
  block_infor3 . . . . . . . . . . . .  AUTO     IDATA  U_CHAR   0003H  1
  check_loop . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  handle . . . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  end_loop . . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
g_smart_read_handle. . . . . . . . . .  ABSBIT   -----  BIT      0021H  1
int1_handler . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  tmp_flag . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
g_security_flag. . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0000H  1
g_smart_test_int . . . . . . . . . . .  ABSBIT   -----  BIT      0015H  1
save_lba . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
SFR_fis_num. . . . . . . . . . . . . .  SFR      DATA   U_CHAR   009FH  1
g_security_cnt_expired . . . . . . . .  ABSBIT   -----  BIT      0004H  1
_intial_data_partition . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  all_partial. . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  ii . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
g_SYS_YD . . . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   000AH  1
check_sec_cnt. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
sata_burst_done. . . . . . . . . . . .  ABSBIT   -----  BIT      00E8H  1
SFR_spi_set. . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00ABH  1
TS8052_CKCON . . . . . . . . . . . . .  SFR      DATA   U_CHAR   008EH  1
chp_clock_off. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
SFR_ext_sram_cntl. . . . . . . . . . .  SFR      DATA   U_CHAR   00F4H  1
dma_cont . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      00FDH  1
security_dis_pwd . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
security_initial . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
wait_chp_ready . . . . . . . . . . . .  PUBLIC   CODE   PROC     0006H  -----
_smart_log . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  chp_cmd. . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  smart_log_over . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
smart_read_cnt . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  tmp. . . . . . . . . . . . . . . . .  * REG *  DATA   U_INT    0006H  2
g_smart_block_cnt_h. . . . . . . . . .  PUBLIC   IDATA  U_CHAR   0027H  1
_chp_burst . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0011H  -----
  cmd. . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  cnt. . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  base_addr. . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
g_security_lock. . . . . . . . . . . .  ABSBIT   -----  BIT      0001H  1
g_smart_write_handle . . . . . . . . .  ABSBIT   -----  BIT      0022H  1
GPIO_old_value . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   000BH  1
trim_burst . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  block_num. . . . . . . . . . . . . .  AUTO     DATA   UNION    0000H  4
cmp_lba. . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  discontinue. . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
g_smart_handle_flag_3. . . . . . . . .  ABSBIT   -----  BIT      0023H  1
g_smart_handle_flag_4. . . . . . . . .  ABSBIT   -----  BIT      0024H  1
SFR_spi_io . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00ACH  1
_delay_ms. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0004H  -----
  cnt. . . . . . . . . . . . . . . . .  * REG *  DATA   INT      0002H  2
  i. . . . . . . . . . . . . . . . . .  * REG *  DATA   U_INT    0082H  2
TS8052_PSW . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D0H  1
g_smart_block_cnt_l. . . . . . . . . .  PUBLIC   IDATA  U_CHAR   0028H  1
g_smart_handle_flag_5. . . . . . . . .  ABSBIT   -----  BIT      0025H  1
gen_check_sum. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0003H  -----
  temp . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 186 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  sum. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0006H  1
  jj . . . . . . . . . . . . . . . . .  * REG *  DATA   U_INT    0004H  2
g_fis_tx_abort . . . . . . . . . . . .  ABSBIT   -----  BIT      001CH  1
g_smart_handle_flag_6. . . . . . . . .  ABSBIT   -----  BIT      0026H  1
sum. . . . . . . . . . . . . . . . . .  PUBLIC   IDATA  UNION    0029H  4
sata_burst_cont. . . . . . . . . . . .  ABSBIT   -----  BIT      00EDH  1
_tx_fis_34 . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0006H  -----
  status . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  error. . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0005H  1
  flag . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0003H  1
TS8052_P0. . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0080H  1
security_set_pwd . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
SFR_CHP_rdy. . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D6H  1
TS8052_P1. . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0090H  1
soft_lba_add . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  tmp_data . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
SFR_dma_max_num. . . . . . . . . . . .  SFR      DATA   U_INT    00FBH  2
TS8052_P2. . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A0H  1
u32. . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_LONG   -----  4
TS8052_P3. . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B0H  1
_updata_smart_n. . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  smart_addr . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  smart_cnt. . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  tmp. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  tmp_data . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
SFR_CHP_en . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D7H  1
u16. . . . . . . . . . . . . . . . . .  TYPEDEF  -----  U_INT    -----  2
fetch_block_border . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  addr . . . . . . . . . . . . . . . .  AUTO     DATA   UNION    0000H  2
  tmp. . . . . . . . . . . . . . . . .  AUTO     IDATA  UNION    0000H  4
  buf. . . . . . . . . . . . . . . . .  AUTO     IDATA  UNION    0004H  4
init_dev_para. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  tmp8 . . . . . . . . . . . . . . . .  AUTO     IDATA  U_CHAR   0000H  1
  init_dev_para_err. . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
g_security_pass. . . . . . . . . . . .  ABSBIT   -----  BIT      0006H  1
smart_write_cnt. . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  tmp. . . . . . . . . . . . . . . . .  * REG *  DATA   U_INT    0006H  2
send_trim_cmd. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0013H  -----
  sec_cnt. . . . . . . . . . . . . . .  AUTO     DATA   UNION    0000H  4
  j. . . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0004H  1
  block_size . . . . . . . . . . . . .  AUTO     IDATA  UNION    0000H  4
read_handler . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  temp_sel . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0002H  1
  temp8. . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  temp_lba_low . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0001H  1
  boundary_check . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  read_cont. . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  read_handler_err . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  read_handler_over. . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
uart_show. . . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   000CH  1
_tx_fis_A1 . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  status . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  error. . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0005H  1
  flag . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0003H  1
g_flag . . . . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0003H  1
reg_type . . . . . . . . . . . . . . .  TYPEDEF  -----  STRUCT   -----  248
  flag_0 . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0000H  1
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 187 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  FIS_error. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0001H  1
  RESV002. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0002H  1
  RESV003. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0003H  1
  FIS_estatus. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0004H  1
  FIS_pio_xfer_cnt_l . . . . . . . . .  MEMBER   -----  U_CHAR   0005H  1
  FIS_pio_xfer_cnt_h . . . . . . . . .  MEMBER   -----  U_CHAR   0006H  1
  RESV007. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0007H  1
  RESV008. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0008H  1
  RESV009. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0009H  1
  RESV00A. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   000AH  1
  FIS_status . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   000BH  1
  RESV00CDEF . . . . . . . . . . . . .  MEMBER   -----  U_LONG   000CH  4
  FIS_feature. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0010H  1
  FIS_feature_ext. . . . . . . . . . .  MEMBER   -----  U_CHAR   0011H  1
  FIS_device . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0012H  1
  FIS_pm . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0013H  1
  FIS_seccnt . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0014H  1
  FIS_seccnt_ext . . . . . . . . . . .  MEMBER   -----  U_CHAR   0015H  1
  FIS_lba_low. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0016H  1
  FIS_lba_low_ext. . . . . . . . . . .  MEMBER   -----  U_CHAR   0017H  1
  FIS_lba_mid. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0018H  1
  FIS_lba_mid_ext. . . . . . . . . . .  MEMBER   -----  U_CHAR   0019H  1
  FIS_lba_high . . . . . . . . . . . .  MEMBER   -----  U_CHAR   001AH  1
  FIS_lba_high_ext . . . . . . . . . .  MEMBER   -----  U_CHAR   001BH  1
  RESV01C. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   001CH  1
  RESV01D. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   001DH  1
  ncq_cntl . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   001EH  1
  quick_sactive. . . . . . . . . . . .  MEMBER   -----  U_CHAR   001FH  1
  phy_cntl . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0020H  1
  RESV021. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0021H  1
  RESV022. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0022H  1
  RESV023. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0023H  1
  RESV024. . . . . . . . . . . . . . .  MEMBER   -----  U_LONG   0024H  4
  RESV028. . . . . . . . . . . . . . .  MEMBER   -----  U_LONG   0028H  4
  RESV02C. . . . . . . . . . . . . . .  MEMBER   -----  U_LONG   002CH  4
  RESV030. . . . . . . . . . . . . . .  MEMBER   -----  U_LONG   0030H  4
  rst_cntl . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0034H  1
  int1_status. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0035H  1
  int1_en. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0036H  1
  FIS_type . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0037H  1
  bist_mode. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0038H  1
  RESV039. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0039H  1
  RESV03A. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   003AH  1
  RESV03B. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   003BH  1
  power_cntl . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   003CH  1
  int2_status. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   003DH  1
  int2_en. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   003EH  1
  RESV03F. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   003FH  1
  FIS_content_1_0. . . . . . . . . . .  MEMBER   -----  U_CHAR   0040H  1
  FIS_content_1_1. . . . . . . . . . .  MEMBER   -----  U_CHAR   0041H  1
  FIS_content_1_2. . . . . . . . . . .  MEMBER   -----  U_CHAR   0042H  1
  FIS_content_1_3. . . . . . . . . . .  MEMBER   -----  U_CHAR   0043H  1
  FIS_content_2_0. . . . . . . . . . .  MEMBER   -----  U_CHAR   0044H  1
  FIS_content_2_1. . . . . . . . . . .  MEMBER   -----  U_CHAR   0045H  1
  FIS_content_2_2. . . . . . . . . . .  MEMBER   -----  U_CHAR   0046H  1
  FIS_content_2_3. . . . . . . . . . .  MEMBER   -----  U_CHAR   0047H  1
  FIS_content_4_0. . . . . . . . . . .  MEMBER   -----  U_CHAR   0048H  1
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 188 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  FIS_content_4_1. . . . . . . . . . .  MEMBER   -----  U_CHAR   0049H  1
  FIS_content_4_2. . . . . . . . . . .  MEMBER   -----  U_CHAR   004AH  1
  FIS_content_4_3. . . . . . . . . . .  MEMBER   -----  U_CHAR   004BH  1
  FIS_content_5_0. . . . . . . . . . .  MEMBER   -----  U_CHAR   004CH  1
  FIS_content_5_1. . . . . . . . . . .  MEMBER   -----  U_CHAR   004DH  1
  FIS_content_5_2. . . . . . . . . . .  MEMBER   -----  U_CHAR   004EH  1
  FIS_content_5_3. . . . . . . . . . .  MEMBER   -----  U_CHAR   004FH  1
  RESV050. . . . . . . . . . . . . . .  MEMBER   -----  U_LONG   0050H  4
  ope_a. . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0054H  1
  ope_b. . . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0055H  1
  auto_power_set . . . . . . . . . . .  MEMBER   -----  U_CHAR   0056H  1
  CHP_stripe_h . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0057H  1
  sactive_0. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0058H  1
  sactive_1. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0059H  1
  sactive_2. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   005AH  1
  sactive_3. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   005BH  1
  CHP0_status_high . . . . . . . . . .  MEMBER   -----  U_CHAR   005CH  1
  CHP1_status_high . . . . . . . . . .  MEMBER   -----  U_CHAR   005DH  1
  CHP2_status_high . . . . . . . . . .  MEMBER   -----  U_CHAR   005EH  1
  CHP3_status_high . . . . . . . . . .  MEMBER   -----  U_CHAR   005FH  1
  phy_set_0. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0060H  1
  phy_set_1. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0061H  1
  phy_set_2. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0062H  1
  phy_set_3. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0063H  1
  phy_set_4. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0064H  1
  phy_set_5. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0065H  1
  phy_set_6. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0066H  1
  phy_set_7. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0067H  1
  phy_set_8. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0068H  1
  phy_set_9. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0069H  1
  RESV06A. . . . . . . . . . . . . . .  MEMBER   -----  U_INT    006AH  2
  RESV06C. . . . . . . . . . . . . . .  MEMBER   -----  U_LONG   006CH  4
  CHP0_status. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0070H  1
  CHP1_status. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0071H  1
  CHP2_status. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0072H  1
  CHP3_status. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0073H  1
  CHP4_status. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0074H  1
  RESV076. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0075H  1
  CHP4_status_high . . . . . . . . . .  MEMBER   -----  U_CHAR   0076H  1
  RESV077. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0077H  1
  SUP_LBA0 . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0078H  1
  SUP_LBA1 . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   0079H  1
  SUP_LBA2 . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   007AH  1
  SUP_LBA3 . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   007BH  1
  SUP_LBA4 . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   007CH  1
  SUP_LBA5 . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   007DH  1
  CHP_cmd. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   007EH  1
  CHP_stripe . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   007FH  1
  fis_rcv_content. . . . . . . . . . .  MEMBER   -----  ARRAY    0080H  32
  COMRESET_LOW . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00A0H  1
  COMRESET_HIGH. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00A1H  1
  COMWAKE_LOW. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00A2H  1
  COMWAKE_HIGH . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00A3H  1
  RESV0A4. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00A4H  1
  RESV0A5. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00A5H  1
  RESV0A6. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00A6H  1
  RESV0A7. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00A7H  1
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 189 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  fifo_base_sata . . . . . . . . . . .  MEMBER   -----  U_INT    00A8H  2
  fifo_base_chp. . . . . . . . . . . .  MEMBER   -----  U_INT    00AAH  2
  counter_low. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00ACH  1
  counter_mid. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00ADH  1
  counter_high . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00AEH  1
  force_CHP. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00AFH  1
  RESV0B0. . . . . . . . . . . . . . .  MEMBER   -----  U_LONG   00B0H  4
  RESV0B4. . . . . . . . . . . . . . .  MEMBER   -----  U_LONG   00B4H  4
  watch_dog_cnt_high . . . . . . . . .  MEMBER   -----  U_CHAR   00B8H  1
  watch_dog_cnt_mid. . . . . . . . . .  MEMBER   -----  U_CHAR   00B9H  1
  watch_dog_cnt_low. . . . . . . . . .  MEMBER   -----  U_CHAR   00BAH  1
  watch_dog_low. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00BBH  1
  watch_dog_cntl . . . . . . . . . . .  MEMBER   -----  U_CHAR   00BCH  1
  RESV0BD. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00BDH  1
  REGULATOR_SETTING_l. . . . . . . . .  MEMBER   -----  U_CHAR   00BEH  1
  REGULATOR_SETTING_h. . . . . . . . .  MEMBER   -----  U_CHAR   00BFH  1
  max_lba. . . . . . . . . . . . . . .  MEMBER   -----  ARRAY    00C0H  6
  chp_bus_sel. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00C6H  1
  ext_int1_status. . . . . . . . . . .  MEMBER   -----  U_CHAR   00C7H  1
  RESV0C8. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00C8H  1
  RESV0C9. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00C9H  1
  RESV0CA. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00CAH  1
  RESV0CB. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00CBH  1
  CHP_clock_set. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00CCH  1
  CHP_cmd_sel. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00CDH  1
  link_tune. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00CEH  1
  oob_tune . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00CFH  1
  uart_config. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00D0H  1
  uart_int . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00D1H  1
  uart_status. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00D2H  1
  RESV0D3. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00D3H  1
  uart_baudrate_low. . . . . . . . . .  MEMBER   -----  U_CHAR   00D4H  1
  uart_baudrate_high . . . . . . . . .  MEMBER   -----  U_CHAR   00D5H  1
  RESV0D6. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00D6H  1
  RESV0D7. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00D7H  1
  uart_rx_stat0. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00D8H  1
  uart_rx_stat1. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00D9H  1
  uart_rx_stat2. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00DAH  1
  uart_rx_stat3. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00DBH  1
  uart_tx_stat0. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00DCH  1
  uart_tx_stat1. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00DDH  1
  uart_tx_stat2. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00DEH  1
  uart_tx_stat3. . . . . . . . . . . .  MEMBER   -----  U_CHAR   00DFH  1
  uart_tx_data . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00E0H  1
  uart_rx_data . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00E1H  1
  uart_rx_thresh_low . . . . . . . . .  MEMBER   -----  U_CHAR   00E2H  1
  uart_rx_thresh_high. . . . . . . . .  MEMBER   -----  U_CHAR   00E3H  1
  uart_tx_thresh_low . . . . . . . . .  MEMBER   -----  U_CHAR   00E4H  1
  uart_tx_thresh_high. . . . . . . . .  MEMBER   -----  U_CHAR   00E5H  1
  RESV0E6. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00E6H  1
  RESV0E7. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00E7H  1
  RESV0E8. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00E8H  1
  RESV0E9. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00E9H  1
  RESV0EA. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00EAH  1
  RESV0EB. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00EBH  1
  RESV0EC. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00ECH  1
  RESV0ED. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00EDH  1
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 190 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


  RESV0EE. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00EEH  1
  RESV0EF. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00EFH  1
  led0_blink . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00F0H  1
  led0_cntl. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00F1H  1
  led1_tunit . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00F2H  1
  led1_period. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00F3H  1
  led1_bright. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00F4H  1
  led1_repeat. . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00F5H  1
  led1_cntl. . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00F6H  1
  RESV0F7. . . . . . . . . . . . . . .  MEMBER   -----  U_CHAR   00F7H  1
g_chp_active . . . . . . . . . . . . .  ABSBIT   -----  BIT      001EH  1
temp_data0 . . . . . . . . . . . . . .  PUBLIC   IDATA  U_CHAR   002DH  1
temp_data1 . . . . . . . . . . . . . .  PUBLIC   IDATA  U_CHAR   002EH  1
temp_id. . . . . . . . . . . . . . . .  PUBLIC   IDATA  U_CHAR   002FH  1
TS8052_IE. . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A8H  1
i. . . . . . . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   000DH  1
smart_block_handle . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  chp_sel. . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  block_infor0 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  block_infor1 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
  block_infor2 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0003H  1
  block_infor3 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0004H  1
  block_infor4 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0005H  1
  block_infor5 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0006H  1
  block_infor6 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0007H  1
  check_loop . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  handle . . . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  end_loop . . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
_smart_data_handler. . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  base_sec . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  sec_cnt. . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  chp_cmd. . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
  pio_interrput. . . . . . . . . . . .  AUTO     DATA   U_CHAR   0003H  1
  cur_cnt. . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0004H  1
chp_clock_on . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
wchar_t. . . . . . . . . . . . . . . .  TYPEDEF  -----  CHAR     -----  1
smart_handler. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  smart_handler_err. . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
g_smart_abort. . . . . . . . . . . . .  ABSBIT   -----  BIT      0017H  1
g_smart_read_flag. . . . . . . . . . .  ABSBIT   -----  BIT      0013H  1
security_unlock. . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
smart_erase_handle . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  tmp. . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0000H  1
  chp_sel. . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0001H  1
  erase_infor0 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0002H  1
  erase_infor1 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0003H  1
  erase_infor2 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0004H  1
  erase_infor3 . . . . . . . . . . . .  AUTO     DATA   U_CHAR   0005H  1
  pe . . . . . . . . . . . . . . . . .  AUTO     DATA   UNION    0006H  4
  erase. . . . . . . . . . . . . . . .  AUTO     DATA   UNION    000AH  4
  cnt. . . . . . . . . . . . . . . . .  AUTO     DATA   U_CHAR   000EH  1
  handle . . . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  end_handle . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
g_smart_flag . . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   0002H  1
SFR_FIS0_0 . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0091H  1
security_check_lba . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
SFR_FIS0_1 . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0095H  1
C51 COMPILER V9.00   SHARK                                                                 10/30/2013 09:41:00 PAGE 191 

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


analyze_states . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
security_erase . . . . . . . . . . . .  PUBLIC   DATA   U_CHAR   000EH  1
write_handler. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  write_cont . . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  write_handler_err. . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
  write_handler_over . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
SFR_FIS0_2 . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0096H  1
smart_offline. . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
chs_cmp_lba. . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  discontinue. . . . . . . . . . . . .  LABEL    CODE   LABEL    -----  -----
va_list. . . . . . . . . . . . . . . .  TYPEDEF  -----  PTR      -----  3
bist_handler . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
g_lba. . . . . . . . . . . . . . . . .  PUBLIC   DATA   ARRAY    000FH  6
SFR_smart_load . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C9H  1
SFR_SATA_done_num_h. . . . . . . . . .  SFR      DATA   U_CHAR   00E5H  1
g_smart_attribute_autosave . . . . . .  ABSBIT   -----  BIT      0011H  1
SFR_sata_burst_cnt_h . . . . . . . . .  SFR      DATA   U_CHAR   00DFH  1
g_cap. . . . . . . . . . . . . . . . .  PUBLIC   IDATA  ARRAY    0030H  16
start_address. . . . . . . . . . . . .  PUBLIC   IDATA  UNION    0040H  8
SFR_dma_base . . . . . . . . . . . . .  SFR      DATA   U_INT    00F9H  2


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  11867    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     26     106
   IDATA SIZE       =     72      28
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
